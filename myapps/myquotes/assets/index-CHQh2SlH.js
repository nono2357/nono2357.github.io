var Ll=Object.defineProperty;var Dl=(t,e,r)=>e in t?Ll(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Le=(t,e,r)=>Dl(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}})();const vn=crypto,io=t=>t instanceof CryptoKey,dr=new TextEncoder,mn=new TextDecoder;function cu(...t){const e=t.reduce((o,{length:c})=>o+c,0),r=new Uint8Array(e);let n=0;for(const o of t)r.set(o,n),n+=o.length;return r}const Ul=t=>{let e=t;typeof e=="string"&&(e=dr.encode(e));const r=32768,n=[];for(let o=0;o<e.length;o+=r)n.push(String.fromCharCode.apply(null,e.subarray(o,o+r)));return btoa(n.join(""))},gi=t=>Ul(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Ol=t=>{const e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r},qr=t=>{let e=t;e instanceof Uint8Array&&(e=mn.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Ol(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class Lt extends Error{constructor(e,r){var n;super(e,r),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(n=Error.captureStackTrace)==null||n.call(Error,this,this.constructor)}}Lt.code="ERR_JOSE_GENERIC";class nr extends Lt{constructor(e,r,n="unspecified",o="unspecified"){super(e,{cause:{claim:n,reason:o,payload:r}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=n,this.reason=o,this.payload=r}}nr.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class Rs extends Lt{constructor(e,r,n="unspecified",o="unspecified"){super(e,{cause:{claim:n,reason:o,payload:r}}),this.code="ERR_JWT_EXPIRED",this.claim=n,this.reason=o,this.payload=r}}Rs.code="ERR_JWT_EXPIRED";class lu extends Lt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}lu.code="ERR_JOSE_ALG_NOT_ALLOWED";class Wt extends Lt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}Wt.code="ERR_JOSE_NOT_SUPPORTED";class Bl extends Lt{constructor(e="decryption operation failed",r){super(e,r),this.code="ERR_JWE_DECRYPTION_FAILED"}}Bl.code="ERR_JWE_DECRYPTION_FAILED";class jl extends Lt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}jl.code="ERR_JWE_INVALID";class dt extends Lt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}dt.code="ERR_JWS_INVALID";class Pi extends Lt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}Pi.code="ERR_JWT_INVALID";class Ml extends Lt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}Ml.code="ERR_JWK_INVALID";class so extends Lt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}so.code="ERR_JWKS_INVALID";class oo extends Lt{constructor(e="no applicable key found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_NO_MATCHING_KEY"}}oo.code="ERR_JWKS_NO_MATCHING_KEY";class du extends Lt{constructor(e="multiple matching keys found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}du.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class fu extends Lt{constructor(e="request timed out",r){super(e,r),this.code="ERR_JWKS_TIMEOUT"}}fu.code="ERR_JWKS_TIMEOUT";class hu extends Lt{constructor(e="signature verification failed",r){super(e,r),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}hu.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";function or(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function Un(t,e){return t.name===e}function Xi(t){return parseInt(t.name.slice(4),10)}function Hl(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function $l(t,e){if(e.length&&!e.some(r=>t.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(e.length>2){const n=e.pop();r+=`one of ${e.join(", ")}, or ${n}.`}else e.length===2?r+=`one of ${e[0]} or ${e[1]}.`:r+=`${e[0]}.`;throw new TypeError(r)}}function Kl(t,e,...r){switch(e){case"HS256":case"HS384":case"HS512":{if(!Un(t.algorithm,"HMAC"))throw or("HMAC");const n=parseInt(e.slice(2),10);if(Xi(t.algorithm.hash)!==n)throw or(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Un(t.algorithm,"RSASSA-PKCS1-v1_5"))throw or("RSASSA-PKCS1-v1_5");const n=parseInt(e.slice(2),10);if(Xi(t.algorithm.hash)!==n)throw or(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Un(t.algorithm,"RSA-PSS"))throw or("RSA-PSS");const n=parseInt(e.slice(2),10);if(Xi(t.algorithm.hash)!==n)throw or(`SHA-${n}`,"algorithm.hash");break}case"EdDSA":{if(t.algorithm.name!=="Ed25519"&&t.algorithm.name!=="Ed448")throw or("Ed25519 or Ed448");break}case"Ed25519":{if(!Un(t.algorithm,"Ed25519"))throw or("Ed25519");break}case"ES256":case"ES384":case"ES512":{if(!Un(t.algorithm,"ECDSA"))throw or("ECDSA");const n=Hl(e);if(t.algorithm.namedCurve!==n)throw or(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}$l(t,r)}function pu(t,e,...r){var n;if(r=r.filter(Boolean),r.length>2){const o=r.pop();t+=`one of type ${r.join(", ")}, or ${o}.`}else r.length===2?t+=`one of type ${r[0]} or ${r[1]}.`:t+=`of type ${r[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(n=e.constructor)!=null&&n.name&&(t+=` Received an instance of ${e.constructor.name}`),t}const Ps=(t,...e)=>pu("Key must be ",t,...e);function gu(t,e,...r){return pu(`Key for the ${t} algorithm must be `,e,...r)}const yu=t=>io(t)?!0:(t==null?void 0:t[Symbol.toStringTag])==="KeyObject",Yn=["CryptoKey"],mu=(...t)=>{const e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let r;for(const n of e){const o=Object.keys(n);if(!r||r.size===0){r=new Set(o);continue}for(const c of o){if(r.has(c))return!1;r.add(c)}}return!0};function Wl(t){return typeof t=="object"&&t!==null}function wr(t){if(!Wl(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}const _u=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){const{modulusLength:r}=e.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}};function Sn(t){return wr(t)&&typeof t.kty=="string"}function Vl(t){return t.kty!=="oct"&&typeof t.d=="string"}function ql(t){return t.kty!=="oct"&&typeof t.d>"u"}function Jl(t){return Sn(t)&&t.kty==="oct"&&typeof t.k=="string"}function zl(t){let e,r;switch(t.kty){case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},r=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Wt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},r=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},r=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new Wt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(t.alg){case"Ed25519":e={name:"Ed25519"},r=t.d?["sign"]:["verify"];break;case"EdDSA":e={name:t.crv},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new Wt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new Wt('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:r}}const bu=async t=>{if(!t.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:r}=zl(t),n=[e,t.ext??!1,t.key_ops??r],o={...t};return delete o.alg,delete o.use,vn.subtle.importKey("jwk",o,...n)},wu=t=>qr(t);let sn,on;const vu=t=>(t==null?void 0:t[Symbol.toStringTag])==="KeyObject",Si=async(t,e,r,n,o=!1)=>{let c=t.get(e);if(c!=null&&c[n])return c[n];const u=await bu({...r,alg:n});return o&&Object.freeze(e),c?c[n]=u:t.set(e,{[n]:u}),u},Gl=(t,e)=>{if(vu(t)){let r=t.export({format:"jwk"});return delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k?wu(r.k):(on||(on=new WeakMap),Si(on,t,r,e))}return Sn(t)?t.k?qr(t.k):(on||(on=new WeakMap),Si(on,t,t,e,!0)):t},Ql=(t,e)=>{if(vu(t)){let r=t.export({format:"jwk"});return r.k?wu(r.k):(sn||(sn=new WeakMap),Si(sn,t,r,e))}return Sn(t)?t.k?qr(t.k):(sn||(sn=new WeakMap),Si(sn,t,t,e,!0)):t},Uo={normalizePublicKey:Gl,normalizePrivateKey:Ql};async function Su(t,e){if(!wr(t))throw new TypeError("JWK must be an object");switch(e||(e=t.alg),t.kty){case"oct":if(typeof t.k!="string"||!t.k)throw new TypeError('missing "k" (Key Value) Parameter value');return qr(t.k);case"RSA":if("oth"in t&&t.oth!==void 0)throw new Wt('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return bu({...t,alg:e});default:throw new Wt('Unsupported "kty" (Key Type) Parameter value')}}const cn=t=>t==null?void 0:t[Symbol.toStringTag],ks=(t,e,r)=>{var n,o;if(e.use!==void 0&&e.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(e.key_ops!==void 0&&((o=(n=e.key_ops).includes)==null?void 0:o.call(n,r))!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(e.alg!==void 0&&e.alg!==t)throw new TypeError(`Invalid key for this operation, when present its alg must be ${t}`);return!0},Yl=(t,e,r,n)=>{if(!(e instanceof Uint8Array)){if(n&&Sn(e)){if(Jl(e)&&ks(t,e,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!yu(e))throw new TypeError(gu(t,e,...Yn,"Uint8Array",n?"JSON Web Key":null));if(e.type!=="secret")throw new TypeError(`${cn(e)} instances for symmetric algorithms must be of type "secret"`)}},Xl=(t,e,r,n)=>{if(n&&Sn(e))switch(r){case"sign":if(Vl(e)&&ks(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(ql(e)&&ks(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!yu(e))throw new TypeError(gu(t,e,...Yn,n?"JSON Web Key":null));if(e.type==="secret")throw new TypeError(`${cn(e)} instances for asymmetric algorithms must not be of type "secret"`);if(r==="sign"&&e.type==="public")throw new TypeError(`${cn(e)} instances for asymmetric algorithm signing must be of type "private"`);if(r==="decrypt"&&e.type==="public")throw new TypeError(`${cn(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&r==="verify"&&e.type==="private")throw new TypeError(`${cn(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&r==="encrypt"&&e.type==="private")throw new TypeError(`${cn(e)} instances for asymmetric algorithm encryption must be of type "public"`)};function Eu(t,e,r,n){e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?Yl(e,r,n,t):Xl(e,r,n,t)}Eu.bind(void 0,!1);const Cs=Eu.bind(void 0,!0);function xu(t,e,r,n,o){if(o.crit!==void 0&&(n==null?void 0:n.crit)===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(u=>typeof u!="string"||u.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let c;r!==void 0?c=new Map([...Object.entries(r),...e.entries()]):c=e;for(const u of n.crit){if(!c.has(u))throw new Wt(`Extension Header Parameter "${u}" is not recognized`);if(o[u]===void 0)throw new t(`Extension Header Parameter "${u}" is missing`);if(c.get(u)&&n[u]===void 0)throw new t(`Extension Header Parameter "${u}" MUST be integrity protected`)}return new Set(n.crit)}const Zl=(t,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(r=>typeof r!="string")))throw new TypeError(`"${t}" option must be an array of strings`);if(e)return new Set(e)},ed=async t=>{if(t instanceof Uint8Array)return{kty:"oct",k:gi(t)};if(!io(t))throw new TypeError(Ps(t,...Yn,"Uint8Array"));if(!t.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:e,key_ops:r,alg:n,use:o,...c}=await vn.subtle.exportKey("jwk",t);return c};async function td(t){return ed(t)}function Fu(t,e){const r=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:t.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:e.namedCurve};case"Ed25519":return{name:"Ed25519"};case"EdDSA":return{name:e.name};default:throw new Wt(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}async function Au(t,e,r){if(r==="sign"&&(e=await Uo.normalizePrivateKey(e,t)),r==="verify"&&(e=await Uo.normalizePublicKey(e,t)),io(e))return Kl(e,t,r),e;if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(Ps(e,...Yn));return vn.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(Ps(e,...Yn,"Uint8Array","JSON Web Key"))}const rd=async(t,e,r,n)=>{const o=await Au(t,e,"verify");_u(t,o);const c=Fu(t,o.algorithm);try{return await vn.subtle.verify(c,o,r,n)}catch{return!1}};async function nd(t,e,r){if(!wr(t))throw new dt("Flattened JWS must be an object");if(t.protected===void 0&&t.header===void 0)throw new dt('Flattened JWS must have either of the "protected" or "header" members');if(t.protected!==void 0&&typeof t.protected!="string")throw new dt("JWS Protected Header incorrect type");if(t.payload===void 0)throw new dt("JWS Payload missing");if(typeof t.signature!="string")throw new dt("JWS Signature missing or incorrect type");if(t.header!==void 0&&!wr(t.header))throw new dt("JWS Unprotected Header incorrect type");let n={};if(t.protected)try{const I=qr(t.protected);n=JSON.parse(mn.decode(I))}catch{throw new dt("JWS Protected Header is invalid")}if(!mu(n,t.header))throw new dt("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o={...n,...t.header},c=xu(dt,new Map([["b64",!0]]),r==null?void 0:r.crit,n,o);let u=!0;if(c.has("b64")&&(u=n.b64,typeof u!="boolean"))throw new dt('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:l}=o;if(typeof l!="string"||!l)throw new dt('JWS "alg" (Algorithm) Header Parameter missing or invalid');const g=r&&Zl("algorithms",r.algorithms);if(g&&!g.has(l))throw new lu('"alg" (Algorithm) Header Parameter value not allowed');if(u){if(typeof t.payload!="string")throw new dt("JWS Payload must be a string")}else if(typeof t.payload!="string"&&!(t.payload instanceof Uint8Array))throw new dt("JWS Payload must be a string or an Uint8Array instance");let f=!1;typeof e=="function"?(e=await e(n,t),f=!0,Cs(l,e,"verify"),Sn(e)&&(e=await Su(e,l))):Cs(l,e,"verify");const h=cu(dr.encode(t.protected??""),dr.encode("."),typeof t.payload=="string"?dr.encode(t.payload):t.payload);let p;try{p=qr(t.signature)}catch{throw new dt("Failed to base64url decode the signature")}if(!await rd(l,e,p,h))throw new hu;let x;if(u)try{x=qr(t.payload)}catch{throw new dt("Failed to base64url decode the payload")}else typeof t.payload=="string"?x=dr.encode(t.payload):x=t.payload;const F={payload:x};return t.protected!==void 0&&(F.protectedHeader=n),t.header!==void 0&&(F.unprotectedHeader=t.header),f?{...F,key:e}:F}async function id(t,e,r){if(t instanceof Uint8Array&&(t=mn.decode(t)),typeof t!="string")throw new dt("Compact JWS must be a string or Uint8Array");const{0:n,1:o,2:c,length:u}=t.split(".");if(u!==3)throw new dt("Invalid Compact JWS");const l=await nd({payload:o,protected:n,signature:c},e,r),g={payload:l.payload,protectedHeader:l.protectedHeader};return typeof e=="function"?{...g,key:l.key}:g}const Ir=t=>Math.floor(t.getTime()/1e3),Iu=60,Tu=Iu*60,ao=Tu*24,sd=ao*7,od=ao*365.25,ad=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,qn=t=>{const e=ad.exec(t);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const r=parseFloat(e[2]),n=e[3].toLowerCase();let o;switch(n){case"sec":case"secs":case"second":case"seconds":case"s":o=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":o=Math.round(r*Iu);break;case"hour":case"hours":case"hr":case"hrs":case"h":o=Math.round(r*Tu);break;case"day":case"days":case"d":o=Math.round(r*ao);break;case"week":case"weeks":case"w":o=Math.round(r*sd);break;default:o=Math.round(r*od);break}return e[1]==="-"||e[4]==="ago"?-o:o},Oo=t=>t.toLowerCase().replace(/^application\//,""),ud=(t,e)=>typeof t=="string"?e.includes(t):Array.isArray(t)?e.some(Set.prototype.has.bind(new Set(t))):!1,cd=(t,e,r={})=>{let n;try{n=JSON.parse(mn.decode(e))}catch{}if(!wr(n))throw new Pi("JWT Claims Set must be a top-level JSON object");const{typ:o}=r;if(o&&(typeof t.typ!="string"||Oo(t.typ)!==Oo(o)))throw new nr('unexpected "typ" JWT header value',n,"typ","check_failed");const{requiredClaims:c=[],issuer:u,subject:l,audience:g,maxTokenAge:f}=r,h=[...c];f!==void 0&&h.push("iat"),g!==void 0&&h.push("aud"),l!==void 0&&h.push("sub"),u!==void 0&&h.push("iss");for(const F of new Set(h.reverse()))if(!(F in n))throw new nr(`missing required "${F}" claim`,n,F,"missing");if(u&&!(Array.isArray(u)?u:[u]).includes(n.iss))throw new nr('unexpected "iss" claim value',n,"iss","check_failed");if(l&&n.sub!==l)throw new nr('unexpected "sub" claim value',n,"sub","check_failed");if(g&&!ud(n.aud,typeof g=="string"?[g]:g))throw new nr('unexpected "aud" claim value',n,"aud","check_failed");let p;switch(typeof r.clockTolerance){case"string":p=qn(r.clockTolerance);break;case"number":p=r.clockTolerance;break;case"undefined":p=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:v}=r,x=Ir(v||new Date);if((n.iat!==void 0||f)&&typeof n.iat!="number")throw new nr('"iat" claim must be a number',n,"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new nr('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>x+p)throw new nr('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new nr('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=x-p)throw new Rs('"exp" claim timestamp check failed',n,"exp","check_failed")}if(f){const F=x-n.iat,I=typeof f=="number"?f:qn(f);if(F-p>I)throw new Rs('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(F<0-p)throw new nr('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n};async function ld(t,e,r){var u;const n=await id(t,e,r);if((u=n.protectedHeader.crit)!=null&&u.includes("b64")&&n.protectedHeader.b64===!1)throw new Pi("JWTs MUST NOT use unencoded payload");const c={payload:cd(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return typeof e=="function"?{...c,key:n.key}:c}const dd=async(t,e,r)=>{const n=await Au(t,e,"sign");_u(t,n);const o=await vn.subtle.sign(Fu(t,n.algorithm),n,r);return new Uint8Array(o)};class fd{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,r){if(!this._protectedHeader&&!this._unprotectedHeader)throw new dt("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!mu(this._protectedHeader,this._unprotectedHeader))throw new dt("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const n={...this._protectedHeader,...this._unprotectedHeader},o=xu(dt,new Map([["b64",!0]]),r==null?void 0:r.crit,this._protectedHeader,n);let c=!0;if(o.has("b64")&&(c=this._protectedHeader.b64,typeof c!="boolean"))throw new dt('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:u}=n;if(typeof u!="string"||!u)throw new dt('JWS "alg" (Algorithm) Header Parameter missing or invalid');Cs(u,e,"sign");let l=this._payload;c&&(l=dr.encode(gi(l)));let g;this._protectedHeader?g=dr.encode(gi(JSON.stringify(this._protectedHeader))):g=dr.encode("");const f=cu(g,dr.encode("."),l),h=await dd(u,e,f),p={signature:gi(h),payload:""};return c&&(p.payload=mn.decode(l)),this._unprotectedHeader&&(p.header=this._unprotectedHeader),this._protectedHeader&&(p.protected=mn.decode(g)),p}}class hd{constructor(e){this._flattened=new fd(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,r){const n=await this._flattened.sign(e,r);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`}}function Mr(t,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${t} input`);return e}class pd{constructor(e={}){if(!wr(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:Mr("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:Mr("setNotBefore",Ir(e))}:this._payload={...this._payload,nbf:Ir(new Date)+qn(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:Mr("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:Mr("setExpirationTime",Ir(e))}:this._payload={...this._payload,exp:Ir(new Date)+qn(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:Ir(new Date)}:e instanceof Date?this._payload={...this._payload,iat:Mr("setIssuedAt",Ir(e))}:typeof e=="string"?this._payload={...this._payload,iat:Mr("setIssuedAt",Ir(new Date)+qn(e))}:this._payload={...this._payload,iat:Mr("setIssuedAt",e)},this}}class gd extends pd{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,r){var o;const n=new hd(dr.encode(JSON.stringify(this._payload)));if(n.setProtectedHeader(this._protectedHeader),Array.isArray((o=this._protectedHeader)==null?void 0:o.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Pi("JWTs MUST NOT use unencoded payload");return n.sign(e,r)}}function yd(t){switch(typeof t=="string"&&t.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new Wt('Unsupported "alg" value for a JSON Web Key Set')}}function md(t){return t&&typeof t=="object"&&Array.isArray(t.keys)&&t.keys.every(_d)}function _d(t){return wr(t)}function Ru(t){return typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t))}class bd{constructor(e){if(this._cached=new WeakMap,!md(e))throw new so("JSON Web Key Set malformed");this._jwks=Ru(e)}async getKey(e,r){const{alg:n,kid:o}={...e,...r==null?void 0:r.header},c=yd(n),u=this._jwks.keys.filter(f=>{let h=c===f.kty;if(h&&typeof o=="string"&&(h=o===f.kid),h&&typeof f.alg=="string"&&(h=n===f.alg),h&&typeof f.use=="string"&&(h=f.use==="sig"),h&&Array.isArray(f.key_ops)&&(h=f.key_ops.includes("verify")),h)switch(n){case"ES256":h=f.crv==="P-256";break;case"ES256K":h=f.crv==="secp256k1";break;case"ES384":h=f.crv==="P-384";break;case"ES512":h=f.crv==="P-521";break;case"Ed25519":h=f.crv==="Ed25519";break;case"EdDSA":h=f.crv==="Ed25519"||f.crv==="Ed448";break}return h}),{0:l,length:g}=u;if(g===0)throw new oo;if(g!==1){const f=new du,{_cached:h}=this;throw f[Symbol.asyncIterator]=async function*(){for(const p of u)try{yield await Bo(h,p,n)}catch{}},f}return Bo(this._cached,l,n)}}async function Bo(t,e,r){const n=t.get(e)||t.set(e,{}).get(e);if(n[r]===void 0){const o=await Su({...e,ext:!0},r);if(o instanceof Uint8Array||o.type!=="public")throw new so("JSON Web Key Set members must be public keys");n[r]=o}return n[r]}function jo(t){const e=new bd(t),r=async(n,o)=>e.getKey(n,o);return Object.defineProperties(r,{jwks:{value:()=>Ru(e._jwks),enumerable:!0,configurable:!1,writable:!1}}),r}const wd=async(t,e,r)=>{let n,o,c=!1;typeof AbortController=="function"&&(n=new AbortController,o=setTimeout(()=>{c=!0,n.abort()},e));const u=await fetch(t.href,{signal:n?n.signal:void 0,redirect:"manual",headers:r.headers}).catch(l=>{throw c?new fu:l});if(o!==void 0&&clearTimeout(o),u.status!==200)throw new Lt("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await u.json()}catch{throw new Lt("Failed to parse the JSON Web Key Set HTTP response as JSON")}};function vd(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}let Ns;var pi,uu;(typeof navigator>"u"||!((uu=(pi=navigator.userAgent)==null?void 0:pi.startsWith)!=null&&uu.call(pi,"Mozilla/5.0 ")))&&(Ns="jose/v5.10.0");const Zi=Symbol();function Sd(t,e){return!(typeof t!="object"||t===null||!("uat"in t)||typeof t.uat!="number"||Date.now()-t.uat>=e||!("jwks"in t)||!wr(t.jwks)||!Array.isArray(t.jwks.keys)||!Array.prototype.every.call(t.jwks.keys,wr))}class Ed{constructor(e,r){if(!(e instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:r==null?void 0:r.agent,headers:r==null?void 0:r.headers},this._timeoutDuration=typeof(r==null?void 0:r.timeoutDuration)=="number"?r==null?void 0:r.timeoutDuration:5e3,this._cooldownDuration=typeof(r==null?void 0:r.cooldownDuration)=="number"?r==null?void 0:r.cooldownDuration:3e4,this._cacheMaxAge=typeof(r==null?void 0:r.cacheMaxAge)=="number"?r==null?void 0:r.cacheMaxAge:6e5,(r==null?void 0:r[Zi])!==void 0&&(this._cache=r==null?void 0:r[Zi],Sd(r==null?void 0:r[Zi],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=jo(this._cache.jwks)))}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(e,r){(!this._local||!this.fresh())&&await this.reload();try{return await this._local(e,r)}catch(n){if(n instanceof oo&&this.coolingDown()===!1)return await this.reload(),this._local(e,r);throw n}}async reload(){this._pendingFetch&&vd()&&(this._pendingFetch=void 0);const e=new Headers(this._options.headers);Ns&&!e.has("User-Agent")&&(e.set("User-Agent",Ns),this._options.headers=Object.fromEntries(e.entries())),this._pendingFetch||(this._pendingFetch=wd(this._url,this._timeoutDuration,this._options).then(r=>{this._local=jo(r),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=r),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(r=>{throw this._pendingFetch=void 0,r})),await this._pendingFetch}}function xd(t,e){const r=new Ed(t,e),n=async(o,c)=>r.getKey(o,c);return Object.defineProperties(n,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!r._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>{var o;return(o=r._local)==null?void 0:o.jwks()},enumerable:!0,configurable:!1,writable:!1}}),n}function es(t){const e=(t==null?void 0:t.modulusLength)??2048;if(typeof e!="number"||e<2048)throw new Wt("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return e}async function Fd(t,e){let r,n;switch(t){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:`SHA-${t.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:es(e)},n=["sign","verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:es(e)},n=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:`SHA-${parseInt(t.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:es(e)},n=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":r={name:"ECDSA",namedCurve:"P-256"},n=["sign","verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},n=["sign","verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},n=["sign","verify"];break;case"Ed25519":r={name:"Ed25519"},n=["sign","verify"];break;case"EdDSA":{n=["sign","verify"];const o="Ed25519";switch(o){case"Ed25519":case"Ed448":r={name:o};break;default:throw new Wt("Invalid or unsupported crv option provided")}break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{n=["deriveKey","deriveBits"];const o="P-256";switch(o){case"P-256":case"P-384":case"P-521":{r={name:"ECDH",namedCurve:o};break}case"X25519":case"X448":r={name:o};break;default:throw new Wt("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new Wt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return vn.subtle.generateKey(r,!1,n)}async function Ad(t,e){return Fd(t,e)}const Pt=[];for(let t=0;t<256;++t)Pt.push((t+256).toString(16).slice(1));function Id(t,e=0){return(Pt[t[e+0]]+Pt[t[e+1]]+Pt[t[e+2]]+Pt[t[e+3]]+"-"+Pt[t[e+4]]+Pt[t[e+5]]+"-"+Pt[t[e+6]]+Pt[t[e+7]]+"-"+Pt[t[e+8]]+Pt[t[e+9]]+"-"+Pt[t[e+10]]+Pt[t[e+11]]+Pt[t[e+12]]+Pt[t[e+13]]+Pt[t[e+14]]+Pt[t[e+15]]).toLowerCase()}let ts;const Td=new Uint8Array(16);function Rd(){if(!ts){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ts=crypto.getRandomValues.bind(crypto)}return ts(Td)}const Pd=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Mo={randomUUID:Pd};function Pu(t,e,r){var o;if(Mo.randomUUID&&!t)return Mo.randomUUID();t=t||{};const n=t.random??((o=t.rng)==null?void 0:o.call(t))??Rd();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Id(n)}const ku="solidClientAuthn:",Ei=["ES256","RS256"],Ft={ERROR:"error",LOGIN:"login",LOGOUT:"logout",NEW_REFRESH_TOKEN:"newRefreshToken",NEW_TOKENS:"newTokens",AUTHORIZATION_REQUEST:"authorizationRequest",SESSION_EXPIRED:"sessionExpired",SESSION_EXTENDED:"sessionExtended",SESSION_RESTORED:"sessionRestore",TIMEOUT_SET:"timeoutSet"},Ho=5,kd="openid",Cd="offline_access",Nd="webid",Cu=[kd,Cd,Nd].join(" ");class Ld{constructor(e){Le(this,"handleables");this.handleables=e,this.handleables=e}async getProperHandler(e){const r=await Promise.all(this.handleables.map(n=>n.canHandle(...e)));for(let n=0;n<r.length;n+=1)if(r[n])return this.handleables[n];return null}async canHandle(...e){return await this.getProperHandler(e)!==null}async handle(...e){const r=await this.getProperHandler(e);if(r)return r.handle(...e);throw new Error(`[${this.constructor.name}] cannot find a suitable handler for: ${e.map(n=>{try{return JSON.stringify(n)}catch{return n.toString()}}).join(", ")}`)}}async function Nu(t,e,r,n){let o,c;try{const{payload:u}=await ld(t,xd(new URL(e)),{issuer:r,audience:n});o=u}catch(u){throw new Error(`Token verification failed: ${u.stack}`)}if(typeof o.azp=="string"&&(c=o.azp),typeof o.webid=="string")return{webId:o.webid,clientId:c};if(typeof o.sub!="string")throw new Error(`The token ${JSON.stringify(o)} is invalid: it has no 'webid' claim and no 'sub' claim.`);try{return new URL(o.sub),{webId:o.sub,clientId:c}}catch(u){throw new Error(`The token has no 'webid' claim, and its 'sub' claim of [${o.sub}] is invalid as a URL - error [${u}].`)}}function Lu(t){try{const e=new URL(t),r=!e.searchParams.has("code")&&!e.searchParams.has("state"),n=e.hash==="";return r&&n}catch{return!1}}function Du(t){const e=new URL(t);return e.searchParams.delete("state"),e.searchParams.delete("code"),e.searchParams.delete("error"),e.searchParams.delete("error_description"),e.searchParams.delete("iss"),e}function Dd(t,e){return typeof t=="boolean"?!!t:!!e}class Ud{constructor(e,r){Le(this,"storageUtility");Le(this,"redirector");Le(this,"parametersGuard",e=>e.issuerConfiguration.grantTypesSupported!==void 0&&e.issuerConfiguration.grantTypesSupported.indexOf("authorization_code")>-1&&e.redirectUrl!==void 0);this.storageUtility=e,this.redirector=r,this.storageUtility=e,this.redirector=r}async canHandle(e){return this.parametersGuard(e)}async setupRedirectHandler({oidcLoginOptions:e,state:r,codeVerifier:n,targetUrl:o}){if(!this.parametersGuard(e))throw new Error("The authorization code grant requires a redirectUrl.");await Promise.all([this.storageUtility.setForUser(r,{sessionId:e.sessionId}),this.storageUtility.setForUser(e.sessionId,{codeVerifier:n,issuer:e.issuer.toString(),redirectUrl:e.redirectUrl,dpop:(!!e.dpop).toString(),keepAlive:Dd(e.keepAlive,!0).toString()})]),this.redirector.redirect(o,{handleRedirect:e.handleRedirect})}}class Od{constructor(e){Le(this,"sessionInfoManager");this.sessionInfoManager=e,this.sessionInfoManager=e}async canHandle(){return!0}async handle(e){await this.sessionInfoManager.clear(e)}}class Bd{constructor(e){Le(this,"redirector");this.redirector=e,this.redirector=e}async canHandle(e,r){return(r==null?void 0:r.logoutType)==="idp"}async handle(e,r){if((r==null?void 0:r.logoutType)!=="idp")throw new Error("Attempting to call idp logout handler to perform app logout");if(r.toLogoutUrl===void 0)throw new Error("Cannot perform IDP logout. Did you log in using the OIDC authentication flow?");this.redirector.redirect(r.toLogoutUrl(r),{handleRedirect:r.handleRedirect})}}class jd{constructor(e,r){Le(this,"handlers");this.handlers=[new Od(e),new Bd(r)]}async canHandle(){return!0}async handle(e,r){for(const n of this.handlers)await n.canHandle(e,r)&&await n.handle(e,r)}}function Uu(){return{isLoggedIn:!1,sessionId:Pu(),fetch:(...t)=>fetch(...t)}}async function Ou(t,e){await Promise.all([e.deleteAllUserData(t,{secure:!1}),e.deleteAllUserData(t,{secure:!0})])}class Md{constructor(e){Le(this,"storageUtility");this.storageUtility=e,this.storageUtility=e}update(e,r){throw new Error("Not Implemented")}set(e,r){throw new Error("Not Implemented")}get(e){throw new Error("Not implemented")}async getAll(){throw new Error("Not implemented")}async clear(e){return Ou(e,this.storageUtility)}async register(e){throw new Error("Not implemented")}async getRegisteredSessionIdAll(){throw new Error("Not implemented")}async clearAll(){throw new Error("Not implemented")}async setOidcContext(e,r){throw new Error("Not implemented")}}function Hd({endSessionEndpoint:t,idTokenHint:e,postLogoutRedirectUri:r,state:n}){const o=new URL(t);return e!==void 0&&o.searchParams.append("id_token_hint",e),r!==void 0&&(o.searchParams.append("post_logout_redirect_uri",r),n!==void 0&&o.searchParams.append("state",n)),o.toString()}function $d({endSessionEndpoint:t,idTokenHint:e}){if(t!==void 0)return function({state:n,postLogoutUrl:o}){return Hd({endSessionEndpoint:t,idTokenHint:e,state:n,postLogoutRedirectUri:o})}}function Kd(t){return typeof t=="string"&&["DPoP","Bearer"].includes(t)}function Bu(t){try{return new URL(t),!0}catch{return!1}}function Wd(t,e){return e.find(r=>t.includes(r))??null}function Vd(t){return t.clientId!==void 0&&!Bu(t.clientId)}function qd(t,e){return e.scopesSupported.includes("webid")&&t.clientId!==void 0&&Bu(t.clientId)}function Jd(t){return typeof t=="string"&&["dynamic","static","solid-oidc"].includes(t)}async function zd(t,e,r,n){let o;if(qd(t,e))o={clientId:t.clientId,clientName:t.clientName,clientType:"solid-oidc"};else if(Vd(t))o={clientId:t.clientId,clientSecret:t.clientSecret,clientName:t.clientName,clientType:"static"};else return n.getClient({sessionId:t.sessionId,clientName:t.clientName,redirectUrl:t.redirectUrl},e);const c={clientId:o.clientId,clientType:o.clientType};return o.clientType==="static"&&(c.clientSecret=o.clientSecret),o.clientName&&(c.clientName=o.clientName),await r.setForUser(t.sessionId,c),o}const $o=(t,e)=>fetch(t,e);let Gd=class{constructor(e,r,n,o,c){Le(this,"loginHandler");Le(this,"redirectHandler");Le(this,"logoutHandler");Le(this,"sessionInfoManager");Le(this,"issuerConfigFetcher");Le(this,"boundLogout");Le(this,"fetch",$o);Le(this,"logout",async(e,r)=>{await this.logoutHandler.handle(e,(r==null?void 0:r.logoutType)==="idp"?{...r,toLogoutUrl:this.boundLogout}:r),this.fetch=$o,delete this.boundLogout});Le(this,"getSessionInfo",async e=>this.sessionInfoManager.get(e));Le(this,"getAllSessionInfo",async()=>this.sessionInfoManager.getAll());this.loginHandler=e,this.redirectHandler=r,this.logoutHandler=n,this.sessionInfoManager=o,this.issuerConfigFetcher=c,this.loginHandler=e,this.redirectHandler=r,this.logoutHandler=n,this.sessionInfoManager=o,this.issuerConfigFetcher=c}};async function ju(t,e,r){try{const[n,o,c,u,l]=await Promise.all([e.getForUser(t,"issuer",{errorIfNull:!0}),e.getForUser(t,"codeVerifier"),e.getForUser(t,"redirectUrl"),e.getForUser(t,"dpop",{errorIfNull:!0}),e.getForUser(t,"keepAlive")]);await e.deleteForUser(t,"codeVerifier");const g=await r.fetchConfig(n);return{codeVerifier:o,redirectUrl:c,issuerConfig:g,dpop:u==="true",keepAlive:typeof l=="string"?l==="true":!0}}catch(n){throw new Error(`Failed to retrieve OIDC context from storage associated with session [${t}]: ${n}`)}}async function Qd(t,e,r,n,o,c,u,l){r!==void 0&&await t.setForUser(e,{webId:r},{secure:u}),n!==void 0&&await t.setForUser(e,{clientId:n},{secure:u}),await t.setForUser(e,{isLoggedIn:o},{secure:u})}class Yd{constructor(e,r){Le(this,"secureStorage");Le(this,"insecureStorage");this.secureStorage=e,this.insecureStorage=r,this.secureStorage=e,this.insecureStorage=r}getKey(e){return`solidClientAuthenticationUser:${e}`}async getUserData(e,r){const n=await(r?this.secureStorage:this.insecureStorage).get(this.getKey(e));if(n===void 0)return{};try{return JSON.parse(n)}catch{throw new Error(`Data for user [${e}] in [${r?"secure":"unsecure"}] storage is corrupted - expected valid JSON, but got: ${n}`)}}async setUserData(e,r,n){await(n?this.secureStorage:this.insecureStorage).set(this.getKey(e),JSON.stringify(r))}async get(e,r){const n=await(r!=null&&r.secure?this.secureStorage:this.insecureStorage).get(e);if(n===void 0&&(r!=null&&r.errorIfNull))throw new Error(`[${e}] is not stored`);return n}async set(e,r,n){return(n!=null&&n.secure?this.secureStorage:this.insecureStorage).set(e,r)}async delete(e,r){return(r!=null&&r.secure?this.secureStorage:this.insecureStorage).delete(e)}async getForUser(e,r,n){const o=await this.getUserData(e,n==null?void 0:n.secure);let c;if((!o||!o[r])&&(c=void 0),c=o[r],c===void 0&&(n!=null&&n.errorIfNull))throw new Error(`Field [${r}] for user [${e}] is not stored`);return c||void 0}async setForUser(e,r,n){let o;try{o=await this.getUserData(e,n==null?void 0:n.secure)}catch{o={}}await this.setUserData(e,{...o,...r},n==null?void 0:n.secure)}async deleteForUser(e,r,n){const o=await this.getUserData(e,n==null?void 0:n.secure);delete o[r],await this.setUserData(e,o,n==null?void 0:n.secure)}async deleteAllUserData(e,r){await(r!=null&&r.secure?this.secureStorage:this.insecureStorage).delete(this.getKey(e))}}class Xd{constructor(){Le(this,"map",{})}async get(e){return this.map[e]||void 0}async set(e,r){this.map[e]=r}async delete(e){delete this.map[e]}}class Ls extends Error{constructor(e){super(e)}}class $n extends Error{constructor(r){super(`Invalid response from OIDC provider: missing fields ${r}`);Le(this,"missingFields");this.missingFields=r}}class Mu extends Error{constructor(r,n,o){super(r);Le(this,"error");Le(this,"errorDescription");this.error=n,this.errorDescription=o}}function Zd(t){const e=new URL(t);return new URL(e.pathname,e.origin).toString()}async function uo(t,e,r){return new gd({htu:Zd(t),htm:e.toUpperCase(),jti:Pu()}).setProtectedHeader({alg:Ei[0],jwk:r.publicKey,typ:"dpop+jwt"}).setIssuedAt().sign(r.privateKey,{})}async function ef(){const{privateKey:t,publicKey:e}=await Ad(Ei[0]),r={privateKey:t,publicKey:await td(e)};return[r.publicKey.alg]=Ei,r}const Hu=600;function tf(t){return[401,403].includes(t)}async function rf(t,e,r,n){const o=new Headers(n==null?void 0:n.headers);return o.set("Authorization",`DPoP ${e}`),o.set("DPoP",await uo(t,(n==null?void 0:n.method)??"get",r)),{...n,headers:o}}async function nf(t,e,r,n){if(r!==void 0)return rf(t,e,r,n);const o=new Headers(n==null?void 0:n.headers);return o.set("Authorization",`Bearer ${e}`),{...n,headers:o}}async function Ko(t,e,r,n){return fetch(e,await nf(e.toString(),t,n,r))}async function sf(t,e,r){const n=await t.tokenRefresher.refresh(t.sessionId,t.refreshToken,e);return r==null||r.emit(Ft.SESSION_EXTENDED,n.expiresIn??Hu),{accessToken:n.accessToken,refreshToken:n.refreshToken,expiresIn:n.expiresIn}}const rs=t=>t!==void 0?t-Ho>0?t-Ho:t:Hu;function of(t,e){var c;let r=t,n;const o=e==null?void 0:e.refreshOptions;if(o!==void 0){const u=async()=>{var l,g,f,h;try{const{accessToken:p,refreshToken:v,expiresIn:x}=await sf(o,e.dpopKey,e.eventEmitter);r=p,v!==void 0&&(o.refreshToken=v),clearTimeout(n),n=setTimeout(u,rs(x)*1e3),(l=e.eventEmitter)==null||l.emit(Ft.TIMEOUT_SET,n)}catch(p){p instanceof Mu&&((g=e==null?void 0:e.eventEmitter)==null||g.emit(Ft.ERROR,p.error,p.errorDescription),(f=e==null?void 0:e.eventEmitter)==null||f.emit(Ft.SESSION_EXPIRED)),p instanceof $n&&p.missingFields.includes("access_token")&&((h=e==null?void 0:e.eventEmitter)==null||h.emit(Ft.SESSION_EXPIRED))}};n=setTimeout(u,rs(e.expiresIn)*1e3),(c=e.eventEmitter)==null||c.emit(Ft.TIMEOUT_SET,n)}else if(e!==void 0&&e.eventEmitter!==void 0){const u=setTimeout(()=>{e.eventEmitter.emit(Ft.SESSION_EXPIRED)},rs(e.expiresIn)*1e3);e.eventEmitter.emit(Ft.TIMEOUT_SET,u)}return async(u,l)=>{let g=await Ko(r,u,l,e==null?void 0:e.dpopKey);const f=!g.ok&&!tf(g.status);return g.ok||f||g.url!==u&&(e==null?void 0:e.dpopKey)!==void 0&&(g=await Ko(r,g.url,l,e.dpopKey)),g}}const kt=[];for(let t=0;t<256;++t)kt.push((t+256).toString(16).slice(1));function af(t,e=0){return(kt[t[e+0]]+kt[t[e+1]]+kt[t[e+2]]+kt[t[e+3]]+"-"+kt[t[e+4]]+kt[t[e+5]]+"-"+kt[t[e+6]]+kt[t[e+7]]+"-"+kt[t[e+8]]+kt[t[e+9]]+"-"+kt[t[e+10]]+kt[t[e+11]]+kt[t[e+12]]+kt[t[e+13]]+kt[t[e+14]]+kt[t[e+15]]).toLowerCase()}let ns;const uf=new Uint8Array(16);function cf(){if(!ns){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ns=crypto.getRandomValues.bind(crypto)}return ns(uf)}const lf=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Wo={randomUUID:lf};function df(t,e,r){var o;if(Wo.randomUUID&&!t)return Wo.randomUUID();t=t||{};const n=t.random??((o=t.rng)==null?void 0:o.call(t))??cf();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,af(n)}var ff=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $u(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var co={exports:{}},hn=typeof Reflect=="object"?Reflect:null,Vo=hn&&typeof hn.apply=="function"?hn.apply:function(e,r,n){return Function.prototype.apply.call(e,r,n)},yi;hn&&typeof hn.ownKeys=="function"?yi=hn.ownKeys:Object.getOwnPropertySymbols?yi=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:yi=function(e){return Object.getOwnPropertyNames(e)};function hf(t){console&&console.warn&&console.warn(t)}var Ku=Number.isNaN||function(e){return e!==e};function et(){et.init.call(this)}co.exports=et;co.exports.once=mf;et.EventEmitter=et;et.prototype._events=void 0;et.prototype._eventsCount=0;et.prototype._maxListeners=void 0;var qo=10;function ki(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(et,"defaultMaxListeners",{enumerable:!0,get:function(){return qo},set:function(t){if(typeof t!="number"||t<0||Ku(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");qo=t}});et.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};et.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Ku(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Wu(t){return t._maxListeners===void 0?et.defaultMaxListeners:t._maxListeners}et.prototype.getMaxListeners=function(){return Wu(this)};et.prototype.emit=function(e){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var o=e==="error",c=this._events;if(c!==void 0)o=o&&c.error===void 0;else if(!o)return!1;if(o){var u;if(r.length>0&&(u=r[0]),u instanceof Error)throw u;var l=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw l.context=u,l}var g=c[e];if(g===void 0)return!1;if(typeof g=="function")Vo(g,this,r);else for(var f=g.length,h=Gu(g,f),n=0;n<f;++n)Vo(h[n],this,r);return!0};function Vu(t,e,r,n){var o,c,u;if(ki(r),c=t._events,c===void 0?(c=t._events=Object.create(null),t._eventsCount=0):(c.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),c=t._events),u=c[e]),u===void 0)u=c[e]=r,++t._eventsCount;else if(typeof u=="function"?u=c[e]=n?[r,u]:[u,r]:n?u.unshift(r):u.push(r),o=Wu(t),o>0&&u.length>o&&!u.warned){u.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=u.length,hf(l)}return t}et.prototype.addListener=function(e,r){return Vu(this,e,r,!1)};et.prototype.on=et.prototype.addListener;et.prototype.prependListener=function(e,r){return Vu(this,e,r,!0)};function pf(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function qu(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},o=pf.bind(n);return o.listener=r,n.wrapFn=o,o}et.prototype.once=function(e,r){return ki(r),this.on(e,qu(this,e,r)),this};et.prototype.prependOnceListener=function(e,r){return ki(r),this.prependListener(e,qu(this,e,r)),this};et.prototype.removeListener=function(e,r){var n,o,c,u,l;if(ki(r),o=this._events,o===void 0)return this;if(n=o[e],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||r));else if(typeof n!="function"){for(c=-1,u=n.length-1;u>=0;u--)if(n[u]===r||n[u].listener===r){l=n[u].listener,c=u;break}if(c<0)return this;c===0?n.shift():gf(n,c),n.length===1&&(o[e]=n[0]),o.removeListener!==void 0&&this.emit("removeListener",e,l||r)}return this};et.prototype.off=et.prototype.removeListener;et.prototype.removeAllListeners=function(e){var r,n,o;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var c=Object.keys(n),u;for(o=0;o<c.length;++o)u=c[o],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(o=r.length-1;o>=0;o--)this.removeListener(e,r[o]);return this};function Ju(t,e,r){var n=t._events;if(n===void 0)return[];var o=n[e];return o===void 0?[]:typeof o=="function"?r?[o.listener||o]:[o]:r?yf(o):Gu(o,o.length)}et.prototype.listeners=function(e){return Ju(this,e,!0)};et.prototype.rawListeners=function(e){return Ju(this,e,!1)};et.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):zu.call(t,e)};et.prototype.listenerCount=zu;function zu(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}et.prototype.eventNames=function(){return this._eventsCount>0?yi(this._events):[]};function Gu(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function gf(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function yf(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function mf(t,e){return new Promise(function(r,n){function o(u){t.removeListener(e,c),n(u)}function c(){typeof t.removeListener=="function"&&t.removeListener("error",o),r([].slice.call(arguments))}Qu(t,e,c,{once:!0}),e!=="error"&&_f(t,o,{once:!0})})}function _f(t,e,r){typeof t.on=="function"&&Qu(t,"error",e,r)}function Qu(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function o(c){n.once&&t.removeEventListener(e,o),r(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Zn=co.exports;const bf=$u(Zn);var Yu={exports:{}};(function(t,e){(function(n,o){t.exports=o()})(ff,function(){return function(r){var n={};function o(c){if(n[c])return n[c].exports;var u=n[c]={i:c,l:!1,exports:{}};return r[c].call(u.exports,u,u.exports,o),u.l=!0,u.exports}return o.m=r,o.c=n,o.d=function(c,u,l){o.o(c,u)||Object.defineProperty(c,u,{enumerable:!0,get:l})},o.r=function(c){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},o.t=function(c,u){if(1&u&&(c=o(c)),8&u||4&u&&typeof c=="object"&&c&&c.__esModule)return c;var l=Object.create(null);if(o.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:c}),2&u&&typeof c!="string")for(var g in c)o.d(l,g,(function(f){return c[f]}).bind(null,g));return l},o.n=function(c){var u=c&&c.__esModule?function(){return c.default}:function(){return c};return o.d(u,"a",u),u},o.o=function(c,u){return Object.prototype.hasOwnProperty.call(c,u)},o.p="",o(o.s=22)}([function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function f(h,p){for(var v=0;v<p.length;v++){var x=p[v];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(h,x.key,x)}}return function(h,p,v){return p&&f(h.prototype,p),v&&f(h,v),h}}(),u={debug:function(){},info:function(){},warn:function(){},error:function(){}},l=void 0,g=void 0;(n.Log=function(){function f(){(function(p,v){if(!(p instanceof v))throw new TypeError("Cannot call a class as a function")})(this,f)}return f.reset=function(){g=3,l=u},f.debug=function(){if(g>=4){for(var p=arguments.length,v=Array(p),x=0;x<p;x++)v[x]=arguments[x];l.debug.apply(l,Array.from(v))}},f.info=function(){if(g>=3){for(var p=arguments.length,v=Array(p),x=0;x<p;x++)v[x]=arguments[x];l.info.apply(l,Array.from(v))}},f.warn=function(){if(g>=2){for(var p=arguments.length,v=Array(p),x=0;x<p;x++)v[x]=arguments[x];l.warn.apply(l,Array.from(v))}},f.error=function(){if(g>=1){for(var p=arguments.length,v=Array(p),x=0;x<p;x++)v[x]=arguments[x];l.error.apply(l,Array.from(v))}},c(f,null,[{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return g},set:function(p){if(!(0<=p&&p<=4))throw new Error("Invalid log level");g=p}},{key:"logger",get:function(){return l},set:function(p){if(!p.debug&&p.info&&(p.debug=p.info),!(p.debug&&p.info&&p.warn&&p.error))throw new Error("Invalid logger");l=p}}]),f}()).reset()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function f(h,p){for(var v=0;v<p.length;v++){var x=p[v];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(h,x.key,x)}}return function(h,p,v){return p&&f(h.prototype,p),v&&f(h,v),h}}(),u={setInterval:function(f){function h(p,v){return f.apply(this,arguments)}return h.toString=function(){return f.toString()},h}(function(f,h){return setInterval(f,h)}),clearInterval:function(f){function h(p){return f.apply(this,arguments)}return h.toString=function(){return f.toString()},h}(function(f){return clearInterval(f)})},l=!1,g=null;n.Global=function(){function f(){(function(p,v){if(!(p instanceof v))throw new TypeError("Cannot call a class as a function")})(this,f)}return f._testing=function(){l=!0},f.setXMLHttpRequest=function(p){g=p},c(f,null,[{key:"location",get:function(){if(!l)return location}},{key:"localStorage",get:function(){if(!l&&typeof window<"u")return localStorage}},{key:"sessionStorage",get:function(){if(!l&&typeof window<"u")return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!l&&typeof window<"u")return g||XMLHttpRequest}},{key:"timer",get:function(){if(!l)return u}}]),f}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.MetadataService=void 0;var c=function(){function h(p,v){for(var x=0;x<v.length;x++){var F=v[x];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(p,F.key,F)}}return function(p,v,x){return v&&h(p.prototype,v),x&&h(p,x),p}}(),u=o(0),l=o(7);function g(h,p){if(!(h instanceof p))throw new TypeError("Cannot call a class as a function")}var f=".well-known/openid-configuration";n.MetadataService=function(){function h(p){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.JsonService;if(g(this,h),!p)throw u.Log.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=p,this._jsonService=new v(["application/jwk-set+json"])}return h.prototype.resetSigningKeys=function(){this._settings=this._settings||{},this._settings.signingKeys=void 0},h.prototype.getMetadata=function(){var v=this;return this._settings.metadata?(u.Log.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(u.Log.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(x){u.Log.debug("MetadataService.getMetadata: json received");var F=v._settings.metadataSeed||{};return v._settings.metadata=Object.assign({},F,x),v._settings.metadata})):(u.Log.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))},h.prototype.getIssuer=function(){return this._getMetadataProperty("issuer")},h.prototype.getAuthorizationEndpoint=function(){return this._getMetadataProperty("authorization_endpoint")},h.prototype.getUserInfoEndpoint=function(){return this._getMetadataProperty("userinfo_endpoint")},h.prototype.getTokenEndpoint=function(){var v=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this._getMetadataProperty("token_endpoint",v)},h.prototype.getCheckSessionIframe=function(){return this._getMetadataProperty("check_session_iframe",!0)},h.prototype.getEndSessionEndpoint=function(){return this._getMetadataProperty("end_session_endpoint",!0)},h.prototype.getRevocationEndpoint=function(){return this._getMetadataProperty("revocation_endpoint",!0)},h.prototype.getKeysEndpoint=function(){return this._getMetadataProperty("jwks_uri",!0)},h.prototype._getMetadataProperty=function(v){var x=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return u.Log.debug("MetadataService.getMetadataProperty for: "+v),this.getMetadata().then(function(F){if(u.Log.debug("MetadataService.getMetadataProperty: metadata recieved"),F[v]===void 0){if(x===!0)return void u.Log.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+v);throw u.Log.error("MetadataService.getMetadataProperty: Metadata does not contain property "+v),new Error("Metadata does not contain property "+v)}return F[v]})},h.prototype.getSigningKeys=function(){var v=this;return this._settings.signingKeys?(u.Log.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(x){return u.Log.debug("MetadataService.getSigningKeys: jwks_uri received",x),v._jsonService.getJson(x).then(function(F){if(u.Log.debug("MetadataService.getSigningKeys: key set received",F),!F.keys)throw u.Log.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return v._settings.signingKeys=F.keys,v._settings.signingKeys})})},c(h,[{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(f)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=f))),this._metadataUrl}}]),h}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.UrlUtility=void 0;var c=o(0),u=o(1);n.UrlUtility=function(){function l(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.addQueryParam=function(f,h,p){return f.indexOf("?")<0&&(f+="?"),f[f.length-1]!=="?"&&(f+="&"),f+=encodeURIComponent(h),f+="=",f+=encodeURIComponent(p)},l.parseUrlFragment=function(f){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#",p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.Global;typeof f!="string"&&(f=p.location.href);var v=f.lastIndexOf(h);v>=0&&(f=f.substr(v+1)),h==="?"&&(v=f.indexOf("#"))>=0&&(f=f.substr(0,v));for(var x,F={},I=/([^&=]+)=([^&]*)/g,R=0;x=I.exec(f);)if(F[decodeURIComponent(x[1])]=decodeURIComponent(x[2].replace(/\+/g," ")),R++>50)return c.Log.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",f),{error:"Response exceeded expected number of parameters"};for(var C in F)return F;return{}},l}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.JoseUtil=void 0;var c=o(26),u=function(g){return g&&g.__esModule?g:{default:g}}(o(33));n.JoseUtil=(0,u.default)({jws:c.jws,KeyUtil:c.KeyUtil,X509:c.X509,crypto:c.crypto,hextob64u:c.hextob64u,b64tohex:c.b64tohex,AllowedSigningAlgs:c.AllowedSigningAlgs})},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.OidcClientSettings=void 0;var c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},u=function(){function C(L,N){for(var O=0;O<N.length;O++){var Y=N[O];Y.enumerable=Y.enumerable||!1,Y.configurable=!0,"value"in Y&&(Y.writable=!0),Object.defineProperty(L,Y.key,Y)}}return function(L,N,O){return N&&C(L.prototype,N),O&&C(L,O),L}}(),l=o(0),g=o(23),f=o(6),h=o(24),p=o(2);function v(C,L){if(!(C instanceof L))throw new TypeError("Cannot call a class as a function")}var x=".well-known/openid-configuration",F="id_token",I="openid",R="client_secret_post";n.OidcClientSettings=function(){function C(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},N=L.authority,O=L.metadataUrl,Y=L.metadata,Q=L.signingKeys,W=L.metadataSeed,fe=L.client_id,de=L.client_secret,q=L.response_type,he=q===void 0?F:q,ke=L.scope,le=ke===void 0?I:ke,Ue=L.redirect_uri,Te=L.post_logout_redirect_uri,Ne=L.client_authentication,Oe=Ne===void 0?R:Ne,He=L.prompt,Fe=L.display,Pe=L.max_age,Ae=L.ui_locales,Me=L.acr_values,Ie=L.resource,We=L.response_mode,it=L.filterProtocolClaims,wt=it===void 0||it,st=L.loadUserInfo,Ge=st===void 0||st,Qe=L.staleStateAge,Je=Qe===void 0?900:Qe,X=L.clockSkew,E=X===void 0?300:X,m=L.clockService,A=m===void 0?new g.ClockService:m,D=L.userInfoJwtIssuer,Z=D===void 0?"OP":D,te=L.mergeClaims,me=te!==void 0&&te,we=L.stateStore,Re=we===void 0?new f.WebStorageStateStore:we,De=L.ResponseValidatorCtor,_e=De===void 0?h.ResponseValidator:De,tt=L.MetadataServiceCtor,It=tt===void 0?p.MetadataService:tt,Se=L.extraQueryParams,rt=Se===void 0?{}:Se,T=L.extraTokenParams,_=T===void 0?{}:T;v(this,C),this._authority=N,this._metadataUrl=O,this._metadata=Y,this._metadataSeed=W,this._signingKeys=Q,this._client_id=fe,this._client_secret=de,this._response_type=he,this._scope=le,this._redirect_uri=Ue,this._post_logout_redirect_uri=Te,this._client_authentication=Oe,this._prompt=He,this._display=Fe,this._max_age=Pe,this._ui_locales=Ae,this._acr_values=Me,this._resource=Ie,this._response_mode=We,this._filterProtocolClaims=!!wt,this._loadUserInfo=!!Ge,this._staleStateAge=Je,this._clockSkew=E,this._clockService=A,this._userInfoJwtIssuer=Z,this._mergeClaims=!!me,this._stateStore=Re,this._validator=new _e(this),this._metadataService=new It(this),this._extraQueryParams=(rt===void 0?"undefined":c(rt))==="object"?rt:{},this._extraTokenParams=(_===void 0?"undefined":c(_))==="object"?_:{}}return C.prototype.getEpochTime=function(){return this._clockService.getEpochTime()},u(C,[{key:"client_id",get:function(){return this._client_id},set:function(N){if(this._client_id)throw l.Log.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=N}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"client_authentication",get:function(){return this._client_authentication}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"response_mode",get:function(){return this._response_mode}},{key:"authority",get:function(){return this._authority},set:function(N){if(this._authority)throw l.Log.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=N}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(x)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=x)),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(N){this._metadata=N}},{key:"metadataSeed",get:function(){return this._metadataSeed},set:function(N){this._metadataSeed=N}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(N){this._signingKeys=N}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function(){return this._userInfoJwtIssuer}},{key:"mergeClaims",get:function(){return this._mergeClaims}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}},{key:"extraQueryParams",get:function(){return this._extraQueryParams},set:function(N){(N===void 0?"undefined":c(N))==="object"?this._extraQueryParams=N:this._extraQueryParams={}}},{key:"extraTokenParams",get:function(){return this._extraTokenParams},set:function(N){(N===void 0?"undefined":c(N))==="object"?this._extraTokenParams=N:this._extraTokenParams={}}}]),C}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.WebStorageStateStore=void 0;var c=o(0),u=o(1);function l(g,f){if(!(g instanceof f))throw new TypeError("Cannot call a class as a function")}n.WebStorageStateStore=function(){function g(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=f.prefix,p=h===void 0?"oidc.":h,v=f.store,x=v===void 0?u.Global.localStorage:v;l(this,g),this._store=x,this._prefix=p}return g.prototype.set=function(h,p){return c.Log.debug("WebStorageStateStore.set",h),h=this._prefix+h,this._store.setItem(h,p),Promise.resolve()},g.prototype.get=function(h){c.Log.debug("WebStorageStateStore.get",h),h=this._prefix+h;var p=this._store.getItem(h);return Promise.resolve(p)},g.prototype.remove=function(h){c.Log.debug("WebStorageStateStore.remove",h),h=this._prefix+h;var p=this._store.getItem(h);return this._store.removeItem(h),Promise.resolve(p)},g.prototype.getAllKeys=function(){c.Log.debug("WebStorageStateStore.getAllKeys");for(var h=[],p=0;p<this._store.length;p++){var v=this._store.key(p);v.indexOf(this._prefix)===0&&h.push(v.substr(this._prefix.length))}return Promise.resolve(h)},g}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.JsonService=void 0;var c=o(0),u=o(1);function l(g,f){if(!(g instanceof f))throw new TypeError("Cannot call a class as a function")}n.JsonService=function(){function g(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:u.Global.XMLHttpRequest,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;l(this,g),f&&Array.isArray(f)?this._contentTypes=f.slice():this._contentTypes=[],this._contentTypes.push("application/json"),p&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=h,this._jwtHandler=p}return g.prototype.getJson=function(h,p){var v=this;if(!h)throw c.Log.error("JsonService.getJson: No url passed"),new Error("url");return c.Log.debug("JsonService.getJson, url: ",h),new Promise(function(x,F){var I=new v._XMLHttpRequest;I.open("GET",h);var R=v._contentTypes,C=v._jwtHandler;I.onload=function(){if(c.Log.debug("JsonService.getJson: HTTP response received, status",I.status),I.status===200){var L=I.getResponseHeader("Content-Type");if(L){var N=R.find(function(O){if(L.startsWith(O))return!0});if(N=="application/jwt")return void C(I).then(x,F);if(N)try{return void x(JSON.parse(I.responseText))}catch(O){return c.Log.error("JsonService.getJson: Error parsing JSON response",O.message),void F(O)}}F(Error("Invalid response Content-Type: "+L+", from URL: "+h))}else F(Error(I.statusText+" ("+I.status+")"))},I.onerror=function(){c.Log.error("JsonService.getJson: network error"),F(Error("Network Error"))},p&&(c.Log.debug("JsonService.getJson: token passed, setting Authorization header"),I.setRequestHeader("Authorization","Bearer "+p)),I.send()})},g.prototype.postForm=function(h,p,v){var x=this;if(!h)throw c.Log.error("JsonService.postForm: No url passed"),new Error("url");return c.Log.debug("JsonService.postForm, url: ",h),new Promise(function(F,I){var R=new x._XMLHttpRequest;R.open("POST",h);var C=x._contentTypes;R.onload=function(){if(c.Log.debug("JsonService.postForm: HTTP response received, status",R.status),R.status!==200){if(R.status===400&&(Q=R.getResponseHeader("Content-Type"))&&C.find(function(W){if(Q.startsWith(W))return!0}))try{var Y=JSON.parse(R.responseText);if(Y&&Y.error)return c.Log.error("JsonService.postForm: Error from server: ",Y.error),void I(new Error(Y.error))}catch(W){return c.Log.error("JsonService.postForm: Error parsing JSON response",W.message),void I(W)}I(Error(R.statusText+" ("+R.status+")"))}else{var Q;if((Q=R.getResponseHeader("Content-Type"))&&C.find(function(W){if(Q.startsWith(W))return!0}))try{return void F(JSON.parse(R.responseText))}catch(W){return c.Log.error("JsonService.postForm: Error parsing JSON response",W.message),void I(W)}I(Error("Invalid response Content-Type: "+Q+", from URL: "+h))}},R.onerror=function(){c.Log.error("JsonService.postForm: network error"),I(Error("Network Error"))};var L="";for(var N in p){var O=p[N];O&&(L.length>0&&(L+="&"),L+=encodeURIComponent(N),L+="=",L+=encodeURIComponent(O))}R.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),v!==void 0&&R.setRequestHeader("Authorization","Basic "+btoa(v)),R.send(L)})},g}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.SigninRequest=void 0;var c=o(0),u=o(3),l=o(13);n.SigninRequest=function(){function g(f){var h=f.url,p=f.client_id,v=f.redirect_uri,x=f.response_type,F=f.scope,I=f.authority,R=f.data,C=f.prompt,L=f.display,N=f.max_age,O=f.ui_locales,Y=f.id_token_hint,Q=f.login_hint,W=f.acr_values,fe=f.resource,de=f.response_mode,q=f.request,he=f.request_uri,ke=f.extraQueryParams,le=f.request_type,Ue=f.client_secret,Te=f.extraTokenParams,Ne=f.skipUserInfo;if(function(Ie,We){if(!(Ie instanceof We))throw new TypeError("Cannot call a class as a function")}(this,g),!h)throw c.Log.error("SigninRequest.ctor: No url passed"),new Error("url");if(!p)throw c.Log.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!v)throw c.Log.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!x)throw c.Log.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!F)throw c.Log.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!I)throw c.Log.error("SigninRequest.ctor: No authority passed"),new Error("authority");var Oe=g.isOidc(x),He=g.isCode(x);de||(de=g.isCode(x)?"query":null),this.state=new l.SigninState({nonce:Oe,data:R,client_id:p,authority:I,redirect_uri:v,code_verifier:He,request_type:le,response_mode:de,client_secret:Ue,scope:F,extraTokenParams:Te,skipUserInfo:Ne}),h=u.UrlUtility.addQueryParam(h,"client_id",p),h=u.UrlUtility.addQueryParam(h,"redirect_uri",v),h=u.UrlUtility.addQueryParam(h,"response_type",x),h=u.UrlUtility.addQueryParam(h,"scope",F),h=u.UrlUtility.addQueryParam(h,"state",this.state.id),Oe&&(h=u.UrlUtility.addQueryParam(h,"nonce",this.state.nonce)),He&&(h=u.UrlUtility.addQueryParam(h,"code_challenge",this.state.code_challenge),h=u.UrlUtility.addQueryParam(h,"code_challenge_method","S256"));var Fe={prompt:C,display:L,max_age:N,ui_locales:O,id_token_hint:Y,login_hint:Q,acr_values:W,resource:fe,request:q,request_uri:he,response_mode:de};for(var Pe in Fe)Fe[Pe]&&(h=u.UrlUtility.addQueryParam(h,Pe,Fe[Pe]));for(var Ae in ke)h=u.UrlUtility.addQueryParam(h,Ae,ke[Ae]);this.url=h}return g.isOidc=function(h){return!!h.split(/\s+/g).filter(function(p){return p==="id_token"})[0]},g.isOAuth=function(h){return!!h.split(/\s+/g).filter(function(p){return p==="token"})[0]},g.isCode=function(h){return!!h.split(/\s+/g).filter(function(p){return p==="code"})[0]},g}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.State=void 0;var c=function(){function f(h,p){for(var v=0;v<p.length;v++){var x=p[v];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(h,x.key,x)}}return function(h,p,v){return p&&f(h.prototype,p),v&&f(h,v),h}}(),u=o(0),l=function(h){return h&&h.__esModule?h:{default:h}}(o(14));function g(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")}n.State=function(){function f(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=h.id,v=h.data,x=h.created,F=h.request_type;g(this,f),this._id=p||(0,l.default)(),this._data=v,this._created=typeof x=="number"&&x>0?x:parseInt(Date.now()/1e3),this._request_type=F}return f.prototype.toStorageString=function(){return u.Log.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},f.fromStorageString=function(p){return u.Log.debug("State.fromStorageString"),new f(JSON.parse(p))},f.clearStaleState=function(p,v){var x=Date.now()/1e3-v;return p.getAllKeys().then(function(F){u.Log.debug("State.clearStaleState: got keys",F);for(var I=[],R=function(O){var Y=F[O];L=p.get(Y).then(function(Q){var W=!1;if(Q)try{var fe=f.fromStorageString(Q);u.Log.debug("State.clearStaleState: got item from key: ",Y,fe.created),fe.created<=x&&(W=!0)}catch(de){u.Log.error("State.clearStaleState: Error parsing state for key",Y,de.message),W=!0}else u.Log.debug("State.clearStaleState: no item in storage for key: ",Y),W=!0;if(W)return u.Log.debug("State.clearStaleState: removed item for key: ",Y),p.remove(Y)}),I.push(L)},C=0;C<F.length;C++){var L;R(C)}return u.Log.debug("State.clearStaleState: waiting on promise count:",I.length),Promise.all(I)})},c(f,[{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}},{key:"request_type",get:function(){return this._request_type}}]),f}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.OidcClient=void 0;var c=function(){function R(C,L){for(var N=0;N<L.length;N++){var O=L[N];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(C,O.key,O)}}return function(C,L,N){return L&&R(C.prototype,L),N&&R(C,N),C}}(),u=o(0),l=o(5),g=o(12),f=o(8),h=o(34),p=o(35),v=o(36),x=o(13),F=o(9);function I(R,C){if(!(R instanceof C))throw new TypeError("Cannot call a class as a function")}n.OidcClient=function(){function R(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};I(this,R),C instanceof l.OidcClientSettings?this._settings=C:this._settings=new l.OidcClientSettings(C)}return R.prototype.createSigninRequest=function(){var L=this,N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},O=N.response_type,Y=N.scope,Q=N.redirect_uri,W=N.data,fe=N.state,de=N.prompt,q=N.display,he=N.max_age,ke=N.ui_locales,le=N.id_token_hint,Ue=N.login_hint,Te=N.acr_values,Ne=N.resource,Oe=N.request,He=N.request_uri,Fe=N.response_mode,Pe=N.extraQueryParams,Ae=N.extraTokenParams,Me=N.request_type,Ie=N.skipUserInfo,We=arguments[1];u.Log.debug("OidcClient.createSigninRequest");var it=this._settings.client_id;O=O||this._settings.response_type,Y=Y||this._settings.scope,Q=Q||this._settings.redirect_uri,de=de||this._settings.prompt,q=q||this._settings.display,he=he||this._settings.max_age,ke=ke||this._settings.ui_locales,Te=Te||this._settings.acr_values,Ne=Ne||this._settings.resource,Fe=Fe||this._settings.response_mode,Pe=Pe||this._settings.extraQueryParams,Ae=Ae||this._settings.extraTokenParams;var wt=this._settings.authority;return f.SigninRequest.isCode(O)&&O!=="code"?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(function(st){u.Log.debug("OidcClient.createSigninRequest: Received authorization endpoint",st);var Ge=new f.SigninRequest({url:st,client_id:it,redirect_uri:Q,response_type:O,scope:Y,data:W||fe,authority:wt,prompt:de,display:q,max_age:he,ui_locales:ke,id_token_hint:le,login_hint:Ue,acr_values:Te,resource:Ne,request:Oe,request_uri:He,extraQueryParams:Pe,extraTokenParams:Ae,request_type:Me,response_mode:Fe,client_secret:L._settings.client_secret,skipUserInfo:Ie}),Qe=Ge.state;return(We=We||L._stateStore).set(Qe.id,Qe.toStorageString()).then(function(){return Ge})})},R.prototype.readSigninResponseState=function(L,N){var O=arguments.length>2&&arguments[2]!==void 0&&arguments[2];u.Log.debug("OidcClient.readSigninResponseState");var Y=this._settings.response_mode==="query"||!this._settings.response_mode&&f.SigninRequest.isCode(this._settings.response_type),Q=Y?"?":"#",W=new h.SigninResponse(L,Q);if(!W.state)return u.Log.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response"));N=N||this._stateStore;var fe=O?N.remove.bind(N):N.get.bind(N);return fe(W.state).then(function(de){if(!de)throw u.Log.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:x.SigninState.fromStorageString(de),response:W}})},R.prototype.processSigninResponse=function(L,N){var O=this;return u.Log.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(L,N,!0).then(function(Y){var Q=Y.state,W=Y.response;return u.Log.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),O._validator.validateSigninResponse(Q,W)})},R.prototype.createSignoutRequest=function(){var L=this,N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},O=N.id_token_hint,Y=N.data,Q=N.state,W=N.post_logout_redirect_uri,fe=N.extraQueryParams,de=N.request_type,q=arguments[1];return u.Log.debug("OidcClient.createSignoutRequest"),W=W||this._settings.post_logout_redirect_uri,fe=fe||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(function(he){if(!he)throw u.Log.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");u.Log.debug("OidcClient.createSignoutRequest: Received end session endpoint",he);var ke=new p.SignoutRequest({url:he,id_token_hint:O,post_logout_redirect_uri:W,data:Y||Q,extraQueryParams:fe,request_type:de}),le=ke.state;return le&&(u.Log.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(q=q||L._stateStore).set(le.id,le.toStorageString())),ke})},R.prototype.readSignoutResponseState=function(L,N){var O=arguments.length>2&&arguments[2]!==void 0&&arguments[2];u.Log.debug("OidcClient.readSignoutResponseState");var Y=new v.SignoutResponse(L);if(!Y.state)return u.Log.debug("OidcClient.readSignoutResponseState: No state in response"),Y.error?(u.Log.warn("OidcClient.readSignoutResponseState: Response was error: ",Y.error),Promise.reject(new g.ErrorResponse(Y))):Promise.resolve({state:void 0,response:Y});var Q=Y.state;N=N||this._stateStore;var W=O?N.remove.bind(N):N.get.bind(N);return W(Q).then(function(fe){if(!fe)throw u.Log.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:F.State.fromStorageString(fe),response:Y}})},R.prototype.processSignoutResponse=function(L,N){var O=this;return u.Log.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(L,N,!0).then(function(Y){var Q=Y.state,W=Y.response;return Q?(u.Log.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),O._validator.validateSignoutResponse(Q,W)):(u.Log.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),W)})},R.prototype.clearStaleState=function(L){return u.Log.debug("OidcClient.clearStaleState"),L=L||this._stateStore,F.State.clearStaleState(L,this.settings.staleStateAge)},c(R,[{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),R}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.TokenClient=void 0;var c=o(7),u=o(2),l=o(0);function g(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")}n.TokenClient=function(){function f(h){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:c.JsonService,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.MetadataService;if(g(this,f),!h)throw l.Log.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=h,this._jsonService=new p,this._metadataService=new v(this._settings)}return f.prototype.exchangeCode=function(){var p=this,v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(v=Object.assign({},v)).grant_type=v.grant_type||"authorization_code",v.client_id=v.client_id||this._settings.client_id,v.client_secret=v.client_secret||this._settings.client_secret,v.redirect_uri=v.redirect_uri||this._settings.redirect_uri;var x=void 0,F=v._client_authentication||this._settings._client_authentication;return delete v._client_authentication,v.code?v.redirect_uri?v.code_verifier?v.client_id?v.client_secret||F!="client_secret_basic"?(F=="client_secret_basic"&&(x=v.client_id+":"+v.client_secret,delete v.client_id,delete v.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(I){return l.Log.debug("TokenClient.exchangeCode: Received token endpoint"),p._jsonService.postForm(I,v,x).then(function(R){return l.Log.debug("TokenClient.exchangeCode: response received"),R})})):(l.Log.error("TokenClient.exchangeCode: No client_secret passed"),Promise.reject(new Error("A client_secret is required"))):(l.Log.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(l.Log.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(l.Log.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(l.Log.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))},f.prototype.exchangeRefreshToken=function(){var p=this,v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(v=Object.assign({},v)).grant_type=v.grant_type||"refresh_token",v.client_id=v.client_id||this._settings.client_id,v.client_secret=v.client_secret||this._settings.client_secret;var x=void 0,F=v._client_authentication||this._settings._client_authentication;return delete v._client_authentication,v.refresh_token?v.client_id?(F=="client_secret_basic"&&(x=v.client_id+":"+v.client_secret,delete v.client_id,delete v.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(I){return l.Log.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),p._jsonService.postForm(I,v,x).then(function(R){return l.Log.debug("TokenClient.exchangeRefreshToken: response received"),R})})):(l.Log.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(l.Log.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))},f}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorResponse=void 0;var c=o(0);function u(g,f){if(!(g instanceof f))throw new TypeError("Cannot call a class as a function")}function l(g,f){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!f||typeof f!="object"&&typeof f!="function"?g:f}n.ErrorResponse=function(g){function f(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=h.error,v=h.error_description,x=h.error_uri,F=h.state,I=h.session_state;if(u(this,f),!p)throw c.Log.error("No error passed to ErrorResponse"),new Error("error");var R=l(this,g.call(this,v||p));return R.name="ErrorResponse",R.error=p,R.error_description=v,R.error_uri=x,R.state=F,R.session_state=I,R}return function(p,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);p.prototype=Object.create(v&&v.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(p,v):p.__proto__=v)}(f,g),f}(Error)},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.SigninState=void 0;var c=function(){function v(x,F){for(var I=0;I<F.length;I++){var R=F[I];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(x,R.key,R)}}return function(x,F,I){return F&&v(x.prototype,F),I&&v(x,I),x}}(),u=o(0),l=o(9),g=o(4),f=function(x){return x&&x.__esModule?x:{default:x}}(o(14));function h(v,x){if(!(v instanceof x))throw new TypeError("Cannot call a class as a function")}function p(v,x){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!x||typeof x!="object"&&typeof x!="function"?v:x}n.SigninState=function(v){function x(){var F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},I=F.nonce,R=F.authority,C=F.client_id,L=F.redirect_uri,N=F.code_verifier,O=F.response_mode,Y=F.client_secret,Q=F.scope,W=F.extraTokenParams,fe=F.skipUserInfo;h(this,x);var de=p(this,v.call(this,arguments[0]));if(I===!0?de._nonce=(0,f.default)():I&&(de._nonce=I),N===!0?de._code_verifier=(0,f.default)()+(0,f.default)()+(0,f.default)():N&&(de._code_verifier=N),de.code_verifier){var q=g.JoseUtil.hashString(de.code_verifier,"SHA256");de._code_challenge=g.JoseUtil.hexToBase64Url(q)}return de._redirect_uri=L,de._authority=R,de._client_id=C,de._response_mode=O,de._client_secret=Y,de._scope=Q,de._extraTokenParams=W,de._skipUserInfo=fe,de}return function(I,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);I.prototype=Object.create(R&&R.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(I,R):I.__proto__=R)}(x,v),x.prototype.toStorageString=function(){return u.Log.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},x.fromStorageString=function(I){return u.Log.debug("SigninState.fromStorageString"),new x(JSON.parse(I))},c(x,[{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"code_verifier",get:function(){return this._code_verifier}},{key:"code_challenge",get:function(){return this._code_challenge}},{key:"response_mode",get:function(){return this._response_mode}},{key:"client_secret",get:function(){return this._client_secret}},{key:"scope",get:function(){return this._scope}},{key:"extraTokenParams",get:function(){return this._extraTokenParams}},{key:"skipUserInfo",get:function(){return this._skipUserInfo}}]),x}(l.State)},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){return(c!="undefined"&&c!==null&&c.getRandomValues!==void 0?u:l)().replace(/-/g,"")};var c=typeof window<"u"?window.crypto||window.msCrypto:null;function u(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,function(g){return(g^c.getRandomValues(new Uint8Array(1))[0]&15>>g/4).toString(16)})}function l(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,function(g){return(g^16*Math.random()>>g/4).toString(16)})}r.exports=n.default},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.User=void 0;var c=function(){function l(g,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(g,p.key,p)}}return function(g,f,h){return f&&l(g.prototype,f),h&&l(g,h),g}}(),u=o(0);n.User=function(){function l(g){var f=g.id_token,h=g.session_state,p=g.access_token,v=g.refresh_token,x=g.token_type,F=g.scope,I=g.profile,R=g.expires_at,C=g.state;(function(N,O){if(!(N instanceof O))throw new TypeError("Cannot call a class as a function")})(this,l),this.id_token=f,this.session_state=h,this.access_token=p,this.refresh_token=v,this.token_type=x,this.scope=F,this.profile=I,this.expires_at=R,this.state=C}return l.prototype.toStorageString=function(){return u.Log.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},l.fromStorageString=function(f){return u.Log.debug("User.fromStorageString"),new l(JSON.parse(f))},c(l,[{key:"expires_in",get:function(){if(this.expires_at){var f=parseInt(Date.now()/1e3);return this.expires_at-f}},set:function(f){var h=parseInt(f);if(typeof h=="number"&&h>0){var p=parseInt(Date.now()/1e3);this.expires_at=p+h}}},{key:"expired",get:function(){var f=this.expires_in;if(f!==void 0)return f<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}]),l}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.AccessTokenEvents=void 0;var c=o(0),u=o(46);function l(g,f){if(!(g instanceof f))throw new TypeError("Cannot call a class as a function")}n.AccessTokenEvents=function(){function g(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=f.accessTokenExpiringNotificationTime,p=h===void 0?60:h,v=f.accessTokenExpiringTimer,x=v===void 0?new u.Timer("Access token expiring"):v,F=f.accessTokenExpiredTimer,I=F===void 0?new u.Timer("Access token expired"):F;l(this,g),this._accessTokenExpiringNotificationTime=p,this._accessTokenExpiring=x,this._accessTokenExpired=I}return g.prototype.load=function(h){if(h.access_token&&h.expires_in!==void 0){var p=h.expires_in;if(c.Log.debug("AccessTokenEvents.load: access token present, remaining duration:",p),p>0){var v=p-this._accessTokenExpiringNotificationTime;v<=0&&(v=1),c.Log.debug("AccessTokenEvents.load: registering expiring timer in:",v),this._accessTokenExpiring.init(v)}else c.Log.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var x=p+1;c.Log.debug("AccessTokenEvents.load: registering expired timer in:",x),this._accessTokenExpired.init(x)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},g.prototype.unload=function(){c.Log.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},g.prototype.addAccessTokenExpiring=function(h){this._accessTokenExpiring.addHandler(h)},g.prototype.removeAccessTokenExpiring=function(h){this._accessTokenExpiring.removeHandler(h)},g.prototype.addAccessTokenExpired=function(h){this._accessTokenExpired.addHandler(h)},g.prototype.removeAccessTokenExpired=function(h){this._accessTokenExpired.removeHandler(h)},g}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.Event=void 0;var c=o(0);n.Event=function(){function u(l){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,u),this._name=l,this._callbacks=[]}return u.prototype.addHandler=function(g){this._callbacks.push(g)},u.prototype.removeHandler=function(g){var f=this._callbacks.findIndex(function(h){return h===g});f>=0&&this._callbacks.splice(f,1)},u.prototype.raise=function(){c.Log.debug("Event: Raising event: "+this._name);for(var g=0;g<this._callbacks.length;g++){var f;(f=this._callbacks)[g].apply(f,arguments)}},u}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.SessionMonitor=void 0;var c=function(){function h(p,v){for(var x=0;x<v.length;x++){var F=v[x];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(p,F.key,F)}}return function(p,v,x){return v&&h(p.prototype,v),x&&h(p,x),p}}(),u=o(0),l=o(19),g=o(1);function f(h,p){if(!(h instanceof p))throw new TypeError("Cannot call a class as a function")}n.SessionMonitor=function(){function h(p){var v=this,x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.CheckSessionIFrame,F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:g.Global.timer;if(f(this,h),!p)throw u.Log.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=p,this._CheckSessionIFrameCtor=x,this._timer=F,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),Promise.resolve(this._userManager.getUser().then(function(I){I?v._start(I):v._settings.monitorAnonymousSession&&v._userManager.querySessionStatus().then(function(R){var C={session_state:R.session_state};R.sub&&R.sid&&(C.profile={sub:R.sub,sid:R.sid}),v._start(C)}).catch(function(R){u.Log.error("SessionMonitor ctor: error from querySessionStatus:",R.message)})}).catch(function(I){u.Log.error("SessionMonitor ctor: error from getUser:",I.message)}))}return h.prototype._start=function(v){var x=this,F=v.session_state;F&&(v.profile?(this._sub=v.profile.sub,this._sid=v.profile.sid,u.Log.debug("SessionMonitor._start: session_state:",F,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,u.Log.debug("SessionMonitor._start: session_state:",F,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(F):this._metadataService.getCheckSessionIframe().then(function(I){if(I){u.Log.debug("SessionMonitor._start: Initializing check session iframe");var R=x._client_id,C=x._checkSessionInterval,L=x._stopCheckSessionOnError;x._checkSessionIFrame=new x._CheckSessionIFrameCtor(x._callback.bind(x),R,I,C,L),x._checkSessionIFrame.load().then(function(){x._checkSessionIFrame.start(F)})}else u.Log.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(function(I){u.Log.error("SessionMonitor._start: Error from getCheckSessionIframe:",I.message)}))},h.prototype._stop=function(){var v=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(u.Log.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var x=this._timer.setInterval(function(){v._timer.clearInterval(x),v._userManager.querySessionStatus().then(function(F){var I={session_state:F.session_state};F.sub&&F.sid&&(I.profile={sub:F.sub,sid:F.sid}),v._start(I)}).catch(function(F){u.Log.error("SessionMonitor: error from querySessionStatus:",F.message)})},1e3)},h.prototype._callback=function(){var v=this;this._userManager.querySessionStatus().then(function(x){var F=!0;x?x.sub===v._sub?(F=!1,v._checkSessionIFrame.start(x.session_state),x.sid===v._sid?u.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",x.session_state):(u.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",x.session_state),v._userManager.events._raiseUserSessionChanged())):u.Log.debug("SessionMonitor._callback: Different subject signed into OP:",x.sub):u.Log.debug("SessionMonitor._callback: Subject no longer signed into OP"),F&&(v._sub?(u.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),v._userManager.events._raiseUserSignedOut()):(u.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),v._userManager.events._raiseUserSignedIn()))}).catch(function(x){v._sub&&(u.Log.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",x.message),v._userManager.events._raiseUserSignedOut())})},c(h,[{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function(){return this._settings.stopCheckSessionOnError}}]),h}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.CheckSessionIFrame=void 0;var c=o(0);function u(l,g){if(!(l instanceof g))throw new TypeError("Cannot call a class as a function")}n.CheckSessionIFrame=function(){function l(g,f,h,p){var v=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];u(this,l),this._callback=g,this._client_id=f,this._url=h,this._interval=p||2e3,this._stopOnError=v;var x=h.indexOf("/",h.indexOf("//")+2);this._frame_origin=h.substr(0,x),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.width=0,this._frame.height=0,this._frame.src=h}return l.prototype.load=function(){var f=this;return new Promise(function(h){f._frame.onload=function(){h()},window.document.body.appendChild(f._frame),f._boundMessageEvent=f._message.bind(f),window.addEventListener("message",f._boundMessageEvent,!1)})},l.prototype._message=function(f){f.origin===this._frame_origin&&f.source===this._frame.contentWindow&&(f.data==="error"?(c.Log.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):f.data==="changed"?(c.Log.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):c.Log.debug("CheckSessionIFrame: "+f.data+" message from check session op iframe"))},l.prototype.start=function(f){var h=this;if(this._session_state!==f){c.Log.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=f;var p=function(){h._frame.contentWindow.postMessage(h._client_id+" "+h._session_state,h._frame_origin)};p(),this._timer=window.setInterval(p,this._interval)}},l.prototype.stop=function(){this._session_state=null,this._timer&&(c.Log.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},l}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.TokenRevocationClient=void 0;var c=o(0),u=o(2),l=o(1);function g(p,v){if(!(p instanceof v))throw new TypeError("Cannot call a class as a function")}var f="access_token",h="refresh_token";n.TokenRevocationClient=function(){function p(v){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.Global.XMLHttpRequest,F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.MetadataService;if(g(this,p),!v)throw c.Log.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=v,this._XMLHttpRequestCtor=x,this._metadataService=new F(this._settings)}return p.prototype.revoke=function(x,F){var I=this,R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"access_token";if(!x)throw c.Log.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if(R!==f&&R!=h)throw c.Log.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(function(C){if(C){c.Log.debug("TokenRevocationClient.revoke: Revoking "+R);var L=I._settings.client_id,N=I._settings.client_secret;return I._revoke(C,L,N,x,R)}if(F)throw c.Log.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")})},p.prototype._revoke=function(x,F,I,R,C){var L=this;return new Promise(function(N,O){var Y=new L._XMLHttpRequestCtor;Y.open("POST",x),Y.onload=function(){c.Log.debug("TokenRevocationClient.revoke: HTTP response received, status",Y.status),Y.status===200?N():O(Error(Y.statusText+" ("+Y.status+")"))},Y.onerror=function(){c.Log.debug("TokenRevocationClient.revoke: Network Error."),O("Network Error")};var Q="client_id="+encodeURIComponent(F);I&&(Q+="&client_secret="+encodeURIComponent(I)),Q+="&token_type_hint="+encodeURIComponent(C),Q+="&token="+encodeURIComponent(R),Y.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),Y.send(Q)})},p}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.CordovaPopupWindow=void 0;var c=function(){function l(g,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(g,p.key,p)}}return function(g,f,h){return f&&l(g.prototype,f),h&&l(g,h),g}}(),u=o(0);n.CordovaPopupWindow=function(){function l(g){var f=this;(function(p,v){if(!(p instanceof v))throw new TypeError("Cannot call a class as a function")})(this,l),this._promise=new Promise(function(h,p){f._resolve=h,f._reject=p}),this.features=g.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=g.popupWindowTarget||"_blank",this.redirect_uri=g.startUrl,u.Log.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}return l.prototype._isInAppBrowserInstalled=function(f){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(h){return f.hasOwnProperty(h)})},l.prototype.navigate=function(f){if(f&&f.url){if(!window.cordova)return this._error("cordova is undefined");var h=window.cordova.require("cordova/plugin_list").metadata;if(this._isInAppBrowserInstalled(h)===!1)return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(f.url,this.target,this.features),this._popup?(u.Log.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},l.prototype._loadStartCallback=function(f){f.url.indexOf(this.redirect_uri)===0&&this._success({url:f.url})},l.prototype._exitCallback=function(f){this._error(f)},l.prototype._success=function(f){this._cleanup(),u.Log.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(f)},l.prototype._error=function(f){this._cleanup(),u.Log.error(f),this._reject(new Error(f))},l.prototype.close=function(){this._cleanup()},l.prototype._cleanup=function(){this._popup&&(u.Log.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},c(l,[{key:"promise",get:function(){return this._promise}}]),l}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var c=o(0),u=o(10),l=o(5),g=o(6),f=o(37),h=o(38),p=o(16),v=o(2),x=o(48),F=o(49),I=o(19),R=o(20),C=o(18),L=o(1),N=o(15),O=o(50);n.default={Version:O.Version,Log:c.Log,OidcClient:u.OidcClient,OidcClientSettings:l.OidcClientSettings,WebStorageStateStore:g.WebStorageStateStore,InMemoryWebStorage:f.InMemoryWebStorage,UserManager:h.UserManager,AccessTokenEvents:p.AccessTokenEvents,MetadataService:v.MetadataService,CordovaPopupNavigator:x.CordovaPopupNavigator,CordovaIFrameNavigator:F.CordovaIFrameNavigator,CheckSessionIFrame:I.CheckSessionIFrame,TokenRevocationClient:R.TokenRevocationClient,SessionMonitor:C.SessionMonitor,Global:L.Global,User:N.User},r.exports=n.default},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.ClockService=function(){function c(){(function(l,g){if(!(l instanceof g))throw new TypeError("Cannot call a class as a function")})(this,c)}return c.prototype.getEpochTime=function(){return Promise.resolve(Date.now()/1e3|0)},c}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.ResponseValidator=void 0;var c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},u=o(0),l=o(2),g=o(25),f=o(11),h=o(12),p=o(4);function v(F,I){if(!(F instanceof I))throw new TypeError("Cannot call a class as a function")}var x=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"];n.ResponseValidator=function(){function F(I){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.MetadataService,C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:g.UserInfoService,L=arguments.length>3&&arguments[3]!==void 0?arguments[3]:p.JoseUtil,N=arguments.length>4&&arguments[4]!==void 0?arguments[4]:f.TokenClient;if(v(this,F),!I)throw u.Log.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=I,this._metadataService=new R(this._settings),this._userInfoService=new C(this._settings),this._joseUtil=L,this._tokenClient=new N(this._settings)}return F.prototype.validateSigninResponse=function(R,C){var L=this;return u.Log.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(R,C).then(function(N){return u.Log.debug("ResponseValidator.validateSigninResponse: state processed"),L._validateTokens(R,N).then(function(O){return u.Log.debug("ResponseValidator.validateSigninResponse: tokens validated"),L._processClaims(R,O).then(function(Y){return u.Log.debug("ResponseValidator.validateSigninResponse: claims processed"),Y})})})},F.prototype.validateSignoutResponse=function(R,C){return R.id!==C.state?(u.Log.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(u.Log.debug("ResponseValidator.validateSignoutResponse: state validated"),C.state=R.data,C.error?(u.Log.warn("ResponseValidator.validateSignoutResponse: Response was error",C.error),Promise.reject(new h.ErrorResponse(C))):Promise.resolve(C))},F.prototype._processSigninParams=function(R,C){if(R.id!==C.state)return u.Log.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!R.client_id)return u.Log.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!R.authority)return u.Log.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==R.authority)return u.Log.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=R.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==R.client_id)return u.Log.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=R.client_id;return u.Log.debug("ResponseValidator._processSigninParams: state validated"),C.state=R.data,C.error?(u.Log.warn("ResponseValidator._processSigninParams: Response was error",C.error),Promise.reject(new h.ErrorResponse(C))):R.nonce&&!C.id_token?(u.Log.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!R.nonce&&C.id_token?(u.Log.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):R.code_verifier&&!C.code?(u.Log.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!R.code_verifier&&C.code?(u.Log.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(C.scope||(C.scope=R.scope),Promise.resolve(C))},F.prototype._processClaims=function(R,C){var L=this;if(C.isOpenIdConnect){if(u.Log.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),C.profile=this._filterProtocolClaims(C.profile),R.skipUserInfo!==!0&&this._settings.loadUserInfo&&C.access_token)return u.Log.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(C.access_token).then(function(N){return u.Log.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),N.sub!==C.profile.sub?(u.Log.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in id_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in id_token"))):(C.profile=L._mergeClaims(C.profile,N),u.Log.debug("ResponseValidator._processClaims: user info claims received, updated profile:",C.profile),C)});u.Log.debug("ResponseValidator._processClaims: not loading user info")}else u.Log.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(C)},F.prototype._mergeClaims=function(R,C){var L=Object.assign({},R);for(var N in C){var O=C[N];Array.isArray(O)||(O=[O]);for(var Y=0;Y<O.length;Y++){var Q=O[Y];L[N]?Array.isArray(L[N])?L[N].indexOf(Q)<0&&L[N].push(Q):L[N]!==Q&&((Q===void 0?"undefined":c(Q))==="object"&&this._settings.mergeClaims?L[N]=this._mergeClaims(L[N],Q):L[N]=[L[N],Q]):L[N]=Q}}return L},F.prototype._filterProtocolClaims=function(R){u.Log.debug("ResponseValidator._filterProtocolClaims, incoming claims:",R);var C=Object.assign({},R);return this._settings._filterProtocolClaims?(x.forEach(function(L){delete C[L]}),u.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",C)):u.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),C},F.prototype._validateTokens=function(R,C){return C.code?(u.Log.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(R,C)):C.id_token?C.access_token?(u.Log.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(R,C)):(u.Log.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(R,C)):(u.Log.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(C))},F.prototype._processCode=function(R,C){var L=this,N={client_id:R.client_id,client_secret:R.client_secret,code:C.code,redirect_uri:R.redirect_uri,code_verifier:R.code_verifier};return R.extraTokenParams&&c(R.extraTokenParams)==="object"&&Object.assign(N,R.extraTokenParams),this._tokenClient.exchangeCode(N).then(function(O){for(var Y in O)C[Y]=O[Y];return C.id_token?(u.Log.debug("ResponseValidator._processCode: token response successful, processing id_token"),L._validateIdTokenAttributes(R,C)):(u.Log.debug("ResponseValidator._processCode: token response successful, returning response"),C)})},F.prototype._validateIdTokenAttributes=function(R,C){var L=this;return this._metadataService.getIssuer().then(function(N){var O=R.client_id,Y=L._settings.clockSkew;return u.Log.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",Y),L._settings.getEpochTime().then(function(Q){return L._joseUtil.validateJwtAttributes(C.id_token,N,O,Y,Q).then(function(W){return R.nonce&&R.nonce!==W.nonce?(u.Log.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):W.sub?(C.profile=W,C):(u.Log.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})})},F.prototype._validateIdTokenAndAccessToken=function(R,C){var L=this;return this._validateIdToken(R,C).then(function(N){return L._validateAccessToken(N)})},F.prototype._getSigningKeyForJwt=function(R){var C=this;return this._metadataService.getSigningKeys().then(function(L){var N=R.header.kid;if(!L)return u.Log.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));u.Log.debug("ResponseValidator._validateIdToken: Received signing keys");var O=void 0;if(N)O=L.filter(function(Y){return Y.kid===N})[0];else{if((L=C._filterByAlg(L,R.header.alg)).length>1)return u.Log.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));O=L[0]}return Promise.resolve(O)})},F.prototype._getSigningKeyForJwtWithSingleRetry=function(R){var C=this;return this._getSigningKeyForJwt(R).then(function(L){return L?Promise.resolve(L):(C._metadataService.resetSigningKeys(),C._getSigningKeyForJwt(R))})},F.prototype._validateIdToken=function(R,C){var L=this;if(!R.nonce)return u.Log.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var N=this._joseUtil.parseJwt(C.id_token);return N&&N.header&&N.payload?R.nonce!==N.payload.nonce?(u.Log.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):this._metadataService.getIssuer().then(function(O){return u.Log.debug("ResponseValidator._validateIdToken: Received issuer"),L._getSigningKeyForJwtWithSingleRetry(N).then(function(Y){if(!Y)return u.Log.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var Q=R.client_id,W=L._settings.clockSkew;return u.Log.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",W),L._joseUtil.validateJwt(C.id_token,Y,O,Q,W).then(function(){return u.Log.debug("ResponseValidator._validateIdToken: JWT validation successful"),N.payload.sub?(C.profile=N.payload,C):(u.Log.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})}):(u.Log.error("ResponseValidator._validateIdToken: Failed to parse id_token",N),Promise.reject(new Error("Failed to parse id_token")))},F.prototype._filterByAlg=function(R,C){var L=null;if(C.startsWith("RS"))L="RSA";else if(C.startsWith("PS"))L="PS";else{if(!C.startsWith("ES"))return u.Log.debug("ResponseValidator._filterByAlg: alg not supported: ",C),[];L="EC"}return u.Log.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",L),R=R.filter(function(N){return N.kty===L}),u.Log.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",L,R.length),R},F.prototype._validateAccessToken=function(R){if(!R.profile)return u.Log.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!R.profile.at_hash)return u.Log.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!R.id_token)return u.Log.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var C=this._joseUtil.parseJwt(R.id_token);if(!C||!C.header)return u.Log.error("ResponseValidator._validateAccessToken: Failed to parse id_token",C),Promise.reject(new Error("Failed to parse id_token"));var L=C.header.alg;if(!L||L.length!==5)return u.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",L),Promise.reject(new Error("Unsupported alg: "+L));var N=L.substr(2,3);if(!N)return u.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",L,N),Promise.reject(new Error("Unsupported alg: "+L));if((N=parseInt(N))!==256&&N!==384&&N!==512)return u.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",L,N),Promise.reject(new Error("Unsupported alg: "+L));var O="sha"+N,Y=this._joseUtil.hashString(R.access_token,O);if(!Y)return u.Log.error("ResponseValidator._validateAccessToken: access_token hash failed:",O),Promise.reject(new Error("Failed to validate at_hash"));var Q=Y.substr(0,Y.length/2),W=this._joseUtil.hexToBase64Url(Q);return W!==R.profile.at_hash?(u.Log.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",W,R.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(u.Log.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(R))},F}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.UserInfoService=void 0;var c=o(7),u=o(2),l=o(0),g=o(4);function f(h,p){if(!(h instanceof p))throw new TypeError("Cannot call a class as a function")}n.UserInfoService=function(){function h(p){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:c.JsonService,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.MetadataService,F=arguments.length>3&&arguments[3]!==void 0?arguments[3]:g.JoseUtil;if(f(this,h),!p)throw l.Log.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=p,this._jsonService=new v(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new x(this._settings),this._joseUtil=F}return h.prototype.getClaims=function(v){var x=this;return v?this._metadataService.getUserInfoEndpoint().then(function(F){return l.Log.debug("UserInfoService.getClaims: received userinfo url",F),x._jsonService.getJson(F,v).then(function(I){return l.Log.debug("UserInfoService.getClaims: claims received",I),I})}):(l.Log.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))},h.prototype._getClaimsFromJwt=function(v){var x=this;try{var F=this._joseUtil.parseJwt(v.responseText);if(!F||!F.header||!F.payload)return l.Log.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",F),Promise.reject(new Error("Failed to parse id_token"));var I=F.header.kid,R=void 0;switch(this._settings.userInfoJwtIssuer){case"OP":R=this._metadataService.getIssuer();break;case"ANY":R=Promise.resolve(F.payload.iss);break;default:R=Promise.resolve(this._settings.userInfoJwtIssuer)}return R.then(function(C){return l.Log.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+C),x._metadataService.getSigningKeys().then(function(L){if(!L)return l.Log.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));l.Log.debug("UserInfoService._getClaimsFromJwt: Received signing keys");var N=void 0;if(I)N=L.filter(function(Q){return Q.kid===I})[0];else{if((L=x._filterByAlg(L,F.header.alg)).length>1)return l.Log.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));N=L[0]}if(!N)return l.Log.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var O=x._settings.client_id,Y=x._settings.clockSkew;return l.Log.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",Y),x._joseUtil.validateJwt(v.responseText,N,C,O,Y,void 0,!0).then(function(){return l.Log.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),F.payload})})})}catch(C){return l.Log.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",C.message),void reject(C)}},h.prototype._filterByAlg=function(v,x){var F=null;if(x.startsWith("RS"))F="RSA";else if(x.startsWith("PS"))F="PS";else{if(!x.startsWith("ES"))return l.Log.debug("UserInfoService._filterByAlg: alg not supported: ",x),[];F="EC"}return l.Log.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",F),v=v.filter(function(I){return I.kty===F}),l.Log.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",F,v.length),v},h}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.AllowedSigningAlgs=n.b64tohex=n.hextob64u=n.crypto=n.X509=n.KeyUtil=n.jws=void 0;var c=o(27);n.jws=c.jws,n.KeyUtil=c.KEYUTIL,n.X509=c.X509,n.crypto=c.crypto,n.hextob64u=c.hextob64u,n.b64tohex=c.b64tohex,n.AllowedSigningAlgs=["RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"]},function(r,n,o){(function(c){Object.defineProperty(n,"__esModule",{value:!0});var u,l,g,f,h,p,v,x,F,I,R,C=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},L={},N={},O=O||(u=Math,g=(l={}).lib={},f=g.Base=function(){function s(){}return{extend:function(a){s.prototype=this;var d=new s;return a&&d.mixIn(a),d.hasOwnProperty("init")||(d.init=function(){d.$super.init.apply(this,arguments)}),d.init.prototype=d,d.$super=this,d},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var d in a)a.hasOwnProperty(d)&&(this[d]=a[d]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),h=g.WordArray=f.extend({init:function(i,a){i=this.words=i||[],this.sigBytes=a??4*i.length},toString:function(i){return(i||v).stringify(this)},concat:function(i){var a=this.words,d=i.words,y=this.sigBytes,S=i.sigBytes;if(this.clamp(),y%4)for(var k=0;k<S;k++){var M=d[k>>>2]>>>24-k%4*8&255;a[y+k>>>2]|=M<<24-(y+k)%4*8}else for(k=0;k<S;k+=4)a[y+k>>>2]=d[k>>>2];return this.sigBytes+=S,this},clamp:function(){var i=this.words,a=this.sigBytes;i[a>>>2]&=4294967295<<32-a%4*8,i.length=u.ceil(a/4)},clone:function(){var i=f.clone.call(this);return i.words=this.words.slice(0),i},random:function(i){for(var a=[],d=0;d<i;d+=4)a.push(4294967296*u.random()|0);return new h.init(a,i)}}),p=l.enc={},v=p.Hex={stringify:function(i){for(var a=i.words,d=i.sigBytes,y=[],S=0;S<d;S++){var k=a[S>>>2]>>>24-S%4*8&255;y.push((k>>>4).toString(16)),y.push((15&k).toString(16))}return y.join("")},parse:function(i){for(var a=i.length,d=[],y=0;y<a;y+=2)d[y>>>3]|=parseInt(i.substr(y,2),16)<<24-y%8*4;return new h.init(d,a/2)}},x=p.Latin1={stringify:function(i){for(var a=i.words,d=i.sigBytes,y=[],S=0;S<d;S++){var k=a[S>>>2]>>>24-S%4*8&255;y.push(String.fromCharCode(k))}return y.join("")},parse:function(i){for(var a=i.length,d=[],y=0;y<a;y++)d[y>>>2]|=(255&i.charCodeAt(y))<<24-y%4*8;return new h.init(d,a)}},F=p.Utf8={stringify:function(i){try{return decodeURIComponent(escape(x.stringify(i)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(i){return x.parse(unescape(encodeURIComponent(i)))}},I=g.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(i){typeof i=="string"&&(i=F.parse(i)),this._data.concat(i),this._nDataBytes+=i.sigBytes},_process:function(i){var a=this._data,d=a.words,y=a.sigBytes,S=this.blockSize,k=y/(4*S),M=(k=i?u.ceil(k):u.max((0|k)-this._minBufferSize,0))*S,U=u.min(4*M,y);if(M){for(var B=0;B<M;B+=S)this._doProcessBlock(d,B);var H=d.splice(0,M);a.sigBytes-=U}return new h.init(H,U)},clone:function(){var i=f.clone.call(this);return i._data=this._data.clone(),i},_minBufferSize:0}),g.Hasher=I.extend({cfg:f.extend(),init:function(i){this.cfg=this.cfg.extend(i),this.reset()},reset:function(){I.reset.call(this),this._doReset()},update:function(i){return this._append(i),this._process(),this},finalize:function(i){return i&&this._append(i),this._doFinalize()},blockSize:16,_createHelper:function(i){return function(a,d){return new i.init(d).finalize(a)}},_createHmacHelper:function(i){return function(a,d){return new R.HMAC.init(i,d).finalize(a)}}}),R=l.algo={},l);(function(s){var i,a=(i=O).lib,d=a.Base,y=a.WordArray;(i=i.x64={}).Word=d.extend({init:function(k,M){this.high=k,this.low=M}}),i.WordArray=d.extend({init:function(k,M){k=this.words=k||[],this.sigBytes=M??8*k.length},toX32:function(){for(var k=this.words,M=k.length,U=[],B=0;B<M;B++){var H=k[B];U.push(H.high),U.push(H.low)}return y.create(U,this.sigBytes)},clone:function(){for(var k=d.clone.call(this),M=k.words=this.words.slice(0),U=M.length,B=0;B<U;B++)M[B]=M[B].clone();return k}})})(),function(){var s=O,i=s.lib.WordArray;s.enc.Base64={stringify:function(d){var y=d.words,S=d.sigBytes,k=this._map;d.clamp(),d=[];for(var M=0;M<S;M+=3)for(var U=(y[M>>>2]>>>24-M%4*8&255)<<16|(y[M+1>>>2]>>>24-(M+1)%4*8&255)<<8|y[M+2>>>2]>>>24-(M+2)%4*8&255,B=0;4>B&&M+.75*B<S;B++)d.push(k.charAt(U>>>6*(3-B)&63));if(y=k.charAt(64))for(;d.length%4;)d.push(y);return d.join("")},parse:function(d){var y=d.length,S=this._map;(k=S.charAt(64))&&(k=d.indexOf(k))!=-1&&(y=k);for(var k=[],M=0,U=0;U<y;U++)if(U%4){var B=S.indexOf(d.charAt(U-1))<<U%4*2,H=S.indexOf(d.charAt(U))>>>6-U%4*2;k[M>>>2]|=(B|H)<<24-M%4*8,M++}return i.create(k,M)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(s){for(var i=O,a=(y=i.lib).WordArray,d=y.Hasher,y=i.algo,S=[],k=[],M=function(ae){return 4294967296*(ae-(0|ae))|0},U=2,B=0;64>B;){var H;e:{H=U;for(var K=s.sqrt(H),G=2;G<=K;G++)if(!(H%G)){H=!1;break e}H=!0}H&&(8>B&&(S[B]=M(s.pow(U,.5))),k[B]=M(s.pow(U,1/3)),B++),U++}var ee=[];y=y.SHA256=d.extend({_doReset:function(){this._hash=new a.init(S.slice(0))},_doProcessBlock:function(ae,ue){for(var P=this._hash.words,$=P[0],V=P[1],z=P[2],se=P[3],ce=P[4],Ee=P[5],pe=P[6],$e=P[7],ve=0;64>ve;ve++){if(16>ve)ee[ve]=0|ae[ue+ve];else{var Ce=ee[ve-15],ot=ee[ve-2];ee[ve]=((Ce<<25|Ce>>>7)^(Ce<<14|Ce>>>18)^Ce>>>3)+ee[ve-7]+((ot<<15|ot>>>17)^(ot<<13|ot>>>19)^ot>>>10)+ee[ve-16]}Ce=$e+((ce<<26|ce>>>6)^(ce<<21|ce>>>11)^(ce<<7|ce>>>25))+(ce&Ee^~ce&pe)+k[ve]+ee[ve],ot=(($<<30|$>>>2)^($<<19|$>>>13)^($<<10|$>>>22))+($&V^$&z^V&z),$e=pe,pe=Ee,Ee=ce,ce=se+Ce|0,se=z,z=V,V=$,$=Ce+ot|0}P[0]=P[0]+$|0,P[1]=P[1]+V|0,P[2]=P[2]+z|0,P[3]=P[3]+se|0,P[4]=P[4]+ce|0,P[5]=P[5]+Ee|0,P[6]=P[6]+pe|0,P[7]=P[7]+$e|0},_doFinalize:function(){var ae=this._data,ue=ae.words,P=8*this._nDataBytes,$=8*ae.sigBytes;return ue[$>>>5]|=128<<24-$%32,ue[14+($+64>>>9<<4)]=s.floor(P/4294967296),ue[15+($+64>>>9<<4)]=P,ae.sigBytes=4*ue.length,this._process(),this._hash},clone:function(){var ae=d.clone.call(this);return ae._hash=this._hash.clone(),ae}}),i.SHA256=d._createHelper(y),i.HmacSHA256=d._createHmacHelper(y)}(Math),function(){function s(){return d.create.apply(d,arguments)}for(var i=O,a=i.lib.Hasher,d=(S=i.x64).Word,y=S.WordArray,S=i.algo,k=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],M=[],U=0;80>U;U++)M[U]=s();S=S.SHA512=a.extend({_doReset:function(){this._hash=new y.init([new d.init(1779033703,4089235720),new d.init(3144134277,2227873595),new d.init(1013904242,4271175723),new d.init(2773480762,1595750129),new d.init(1359893119,2917565137),new d.init(2600822924,725511199),new d.init(528734635,4215389547),new d.init(1541459225,327033209)])},_doProcessBlock:function(H,K){for(var G=(V=this._hash.words)[0],ee=V[1],ie=V[2],ae=V[3],ue=V[4],P=V[5],$=V[6],V=V[7],z=G.high,se=G.low,ce=ee.high,Ee=ee.low,pe=ie.high,$e=ie.low,ve=ae.high,Ce=ae.low,ot=ue.high,ct=ue.low,at=P.high,$t=P.low,Ut=$.high,Ot=$.low,mt=V.high,Et=V.low,Rt=z,Bt=se,Pn=ce,tn=Ee,kn=pe,rn=$e,Gi=ve,Cn=Ce,tr=ot,Qt=ct,ii=at,Nn=$t,si=Ut,Ln=Ot,Qi=mt,Dn=Et,rr=0;80>rr;rr++){var Or=M[rr];if(16>rr)var yr=Or.high=0|H[K+2*rr],lt=Or.low=0|H[K+2*rr+1];else{yr=((lt=(yr=M[rr-15]).high)>>>1|(mr=yr.low)<<31)^(lt>>>8|mr<<24)^lt>>>7;var mr=(mr>>>1|lt<<31)^(mr>>>8|lt<<24)^(mr>>>7|lt<<25),nn=((lt=(nn=M[rr-2]).high)>>>19|(xt=nn.low)<<13)^(lt<<3|xt>>>29)^lt>>>6,xt=(xt>>>19|lt<<13)^(xt<<3|lt>>>29)^(xt>>>6|lt<<26),Yi=(lt=M[rr-7]).high,Br=(jr=M[rr-16]).high,jr=jr.low;yr=(yr=(yr=yr+Yi+((lt=mr+lt.low)>>>0<mr>>>0?1:0))+nn+((lt=lt+xt)>>>0<xt>>>0?1:0))+Br+((lt=lt+jr)>>>0<jr>>>0?1:0),Or.high=yr,Or.low=lt}Yi=tr&ii^~tr&si,jr=Qt&Nn^~Qt&Ln,Or=Rt&Pn^Rt&kn^Pn&kn;var Cl=Bt&tn^Bt&rn^tn&rn,Nl=(mr=(Rt>>>28|Bt<<4)^(Rt<<30|Bt>>>2)^(Rt<<25|Bt>>>7),nn=(Bt>>>28|Rt<<4)^(Bt<<30|Rt>>>2)^(Bt<<25|Rt>>>7),(xt=k[rr]).high),Do=xt.low;Br=Qi+((tr>>>14|Qt<<18)^(tr>>>18|Qt<<14)^(tr<<23|Qt>>>9))+((xt=Dn+((Qt>>>14|tr<<18)^(Qt>>>18|tr<<14)^(Qt<<23|tr>>>9)))>>>0<Dn>>>0?1:0),Qi=si,Dn=Ln,si=ii,Ln=Nn,ii=tr,Nn=Qt,tr=Gi+(Br=(Br=(Br=Br+Yi+((xt=xt+jr)>>>0<jr>>>0?1:0))+Nl+((xt=xt+Do)>>>0<Do>>>0?1:0))+yr+((xt=xt+lt)>>>0<lt>>>0?1:0))+((Qt=Cn+xt|0)>>>0<Cn>>>0?1:0)|0,Gi=kn,Cn=rn,kn=Pn,rn=tn,Pn=Rt,tn=Bt,Rt=Br+(Or=mr+Or+((lt=nn+Cl)>>>0<nn>>>0?1:0))+((Bt=xt+lt|0)>>>0<xt>>>0?1:0)|0}se=G.low=se+Bt,G.high=z+Rt+(se>>>0<Bt>>>0?1:0),Ee=ee.low=Ee+tn,ee.high=ce+Pn+(Ee>>>0<tn>>>0?1:0),$e=ie.low=$e+rn,ie.high=pe+kn+($e>>>0<rn>>>0?1:0),Ce=ae.low=Ce+Cn,ae.high=ve+Gi+(Ce>>>0<Cn>>>0?1:0),ct=ue.low=ct+Qt,ue.high=ot+tr+(ct>>>0<Qt>>>0?1:0),$t=P.low=$t+Nn,P.high=at+ii+($t>>>0<Nn>>>0?1:0),Ot=$.low=Ot+Ln,$.high=Ut+si+(Ot>>>0<Ln>>>0?1:0),Et=V.low=Et+Dn,V.high=mt+Qi+(Et>>>0<Dn>>>0?1:0)},_doFinalize:function(){var H=this._data,K=H.words,G=8*this._nDataBytes,ee=8*H.sigBytes;return K[ee>>>5]|=128<<24-ee%32,K[30+(ee+128>>>10<<5)]=Math.floor(G/4294967296),K[31+(ee+128>>>10<<5)]=G,H.sigBytes=4*K.length,this._process(),this._hash.toX32()},clone:function(){var H=a.clone.call(this);return H._hash=this._hash.clone(),H},blockSize:32}),i.SHA512=a._createHelper(S),i.HmacSHA512=a._createHmacHelper(S)}(),function(){var s=O,i=(y=s.x64).Word,a=y.WordArray,d=(y=s.algo).SHA512,y=y.SHA384=d.extend({_doReset:function(){this._hash=new a.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var k=d._doFinalize.call(this);return k.sigBytes-=16,k}});s.SHA384=d._createHelper(y),s.HmacSHA384=d._createHmacHelper(y)}();/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var Y,Q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function W(s){var i,a,d="";for(i=0;i+3<=s.length;i+=3)a=parseInt(s.substring(i,i+3),16),d+=Q.charAt(a>>6)+Q.charAt(63&a);for(i+1==s.length?(a=parseInt(s.substring(i,i+1),16),d+=Q.charAt(a<<2)):i+2==s.length&&(a=parseInt(s.substring(i,i+2),16),d+=Q.charAt(a>>2)+Q.charAt((3&a)<<4)),"=";(3&d.length)>0;)d+="=";return d}function fe(s){var i,a,d,y="",S=0;for(i=0;i<s.length&&s.charAt(i)!="=";++i)(d=Q.indexOf(s.charAt(i)))<0||(S==0?(y+=Te(d>>2),a=3&d,S=1):S==1?(y+=Te(a<<2|d>>4),a=15&d,S=2):S==2?(y+=Te(a),y+=Te(d>>2),a=3&d,S=3):(y+=Te(a<<2|d>>4),y+=Te(15&d),S=0));return S==1&&(y+=Te(a<<2)),y}function de(s){var i,a=fe(s),d=new Array;for(i=0;2*i<a.length;++i)d[i]=parseInt(a.substring(2*i,2*i+2),16);return d}function q(s,i,a){s!=null&&(typeof s=="number"?this.fromNumber(s,i,a):i==null&&typeof s!="string"?this.fromString(s,256):this.fromString(s,i))}function he(){return new q(null)}L.appName=="Microsoft Internet Explorer"?(q.prototype.am=function(i,a,d,y,S,k){for(var M=32767&a,U=a>>15;--k>=0;){var B=32767&this[i],H=this[i++]>>15,K=U*B+H*M;S=((B=M*B+((32767&K)<<15)+d[y]+(1073741823&S))>>>30)+(K>>>15)+U*H+(S>>>30),d[y++]=1073741823&B}return S},Y=30):L.appName!="Netscape"?(q.prototype.am=function(i,a,d,y,S,k){for(;--k>=0;){var M=a*this[i++]+d[y]+S;S=Math.floor(M/67108864),d[y++]=67108863&M}return S},Y=26):(q.prototype.am=function(i,a,d,y,S,k){for(var M=16383&a,U=a>>14;--k>=0;){var B=16383&this[i],H=this[i++]>>14,K=U*B+H*M;S=((B=M*B+((16383&K)<<14)+d[y]+S)>>28)+(K>>14)+U*H,d[y++]=268435455&B}return S},Y=28),q.prototype.DB=Y,q.prototype.DM=(1<<Y)-1,q.prototype.DV=1<<Y,q.prototype.FV=Math.pow(2,52),q.prototype.F1=52-Y,q.prototype.F2=2*Y-52;var ke,le,Ue=new Array;for(ke=48,le=0;le<=9;++le)Ue[ke++]=le;for(ke=97,le=10;le<36;++le)Ue[ke++]=le;for(ke=65,le=10;le<36;++le)Ue[ke++]=le;function Te(s){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(s)}function Ne(s,i){var a=Ue[s.charCodeAt(i)];return a??-1}function Oe(s){var i=he();return i.fromInt(s),i}function He(s){var i,a=1;return(i=s>>>16)!=0&&(s=i,a+=16),(i=s>>8)!=0&&(s=i,a+=8),(i=s>>4)!=0&&(s=i,a+=4),(i=s>>2)!=0&&(s=i,a+=2),(i=s>>1)!=0&&(s=i,a+=1),a}function Fe(s){this.m=s}function Pe(s){this.m=s,this.mp=s.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<s.DB-15)-1,this.mt2=2*s.t}function Ae(s,i){return s&i}function Me(s,i){return s|i}function Ie(s,i){return s^i}function We(s,i){return s&~i}function it(s){if(s==0)return-1;var i=0;return!(65535&s)&&(s>>=16,i+=16),!(255&s)&&(s>>=8,i+=8),!(15&s)&&(s>>=4,i+=4),!(3&s)&&(s>>=2,i+=2),!(1&s)&&++i,i}function wt(s){for(var i=0;s!=0;)s&=s-1,++i;return i}function st(){}function Ge(s){return s}function Qe(s){this.r2=he(),this.q3=he(),q.ONE.dlShiftTo(2*s.t,this.r2),this.mu=this.r2.divide(s),this.m=s}Fe.prototype.convert=function(i){return i.s<0||i.compareTo(this.m)>=0?i.mod(this.m):i},Fe.prototype.revert=function(i){return i},Fe.prototype.reduce=function(i){i.divRemTo(this.m,null,i)},Fe.prototype.mulTo=function(i,a,d){i.multiplyTo(a,d),this.reduce(d)},Fe.prototype.sqrTo=function(i,a){i.squareTo(a),this.reduce(a)},Pe.prototype.convert=function(i){var a=he();return i.abs().dlShiftTo(this.m.t,a),a.divRemTo(this.m,null,a),i.s<0&&a.compareTo(q.ZERO)>0&&this.m.subTo(a,a),a},Pe.prototype.revert=function(i){var a=he();return i.copyTo(a),this.reduce(a),a},Pe.prototype.reduce=function(i){for(;i.t<=this.mt2;)i[i.t++]=0;for(var a=0;a<this.m.t;++a){var d=32767&i[a],y=d*this.mpl+((d*this.mph+(i[a]>>15)*this.mpl&this.um)<<15)&i.DM;for(i[d=a+this.m.t]+=this.m.am(0,y,i,a,0,this.m.t);i[d]>=i.DV;)i[d]-=i.DV,i[++d]++}i.clamp(),i.drShiftTo(this.m.t,i),i.compareTo(this.m)>=0&&i.subTo(this.m,i)},Pe.prototype.mulTo=function(i,a,d){i.multiplyTo(a,d),this.reduce(d)},Pe.prototype.sqrTo=function(i,a){i.squareTo(a),this.reduce(a)},q.prototype.copyTo=function(i){for(var a=this.t-1;a>=0;--a)i[a]=this[a];i.t=this.t,i.s=this.s},q.prototype.fromInt=function(i){this.t=1,this.s=i<0?-1:0,i>0?this[0]=i:i<-1?this[0]=i+this.DV:this.t=0},q.prototype.fromString=function(i,a){var d;if(a==16)d=4;else if(a==8)d=3;else if(a==256)d=8;else if(a==2)d=1;else if(a==32)d=5;else{if(a!=4)return void this.fromRadix(i,a);d=2}this.t=0,this.s=0;for(var y=i.length,S=!1,k=0;--y>=0;){var M=d==8?255&i[y]:Ne(i,y);M<0?i.charAt(y)=="-"&&(S=!0):(S=!1,k==0?this[this.t++]=M:k+d>this.DB?(this[this.t-1]|=(M&(1<<this.DB-k)-1)<<k,this[this.t++]=M>>this.DB-k):this[this.t-1]|=M<<k,(k+=d)>=this.DB&&(k-=this.DB))}d==8&&128&i[0]&&(this.s=-1,k>0&&(this[this.t-1]|=(1<<this.DB-k)-1<<k)),this.clamp(),S&&q.ZERO.subTo(this,this)},q.prototype.clamp=function(){for(var i=this.s&this.DM;this.t>0&&this[this.t-1]==i;)--this.t},q.prototype.dlShiftTo=function(i,a){var d;for(d=this.t-1;d>=0;--d)a[d+i]=this[d];for(d=i-1;d>=0;--d)a[d]=0;a.t=this.t+i,a.s=this.s},q.prototype.drShiftTo=function(i,a){for(var d=i;d<this.t;++d)a[d-i]=this[d];a.t=Math.max(this.t-i,0),a.s=this.s},q.prototype.lShiftTo=function(i,a){var d,y=i%this.DB,S=this.DB-y,k=(1<<S)-1,M=Math.floor(i/this.DB),U=this.s<<y&this.DM;for(d=this.t-1;d>=0;--d)a[d+M+1]=this[d]>>S|U,U=(this[d]&k)<<y;for(d=M-1;d>=0;--d)a[d]=0;a[M]=U,a.t=this.t+M+1,a.s=this.s,a.clamp()},q.prototype.rShiftTo=function(i,a){a.s=this.s;var d=Math.floor(i/this.DB);if(d>=this.t)a.t=0;else{var y=i%this.DB,S=this.DB-y,k=(1<<y)-1;a[0]=this[d]>>y;for(var M=d+1;M<this.t;++M)a[M-d-1]|=(this[M]&k)<<S,a[M-d]=this[M]>>y;y>0&&(a[this.t-d-1]|=(this.s&k)<<S),a.t=this.t-d,a.clamp()}},q.prototype.subTo=function(i,a){for(var d=0,y=0,S=Math.min(i.t,this.t);d<S;)y+=this[d]-i[d],a[d++]=y&this.DM,y>>=this.DB;if(i.t<this.t){for(y-=i.s;d<this.t;)y+=this[d],a[d++]=y&this.DM,y>>=this.DB;y+=this.s}else{for(y+=this.s;d<i.t;)y-=i[d],a[d++]=y&this.DM,y>>=this.DB;y-=i.s}a.s=y<0?-1:0,y<-1?a[d++]=this.DV+y:y>0&&(a[d++]=y),a.t=d,a.clamp()},q.prototype.multiplyTo=function(i,a){var d=this.abs(),y=i.abs(),S=d.t;for(a.t=S+y.t;--S>=0;)a[S]=0;for(S=0;S<y.t;++S)a[S+d.t]=d.am(0,y[S],a,S,0,d.t);a.s=0,a.clamp(),this.s!=i.s&&q.ZERO.subTo(a,a)},q.prototype.squareTo=function(i){for(var a=this.abs(),d=i.t=2*a.t;--d>=0;)i[d]=0;for(d=0;d<a.t-1;++d){var y=a.am(d,a[d],i,2*d,0,1);(i[d+a.t]+=a.am(d+1,2*a[d],i,2*d+1,y,a.t-d-1))>=a.DV&&(i[d+a.t]-=a.DV,i[d+a.t+1]=1)}i.t>0&&(i[i.t-1]+=a.am(d,a[d],i,2*d,0,1)),i.s=0,i.clamp()},q.prototype.divRemTo=function(i,a,d){var y=i.abs();if(!(y.t<=0)){var S=this.abs();if(S.t<y.t)return a!=null&&a.fromInt(0),void(d!=null&&this.copyTo(d));d==null&&(d=he());var k=he(),M=this.s,U=i.s,B=this.DB-He(y[y.t-1]);B>0?(y.lShiftTo(B,k),S.lShiftTo(B,d)):(y.copyTo(k),S.copyTo(d));var H=k.t,K=k[H-1];if(K!=0){var G=K*(1<<this.F1)+(H>1?k[H-2]>>this.F2:0),ee=this.FV/G,ie=(1<<this.F1)/G,ae=1<<this.F2,ue=d.t,P=ue-H,$=a??he();for(k.dlShiftTo(P,$),d.compareTo($)>=0&&(d[d.t++]=1,d.subTo($,d)),q.ONE.dlShiftTo(H,$),$.subTo(k,k);k.t<H;)k[k.t++]=0;for(;--P>=0;){var V=d[--ue]==K?this.DM:Math.floor(d[ue]*ee+(d[ue-1]+ae)*ie);if((d[ue]+=k.am(0,V,d,P,0,H))<V)for(k.dlShiftTo(P,$),d.subTo($,d);d[ue]<--V;)d.subTo($,d)}a!=null&&(d.drShiftTo(H,a),M!=U&&q.ZERO.subTo(a,a)),d.t=H,d.clamp(),B>0&&d.rShiftTo(B,d),M<0&&q.ZERO.subTo(d,d)}}},q.prototype.invDigit=function(){if(this.t<1)return 0;var i=this[0];if(!(1&i))return 0;var a=3&i;return(a=(a=(a=(a=a*(2-(15&i)*a)&15)*(2-(255&i)*a)&255)*(2-((65535&i)*a&65535))&65535)*(2-i*a%this.DV)%this.DV)>0?this.DV-a:-a},q.prototype.isEven=function(){return(this.t>0?1&this[0]:this.s)==0},q.prototype.exp=function(i,a){if(i>4294967295||i<1)return q.ONE;var d=he(),y=he(),S=a.convert(this),k=He(i)-1;for(S.copyTo(d);--k>=0;)if(a.sqrTo(d,y),(i&1<<k)>0)a.mulTo(y,S,d);else{var M=d;d=y,y=M}return a.revert(d)},q.prototype.toString=function(i){if(this.s<0)return"-"+this.negate().toString(i);var a;if(i==16)a=4;else if(i==8)a=3;else if(i==2)a=1;else if(i==32)a=5;else{if(i!=4)return this.toRadix(i);a=2}var d,y=(1<<a)-1,S=!1,k="",M=this.t,U=this.DB-M*this.DB%a;if(M-- >0)for(U<this.DB&&(d=this[M]>>U)>0&&(S=!0,k=Te(d));M>=0;)U<a?(d=(this[M]&(1<<U)-1)<<a-U,d|=this[--M]>>(U+=this.DB-a)):(d=this[M]>>(U-=a)&y,U<=0&&(U+=this.DB,--M)),d>0&&(S=!0),S&&(k+=Te(d));return S?k:"0"},q.prototype.negate=function(){var i=he();return q.ZERO.subTo(this,i),i},q.prototype.abs=function(){return this.s<0?this.negate():this},q.prototype.compareTo=function(i){var a=this.s-i.s;if(a!=0)return a;var d=this.t;if((a=d-i.t)!=0)return this.s<0?-a:a;for(;--d>=0;)if((a=this[d]-i[d])!=0)return a;return 0},q.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+He(this[this.t-1]^this.s&this.DM)},q.prototype.mod=function(i){var a=he();return this.abs().divRemTo(i,null,a),this.s<0&&a.compareTo(q.ZERO)>0&&i.subTo(a,a),a},q.prototype.modPowInt=function(i,a){var d;return d=i<256||a.isEven()?new Fe(a):new Pe(a),this.exp(i,d)},q.ZERO=Oe(0),q.ONE=Oe(1),st.prototype.convert=Ge,st.prototype.revert=Ge,st.prototype.mulTo=function(i,a,d){i.multiplyTo(a,d)},st.prototype.sqrTo=function(i,a){i.squareTo(a)},Qe.prototype.convert=function(i){if(i.s<0||i.t>2*this.m.t)return i.mod(this.m);if(i.compareTo(this.m)<0)return i;var a=he();return i.copyTo(a),this.reduce(a),a},Qe.prototype.revert=function(i){return i},Qe.prototype.reduce=function(i){for(i.drShiftTo(this.m.t-1,this.r2),i.t>this.m.t+1&&(i.t=this.m.t+1,i.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);i.compareTo(this.r2)<0;)i.dAddOffset(1,this.m.t+1);for(i.subTo(this.r2,i);i.compareTo(this.m)>=0;)i.subTo(this.m,i)},Qe.prototype.mulTo=function(i,a,d){i.multiplyTo(a,d),this.reduce(d)},Qe.prototype.sqrTo=function(i,a){i.squareTo(a),this.reduce(a)};var Je=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],X=(1<<26)/Je[Je.length-1];/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function E(){this.i=0,this.j=0,this.S=new Array}q.prototype.chunkSize=function(i){return Math.floor(Math.LN2*this.DB/Math.log(i))},q.prototype.toRadix=function(i){if(i==null&&(i=10),this.signum()==0||i<2||i>36)return"0";var a=this.chunkSize(i),d=Math.pow(i,a),y=Oe(d),S=he(),k=he(),M="";for(this.divRemTo(y,S,k);S.signum()>0;)M=(d+k.intValue()).toString(i).substr(1)+M,S.divRemTo(y,S,k);return k.intValue().toString(i)+M},q.prototype.fromRadix=function(i,a){this.fromInt(0),a==null&&(a=10);for(var d=this.chunkSize(a),y=Math.pow(a,d),S=!1,k=0,M=0,U=0;U<i.length;++U){var B=Ne(i,U);B<0?i.charAt(U)=="-"&&this.signum()==0&&(S=!0):(M=a*M+B,++k>=d&&(this.dMultiply(y),this.dAddOffset(M,0),k=0,M=0))}k>0&&(this.dMultiply(Math.pow(a,k)),this.dAddOffset(M,0)),S&&q.ZERO.subTo(this,this)},q.prototype.fromNumber=function(i,a,d){if(typeof a=="number")if(i<2)this.fromInt(1);else for(this.fromNumber(i,d),this.testBit(i-1)||this.bitwiseTo(q.ONE.shiftLeft(i-1),Me,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(a);)this.dAddOffset(2,0),this.bitLength()>i&&this.subTo(q.ONE.shiftLeft(i-1),this);else{var y=new Array,S=7&i;y.length=1+(i>>3),a.nextBytes(y),S>0?y[0]&=(1<<S)-1:y[0]=0,this.fromString(y,256)}},q.prototype.bitwiseTo=function(i,a,d){var y,S,k=Math.min(i.t,this.t);for(y=0;y<k;++y)d[y]=a(this[y],i[y]);if(i.t<this.t){for(S=i.s&this.DM,y=k;y<this.t;++y)d[y]=a(this[y],S);d.t=this.t}else{for(S=this.s&this.DM,y=k;y<i.t;++y)d[y]=a(S,i[y]);d.t=i.t}d.s=a(this.s,i.s),d.clamp()},q.prototype.changeBit=function(i,a){var d=q.ONE.shiftLeft(i);return this.bitwiseTo(d,a,d),d},q.prototype.addTo=function(i,a){for(var d=0,y=0,S=Math.min(i.t,this.t);d<S;)y+=this[d]+i[d],a[d++]=y&this.DM,y>>=this.DB;if(i.t<this.t){for(y+=i.s;d<this.t;)y+=this[d],a[d++]=y&this.DM,y>>=this.DB;y+=this.s}else{for(y+=this.s;d<i.t;)y+=i[d],a[d++]=y&this.DM,y>>=this.DB;y+=i.s}a.s=y<0?-1:0,y>0?a[d++]=y:y<-1&&(a[d++]=this.DV+y),a.t=d,a.clamp()},q.prototype.dMultiply=function(i){this[this.t]=this.am(0,i-1,this,0,0,this.t),++this.t,this.clamp()},q.prototype.dAddOffset=function(i,a){if(i!=0){for(;this.t<=a;)this[this.t++]=0;for(this[a]+=i;this[a]>=this.DV;)this[a]-=this.DV,++a>=this.t&&(this[this.t++]=0),++this[a]}},q.prototype.multiplyLowerTo=function(i,a,d){var y,S=Math.min(this.t+i.t,a);for(d.s=0,d.t=S;S>0;)d[--S]=0;for(y=d.t-this.t;S<y;++S)d[S+this.t]=this.am(0,i[S],d,S,0,this.t);for(y=Math.min(i.t,a);S<y;++S)this.am(0,i[S],d,S,0,a-S);d.clamp()},q.prototype.multiplyUpperTo=function(i,a,d){--a;var y=d.t=this.t+i.t-a;for(d.s=0;--y>=0;)d[y]=0;for(y=Math.max(a-this.t,0);y<i.t;++y)d[this.t+y-a]=this.am(a-y,i[y],d,0,0,this.t+y-a);d.clamp(),d.drShiftTo(1,d)},q.prototype.modInt=function(i){if(i<=0)return 0;var a=this.DV%i,d=this.s<0?i-1:0;if(this.t>0)if(a==0)d=this[0]%i;else for(var y=this.t-1;y>=0;--y)d=(a*d+this[y])%i;return d},q.prototype.millerRabin=function(i){var a=this.subtract(q.ONE),d=a.getLowestSetBit();if(d<=0)return!1;var y=a.shiftRight(d);(i=i+1>>1)>Je.length&&(i=Je.length);for(var S=he(),k=0;k<i;++k){S.fromInt(Je[Math.floor(Math.random()*Je.length)]);var M=S.modPow(y,this);if(M.compareTo(q.ONE)!=0&&M.compareTo(a)!=0){for(var U=1;U++<d&&M.compareTo(a)!=0;)if((M=M.modPowInt(2,this)).compareTo(q.ONE)==0)return!1;if(M.compareTo(a)!=0)return!1}}return!0},q.prototype.clone=function(){var i=he();return this.copyTo(i),i},q.prototype.intValue=function(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},q.prototype.byteValue=function(){return this.t==0?this.s:this[0]<<24>>24},q.prototype.shortValue=function(){return this.t==0?this.s:this[0]<<16>>16},q.prototype.signum=function(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1},q.prototype.toByteArray=function(){var i=this.t,a=new Array;a[0]=this.s;var d,y=this.DB-i*this.DB%8,S=0;if(i-- >0)for(y<this.DB&&(d=this[i]>>y)!=(this.s&this.DM)>>y&&(a[S++]=d|this.s<<this.DB-y);i>=0;)y<8?(d=(this[i]&(1<<y)-1)<<8-y,d|=this[--i]>>(y+=this.DB-8)):(d=this[i]>>(y-=8)&255,y<=0&&(y+=this.DB,--i)),128&d&&(d|=-256),S==0&&(128&this.s)!=(128&d)&&++S,(S>0||d!=this.s)&&(a[S++]=d);return a},q.prototype.equals=function(i){return this.compareTo(i)==0},q.prototype.min=function(i){return this.compareTo(i)<0?this:i},q.prototype.max=function(i){return this.compareTo(i)>0?this:i},q.prototype.and=function(i){var a=he();return this.bitwiseTo(i,Ae,a),a},q.prototype.or=function(i){var a=he();return this.bitwiseTo(i,Me,a),a},q.prototype.xor=function(i){var a=he();return this.bitwiseTo(i,Ie,a),a},q.prototype.andNot=function(i){var a=he();return this.bitwiseTo(i,We,a),a},q.prototype.not=function(){for(var i=he(),a=0;a<this.t;++a)i[a]=this.DM&~this[a];return i.t=this.t,i.s=~this.s,i},q.prototype.shiftLeft=function(i){var a=he();return i<0?this.rShiftTo(-i,a):this.lShiftTo(i,a),a},q.prototype.shiftRight=function(i){var a=he();return i<0?this.lShiftTo(-i,a):this.rShiftTo(i,a),a},q.prototype.getLowestSetBit=function(){for(var i=0;i<this.t;++i)if(this[i]!=0)return i*this.DB+it(this[i]);return this.s<0?this.t*this.DB:-1},q.prototype.bitCount=function(){for(var i=0,a=this.s&this.DM,d=0;d<this.t;++d)i+=wt(this[d]^a);return i},q.prototype.testBit=function(i){var a=Math.floor(i/this.DB);return a>=this.t?this.s!=0:(this[a]&1<<i%this.DB)!=0},q.prototype.setBit=function(i){return this.changeBit(i,Me)},q.prototype.clearBit=function(i){return this.changeBit(i,We)},q.prototype.flipBit=function(i){return this.changeBit(i,Ie)},q.prototype.add=function(i){var a=he();return this.addTo(i,a),a},q.prototype.subtract=function(i){var a=he();return this.subTo(i,a),a},q.prototype.multiply=function(i){var a=he();return this.multiplyTo(i,a),a},q.prototype.divide=function(i){var a=he();return this.divRemTo(i,a,null),a},q.prototype.remainder=function(i){var a=he();return this.divRemTo(i,null,a),a},q.prototype.divideAndRemainder=function(i){var a=he(),d=he();return this.divRemTo(i,a,d),new Array(a,d)},q.prototype.modPow=function(i,a){var d,y,S=i.bitLength(),k=Oe(1);if(S<=0)return k;d=S<18?1:S<48?3:S<144?4:S<768?5:6,y=S<8?new Fe(a):a.isEven()?new Qe(a):new Pe(a);var M=new Array,U=3,B=d-1,H=(1<<d)-1;if(M[1]=y.convert(this),d>1){var K=he();for(y.sqrTo(M[1],K);U<=H;)M[U]=he(),y.mulTo(K,M[U-2],M[U]),U+=2}var G,ee,ie=i.t-1,ae=!0,ue=he();for(S=He(i[ie])-1;ie>=0;){for(S>=B?G=i[ie]>>S-B&H:(G=(i[ie]&(1<<S+1)-1)<<B-S,ie>0&&(G|=i[ie-1]>>this.DB+S-B)),U=d;!(1&G);)G>>=1,--U;if((S-=U)<0&&(S+=this.DB,--ie),ae)M[G].copyTo(k),ae=!1;else{for(;U>1;)y.sqrTo(k,ue),y.sqrTo(ue,k),U-=2;U>0?y.sqrTo(k,ue):(ee=k,k=ue,ue=ee),y.mulTo(ue,M[G],k)}for(;ie>=0&&!(i[ie]&1<<S);)y.sqrTo(k,ue),ee=k,k=ue,ue=ee,--S<0&&(S=this.DB-1,--ie)}return y.revert(k)},q.prototype.modInverse=function(i){var a=i.isEven();if(this.isEven()&&a||i.signum()==0)return q.ZERO;for(var d=i.clone(),y=this.clone(),S=Oe(1),k=Oe(0),M=Oe(0),U=Oe(1);d.signum()!=0;){for(;d.isEven();)d.rShiftTo(1,d),a?(S.isEven()&&k.isEven()||(S.addTo(this,S),k.subTo(i,k)),S.rShiftTo(1,S)):k.isEven()||k.subTo(i,k),k.rShiftTo(1,k);for(;y.isEven();)y.rShiftTo(1,y),a?(M.isEven()&&U.isEven()||(M.addTo(this,M),U.subTo(i,U)),M.rShiftTo(1,M)):U.isEven()||U.subTo(i,U),U.rShiftTo(1,U);d.compareTo(y)>=0?(d.subTo(y,d),a&&S.subTo(M,S),k.subTo(U,k)):(y.subTo(d,y),a&&M.subTo(S,M),U.subTo(k,U))}return y.compareTo(q.ONE)!=0?q.ZERO:U.compareTo(i)>=0?U.subtract(i):U.signum()<0?(U.addTo(i,U),U.signum()<0?U.add(i):U):U},q.prototype.pow=function(i){return this.exp(i,new st)},q.prototype.gcd=function(i){var a=this.s<0?this.negate():this.clone(),d=i.s<0?i.negate():i.clone();if(a.compareTo(d)<0){var y=a;a=d,d=y}var S=a.getLowestSetBit(),k=d.getLowestSetBit();if(k<0)return a;for(S<k&&(k=S),k>0&&(a.rShiftTo(k,a),d.rShiftTo(k,d));a.signum()>0;)(S=a.getLowestSetBit())>0&&a.rShiftTo(S,a),(S=d.getLowestSetBit())>0&&d.rShiftTo(S,d),a.compareTo(d)>=0?(a.subTo(d,a),a.rShiftTo(1,a)):(d.subTo(a,d),d.rShiftTo(1,d));return k>0&&d.lShiftTo(k,d),d},q.prototype.isProbablePrime=function(i){var a,d=this.abs();if(d.t==1&&d[0]<=Je[Je.length-1]){for(a=0;a<Je.length;++a)if(d[0]==Je[a])return!0;return!1}if(d.isEven())return!1;for(a=1;a<Je.length;){for(var y=Je[a],S=a+1;S<Je.length&&y<X;)y*=Je[S++];for(y=d.modInt(y);a<S;)if(y%Je[a++]==0)return!1}return d.millerRabin(i)},q.prototype.square=function(){var i=he();return this.squareTo(i),i},E.prototype.init=function(i){var a,d,y;for(a=0;a<256;++a)this.S[a]=a;for(d=0,a=0;a<256;++a)d=d+this.S[a]+i[a%i.length]&255,y=this.S[a],this.S[a]=this.S[d],this.S[d]=y;this.i=0,this.j=0},E.prototype.next=function(){var i;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,i=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=i,this.S[i+this.S[this.i]&255]};var m,A,D;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Z(){(function(i){A[D++]^=255&i,A[D++]^=i>>8&255,A[D++]^=i>>16&255,A[D++]^=i>>24&255,D>=256&&(D-=256)})(new Date().getTime())}if(A==null){var te;if(A=new Array,D=0,N!==void 0&&(N.crypto!==void 0||N.msCrypto!==void 0)){var me=N.crypto||N.msCrypto;if(me.getRandomValues){var we=new Uint8Array(32);for(me.getRandomValues(we),te=0;te<32;++te)A[D++]=we[te]}else if(L.appName=="Netscape"&&L.appVersion<"5"){var Re=N.crypto.random(32);for(te=0;te<Re.length;++te)A[D++]=255&Re.charCodeAt(te)}}for(;D<256;)te=Math.floor(65536*Math.random()),A[D++]=te>>>8,A[D++]=255&te;D=0,Z()}function De(){if(m==null){for(Z(),(m=function(){return new E}()).init(A),D=0;D<A.length;++D)A[D]=0;D=0}return m.next()}function _e(){}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function tt(s,i){return new q(s,i)}function It(s,i,a){for(var d="",y=0;d.length<i;)d+=a(String.fromCharCode.apply(String,s.concat([(4278190080&y)>>24,(16711680&y)>>16,(65280&y)>>8,255&y]))),y+=1;return d}function Se(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function rt(s,i){this.x=i,this.q=s}function T(s,i,a,d){this.curve=s,this.x=i,this.y=a,this.z=d??q.ONE,this.zinv=null}function _(s,i,a){this.q=s,this.a=this.fromBigInteger(i),this.b=this.fromBigInteger(a),this.infinity=new T(this,null,null)}_e.prototype.nextBytes=function(i){var a;for(a=0;a<i.length;++a)i[a]=De()},Se.prototype.doPublic=function(i){return i.modPowInt(this.e,this.n)},Se.prototype.setPublic=function(i,a){if(this.isPublic=!0,this.isPrivate=!1,typeof i!="string")this.n=i,this.e=a;else{if(!(i!=null&&a!=null&&i.length>0&&a.length>0))throw"Invalid RSA public key";this.n=tt(i,16),this.e=parseInt(a,16)}},Se.prototype.encrypt=function(i){var a=function(k,M){if(M<k.length+11)throw"Message too long for RSA";for(var U=new Array,B=k.length-1;B>=0&&M>0;){var H=k.charCodeAt(B--);H<128?U[--M]=H:H>127&&H<2048?(U[--M]=63&H|128,U[--M]=H>>6|192):(U[--M]=63&H|128,U[--M]=H>>6&63|128,U[--M]=H>>12|224)}U[--M]=0;for(var K=new _e,G=new Array;M>2;){for(G[0]=0;G[0]==0;)K.nextBytes(G);U[--M]=G[0]}return U[--M]=2,U[--M]=0,new q(U)}(i,this.n.bitLength()+7>>3);if(a==null)return null;var d=this.doPublic(a);if(d==null)return null;var y=d.toString(16);return 1&y.length?"0"+y:y},Se.prototype.encryptOAEP=function(i,a,d){var y=function(U,B,H,K){var G=b.crypto.MessageDigest,ee=b.crypto.Util,ie=null;if(H||(H="sha1"),typeof H=="string"&&(ie=G.getCanonicalAlgName(H),K=G.getHashLength(ie),H=function(pe){return Mt(ee.hashHex(Ht(pe),ie))}),U.length+2*K+2>B)throw"Message too long for RSA";var ae,ue="";for(ae=0;ae<B-U.length-2*K-2;ae+=1)ue+="\0";var P=H("")+ue+""+U,$=new Array(K);new _e().nextBytes($);var V=It($,P.length,H),z=[];for(ae=0;ae<P.length;ae+=1)z[ae]=P.charCodeAt(ae)^V.charCodeAt(ae);var se=It(z,$.length,H),ce=[0];for(ae=0;ae<$.length;ae+=1)ce[ae+1]=$[ae]^se.charCodeAt(ae);return new q(ce.concat(z))}(i,this.n.bitLength()+7>>3,a,d);if(y==null)return null;var S=this.doPublic(y);if(S==null)return null;var k=S.toString(16);return 1&k.length?"0"+k:k},Se.prototype.type="RSA",rt.prototype.equals=function(i){return i==this||this.q.equals(i.q)&&this.x.equals(i.x)},rt.prototype.toBigInteger=function(){return this.x},rt.prototype.negate=function(){return new rt(this.q,this.x.negate().mod(this.q))},rt.prototype.add=function(i){return new rt(this.q,this.x.add(i.toBigInteger()).mod(this.q))},rt.prototype.subtract=function(i){return new rt(this.q,this.x.subtract(i.toBigInteger()).mod(this.q))},rt.prototype.multiply=function(i){return new rt(this.q,this.x.multiply(i.toBigInteger()).mod(this.q))},rt.prototype.square=function(){return new rt(this.q,this.x.square().mod(this.q))},rt.prototype.divide=function(i){return new rt(this.q,this.x.multiply(i.toBigInteger().modInverse(this.q)).mod(this.q))},T.prototype.getX=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},T.prototype.getY=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},T.prototype.equals=function(i){return i==this||(this.isInfinity()?i.isInfinity():i.isInfinity()?this.isInfinity():!!i.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(i.z)).mod(this.curve.q).equals(q.ZERO)&&i.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(i.z)).mod(this.curve.q).equals(q.ZERO))},T.prototype.isInfinity=function(){return this.x==null&&this.y==null||this.z.equals(q.ZERO)&&!this.y.toBigInteger().equals(q.ZERO)},T.prototype.negate=function(){return new T(this.curve,this.x,this.y.negate(),this.z)},T.prototype.add=function(i){if(this.isInfinity())return i;if(i.isInfinity())return this;var a=i.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(i.z)).mod(this.curve.q),d=i.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(i.z)).mod(this.curve.q);if(q.ZERO.equals(d))return q.ZERO.equals(a)?this.twice():this.curve.getInfinity();var y=new q("3"),S=this.x.toBigInteger(),k=this.y.toBigInteger(),M=(i.x.toBigInteger(),i.y.toBigInteger(),d.square()),U=M.multiply(d),B=S.multiply(M),H=a.square().multiply(this.z),K=H.subtract(B.shiftLeft(1)).multiply(i.z).subtract(U).multiply(d).mod(this.curve.q),G=B.multiply(y).multiply(a).subtract(k.multiply(U)).subtract(H.multiply(a)).multiply(i.z).add(a.multiply(U)).mod(this.curve.q),ee=U.multiply(this.z).multiply(i.z).mod(this.curve.q);return new T(this.curve,this.curve.fromBigInteger(K),this.curve.fromBigInteger(G),ee)},T.prototype.twice=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var i=new q("3"),a=this.x.toBigInteger(),d=this.y.toBigInteger(),y=d.multiply(this.z),S=y.multiply(d).mod(this.curve.q),k=this.curve.a.toBigInteger(),M=a.square().multiply(i);q.ZERO.equals(k)||(M=M.add(this.z.square().multiply(k)));var U=(M=M.mod(this.curve.q)).square().subtract(a.shiftLeft(3).multiply(S)).shiftLeft(1).multiply(y).mod(this.curve.q),B=M.multiply(i).multiply(a).subtract(S.shiftLeft(1)).shiftLeft(2).multiply(S).subtract(M.square().multiply(M)).mod(this.curve.q),H=y.square().multiply(y).shiftLeft(3).mod(this.curve.q);return new T(this.curve,this.curve.fromBigInteger(U),this.curve.fromBigInteger(B),H)},T.prototype.multiply=function(i){if(this.isInfinity())return this;if(i.signum()==0)return this.curve.getInfinity();var a,d=i,y=d.multiply(new q("3")),S=this.negate(),k=this,M=this.curve.q.subtract(i),U=M.multiply(new q("3")),B=new T(this.curve,this.x,this.y),H=B.negate();for(a=y.bitLength()-2;a>0;--a){k=k.twice();var K=y.testBit(a);K!=d.testBit(a)&&(k=k.add(K?this:S))}for(a=U.bitLength()-2;a>0;--a){B=B.twice();var G=U.testBit(a);G!=M.testBit(a)&&(B=B.add(G?B:H))}return k},T.prototype.multiplyTwo=function(i,a,d){var y;y=i.bitLength()>d.bitLength()?i.bitLength()-1:d.bitLength()-1;for(var S=this.curve.getInfinity(),k=this.add(a);y>=0;)S=S.twice(),i.testBit(y)?S=d.testBit(y)?S.add(k):S.add(this):d.testBit(y)&&(S=S.add(a)),--y;return S},_.prototype.getQ=function(){return this.q},_.prototype.getA=function(){return this.a},_.prototype.getB=function(){return this.b},_.prototype.equals=function(i){return i==this||this.q.equals(i.q)&&this.a.equals(i.a)&&this.b.equals(i.b)},_.prototype.getInfinity=function(){return this.infinity},_.prototype.fromBigInteger=function(i){return new rt(this.q,i)},_.prototype.decodePointHex=function(i){switch(parseInt(i.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var a=(i.length-2)/2,d=i.substr(2,a),y=i.substr(a+2,a);return new T(this,this.fromBigInteger(new q(d,16)),this.fromBigInteger(new q(y,16)));default:return null}},rt.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},T.prototype.getEncoded=function(s){var i=function(k,M){var U=k.toByteArrayUnsigned();if(M<U.length)U=U.slice(U.length-M);else for(;M>U.length;)U.unshift(0);return U},a=this.getX().toBigInteger(),d=this.getY().toBigInteger(),y=i(a,32);return s?d.isEven()?y.unshift(2):y.unshift(3):(y.unshift(4),y=y.concat(i(d,32))),y},T.decodeFrom=function(s,i){i[0];var a=i.length-1,d=i.slice(1,1+a/2),y=i.slice(1+a/2,1+a);d.unshift(0),y.unshift(0);var S=new q(d),k=new q(y);return new T(s,s.fromBigInteger(S),s.fromBigInteger(k))},T.decodeFromHex=function(s,i){i.substr(0,2);var a=i.length-2,d=i.substr(2,a/2),y=i.substr(2+a/2,a/2),S=new q(d,16),k=new q(y,16);return new T(s,s.fromBigInteger(S),s.fromBigInteger(k))},T.prototype.add2D=function(s){if(this.isInfinity())return s;if(s.isInfinity())return this;if(this.x.equals(s.x))return this.y.equals(s.y)?this.twice():this.curve.getInfinity();var i=s.x.subtract(this.x),a=s.y.subtract(this.y).divide(i),d=a.square().subtract(this.x).subtract(s.x),y=a.multiply(this.x.subtract(d)).subtract(this.y);return new T(this.curve,d,y)},T.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var s=this.curve.fromBigInteger(q.valueOf(2)),i=this.curve.fromBigInteger(q.valueOf(3)),a=this.x.square().multiply(i).add(this.curve.a).divide(this.y.multiply(s)),d=a.square().subtract(this.x.multiply(s)),y=a.multiply(this.x.subtract(d)).subtract(this.y);return new T(this.curve,d,y)},T.prototype.multiply2D=function(s){if(this.isInfinity())return this;if(s.signum()==0)return this.curve.getInfinity();var i,a=s,d=a.multiply(new q("3")),y=this.negate(),S=this;for(i=d.bitLength()-2;i>0;--i){S=S.twice();var k=d.testBit(i);k!=a.testBit(i)&&(S=S.add2D(k?this:y))}return S},T.prototype.isOnCurve=function(){var s=this.getX().toBigInteger(),i=this.getY().toBigInteger(),a=this.curve.getA().toBigInteger(),d=this.curve.getB().toBigInteger(),y=this.curve.getQ(),S=i.multiply(i).mod(y),k=s.multiply(s).multiply(s).add(a.multiply(s)).add(d).mod(y);return S.equals(k)},T.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},T.prototype.validate=function(){var s=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var i=this.getX().toBigInteger(),a=this.getY().toBigInteger();if(i.compareTo(q.ONE)<0||i.compareTo(s.subtract(q.ONE))>0)throw new Error("x coordinate out of bounds");if(a.compareTo(q.ONE)<0||a.compareTo(s.subtract(q.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(s).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */var w=function(){var s=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),i=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),a={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function d(k,M,U){return M?a[M]:String.fromCharCode(parseInt(U,16))}var y=new String(""),S=Object.hasOwnProperty;return function(k,M){var U,B,H=k.match(s),K=H[0],G=!1;K==="{"?U={}:K==="["?U=[]:(U=[],G=!0);for(var ee=[U],ie=1-G,ae=H.length;ie<ae;++ie){var ue;switch((K=H[ie]).charCodeAt(0)){default:(ue=ee[0])[B||ue.length]=+K,B=void 0;break;case 34:if((K=K.substring(1,K.length-1)).indexOf("\\")!==-1&&(K=K.replace(i,d)),ue=ee[0],!B){if(!(ue instanceof Array)){B=K||y;break}B=ue.length}ue[B]=K,B=void 0;break;case 91:ue=ee[0],ee.unshift(ue[B||ue.length]=[]),B=void 0;break;case 93:ee.shift();break;case 102:(ue=ee[0])[B||ue.length]=!1,B=void 0;break;case 110:(ue=ee[0])[B||ue.length]=null,B=void 0;break;case 116:(ue=ee[0])[B||ue.length]=!0,B=void 0;break;case 123:ue=ee[0],ee.unshift(ue[B||ue.length]={}),B=void 0;break;case 125:ee.shift()}}if(G){if(ee.length!==1)throw new Error;U=U[0]}else if(ee.length)throw new Error;return M&&(U=function P($,V){var z=$[V];if(z&&(z===void 0?"undefined":C(z))==="object"){var se=null;for(var ce in z)if(S.call(z,ce)&&z!==$){var Ee=P(z,ce);Ee!==void 0?z[ce]=Ee:(se||(se=[]),se.push(ce))}if(se)for(var pe=se.length;--pe>=0;)delete z[se[pe]]}return M.call($,V,z)}({"":U},"")),U}}();b!==void 0&&b||(n.KJUR=b={}),b.asn1!==void 0&&b.asn1||(b.asn1={}),b.asn1.ASN1Util=new function(){this.integerToByteHex=function(s){var i=s.toString(16);return i.length%2==1&&(i="0"+i),i},this.bigIntToMinTwosComplementsHex=function(s){var i=s.toString(16);if(i.substr(0,1)!="-")i.length%2==1?i="0"+i:i.match(/^[0-7]/)||(i="00"+i);else{var a=i.substr(1).length;a%2==1?a+=1:i.match(/^[0-7]/)||(a+=2);for(var d="",y=0;y<a;y++)d+="f";i=new q(d,16).xor(s).add(q.ONE).toString(16).replace(/^-/,"")}return i},this.getPEMStringFromHex=function(s,i){return ge(s,i)},this.newObject=function(s){var i=b.asn1,a=i.ASN1Object,d=i.DERBoolean,y=i.DERInteger,S=i.DERBitString,k=i.DEROctetString,M=i.DERNull,U=i.DERObjectIdentifier,B=i.DEREnumerated,H=i.DERUTF8String,K=i.DERNumericString,G=i.DERPrintableString,ee=i.DERTeletexString,ie=i.DERIA5String,ae=i.DERUTCTime,ue=i.DERGeneralizedTime,P=i.DERVisibleString,$=i.DERBMPString,V=i.DERSequence,z=i.DERSet,se=i.DERTaggedObject,ce=i.ASN1Util.newObject;if(s instanceof i.ASN1Object)return s;var Ee=Object.keys(s);if(Ee.length!=1)throw new Error("key of param shall be only one.");var pe=Ee[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+pe+":")==-1)throw new Error("undefined key: "+pe);if(pe=="bool")return new d(s[pe]);if(pe=="int")return new y(s[pe]);if(pe=="bitstr")return new S(s[pe]);if(pe=="octstr")return new k(s[pe]);if(pe=="null")return new M(s[pe]);if(pe=="oid")return new U(s[pe]);if(pe=="enum")return new B(s[pe]);if(pe=="utf8str")return new H(s[pe]);if(pe=="numstr")return new K(s[pe]);if(pe=="prnstr")return new G(s[pe]);if(pe=="telstr")return new ee(s[pe]);if(pe=="ia5str")return new ie(s[pe]);if(pe=="utctime")return new ae(s[pe]);if(pe=="gentime")return new ue(s[pe]);if(pe=="visstr")return new P(s[pe]);if(pe=="bmpstr")return new $(s[pe]);if(pe=="asn1")return new a(s[pe]);if(pe=="seq"){for(var $e=s[pe],ve=[],Ce=0;Ce<$e.length;Ce++){var ot=ce($e[Ce]);ve.push(ot)}return new V({array:ve})}if(pe=="set"){for($e=s[pe],ve=[],Ce=0;Ce<$e.length;Ce++)ot=ce($e[Ce]),ve.push(ot);return new z({array:ve})}if(pe=="tag"){var ct=s[pe];if(Object.prototype.toString.call(ct)==="[object Array]"&&ct.length==3){var at=ce(ct[2]);return new se({tag:ct[0],explicit:ct[1],obj:at})}return new se(ct)}},this.jsonToASN1HEX=function(s){return this.newObject(s).getEncodedHex()}},b.asn1.ASN1Util.oidHexToInt=function(s){for(var i="",a=parseInt(s.substr(0,2),16),d=(i=Math.floor(a/40)+"."+a%40,""),y=2;y<s.length;y+=2){var S=("00000000"+parseInt(s.substr(y,2),16).toString(2)).slice(-8);d+=S.substr(1,7),S.substr(0,1)=="0"&&(i=i+"."+new q(d,2).toString(10),d="")}return i},b.asn1.ASN1Util.oidIntToHex=function(s){var i=function(U){var B=U.toString(16);return B.length==1&&(B="0"+B),B},a=function(U){var B="",H=new q(U,10).toString(2),K=7-H.length%7;K==7&&(K=0);for(var G="",ee=0;ee<K;ee++)G+="0";for(H=G+H,ee=0;ee<H.length-1;ee+=7){var ie=H.substr(ee,7);ee!=H.length-7&&(ie="1"+ie),B+=i(parseInt(ie,2))}return B};if(!s.match(/^[0-9.]+$/))throw"malformed oid string: "+s;var d="",y=s.split("."),S=40*parseInt(y[0])+parseInt(y[1]);d+=i(S),y.splice(0,2);for(var k=0;k<y.length;k++)d+=a(y[k]);return d},b.asn1.ASN1Object=function(s){this.params=null,this.getLengthHexFromValue=function(){if(this.hV===void 0||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n=0,v="+this.hV);var i=this.hV.length/2,a=i.toString(16);if(a.length%2==1&&(a="0"+a),i<128)return a;var d=a.length/2;if(d>15)throw"ASN.1 length too long to represent by 8x: n = "+i.toString(16);return(128+d).toString(16)+a},this.getEncodedHex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(i){this.params=i},s!=null&&s.tlv!=null&&(this.hTLV=s.tlv,this.isModified=!1)},b.asn1.DERAbstractString=function(s){b.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(i){this.hTLV=null,this.isModified=!0,this.s=i,this.hV=Nr(this.s).toLowerCase()},this.setStringHex=function(i){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=i},this.getFreshValueHex=function(){return this.hV},s!==void 0&&(typeof s=="string"?this.setString(s):s.str!==void 0?this.setString(s.str):s.hex!==void 0&&this.setStringHex(s.hex))},Xe(b.asn1.DERAbstractString,b.asn1.ASN1Object),b.asn1.DERAbstractTime=function(s){b.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(i){var a=i.getTime()+6e4*i.getTimezoneOffset();return new Date(a)},this.formatDate=function(i,a,d){var y=this.zeroPadding,S=this.localDateToUTC(i),k=String(S.getFullYear());a=="utc"&&(k=k.substr(2,2));var M=k+y(String(S.getMonth()+1),2)+y(String(S.getDate()),2)+y(String(S.getHours()),2)+y(String(S.getMinutes()),2)+y(String(S.getSeconds()),2);if(d===!0){var U=S.getMilliseconds();if(U!=0){var B=y(String(U),3);M=M+"."+(B=B.replace(/[0]+$/,""))}}return M+"Z"},this.zeroPadding=function(i,a){return i.length>=a?i:new Array(a-i.length+1).join("0")+i},this.getString=function(){return this.s},this.setString=function(i){this.hTLV=null,this.isModified=!0,this.s=i,this.hV=qe(i)},this.setByDateValue=function(i,a,d,y,S,k){var M=new Date(Date.UTC(i,a-1,d,y,S,k,0));this.setByDate(M)},this.getFreshValueHex=function(){return this.hV}},Xe(b.asn1.DERAbstractTime,b.asn1.ASN1Object),b.asn1.DERAbstractStructured=function(s){b.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(i){this.hTLV=null,this.isModified=!0,this.asn1Array=i},this.appendASN1Object=function(i){this.hTLV=null,this.isModified=!0,this.asn1Array.push(i)},this.asn1Array=new Array,s!==void 0&&s.array!==void 0&&(this.asn1Array=s.array)},Xe(b.asn1.DERAbstractStructured,b.asn1.ASN1Object),b.asn1.DERBoolean=function(s){b.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=s==0?"010100":"0101ff"},Xe(b.asn1.DERBoolean,b.asn1.ASN1Object),b.asn1.DERInteger=function(s){b.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(i){this.hTLV=null,this.isModified=!0,this.hV=b.asn1.ASN1Util.bigIntToMinTwosComplementsHex(i)},this.setByInteger=function(i){var a=new q(String(i),10);this.setByBigInteger(a)},this.setValueHex=function(i){this.hV=i},this.getFreshValueHex=function(){return this.hV},s!==void 0&&(s.bigint!==void 0?this.setByBigInteger(s.bigint):s.int!==void 0?this.setByInteger(s.int):typeof s=="number"?this.setByInteger(s):s.hex!==void 0&&this.setValueHex(s.hex))},Xe(b.asn1.DERInteger,b.asn1.ASN1Object),b.asn1.DERBitString=function(s){if(s!==void 0&&s.obj!==void 0){var i=b.asn1.ASN1Util.newObject(s.obj);s.hex="00"+i.getEncodedHex()}b.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(a){this.hTLV=null,this.isModified=!0,this.hV=a},this.setUnusedBitsAndHexValue=function(a,d){if(a<0||7<a)throw"unused bits shall be from 0 to 7: u = "+a;var y="0"+a;this.hTLV=null,this.isModified=!0,this.hV=y+d},this.setByBinaryString=function(a){var d=8-(a=a.replace(/0+$/,"")).length%8;d==8&&(d=0);for(var y=0;y<=d;y++)a+="0";var S="";for(y=0;y<a.length-1;y+=8){var k=a.substr(y,8),M=parseInt(k,2).toString(16);M.length==1&&(M="0"+M),S+=M}this.hTLV=null,this.isModified=!0,this.hV="0"+d+S},this.setByBooleanArray=function(a){for(var d="",y=0;y<a.length;y++)a[y]==1?d+="1":d+="0";this.setByBinaryString(d)},this.newFalseArray=function(a){for(var d=new Array(a),y=0;y<a;y++)d[y]=!1;return d},this.getFreshValueHex=function(){return this.hV},s!==void 0&&(typeof s=="string"&&s.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(s):s.hex!==void 0?this.setHexValueIncludingUnusedBits(s.hex):s.bin!==void 0?this.setByBinaryString(s.bin):s.array!==void 0&&this.setByBooleanArray(s.array))},Xe(b.asn1.DERBitString,b.asn1.ASN1Object),b.asn1.DEROctetString=function(s){if(s!==void 0&&s.obj!==void 0){var i=b.asn1.ASN1Util.newObject(s.obj);s.hex=i.getEncodedHex()}b.asn1.DEROctetString.superclass.constructor.call(this,s),this.hT="04"},Xe(b.asn1.DEROctetString,b.asn1.DERAbstractString),b.asn1.DERNull=function(){b.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},Xe(b.asn1.DERNull,b.asn1.ASN1Object),b.asn1.DERObjectIdentifier=function(s){b.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(i){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=i},this.setValueOidString=function(i){var a=function(y){var S=function(G){var ee=G.toString(16);return ee.length==1&&(ee="0"+ee),ee},k=function(G){var ee="",ie=parseInt(G,10).toString(2),ae=7-ie.length%7;ae==7&&(ae=0);for(var ue="",P=0;P<ae;P++)ue+="0";for(ie=ue+ie,P=0;P<ie.length-1;P+=7){var $=ie.substr(P,7);P!=ie.length-7&&($="1"+$),ee+=S(parseInt($,2))}return ee};try{if(!y.match(/^[0-9.]+$/))return null;var M="",U=y.split("."),B=40*parseInt(U[0],10)+parseInt(U[1],10);M+=S(B),U.splice(0,2);for(var H=0;H<U.length;H++)M+=k(U[H]);return M}catch{return null}}(i);if(a==null)throw new Error("malformed oid string: "+i);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=a},this.setValueName=function(i){var a=b.asn1.x509.OID.name2oid(i);if(a==="")throw new Error("DERObjectIdentifier oidName undefined: "+i);this.setValueOidString(a)},this.setValueNameOrOid=function(i){i.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(i):this.setValueName(i)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(i){typeof i=="string"?this.setValueNameOrOid(i):i.oid!==void 0?this.setValueNameOrOid(i.oid):i.name!==void 0?this.setValueNameOrOid(i.name):i.hex!==void 0&&this.setValueHex(i.hex)},s!==void 0&&this.setByParam(s)},Xe(b.asn1.DERObjectIdentifier,b.asn1.ASN1Object),b.asn1.DEREnumerated=function(s){b.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(i){this.hTLV=null,this.isModified=!0,this.hV=b.asn1.ASN1Util.bigIntToMinTwosComplementsHex(i)},this.setByInteger=function(i){var a=new q(String(i),10);this.setByBigInteger(a)},this.setValueHex=function(i){this.hV=i},this.getFreshValueHex=function(){return this.hV},s!==void 0&&(s.int!==void 0?this.setByInteger(s.int):typeof s=="number"?this.setByInteger(s):s.hex!==void 0&&this.setValueHex(s.hex))},Xe(b.asn1.DEREnumerated,b.asn1.ASN1Object),b.asn1.DERUTF8String=function(s){b.asn1.DERUTF8String.superclass.constructor.call(this,s),this.hT="0c"},Xe(b.asn1.DERUTF8String,b.asn1.DERAbstractString),b.asn1.DERNumericString=function(s){b.asn1.DERNumericString.superclass.constructor.call(this,s),this.hT="12"},Xe(b.asn1.DERNumericString,b.asn1.DERAbstractString),b.asn1.DERPrintableString=function(s){b.asn1.DERPrintableString.superclass.constructor.call(this,s),this.hT="13"},Xe(b.asn1.DERPrintableString,b.asn1.DERAbstractString),b.asn1.DERTeletexString=function(s){b.asn1.DERTeletexString.superclass.constructor.call(this,s),this.hT="14"},Xe(b.asn1.DERTeletexString,b.asn1.DERAbstractString),b.asn1.DERIA5String=function(s){b.asn1.DERIA5String.superclass.constructor.call(this,s),this.hT="16"},Xe(b.asn1.DERIA5String,b.asn1.DERAbstractString),b.asn1.DERVisibleString=function(s){b.asn1.DERIA5String.superclass.constructor.call(this,s),this.hT="1a"},Xe(b.asn1.DERVisibleString,b.asn1.DERAbstractString),b.asn1.DERBMPString=function(s){b.asn1.DERBMPString.superclass.constructor.call(this,s),this.hT="1e"},Xe(b.asn1.DERBMPString,b.asn1.DERAbstractString),b.asn1.DERUTCTime=function(s){b.asn1.DERUTCTime.superclass.constructor.call(this,s),this.hT="17",this.setByDate=function(i){this.hTLV=null,this.isModified=!0,this.date=i,this.s=this.formatDate(this.date,"utc"),this.hV=qe(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=qe(this.s)),this.hV},s!==void 0&&(s.str!==void 0?this.setString(s.str):typeof s=="string"&&s.match(/^[0-9]{12}Z$/)?this.setString(s):s.hex!==void 0?this.setStringHex(s.hex):s.date!==void 0&&this.setByDate(s.date))},Xe(b.asn1.DERUTCTime,b.asn1.DERAbstractTime),b.asn1.DERGeneralizedTime=function(s){b.asn1.DERGeneralizedTime.superclass.constructor.call(this,s),this.hT="18",this.withMillis=!1,this.setByDate=function(i){this.hTLV=null,this.isModified=!0,this.date=i,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=qe(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=qe(this.s)),this.hV},s!==void 0&&(s.str!==void 0?this.setString(s.str):typeof s=="string"&&s.match(/^[0-9]{14}Z$/)?this.setString(s):s.hex!==void 0?this.setStringHex(s.hex):s.date!==void 0&&this.setByDate(s.date),s.millis===!0&&(this.withMillis=!0))},Xe(b.asn1.DERGeneralizedTime,b.asn1.DERAbstractTime),b.asn1.DERSequence=function(s){b.asn1.DERSequence.superclass.constructor.call(this,s),this.hT="30",this.getFreshValueHex=function(){for(var i="",a=0;a<this.asn1Array.length;a++)i+=this.asn1Array[a].getEncodedHex();return this.hV=i,this.hV}},Xe(b.asn1.DERSequence,b.asn1.DERAbstractStructured),b.asn1.DERSet=function(s){b.asn1.DERSet.superclass.constructor.call(this,s),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var i=new Array,a=0;a<this.asn1Array.length;a++){var d=this.asn1Array[a];i.push(d.getEncodedHex())}return this.sortFlag==1&&i.sort(),this.hV=i.join(""),this.hV},s!==void 0&&s.sortflag!==void 0&&s.sortflag==0&&(this.sortFlag=!1)},Xe(b.asn1.DERSet,b.asn1.DERAbstractStructured),b.asn1.DERTaggedObject=function(s){b.asn1.DERTaggedObject.superclass.constructor.call(this);var i=b.asn1;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(a,d,y){this.hT=d,this.isExplicit=a,this.asn1Object=y,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=y.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,d),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(a){a.tag!=null&&(this.hT=a.tag),a.explicit!=null&&(this.isExplicit=a.explicit),a.tage!=null&&(this.hT=a.tage,this.isExplicit=!0),a.tagi!=null&&(this.hT=a.tagi,this.isExplicit=!1),a.obj!=null&&(a.obj instanceof i.ASN1Object?(this.asn1Object=a.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)):C(a.obj)=="object"&&(this.asn1Object=i.ASN1Util.newObject(a.obj),this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},s!=null&&this.setByParam(s)},Xe(b.asn1.DERTaggedObject,b.asn1.ASN1Object);var b,re,oe,ne=new function(){};function Be(s){for(var i=new Array,a=0;a<s.length;a++)i[a]=s.charCodeAt(a);return i}function nt(s){for(var i="",a=0;a<s.length;a++)i+=String.fromCharCode(s[a]);return i}function ze(s){for(var i="",a=0;a<s.length;a++){var d=s[a].toString(16);d.length==1&&(d="0"+d),i+=d}return i}function qe(s){return ze(Be(s))}function Ve(s){return s=(s=(s=s.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function Ar(s){return s.length%4==2?s+="==":s.length%4==3&&(s+="="),s=(s=s.replace(/-/g,"+")).replace(/_/g,"/")}function gt(s){return s.length%2==1&&(s="0"+s),Ve(W(s))}function Ye(s){return fe(Ar(s))}function Nr(s){return Tt(Dr(s))}function yt(s){return decodeURIComponent(Lr(s))}function Mt(s){for(var i="",a=0;a<s.length-1;a+=2)i+=String.fromCharCode(parseInt(s.substr(a,2),16));return i}function Ht(s){for(var i="",a=0;a<s.length;a++)i+=("0"+s.charCodeAt(a).toString(16)).slice(-2);return i}function An(s){return W(s)}function j(s){var i=An(s).replace(/(.{64})/g,`$1\r
`);return i=i.replace(/\r\n$/,"")}function J(s){return fe(s.replace(/[^0-9A-Za-z\/+=]*/g,""))}function ge(s,i){return"-----BEGIN "+i+`-----\r
`+j(s)+`\r
-----END `+i+`-----\r
`}function ye(s,i){if(s.indexOf("-----BEGIN ")==-1)throw"can't find PEM header: "+i;return J(s=i!==void 0?(s=s.replace(new RegExp("^[^]*-----BEGIN "+i+"-----"),"")).replace(new RegExp("-----END "+i+"-----[^]*$"),""):(s=s.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function xe(s){var i,a,d,y,S,k,M,U,B,H,K;if(K=s.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return U=K[1],i=parseInt(U),U.length===2&&(50<=i&&i<100?i=1900+i:0<=i&&i<50&&(i=2e3+i)),a=parseInt(K[2])-1,d=parseInt(K[3]),y=parseInt(K[4]),S=parseInt(K[5]),k=parseInt(K[6]),M=0,(B=K[7])!==""&&(H=(B.substr(1)+"00").substr(0,3),M=parseInt(H)),Date.UTC(i,a,d,y,S,k,M);throw"unsupported zulu format: "+s}function vt(s){return~~(xe(s)/1e3)}function Tt(s){return s.replace(/%/g,"")}function Lr(s){return s.replace(/(..)/g,"%$1")}function sr(s){var i="malformed IPv6 address";if(!s.match(/^[0-9A-Fa-f:]+$/))throw i;var a=(s=s.toLowerCase()).split(":").length-1;if(a<2)throw i;var d=":".repeat(7-a+2),y=(s=s.replace("::",d)).split(":");if(y.length!=8)throw i;for(var S=0;S<8;S++)y[S]=("0000"+y[S]).slice(-4);return y.join("")}function In(s){if(!s.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var i=(s=s.toLowerCase()).match(/.{1,4}/g),a=0;a<8;a++)i[a]=i[a].replace(/^0+/,""),i[a]==""&&(i[a]="0");var d=(s=":"+i.join(":")+":").match(/:(0:){2,}/g);if(d===null)return s.slice(1,-1);var y="";for(a=0;a<d.length;a++)d[a].length>y.length&&(y=d[a]);return(s=s.replace(y,"::")).slice(1,-1)}function Tn(s){var i="malformed hex value";if(!s.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw i;if(s.length!=8)return s.length==32?In(s):s;try{return parseInt(s.substr(0,2),16)+"."+parseInt(s.substr(2,2),16)+"."+parseInt(s.substr(4,2),16)+"."+parseInt(s.substr(6,2),16)}catch{throw i}}function Rn(s){return s.match(/.{4}/g).map(function(a){var d=parseInt(a.substr(0,2),16),y=parseInt(a.substr(2),16);if(d==0&y<128)return String.fromCharCode(y);if(d<8){var S=128|63&y;return yt((192|(7&d)<<3|(192&y)>>6).toString(16)+S.toString(16))}S=128|(15&d)<<2|(192&y)>>6;var k=128|63&y;return yt((224|(240&d)>>4).toString(16)+S.toString(16)+k.toString(16))}).join("")}function Dr(s){for(var i=encodeURIComponent(s),a="",d=0;d<i.length;d++)i[d]=="%"?(a+=i.substr(d,3),d+=2):a=a+"%"+qe(i[d]);return a}function Zr(s){return!(s.length%2!=0||!s.match(/^[0-9a-f]+$/)&&!s.match(/^[0-9A-F]+$/))}function Ur(s){return s.length%2==1?"0"+s:s.substr(0,1)>"7"?"00"+s:s}ne.getLblen=function(s,i){if(s.substr(i+2,1)!="8")return 1;var a=parseInt(s.substr(i+3,1));return a==0?-1:0<a&&a<10?a+1:-2},ne.getL=function(s,i){var a=ne.getLblen(s,i);return a<1?"":s.substr(i+2,2*a)},ne.getVblen=function(s,i){var a;return(a=ne.getL(s,i))==""?-1:(a.substr(0,1)==="8"?new q(a.substr(2),16):new q(a,16)).intValue()},ne.getVidx=function(s,i){var a=ne.getLblen(s,i);return a<0?a:i+2*(a+1)},ne.getV=function(s,i){var a=ne.getVidx(s,i),d=ne.getVblen(s,i);return s.substr(a,2*d)},ne.getTLV=function(s,i){return s.substr(i,2)+ne.getL(s,i)+ne.getV(s,i)},ne.getTLVblen=function(s,i){return 2+2*ne.getLblen(s,i)+2*ne.getVblen(s,i)},ne.getNextSiblingIdx=function(s,i){return ne.getVidx(s,i)+2*ne.getVblen(s,i)},ne.getChildIdx=function(s,i){var a,d,y,S=ne,k=[];a=S.getVidx(s,i),d=2*S.getVblen(s,i),s.substr(i,2)=="03"&&(a+=2,d-=2),y=0;for(var M=a;y<=d;){var U=S.getTLVblen(s,M);if((y+=U)<=d&&k.push(M),M+=U,y>=d)break}return k},ne.getNthChildIdx=function(s,i,a){return ne.getChildIdx(s,i)[a]},ne.getIdxbyList=function(s,i,a,d){var y,S,k=ne;return a.length==0?d!==void 0&&s.substr(i,2)!==d?-1:i:(y=a.shift())>=(S=k.getChildIdx(s,i)).length?-1:k.getIdxbyList(s,S[y],a,d)},ne.getIdxbyListEx=function(s,i,a,d){var y,S,k=ne;if(a.length==0)return d!==void 0&&s.substr(i,2)!==d?-1:i;y=a.shift(),S=k.getChildIdx(s,i);for(var M=0,U=0;U<S.length;U++){var B=s.substr(S[U],2);if(typeof y=="number"&&!k.isContextTag(B)&&M==y||typeof y=="string"&&k.isContextTag(B,y))return k.getIdxbyListEx(s,S[U],a,d);k.isContextTag(B)||M++}return-1},ne.getTLVbyList=function(s,i,a,d){var y=ne,S=y.getIdxbyList(s,i,a,d);return S==-1||S>=s.length?null:y.getTLV(s,S)},ne.getTLVbyListEx=function(s,i,a,d){var y=ne,S=y.getIdxbyListEx(s,i,a,d);return S==-1?null:y.getTLV(s,S)},ne.getVbyList=function(s,i,a,d,y){var S,k,M=ne;return(S=M.getIdxbyList(s,i,a,d))==-1||S>=s.length?null:(k=M.getV(s,S),y===!0&&(k=k.substr(2)),k)},ne.getVbyListEx=function(s,i,a,d,y){var S,k,M=ne;return(S=M.getIdxbyListEx(s,i,a,d))==-1?null:(k=M.getV(s,S),s.substr(S,2)=="03"&&y!==!1&&(k=k.substr(2)),k)},ne.getInt=function(s,i,a){a==null&&(a=-1);try{var d=s.substr(i,2);if(d!="02"&&d!="03")return a;var y=ne.getV(s,i);return d=="02"?parseInt(y,16):function(k){try{var M=k.substr(0,2);if(M=="00")return parseInt(k.substr(2),16);var U=parseInt(M,16),B=k.substr(2),H=parseInt(B,16).toString(2);return H=="0"&&(H="00000000"),H=H.slice(0,0-U),parseInt(H,2)}catch{return-1}}(y)}catch{return a}},ne.getOID=function(s,i,a){a==null&&(a=null);try{return s.substr(i,2)!="06"?a:function(y){if(!Zr(y))return null;try{var S=[],k=y.substr(0,2),M=parseInt(k,16);S[0]=new String(Math.floor(M/40)),S[1]=new String(M%40);for(var U=y.substr(2),B=[],H=0;H<U.length/2;H++)B.push(parseInt(U.substr(2*H,2),16));var K=[],G="";for(H=0;H<B.length;H++)128&B[H]?G+=en((127&B[H]).toString(2),7):(G+=en((127&B[H]).toString(2),7),K.push(new String(parseInt(G,2))),G="");var ee=S.join(".");return K.length>0&&(ee=ee+"."+K.join(".")),ee}catch{return null}}(ne.getV(s,i))}catch{return a}},ne.getOIDName=function(s,i,a){a==null&&(a=null);try{var d=ne.getOID(s,i,a);if(d==a)return a;var y=b.asn1.x509.OID.oid2name(d);return y==""?d:y}catch{return a}},ne.getString=function(s,i,a){a==null&&(a=null);try{return Mt(ne.getV(s,i))}catch{return a}},ne.hextooidstr=function(s){var i=function(G,ee){return G.length>=ee?G:new Array(ee-G.length+1).join("0")+G},a=[],d=s.substr(0,2),y=parseInt(d,16);a[0]=new String(Math.floor(y/40)),a[1]=new String(y%40);for(var S=s.substr(2),k=[],M=0;M<S.length/2;M++)k.push(parseInt(S.substr(2*M,2),16));var U=[],B="";for(M=0;M<k.length;M++)128&k[M]?B+=i((127&k[M]).toString(2),7):(B+=i((127&k[M]).toString(2),7),U.push(new String(parseInt(B,2))),B="");var H=a.join(".");return U.length>0&&(H=H+"."+U.join(".")),H},ne.dump=function(s,i,a,d){var y=ne,S=y.getV,k=y.dump,M=y.getChildIdx,U=s;s instanceof b.asn1.ASN1Object&&(U=s.getEncodedHex());var B=function(pe,$e){return pe.length<=2*$e?pe:pe.substr(0,$e)+"..(total "+pe.length/2+"bytes).."+pe.substr(pe.length-$e,$e)};i===void 0&&(i={ommit_long_octet:32}),a===void 0&&(a=0),d===void 0&&(d="");var H,K=i.ommit_long_octet;if((H=U.substr(a,2))=="01")return(G=S(U,a))=="00"?d+`BOOLEAN FALSE
`:d+`BOOLEAN TRUE
`;if(H=="02")return d+"INTEGER "+B(G=S(U,a),K)+`
`;if(H=="03"){var G=S(U,a);if(y.isASN1HEX(G.substr(2))){var ee=d+`BITSTRING, encapsulates
`;return ee+=k(G.substr(2),i,0,d+"  ")}return d+"BITSTRING "+B(G,K)+`
`}if(H=="04")return G=S(U,a),y.isASN1HEX(G)?(ee=d+`OCTETSTRING, encapsulates
`,ee+=k(G,i,0,d+"  ")):d+"OCTETSTRING "+B(G,K)+`
`;if(H=="05")return d+`NULL
`;if(H=="06"){var ie=S(U,a),ae=b.asn1.ASN1Util.oidHexToInt(ie),ue=b.asn1.x509.OID.oid2name(ae),P=ae.replace(/\./g," ");return ue!=""?d+"ObjectIdentifier "+ue+" ("+P+`)
`:d+"ObjectIdentifier ("+P+`)
`}if(H=="0a")return d+"ENUMERATED "+parseInt(S(U,a))+`
`;if(H=="0c")return d+"UTF8String '"+yt(S(U,a))+`'
`;if(H=="13")return d+"PrintableString '"+yt(S(U,a))+`'
`;if(H=="14")return d+"TeletexString '"+yt(S(U,a))+`'
`;if(H=="16")return d+"IA5String '"+yt(S(U,a))+`'
`;if(H=="17")return d+"UTCTime "+yt(S(U,a))+`
`;if(H=="18")return d+"GeneralizedTime "+yt(S(U,a))+`
`;if(H=="1a")return d+"VisualString '"+yt(S(U,a))+`'
`;if(H=="1e")return d+"BMPString '"+Rn(S(U,a))+`'
`;if(H=="30"){if(U.substr(a,4)=="3000")return d+`SEQUENCE {}
`;ee=d+`SEQUENCE
`;var $=i;if(((se=M(U,a)).length==2||se.length==3)&&U.substr(se[0],2)=="06"&&U.substr(se[se.length-1],2)=="04"){ue=y.oidname(S(U,se[0]));var V=JSON.parse(JSON.stringify(i));V.x509ExtName=ue,$=V}for(var z=0;z<se.length;z++)ee+=k(U,$,se[z],d+"  ");return ee}if(H=="31"){ee=d+`SET
`;var se=M(U,a);for(z=0;z<se.length;z++)ee+=k(U,i,se[z],d+"  ");return ee}if(128&(H=parseInt(H,16))){var ce=31&H;if(32&H){for(ee=d+"["+ce+`]
`,se=M(U,a),z=0;z<se.length;z++)ee+=k(U,i,se[z],d+"  ");return ee}if(G=S(U,a),ne.isASN1HEX(G)){var ee=d+"["+ce+`]
`;return ee+=k(G,i,0,d+"  ")}return(G.substr(0,8)=="68747470"||i.x509ExtName==="subjectAltName"&&ce==2)&&(G=yt(G)),ee=d+"["+ce+"] "+G+`
`}return d+"UNKNOWN("+H+") "+S(U,a)+`
`},ne.isContextTag=function(s,i){var a,d;s=s.toLowerCase();try{a=parseInt(s,16)}catch{return-1}if(i===void 0)return(192&a)==128;try{return i.match(/^\[[0-9]+\]$/)!=null&&!((d=parseInt(i.substr(1,i.length-1),10))>31)&&(192&a)==128&&(31&a)==d}catch{return!1}},ne.isASN1HEX=function(s){var i=ne;if(s.length%2==1)return!1;var a=i.getVblen(s,0),d=s.substr(0,2),y=i.getL(s,0);return s.length-d.length-y.length==2*a},ne.checkStrictDER=function(s,i,a,d,y){var S=ne;if(a===void 0){if(typeof s!="string")throw new Error("not hex string");if(s=s.toLowerCase(),!b.lang.String.isHex(s))throw new Error("not hex string");a=s.length,y=(d=s.length/2)<128?1:Math.ceil(d.toString(16))+1}if(S.getL(s,i).length>2*y)throw new Error("L of TLV too long: idx="+i);var k=S.getVblen(s,i);if(k>d)throw new Error("value of L too long than hex: idx="+i);var M=S.getTLV(s,i),U=M.length-2-S.getL(s,i).length;if(U!==2*k)throw new Error("V string length and L's value not the same:"+U+"/"+2*k);if(i===0&&s.length!=M.length)throw new Error("total length and TLV length unmatch:"+s.length+"!="+M.length);var B=s.substr(i,2);if(B==="02"){var H=S.getVidx(s,i);if(s.substr(H,2)=="00"&&s.charCodeAt(H+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(B,16)){for(var K=S.getVblen(s,i),G=0,ee=S.getChildIdx(s,i),ie=0;ie<ee.length;ie++)G+=S.getTLV(s,ee[ie]).length,S.checkStrictDER(s,ee[ie],a,d,y);if(2*K!=G)throw new Error("sum of children's TLV length and L unmatch: "+2*K+"!="+G)}},ne.oidname=function(s){var i=b.asn1;b.lang.String.isHex(s)&&(s=i.ASN1Util.oidHexToInt(s));var a=i.x509.OID.oid2name(s);return a===""&&(a=s),a},b!==void 0&&b||(n.KJUR=b={}),b.lang!==void 0&&b.lang||(b.lang={}),b.lang.String=function(){},typeof c=="function"?(n.utf8tob64u=re=function(i){return Ve(c.from(i,"utf8").toString("base64"))},n.b64utoutf8=oe=function(i){return c.from(Ar(i),"base64").toString("utf8")}):(n.utf8tob64u=re=function(i){return gt(Tt(Dr(i)))},n.b64utoutf8=oe=function(i){return decodeURIComponent(Lr(Ye(i)))}),b.lang.String.isInteger=function(s){return!!s.match(/^[0-9]+$/)||!!s.match(/^-[0-9]+$/)},b.lang.String.isHex=function(s){return Zr(s)},b.lang.String.isBase64=function(s){return!(!(s=s.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||s.length%4!=0)},b.lang.String.isBase64URL=function(s){return!s.match(/[+/=]/)&&(s=Ar(s),b.lang.String.isBase64(s))},b.lang.String.isIntegerArray=function(s){return!!(s=s.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},b.lang.String.isPrintable=function(s){return s.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},b.lang.String.isIA5=function(s){return s.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},b.lang.String.isMail=function(s){return s.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};var en=function(i,a,d){return d==null&&(d="0"),i.length>=a?i:new Array(a-i.length+1).join(d)+i};function Xe(s,i){var a=function(){};a.prototype=i.prototype,s.prototype=new a,s.prototype.constructor=s,s.superclass=i.prototype,i.prototype.constructor==Object.prototype.constructor&&(i.prototype.constructor=i)}b!==void 0&&b||(n.KJUR=b={}),b.crypto!==void 0&&b.crypto||(b.crypto={}),b.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:O.algo.MD5,sha1:O.algo.SHA1,sha224:O.algo.SHA224,sha256:O.algo.SHA256,sha384:O.algo.SHA384,sha512:O.algo.SHA512,ripemd160:O.algo.RIPEMD160},this.getDigestInfoHex=function(s,i){if(this.DIGESTINFOHEAD[i]===void 0)throw"alg not supported in Util.DIGESTINFOHEAD: "+i;return this.DIGESTINFOHEAD[i]+s},this.getPaddedDigestInfoHex=function(s,i,a){var d=this.getDigestInfoHex(s,i),y=a/4;if(d.length+22>y)throw"key is too short for SigAlg: keylen="+a+","+i;for(var S="0001",k="00"+d,M="",U=y-S.length-k.length,B=0;B<U;B+=2)M+="ff";return S+M+k},this.hashString=function(s,i){return new b.crypto.MessageDigest({alg:i}).digestString(s)},this.hashHex=function(s,i){return new b.crypto.MessageDigest({alg:i}).digestHex(s)},this.sha1=function(s){return this.hashString(s,"sha1")},this.sha256=function(s){return this.hashString(s,"sha256")},this.sha256Hex=function(s){return this.hashHex(s,"sha256")},this.sha512=function(s){return this.hashString(s,"sha512")},this.sha512Hex=function(s){return this.hashHex(s,"sha512")},this.isKey=function(s){return s instanceof Se||s instanceof b.crypto.DSA||s instanceof b.crypto.ECDSA}},b.crypto.Util.md5=function(s){return new b.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(s)},b.crypto.Util.ripemd160=function(s){return new b.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(s)},b.crypto.Util.SECURERANDOMGEN=new _e,b.crypto.Util.getRandomHexOfNbytes=function(s){var i=new Array(s);return b.crypto.Util.SECURERANDOMGEN.nextBytes(i),ze(i)},b.crypto.Util.getRandomBigIntegerOfNbytes=function(s){return new q(b.crypto.Util.getRandomHexOfNbytes(s),16)},b.crypto.Util.getRandomHexOfNbits=function(s){var i=s%8,a=new Array((s-i)/8+1);return b.crypto.Util.SECURERANDOMGEN.nextBytes(a),a[0]=(255<<i&255^255)&a[0],ze(a)},b.crypto.Util.getRandomBigIntegerOfNbits=function(s){return new q(b.crypto.Util.getRandomHexOfNbits(s),16)},b.crypto.Util.getRandomBigIntegerZeroToMax=function(s){for(var i=s.bitLength();;){var a=b.crypto.Util.getRandomBigIntegerOfNbits(i);if(s.compareTo(a)!=-1)return a}},b.crypto.Util.getRandomBigIntegerMinToMax=function(s,i){var a=s.compareTo(i);if(a==1)throw"biMin is greater than biMax";if(a==0)return s;var d=i.subtract(s);return b.crypto.Util.getRandomBigIntegerZeroToMax(d).add(s)},b.crypto.MessageDigest=function(s){this.setAlgAndProvider=function(i,a){if((i=b.crypto.MessageDigest.getCanonicalAlgName(i))!==null&&a===void 0&&(a=b.crypto.Util.DEFAULTPROVIDER[i]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(i)!=-1&&a=="cryptojs"){try{this.md=b.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[i].create()}catch(d){throw"setAlgAndProvider hash alg set fail alg="+i+"/"+d}this.updateString=function(d){this.md.update(d)},this.updateHex=function(d){var y=O.enc.Hex.parse(d);this.md.update(y)},this.digest=function(){return this.md.finalize().toString(O.enc.Hex)},this.digestString=function(d){return this.updateString(d),this.digest()},this.digestHex=function(d){return this.updateHex(d),this.digest()}}if(":sha256:".indexOf(i)!=-1&&a=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(d){throw"setAlgAndProvider hash alg set fail alg="+i+"/"+d}this.updateString=function(d){this.md.update(d)},this.updateHex=function(d){var y=sjcl.codec.hex.toBits(d);this.md.update(y)},this.digest=function(){var d=this.md.finalize();return sjcl.codec.hex.fromBits(d)},this.digestString=function(d){return this.updateString(d),this.digest()},this.digestHex=function(d){return this.updateHex(d),this.digest()}}},this.updateString=function(i){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(i){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(i){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(i){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},s!==void 0&&s.alg!==void 0&&(this.algName=s.alg,s.prov===void 0&&(this.provName=b.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},b.crypto.MessageDigest.getCanonicalAlgName=function(s){return typeof s=="string"&&(s=(s=s.toLowerCase()).replace(/-/,"")),s},b.crypto.MessageDigest.getHashLength=function(s){var i=b.crypto.MessageDigest,a=i.getCanonicalAlgName(s);if(i.HASHLENGTH[a]===void 0)throw"not supported algorithm: "+s;return i.HASHLENGTH[a]},b.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},b.crypto.Mac=function(s){this.setAlgAndProvider=function(i,a){if((i=i.toLowerCase())==null&&(i="hmacsha1"),(i=i.toLowerCase()).substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+i;a===void 0&&(a=b.crypto.Util.DEFAULTPROVIDER[i]),this.algProv=i+"/"+a;var d=i.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(d)!=-1&&a=="cryptojs"){try{var y=b.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[d];this.mac=O.algo.HMAC.create(y,this.pass)}catch(S){throw"setAlgAndProvider hash alg set fail hashAlg="+d+"/"+S}this.updateString=function(S){this.mac.update(S)},this.updateHex=function(S){var k=O.enc.Hex.parse(S);this.mac.update(k)},this.doFinal=function(){return this.mac.finalize().toString(O.enc.Hex)},this.doFinalString=function(S){return this.updateString(S),this.doFinal()},this.doFinalHex=function(S){return this.updateHex(S),this.doFinal()}}},this.updateString=function(i){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(i){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(i){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(i){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(i){if(typeof i=="string"){var a=i;return i.length%2!=1&&i.match(/^[0-9A-Fa-f]+$/)||(a=Ht(i)),void(this.pass=O.enc.Hex.parse(a))}if((i===void 0?"undefined":C(i))!="object")throw"KJUR.crypto.Mac unsupported password type: "+i;if(a=null,i.hex!==void 0){if(i.hex.length%2!=0||!i.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+i.hex;a=i.hex}if(i.utf8!==void 0&&(a=Nr(i.utf8)),i.rstr!==void 0&&(a=Ht(i.rstr)),i.b64!==void 0&&(a=fe(i.b64)),i.b64u!==void 0&&(a=Ye(i.b64u)),a==null)throw"KJUR.crypto.Mac unsupported password type: "+i;this.pass=O.enc.Hex.parse(a)},s!==void 0&&(s.pass!==void 0&&this.setPassword(s.pass),s.alg!==void 0&&(this.algName=s.alg,s.prov===void 0&&(this.provName=b.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},b.crypto.Signature=function(s){var i=null;if(this._setAlgNames=function(){var a=this.algName.match(/^(.+)with(.+)$/);a&&(this.mdAlgName=a[1].toLowerCase(),this.pubkeyAlgName=a[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(a,d){for(var y="",S=d/4-a.length,k=0;k<S;k++)y+="0";return y+a},this.setAlgAndProvider=function(a,d){if(this._setAlgNames(),d!="cryptojs/jsrsa")throw new Error("provider not supported: "+d);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new b.crypto.MessageDigest({alg:this.mdAlgName})}catch(y){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+y)}this.init=function(y,S){var k=null;try{k=S===void 0?Ze.getKey(y):Ze.getKey(y,S)}catch(M){throw"init failed:"+M}if(k.isPrivate===!0)this.prvKey=k,this.state="SIGN";else{if(k.isPublic!==!0)throw"init failed.:"+k;this.pubKey=k,this.state="VERIFY"}},this.updateString=function(y){this.md.updateString(y)},this.updateHex=function(y){this.md.updateHex(y)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&b.crypto.ECDSA!==void 0&&(this.prvKey=new b.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof Se&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof Se&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof b.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof b.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(y){return this.updateString(y),this.sign()},this.signHex=function(y){return this.updateHex(y),this.sign()},this.verify=function(y){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&b.crypto.ECDSA!==void 0&&(this.pubKey=new b.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof Se&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,y,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof Se&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,y);if(b.crypto.ECDSA!==void 0&&this.pubKey instanceof b.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,y);if(b.crypto.DSA!==void 0&&this.pubKey instanceof b.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,y);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(a,d){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(a){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(a){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(a){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(a){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(a){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=s,s!==void 0&&(s.alg!==void 0&&(this.algName=s.alg,s.prov===void 0?this.provName=b.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=s.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),s.psssaltlen!==void 0&&(this.pssSaltLen=s.psssaltlen),s.prvkeypem!==void 0)){if(s.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{i=Ze.getKey(s.prvkeypem),this.init(i)}catch(a){throw"fatal error to load pem private key: "+a}}},b.crypto.Cipher=function(s){},b.crypto.Cipher.encrypt=function(s,i,a){if(i instanceof Se&&i.isPublic){var d=b.crypto.Cipher.getAlgByKeyAndName(i,a);if(d==="RSA")return i.encrypt(s);if(d==="RSAOAEP")return i.encryptOAEP(s,"sha1");var y=d.match(/^RSAOAEP(\d+)$/);if(y!==null)return i.encryptOAEP(s,"sha"+y[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+a}throw"Cipher.encrypt: unsupported key or algorithm"},b.crypto.Cipher.decrypt=function(s,i,a){if(i instanceof Se&&i.isPrivate){var d=b.crypto.Cipher.getAlgByKeyAndName(i,a);if(d==="RSA")return i.decrypt(s);if(d==="RSAOAEP")return i.decryptOAEP(s,"sha1");var y=d.match(/^RSAOAEP(\d+)$/);if(y!==null)return i.decryptOAEP(s,"sha"+y[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+a}throw"Cipher.decrypt: unsupported key or algorithm"},b.crypto.Cipher.getAlgByKeyAndName=function(s,i){if(s instanceof Se){if(":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(i)!=-1)return i;if(i==null)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+i}throw"getAlgByKeyAndName: not supported algorithm name: "+i},b.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},b!==void 0&&b||(n.KJUR=b={}),b.crypto!==void 0&&b.crypto||(b.crypto={}),b.crypto.ECDSA=function(s){var i=Error,a=q,d=T,y=b.crypto.ECDSA,S=b.crypto.ECParameterDB,k=y.getName,M=ne,U=M.getVbyListEx,B=M.isASN1HEX,H=new _e;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(K){return new a(K.bitLength(),H).mod(K.subtract(a.ONE)).add(a.ONE)},this.setNamedCurve=function(K){this.ecparams=S.getByName(K),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=K},this.setPrivateKeyHex=function(K){this.isPrivate=!0,this.prvKeyHex=K},this.setPublicKeyHex=function(K){this.isPublic=!0,this.pubKeyHex=K},this.getPublicKeyXYHex=function(){var K=this.pubKeyHex;if(K.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var G=this.ecparams.keylen/4;if(K.length!==2+2*G)throw"malformed public key hex length";var ee={};return ee.x=K.substr(2,G),ee.y=K.substr(2+G),ee},this.getShortNISTPCurveName=function(){var K=this.curveName;return K==="secp256r1"||K==="NIST P-256"||K==="P-256"||K==="prime256v1"?"P-256":K==="secp384r1"||K==="NIST P-384"||K==="P-384"?"P-384":null},this.generateKeyPairHex=function(){var K=this.ecparams.n,G=this.getBigRandom(K),ee=this.ecparams.G.multiply(G),ie=ee.getX().toBigInteger(),ae=ee.getY().toBigInteger(),ue=this.ecparams.keylen/4,P=("0000000000"+G.toString(16)).slice(-ue),$="04"+("0000000000"+ie.toString(16)).slice(-ue)+("0000000000"+ae.toString(16)).slice(-ue);return this.setPrivateKeyHex(P),this.setPublicKeyHex($),{ecprvhex:P,ecpubhex:$}},this.signWithMessageHash=function(K){return this.signHex(K,this.prvKeyHex)},this.signHex=function(K,G){var ee=new a(G,16),ie=this.ecparams.n,ae=new a(K.substring(0,this.ecparams.keylen/4),16);do var ue=this.getBigRandom(ie),P=this.ecparams.G.multiply(ue).getX().toBigInteger().mod(ie);while(P.compareTo(a.ZERO)<=0);var $=ue.modInverse(ie).multiply(ae.add(ee.multiply(P))).mod(ie);return y.biRSSigToASN1Sig(P,$)},this.sign=function(K,G){var ee=G,ie=this.ecparams.n,ae=a.fromByteArrayUnsigned(K);do var ue=this.getBigRandom(ie),P=this.ecparams.G.multiply(ue).getX().toBigInteger().mod(ie);while(P.compareTo(q.ZERO)<=0);var $=ue.modInverse(ie).multiply(ae.add(ee.multiply(P))).mod(ie);return this.serializeSig(P,$)},this.verifyWithMessageHash=function(K,G){return this.verifyHex(K,G,this.pubKeyHex)},this.verifyHex=function(K,G,ee){try{var ie,ae,ue=y.parseSigHex(G);ie=ue.r,ae=ue.s;var P=d.decodeFromHex(this.ecparams.curve,ee),$=new a(K.substring(0,this.ecparams.keylen/4),16);return this.verifyRaw($,ie,ae,P)}catch{return!1}},this.verify=function(K,G,ee){var ie,ae,ue;if(Bitcoin.Util.isArray(G)){var P=this.parseSig(G);ie=P.r,ae=P.s}else{if((G===void 0?"undefined":C(G))!=="object"||!G.r||!G.s)throw"Invalid value for signature";ie=G.r,ae=G.s}if(ee instanceof T)ue=ee;else{if(!Bitcoin.Util.isArray(ee))throw"Invalid format for pubkey value, must be byte array or ECPointFp";ue=d.decodeFrom(this.ecparams.curve,ee)}var $=a.fromByteArrayUnsigned(K);return this.verifyRaw($,ie,ae,ue)},this.verifyRaw=function(K,G,ee,ie){var ae=this.ecparams.n,ue=this.ecparams.G;if(G.compareTo(a.ONE)<0||G.compareTo(ae)>=0||ee.compareTo(a.ONE)<0||ee.compareTo(ae)>=0)return!1;var P=ee.modInverse(ae),$=K.multiply(P).mod(ae),V=G.multiply(P).mod(ae);return ue.multiply($).add(ie.multiply(V)).getX().toBigInteger().mod(ae).equals(G)},this.serializeSig=function(K,G){var ee=K.toByteArraySigned(),ie=G.toByteArraySigned(),ae=[];return ae.push(2),ae.push(ee.length),(ae=ae.concat(ee)).push(2),ae.push(ie.length),(ae=ae.concat(ie)).unshift(ae.length),ae.unshift(48),ae},this.parseSig=function(K){var G;if(K[0]!=48)throw new Error("Signature not a valid DERSequence");if(K[G=2]!=2)throw new Error("First element in signature must be a DERInteger");var ee=K.slice(G+2,G+2+K[G+1]);if(K[G+=2+K[G+1]]!=2)throw new Error("Second element in signature must be a DERInteger");var ie=K.slice(G+2,G+2+K[G+1]);return G+=2+K[G+1],{r:a.fromByteArrayUnsigned(ee),s:a.fromByteArrayUnsigned(ie)}},this.parseSigCompact=function(K){if(K.length!==65)throw"Signature has the wrong length";var G=K[0]-27;if(G<0||G>7)throw"Invalid signature type";var ee=this.ecparams.n;return{r:a.fromByteArrayUnsigned(K.slice(1,33)).mod(ee),s:a.fromByteArrayUnsigned(K.slice(33,65)).mod(ee),i:G}},this.readPKCS5PrvKeyHex=function(K){if(B(K)===!1)throw new Error("not ASN.1 hex string");var G,ee,ie;try{G=U(K,0,["[0]",0],"06"),ee=U(K,0,[1],"04");try{ie=U(K,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=k(G),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(ie),this.setPrivateKeyHex(ee),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(K){if(B(K)===!1)throw new i("not ASN.1 hex string");var G,ee,ie;try{U(K,0,[1,0],"06"),G=U(K,0,[1,1],"06"),ee=U(K,0,[2,0,1],"04");try{ie=U(K,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new i("malformed PKCS#8 plain ECC private key")}if(this.curveName=k(G),this.curveName===void 0)throw new i("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(ie),this.setPrivateKeyHex(ee),this.isPublic=!1},this.readPKCS8PubKeyHex=function(K){if(B(K)===!1)throw new i("not ASN.1 hex string");var G,ee;try{U(K,0,[0,0],"06"),G=U(K,0,[0,1],"06"),ee=U(K,0,[1],"03")}catch{throw new i("malformed PKCS#8 ECC public key")}if(this.curveName=k(G),this.curveName===null)throw new i("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(ee)},this.readCertPubKeyHex=function(K,G){if(B(K)===!1)throw new i("not ASN.1 hex string");var ee,ie;try{ee=U(K,0,[0,5,0,1],"06"),ie=U(K,0,[0,5,1],"03")}catch{throw new i("malformed X.509 certificate ECC public key")}if(this.curveName=k(ee),this.curveName===null)throw new i("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(ie)},s!==void 0&&s.curve!==void 0&&(this.curveName=s.curve),this.curveName===void 0&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),s!==void 0&&(s.prv!==void 0&&this.setPrivateKeyHex(s.prv),s.pub!==void 0&&this.setPublicKeyHex(s.pub))},b.crypto.ECDSA.parseSigHex=function(s){var i=b.crypto.ECDSA.parseSigHexInHexRS(s);return{r:new q(i.r,16),s:new q(i.s,16)}},b.crypto.ECDSA.parseSigHexInHexRS=function(s){var i=ne,a=i.getChildIdx,d=i.getV;if(i.checkStrictDER(s,0),s.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var y=a(s,0);if(y.length!=2)throw new Error("signature shall have two elements");var S=y[0],k=y[1];if(s.substr(S,2)!="02")throw new Error("1st item not ASN.1 integer");if(s.substr(k,2)!="02")throw new Error("2nd item not ASN.1 integer");return{r:d(s,S),s:d(s,k)}},b.crypto.ECDSA.asn1SigToConcatSig=function(s){var i=b.crypto.ECDSA.parseSigHexInHexRS(s),a=i.r,d=i.s;if(a.substr(0,2)=="00"&&a.length%32==2&&(a=a.substr(2)),d.substr(0,2)=="00"&&d.length%32==2&&(d=d.substr(2)),a.length%32==30&&(a="00"+a),d.length%32==30&&(d="00"+d),a.length%32!=0)throw"unknown ECDSA sig r length error";if(d.length%32!=0)throw"unknown ECDSA sig s length error";return a+d},b.crypto.ECDSA.concatSigToASN1Sig=function(s){if(s.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var i=s.substr(0,s.length/2),a=s.substr(s.length/2);return b.crypto.ECDSA.hexRSSigToASN1Sig(i,a)},b.crypto.ECDSA.hexRSSigToASN1Sig=function(s,i){var a=new q(s,16),d=new q(i,16);return b.crypto.ECDSA.biRSSigToASN1Sig(a,d)},b.crypto.ECDSA.biRSSigToASN1Sig=function(s,i){var a=b.asn1,d=new a.DERInteger({bigint:s}),y=new a.DERInteger({bigint:i});return new a.DERSequence({array:[d,y]}).getEncodedHex()},b.crypto.ECDSA.getName=function(s){return s==="2b8104001f"?"secp192k1":s==="2a8648ce3d030107"?"secp256r1":s==="2b8104000a"?"secp256k1":s==="2b81040021"?"secp224r1":s==="2b81040022"?"secp384r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(s)!==-1?"secp256r1":"|secp256k1|".indexOf(s)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(s)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(s)!==-1?"secp384r1":null},b!==void 0&&b||(n.KJUR=b={}),b.crypto!==void 0&&b.crypto||(b.crypto={}),b.crypto.ECParameterDB=new function(){var s={},i={};function a(d){return new q(d,16)}this.getByName=function(d){var y=d;if(i[y]!==void 0&&(y=i[d]),s[y]!==void 0)return s[y];throw"unregistered EC curve name: "+y},this.regist=function(d,y,S,k,M,U,B,H,K,G,ee,ie){s[d]={};var ae=a(S),ue=a(k),P=a(M),$=a(U),V=a(B),z=new _(ae,ue,P),se=z.decodePointHex("04"+H+K);s[d].name=d,s[d].keylen=y,s[d].curve=z,s[d].G=se,s[d].n=$,s[d].h=V,s[d].oid=ee,s[d].info=ie;for(var ce=0;ce<G.length;ce++)i[G[ce]]=d}},b.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),b.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),b.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),b.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),b.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),b.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),b.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),b.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),b.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),b.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);var Ze=function(){var s=function(B,H,K){return i(O.AES,B,H,K)},i=function(B,H,K,G){var ee=O.enc.Hex.parse(H),ie=O.enc.Hex.parse(K),ae=O.enc.Hex.parse(G),ue={};ue.key=ie,ue.iv=ae,ue.ciphertext=ee;var P=B.decrypt(ue,ie,{iv:ae});return O.enc.Hex.stringify(P)},a=function(B,H,K){return d(O.AES,B,H,K)},d=function(B,H,K,G){var ee=O.enc.Hex.parse(H),ie=O.enc.Hex.parse(K),ae=O.enc.Hex.parse(G),ue=B.encrypt(ee,ie,{iv:ae}),P=O.enc.Hex.parse(ue.toString());return O.enc.Base64.stringify(P)},y={"AES-256-CBC":{proc:s,eproc:a,keylen:32,ivlen:16},"AES-192-CBC":{proc:s,eproc:a,keylen:24,ivlen:16},"AES-128-CBC":{proc:s,eproc:a,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(B,H,K){return i(O.TripleDES,B,H,K)},eproc:function(B,H,K){return d(O.TripleDES,B,H,K)},keylen:24,ivlen:8},"DES-CBC":{proc:function(B,H,K){return i(O.DES,B,H,K)},eproc:function(B,H,K){return d(O.DES,B,H,K)},keylen:8,ivlen:8}},S=function(B){var H={},K=B.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));K&&(H.cipher=K[1],H.ivsalt=K[2]);var G=B.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));G&&(H.type=G[1]);var ee=-1,ie=0;B.indexOf(`\r
\r
`)!=-1&&(ee=B.indexOf(`\r
\r
`),ie=2),B.indexOf(`

`)!=-1&&(ee=B.indexOf(`

`),ie=1);var ae=B.indexOf("-----END");if(ee!=-1&&ae!=-1){var ue=B.substring(ee+2*ie,ae-ie);ue=ue.replace(/\s+/g,""),H.data=ue}return H},k=function(B,H,K){for(var G=K.substring(0,16),ee=O.enc.Hex.parse(G),ie=O.enc.Utf8.parse(H),ae=y[B].keylen+y[B].ivlen,ue="",P=null;;){var $=O.algo.MD5.create();if(P!=null&&$.update(P),$.update(ie),$.update(ee),P=$.finalize(),(ue+=O.enc.Hex.stringify(P)).length>=2*ae)break}var V={};return V.keyhex=ue.substr(0,2*y[B].keylen),V.ivhex=ue.substr(2*y[B].keylen,2*y[B].ivlen),V},M=function(B,H,K,G){var ee=O.enc.Base64.parse(B),ie=O.enc.Hex.stringify(ee);return(0,y[H].proc)(ie,K,G)};return{version:"1.0.0",parsePKCS5PEM:function(B){return S(B)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(B,H,K){return k(B,H,K)},decryptKeyB64:function(B,H,K,G){return M(B,H,K,G)},getDecryptedKeyHex:function(B,H){var K=S(B),G=K.cipher,ee=K.ivsalt,ie=K.data,ae=k(G,H,ee).keyhex;return M(ie,G,ae,ee)},getEncryptedPKCS5PEMFromPrvKeyHex:function(B,H,K,G,ee){var ie="";if(G!==void 0&&G!=null||(G="AES-256-CBC"),y[G]===void 0)throw new Error("KEYUTIL unsupported algorithm: "+G);ee!==void 0&&ee!=null||(ee=function(P){var $=O.lib.WordArray.random(P);return O.enc.Hex.stringify($)}(y[G].ivlen).toUpperCase());var ae=function(P,$,V,z){return(0,y[$].eproc)(P,V,z)}(H,G,k(G,K,ee).keyhex,ee);return ie="-----BEGIN "+B+` PRIVATE KEY-----\r
`,ie+=`Proc-Type: 4,ENCRYPTED\r
`,ie+="DEK-Info: "+G+","+ee+`\r
`,ie+=`\r
`,ie+=ae.replace(/(.{64})/g,`$1\r
`),ie+=`\r
-----END `+B+` PRIVATE KEY-----\r
`},parseHexOfEncryptedPKCS8:function(B){var H=ne,K=H.getChildIdx,G=H.getV,ee={},ie=K(B,0);if(ie.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+ie.length);ee.ciphertext=G(B,ie[1]);var ae=K(B,ie[0]);if(ae.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+ae.length);if(G(B,ae[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var ue=K(B,ae[1]);if(ae.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+ue.length);var P=K(B,ue[1]);if(P.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+P.length);if(G(B,P[0])!="2a864886f70d0307")throw"this only supports TripleDES";ee.encryptionSchemeAlg="TripleDES",ee.encryptionSchemeIV=G(B,P[1]);var $=K(B,ue[0]);if($.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+$.length);if(G(B,$[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var V=K(B,$[1]);if(V.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+V.length);ee.pbkdf2Salt=G(B,V[0]);var z=G(B,V[1]);try{ee.pbkdf2Iter=parseInt(z,16)}catch{throw new Error("malformed format pbkdf2Iter: "+z)}return ee},getPBKDF2KeyHexFromParam:function(B,H){var K=O.enc.Hex.parse(B.pbkdf2Salt),G=B.pbkdf2Iter,ee=O.PBKDF2(H,K,{keySize:6,iterations:G});return O.enc.Hex.stringify(ee)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(B,H){var K=ye(B,"ENCRYPTED PRIVATE KEY"),G=this.parseHexOfEncryptedPKCS8(K),ee=Ze.getPBKDF2KeyHexFromParam(G,H),ie={};ie.ciphertext=O.enc.Hex.parse(G.ciphertext);var ae=O.enc.Hex.parse(ee),ue=O.enc.Hex.parse(G.encryptionSchemeIV),P=O.TripleDES.decrypt(ie,ae,{iv:ue});return O.enc.Hex.stringify(P)},getKeyFromEncryptedPKCS8PEM:function(B,H){var K=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(B,H);return this.getKeyFromPlainPrivatePKCS8Hex(K)},parsePlainPrivatePKCS8Hex:function(B){var H=ne,K=H.getChildIdx,G=H.getV,ee={algparam:null};if(B.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var ie=K(B,0);if(ie.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(B.substr(ie[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var ae=K(B,ie[1]);if(ae.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(B.substr(ae[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(ee.algoid=G(B,ae[0]),B.substr(ae[1],2)=="06"&&(ee.algparam=G(B,ae[1])),B.substr(ie[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return ee.keyidx=H.getVidx(B,ie[2]),ee},getKeyFromPlainPrivatePKCS8PEM:function(B){var H=ye(B,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(H)},getKeyFromPlainPrivatePKCS8Hex:function(B){var H,K=this.parsePlainPrivatePKCS8Hex(B);if(K.algoid=="2a864886f70d010101")H=new Se;else if(K.algoid=="2a8648ce380401")H=new b.crypto.DSA;else{if(K.algoid!="2a8648ce3d0201")throw new Error("unsupported private key algorithm");H=new b.crypto.ECDSA}return H.readPKCS8PrvKeyHex(B),H},_getKeyFromPublicPKCS8Hex:function(B){var H,K=ne.getVbyList(B,0,[0,0],"06");if(K==="2a864886f70d010101")H=new Se;else if(K==="2a8648ce380401")H=new b.crypto.DSA;else{if(K!=="2a8648ce3d0201")throw new Error("unsupported PKCS#8 public key hex");H=new b.crypto.ECDSA}return H.readPKCS8PubKeyHex(B),H},parsePublicRawRSAKeyHex:function(B){var H=ne,K=H.getChildIdx,G=H.getV,ee={};if(B.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var ie=K(B,0);if(ie.length!=2)throw new Error("malformed RSA key(code:002)");if(B.substr(ie[0],2)!="02")throw new Error("malformed RSA key(code:003)");if(ee.n=G(B,ie[0]),B.substr(ie[1],2)!="02")throw new Error("malformed RSA key(code:004)");return ee.e=G(B,ie[1]),ee},parsePublicPKCS8Hex:function(B){var H=ne,K=H.getChildIdx,G=H.getV,ee={algparam:null},ie=K(B,0);if(ie.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+ie.length);var ae=ie[0];if(B.substr(ae,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var ue=K(B,ae);if(ue.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(B.substr(ue[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if(ee.algoid=G(B,ue[0]),B.substr(ue[1],2)=="06"?ee.algparam=G(B,ue[1]):B.substr(ue[1],2)=="30"&&(ee.algparam={},ee.algparam.p=H.getVbyList(B,ue[1],[0],"02"),ee.algparam.q=H.getVbyList(B,ue[1],[1],"02"),ee.algparam.g=H.getVbyList(B,ue[1],[2],"02")),B.substr(ie[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return ee.key=G(B,ie[1]).substr(2),ee}}}();Ze.getKey=function(s,i,a){var d=(ue=ne).getChildIdx,y=(ue.getV,ue.getVbyList),S=b.crypto,k=S.ECDSA,M=S.DSA,U=Se,B=ye,H=Ze;if(U!==void 0&&s instanceof U||k!==void 0&&s instanceof k||M!==void 0&&s instanceof M)return s;if(s.curve!==void 0&&s.xy!==void 0&&s.d===void 0)return new k({pub:s.xy,curve:s.curve});if(s.curve!==void 0&&s.d!==void 0)return new k({prv:s.d,curve:s.curve});if(s.kty===void 0&&s.n!==void 0&&s.e!==void 0&&s.d===void 0)return(Ce=new U).setPublic(s.n,s.e),Ce;if(s.kty===void 0&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0&&s.p!==void 0&&s.q!==void 0&&s.dp!==void 0&&s.dq!==void 0&&s.co!==void 0&&s.qi===void 0)return(Ce=new U).setPrivateEx(s.n,s.e,s.d,s.p,s.q,s.dp,s.dq,s.co),Ce;if(s.kty===void 0&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0&&s.p===void 0)return(Ce=new U).setPrivate(s.n,s.e,s.d),Ce;if(s.p!==void 0&&s.q!==void 0&&s.g!==void 0&&s.y!==void 0&&s.x===void 0)return(Ce=new M).setPublic(s.p,s.q,s.g,s.y),Ce;if(s.p!==void 0&&s.q!==void 0&&s.g!==void 0&&s.y!==void 0&&s.x!==void 0)return(Ce=new M).setPrivate(s.p,s.q,s.g,s.y,s.x),Ce;if(s.kty==="RSA"&&s.n!==void 0&&s.e!==void 0&&s.d===void 0)return(Ce=new U).setPublic(Ye(s.n),Ye(s.e)),Ce;if(s.kty==="RSA"&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0&&s.p!==void 0&&s.q!==void 0&&s.dp!==void 0&&s.dq!==void 0&&s.qi!==void 0)return(Ce=new U).setPrivateEx(Ye(s.n),Ye(s.e),Ye(s.d),Ye(s.p),Ye(s.q),Ye(s.dp),Ye(s.dq),Ye(s.qi)),Ce;if(s.kty==="RSA"&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0)return(Ce=new U).setPrivate(Ye(s.n),Ye(s.e),Ye(s.d)),Ce;if(s.kty==="EC"&&s.crv!==void 0&&s.x!==void 0&&s.y!==void 0&&s.d===void 0){var K=(ve=new k({curve:s.crv})).ecparams.keylen/4,G="04"+("0000000000"+Ye(s.x)).slice(-K)+("0000000000"+Ye(s.y)).slice(-K);return ve.setPublicKeyHex(G),ve}if(s.kty==="EC"&&s.crv!==void 0&&s.x!==void 0&&s.y!==void 0&&s.d!==void 0){K=(ve=new k({curve:s.crv})).ecparams.keylen/4,G="04"+("0000000000"+Ye(s.x)).slice(-K)+("0000000000"+Ye(s.y)).slice(-K);var ee=("0000000000"+Ye(s.d)).slice(-K);return ve.setPublicKeyHex(G),ve.setPrivateKeyHex(ee),ve}if(a==="pkcs5prv"){var ie,ae=s,ue=ne;if((ie=d(ae,0)).length===9)(Ce=new U).readPKCS5PrvKeyHex(ae);else if(ie.length===6)(Ce=new M).readPKCS5PrvKeyHex(ae);else{if(!(ie.length>2&&ae.substr(ie[1],2)==="04"))throw new Error("unsupported PKCS#1/5 hexadecimal key");(Ce=new k).readPKCS5PrvKeyHex(ae)}return Ce}if(a==="pkcs8prv")return Ce=H.getKeyFromPlainPrivatePKCS8Hex(s);if(a==="pkcs8pub")return H._getKeyFromPublicPKCS8Hex(s);if(a==="x509pub")return St.getPublicKeyFromCertHex(s);if(s.indexOf("-END CERTIFICATE-",0)!=-1||s.indexOf("-END X509 CERTIFICATE-",0)!=-1||s.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return St.getPublicKeyFromCertPEM(s);if(s.indexOf("-END PUBLIC KEY-")!=-1){var P=ye(s,"PUBLIC KEY");return H._getKeyFromPublicPKCS8Hex(P)}if(s.indexOf("-END RSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")==-1){var $=B(s,"RSA PRIVATE KEY");return H.getKey($,null,"pkcs5prv")}if(s.indexOf("-END DSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")==-1){var V=y(at=B(s,"DSA PRIVATE KEY"),0,[1],"02"),z=y(at,0,[2],"02"),se=y(at,0,[3],"02"),ce=y(at,0,[4],"02"),Ee=y(at,0,[5],"02");return(Ce=new M).setPrivate(new q(V,16),new q(z,16),new q(se,16),new q(ce,16),new q(Ee,16)),Ce}if(s.indexOf("-END EC PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")==-1)return $=B(s,"EC PRIVATE KEY"),H.getKey($,null,"pkcs5prv");if(s.indexOf("-END PRIVATE KEY-")!=-1)return H.getKeyFromPlainPrivatePKCS8PEM(s);if(s.indexOf("-END RSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")!=-1){var pe=H.getDecryptedKeyHex(s,i),$e=new Se;return $e.readPKCS5PrvKeyHex(pe),$e}if(s.indexOf("-END EC PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")!=-1){var ve,Ce=y(at=H.getDecryptedKeyHex(s,i),0,[1],"04"),ot=y(at,0,[2,0],"06"),ct=y(at,0,[3,0],"03").substr(2);if(b.crypto.OID.oidhex2name[ot]===void 0)throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+ot);return(ve=new k({curve:b.crypto.OID.oidhex2name[ot]})).setPublicKeyHex(ct),ve.setPrivateKeyHex(Ce),ve.isPublic=!1,ve}if(s.indexOf("-END DSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")!=-1){var at;return V=y(at=H.getDecryptedKeyHex(s,i),0,[1],"02"),z=y(at,0,[2],"02"),se=y(at,0,[3],"02"),ce=y(at,0,[4],"02"),Ee=y(at,0,[5],"02"),(Ce=new M).setPrivate(new q(V,16),new q(z,16),new q(se,16),new q(ce,16),new q(Ee,16)),Ce}if(s.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return H.getKeyFromEncryptedPKCS8PEM(s,i);throw new Error("not supported argument")},Ze.generateKeypair=function(s,i){if(s=="RSA"){var a=i;(k=new Se).generate(a,"10001"),k.isPrivate=!0,k.isPublic=!0;var d=new Se,y=k.n.toString(16),S=k.e.toString(16);return d.setPublic(y,S),d.isPrivate=!1,d.isPublic=!0,(M={}).prvKeyObj=k,M.pubKeyObj=d,M}if(s=="EC"){var k,M,U=i,B=new b.crypto.ECDSA({curve:U}).generateKeyPairHex();return(k=new b.crypto.ECDSA({curve:U})).setPublicKeyHex(B.ecpubhex),k.setPrivateKeyHex(B.ecprvhex),k.isPrivate=!0,k.isPublic=!1,(d=new b.crypto.ECDSA({curve:U})).setPublicKeyHex(B.ecpubhex),d.isPrivate=!1,d.isPublic=!0,(M={}).prvKeyObj=k,M.pubKeyObj=d,M}throw new Error("unknown algorithm: "+s)},Ze.getPEM=function(s,i,a,d,y,S){var k=b,M=k.asn1,U=M.DERObjectIdentifier,B=M.DERInteger,H=M.ASN1Util.newObject,K=M.x509.SubjectPublicKeyInfo,G=k.crypto,ee=G.DSA,ie=G.ECDSA,ae=Se;function ue(ve){return H({seq:[{int:0},{int:{bigint:ve.n}},{int:ve.e},{int:{bigint:ve.d}},{int:{bigint:ve.p}},{int:{bigint:ve.q}},{int:{bigint:ve.dmp1}},{int:{bigint:ve.dmq1}},{int:{bigint:ve.coeff}}]})}function P(ve){return H({seq:[{int:1},{octstr:{hex:ve.prvKeyHex}},{tag:["a0",!0,{oid:{name:ve.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+ve.pubKeyHex}}]}]})}function $(ve){return H({seq:[{int:0},{int:{bigint:ve.p}},{int:{bigint:ve.q}},{int:{bigint:ve.g}},{int:{bigint:ve.y}},{int:{bigint:ve.x}}]})}if((ae!==void 0&&s instanceof ae||ee!==void 0&&s instanceof ee||ie!==void 0&&s instanceof ie)&&s.isPublic==1&&(i===void 0||i=="PKCS8PUB"))return ge(ce=new K(s).getEncodedHex(),"PUBLIC KEY");if(i=="PKCS1PRV"&&ae!==void 0&&s instanceof ae&&(a===void 0||a==null)&&s.isPrivate==1)return ge(ce=ue(s).getEncodedHex(),"RSA PRIVATE KEY");if(i=="PKCS1PRV"&&ie!==void 0&&s instanceof ie&&(a===void 0||a==null)&&s.isPrivate==1){var V=new U({name:s.curveName}).getEncodedHex(),z=P(s).getEncodedHex(),se="";return se+=ge(V,"EC PARAMETERS"),se+=ge(z,"EC PRIVATE KEY")}if(i=="PKCS1PRV"&&ee!==void 0&&s instanceof ee&&(a===void 0||a==null)&&s.isPrivate==1)return ge(ce=$(s).getEncodedHex(),"DSA PRIVATE KEY");if(i=="PKCS5PRV"&&ae!==void 0&&s instanceof ae&&a!==void 0&&a!=null&&s.isPrivate==1){var ce=ue(s).getEncodedHex();return d===void 0&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",ce,a,d,S)}if(i=="PKCS5PRV"&&ie!==void 0&&s instanceof ie&&a!==void 0&&a!=null&&s.isPrivate==1)return ce=P(s).getEncodedHex(),d===void 0&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",ce,a,d,S);if(i=="PKCS5PRV"&&ee!==void 0&&s instanceof ee&&a!==void 0&&a!=null&&s.isPrivate==1)return ce=$(s).getEncodedHex(),d===void 0&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",ce,a,d,S);var Ee=function(Ce,ot){var ct=pe(Ce,ot);return new H({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:ct.pbkdf2Salt}},{int:ct.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:ct.encryptionSchemeIV}}]}]}]},{octstr:{hex:ct.ciphertext}}]}).getEncodedHex()},pe=function(Ce,ot){var ct=O.lib.WordArray.random(8),at=O.lib.WordArray.random(8),$t=O.PBKDF2(ot,ct,{keySize:6,iterations:100}),Ut=O.enc.Hex.parse(Ce),Ot=O.TripleDES.encrypt(Ut,$t,{iv:at})+"",mt={};return mt.ciphertext=Ot,mt.pbkdf2Salt=O.enc.Hex.stringify(ct),mt.pbkdf2Iter=100,mt.encryptionSchemeAlg="DES-EDE3-CBC",mt.encryptionSchemeIV=O.enc.Hex.stringify(at),mt};if(i=="PKCS8PRV"&&ae!=null&&s instanceof ae&&s.isPrivate==1){var $e=ue(s).getEncodedHex();return ce=H({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:$e}}]}).getEncodedHex(),a===void 0||a==null?ge(ce,"PRIVATE KEY"):ge(z=Ee(ce,a),"ENCRYPTED PRIVATE KEY")}if(i=="PKCS8PRV"&&ie!==void 0&&s instanceof ie&&s.isPrivate==1)return $e=new H({seq:[{int:1},{octstr:{hex:s.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+s.pubKeyHex}}]}]}).getEncodedHex(),ce=H({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:s.curveName}}]},{octstr:{hex:$e}}]}).getEncodedHex(),a===void 0||a==null?ge(ce,"PRIVATE KEY"):ge(z=Ee(ce,a),"ENCRYPTED PRIVATE KEY");if(i=="PKCS8PRV"&&ee!==void 0&&s instanceof ee&&s.isPrivate==1)return $e=new B({bigint:s.x}).getEncodedHex(),ce=H({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:s.p}},{int:{bigint:s.q}},{int:{bigint:s.g}}]}]},{octstr:{hex:$e}}]}).getEncodedHex(),a===void 0||a==null?ge(ce,"PRIVATE KEY"):ge(z=Ee(ce,a),"ENCRYPTED PRIVATE KEY");throw new Error("unsupported object nor format")},Ze.getKeyFromCSRPEM=function(s){var i=ye(s,"CERTIFICATE REQUEST");return Ze.getKeyFromCSRHex(i)},Ze.getKeyFromCSRHex=function(s){var i=Ze.parseCSRHex(s);return Ze.getKey(i.p8pubkeyhex,null,"pkcs8pub")},Ze.parseCSRHex=function(s){var i=ne,a=i.getChildIdx,d=i.getTLV,y={},S=s;if(S.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var k=a(S,0);if(k.length<1)throw new Error("malformed CSR(code:002)");if(S.substr(k[0],2)!="30")throw new Error("malformed CSR(code:003)");var M=a(S,k[0]);if(M.length<3)throw new Error("malformed CSR(code:004)");return y.p8pubkeyhex=d(S,M[2]),y},Ze.getKeyID=function(s){var i=Ze,a=ne;typeof s=="string"&&s.indexOf("BEGIN ")!=-1&&(s=i.getKey(s));var d=ye(i.getPEM(s)),y=a.getIdxbyList(d,0,[1]),S=a.getV(d,y).substring(2);return b.crypto.Util.hashHex(S,"sha1")},Ze.getJWKFromKey=function(s){var i={};if(s instanceof Se&&s.isPrivate)return i.kty="RSA",i.n=gt(s.n.toString(16)),i.e=gt(s.e.toString(16)),i.d=gt(s.d.toString(16)),i.p=gt(s.p.toString(16)),i.q=gt(s.q.toString(16)),i.dp=gt(s.dmp1.toString(16)),i.dq=gt(s.dmq1.toString(16)),i.qi=gt(s.coeff.toString(16)),i;if(s instanceof Se&&s.isPublic)return i.kty="RSA",i.n=gt(s.n.toString(16)),i.e=gt(s.e.toString(16)),i;if(s instanceof b.crypto.ECDSA&&s.isPrivate){if((d=s.getShortNISTPCurveName())!=="P-256"&&d!=="P-384")throw new Error("unsupported curve name for JWT: "+d);var a=s.getPublicKeyXYHex();return i.kty="EC",i.crv=d,i.x=gt(a.x),i.y=gt(a.y),i.d=gt(s.prvKeyHex),i}if(s instanceof b.crypto.ECDSA&&s.isPublic){var d;if((d=s.getShortNISTPCurveName())!=="P-256"&&d!=="P-384")throw new Error("unsupported curve name for JWT: "+d);return a=s.getPublicKeyXYHex(),i.kty="EC",i.crv=d,i.x=gt(a.x),i.y=gt(a.y),i}throw new Error("not supported key object")},Se.getPosArrayOfChildrenFromHex=function(s){return ne.getChildIdx(s,0)},Se.getHexValueArrayOfChildrenFromHex=function(s){var i,a=ne.getV,d=a(s,(i=Se.getPosArrayOfChildrenFromHex(s))[0]),y=a(s,i[1]),S=a(s,i[2]),k=a(s,i[3]),M=a(s,i[4]),U=a(s,i[5]),B=a(s,i[6]),H=a(s,i[7]),K=a(s,i[8]);return(i=new Array).push(d,y,S,k,M,U,B,H,K),i},Se.prototype.readPrivateKeyFromPEMString=function(s){var i=ye(s),a=Se.getHexValueArrayOfChildrenFromHex(i);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},Se.prototype.readPKCS5PrvKeyHex=function(s){var i=Se.getHexValueArrayOfChildrenFromHex(s);this.setPrivateEx(i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},Se.prototype.readPKCS8PrvKeyHex=function(s){var i,a,d,y,S,k,M,U,B=ne,H=B.getVbyListEx;if(B.isASN1HEX(s)===!1)throw new Error("not ASN.1 hex string");try{i=H(s,0,[2,0,1],"02"),a=H(s,0,[2,0,2],"02"),d=H(s,0,[2,0,3],"02"),y=H(s,0,[2,0,4],"02"),S=H(s,0,[2,0,5],"02"),k=H(s,0,[2,0,6],"02"),M=H(s,0,[2,0,7],"02"),U=H(s,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(i,a,d,y,S,k,M,U)},Se.prototype.readPKCS5PubKeyHex=function(s){var i=ne,a=i.getV;if(i.isASN1HEX(s)===!1)throw new Error("keyHex is not ASN.1 hex string");var d=i.getChildIdx(s,0);if(d.length!==2||s.substr(d[0],2)!=="02"||s.substr(d[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var y=a(s,d[0]),S=a(s,d[1]);this.setPublic(y,S)},Se.prototype.readPKCS8PubKeyHex=function(s){var i=ne;if(i.isASN1HEX(s)===!1)throw new Error("not ASN.1 hex string");if(i.getTLVbyListEx(s,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var a=i.getTLVbyListEx(s,0,[1,0]);this.readPKCS5PubKeyHex(a)},Se.prototype.readCertPubKeyHex=function(s,i){var a,d;(a=new St).readCertHex(s),d=a.getPublicKeyHex(),this.readPKCS8PubKeyHex(d)};function Gt(s,i){for(var a="",d=i/4-s.length,y=0;y<d;y++)a+="0";return a+s}function No(s,i,a){for(var d="",y=0;d.length<i;)d+=Mt(a(Ht(s+String.fromCharCode.apply(String,[(4278190080&y)>>24,(16711680&y)>>16,(65280&y)>>8,255&y])))),y+=1;return d}function Lo(s){for(var i in b.crypto.Util.DIGESTINFOHEAD){var a=b.crypto.Util.DIGESTINFOHEAD[i],d=a.length;if(s.substring(0,d)==a)return[i,s.substring(d)]}return[]}function St(s){var i,a=ne,d=a.getChildIdx,y=a.getV,S=a.getTLV,k=a.getVbyList,M=a.getVbyListEx,U=a.getTLVbyList,B=a.getTLVbyListEx,H=a.getIdxbyList,K=a.getIdxbyListEx,G=a.getVidx,ee=a.getInt,ie=a.oidname,ae=a.hextooidstr,ue=ye;try{i=b.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var P=U(this.hex,0,[0,0]);if(P.substr(0,2)=="a0"){var $=U(P,0,[0]),V=ee($,0);if(V<0||2<V)throw new Error("malformed version field");return this.version=V+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return M(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var P=B(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(P)},this.getAlgorithmIdentifierName=function(P){for(var $ in i)if(P===i[$])return $;return ie(M(P,0,[0],"06"))},this.getIssuer=function(){return this.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return U(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(){return this.getX500Name(this.getSubjectHex())},this.getSubjectHex=function(){return U(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var P=k(this.hex,0,[0,4+this.foffset,0]);return P=P.replace(/(..)/g,"%$1"),P=decodeURIComponent(P)},this.getNotAfter=function(){var P=k(this.hex,0,[0,4+this.foffset,1]);return P=P.replace(/(..)/g,"%$1"),P=decodeURIComponent(P)},this.getPublicKeyHex=function(){return a.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return H(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var P=this.getPublicKeyIdx();return H(this.hex,P,[1,0],"30")},this.getPublicKey=function(){return Ze.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var P=U(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(P)},this.getSignatureValueHex=function(){return k(this.hex,0,[2],"03",!0)},this.verifySignature=function(P){var $=this.getSignatureAlgorithmField(),V=this.getSignatureValueHex(),z=U(this.hex,0,[0],"30"),se=new b.crypto.Signature({alg:$});return se.init(P),se.updateHex(z),se.verify(V)},this.parseExt=function(P){var $,V,z;if(P===void 0){if(z=this.hex,this.version!==3)return-1;$=H(z,0,[0,7,0],"30"),V=d(z,$)}else{z=ye(P);var se=H(z,0,[0,3,0,0],"06");if(y(z,se)!="2a864886f70d01090e")return void(this.aExtInfo=new Array);$=H(z,0,[0,3,0,1,0],"30"),V=d(z,$),this.hex=z}this.aExtInfo=new Array;for(var ce=0;ce<V.length;ce++){var Ee={critical:!1},pe=0;d(z,V[ce]).length===3&&(Ee.critical=!0,pe=1),Ee.oid=a.hextooidstr(k(z,V[ce],[0],"06"));var $e=H(z,V[ce],[1+pe]);Ee.vidx=G(z,$e),this.aExtInfo.push(Ee)}},this.getExtInfo=function(P){var $=this.aExtInfo,V=P;if(P.match(/^[0-9.]+$/)||(V=b.asn1.x509.OID.name2oid(P)),V!==""){for(var z=0;z<$.length;z++)if($[z].oid===V)return $[z]}},this.getExtBasicConstraints=function(P,$){if(P===void 0&&$===void 0){var V=this.getExtInfo("basicConstraints");if(V===void 0)return;P=S(this.hex,V.vidx),$=V.critical}var z={extname:"basicConstraints"};if($&&(z.critical=!0),P==="3000")return z;if(P==="30030101ff")return z.cA=!0,z;if(P.substr(0,12)==="30060101ff02"){var se=y(P,10),ce=parseInt(se,16);return z.cA=!0,z.pathLen=ce,z}throw new Error("hExtV parse error: "+P)},this.getExtKeyUsage=function(P,$){if(P===void 0&&$===void 0){var V=this.getExtInfo("keyUsage");if(V===void 0)return;P=S(this.hex,V.vidx),$=V.critical}var z={extname:"keyUsage"};return $&&(z.critical=!0),z.names=this.getExtKeyUsageString(P).split(","),z},this.getExtKeyUsageBin=function(P){if(P===void 0){var $=this.getExtInfo("keyUsage");if($===void 0)return"";P=S(this.hex,$.vidx)}if(P.length!=8&&P.length!=10)throw new Error("malformed key usage value: "+P);var V="000000000000000"+parseInt(P.substr(6),16).toString(2);return P.length==8&&(V=V.slice(-8)),P.length==10&&(V=V.slice(-16)),(V=V.replace(/0+$/,""))==""&&(V="0"),V},this.getExtKeyUsageString=function(P){for(var $=this.getExtKeyUsageBin(P),V=new Array,z=0;z<$.length;z++)$.substr(z,1)=="1"&&V.push(St.KEYUSAGE_NAME[z]);return V.join(",")},this.getExtSubjectKeyIdentifier=function(P,$){if(P===void 0&&$===void 0){var V=this.getExtInfo("subjectKeyIdentifier");if(V===void 0)return;P=S(this.hex,V.vidx),$=V.critical}var z={extname:"subjectKeyIdentifier"};$&&(z.critical=!0);var se=y(P,0);return z.kid={hex:se},z},this.getExtAuthorityKeyIdentifier=function(P,$){if(P===void 0&&$===void 0){var V=this.getExtInfo("authorityKeyIdentifier");if(V===void 0)return;P=S(this.hex,V.vidx),$=V.critical}var z={extname:"authorityKeyIdentifier"};$&&(z.critical=!0);for(var se=d(P,0),ce=0;ce<se.length;ce++){var Ee=P.substr(se[ce],2);if(Ee==="80"&&(z.kid={hex:y(P,se[ce])}),Ee==="a1"){var pe=S(P,se[ce]),$e=this.getGeneralNames(pe);z.issuer=$e[0].dn}Ee==="82"&&(z.sn={hex:y(P,se[ce])})}return z},this.getExtExtKeyUsage=function(P,$){if(P===void 0&&$===void 0){var V=this.getExtInfo("extKeyUsage");if(V===void 0)return;P=S(this.hex,V.vidx),$=V.critical}var z={extname:"extKeyUsage",array:[]};$&&(z.critical=!0);for(var se=d(P,0),ce=0;ce<se.length;ce++)z.array.push(ie(y(P,se[ce])));return z},this.getExtExtKeyUsageName=function(){var P=this.getExtInfo("extKeyUsage");if(P===void 0)return P;var $=new Array,V=S(this.hex,P.vidx);if(V==="")return $;for(var z=d(V,0),se=0;se<z.length;se++)$.push(ie(y(V,z[se])));return $},this.getExtSubjectAltName=function(P,$){if(P===void 0&&$===void 0){var V=this.getExtInfo("subjectAltName");if(V===void 0)return;P=S(this.hex,V.vidx),$=V.critical}var z={extname:"subjectAltName",array:[]};return $&&(z.critical=!0),z.array=this.getGeneralNames(P),z},this.getExtIssuerAltName=function(P,$){if(P===void 0&&$===void 0){var V=this.getExtInfo("issuerAltName");if(V===void 0)return;P=S(this.hex,V.vidx),$=V.critical}var z={extname:"issuerAltName",array:[]};return $&&(z.critical=!0),z.array=this.getGeneralNames(P),z},this.getGeneralNames=function(P){for(var $=d(P,0),V=[],z=0;z<$.length;z++){var se=this.getGeneralName(S(P,$[z]));se!==void 0&&V.push(se)}return V},this.getGeneralName=function(P){var $=P.substr(0,2),V=y(P,0),z=Mt(V);return $=="81"?{rfc822:z}:$=="82"?{dns:z}:$=="86"?{uri:z}:$=="87"?{ip:Tn(V)}:$=="a4"?{dn:this.getX500Name(V)}:void 0},this.getExtSubjectAltName2=function(){var P,$,V,z=this.getExtInfo("subjectAltName");if(z===void 0)return z;for(var se=new Array,ce=S(this.hex,z.vidx),Ee=d(ce,0),pe=0;pe<Ee.length;pe++)V=ce.substr(Ee[pe],2),P=y(ce,Ee[pe]),V==="81"&&($=yt(P),se.push(["MAIL",$])),V==="82"&&($=yt(P),se.push(["DNS",$])),V==="84"&&($=St.hex2dn(P,0),se.push(["DN",$])),V==="86"&&($=yt(P),se.push(["URI",$])),V==="87"&&($=Tn(P),se.push(["IP",$]));return se},this.getExtCRLDistributionPoints=function(P,$){if(P===void 0&&$===void 0){var V=this.getExtInfo("cRLDistributionPoints");if(V===void 0)return;P=S(this.hex,V.vidx),$=V.critical}var z={extname:"cRLDistributionPoints",array:[]};$&&(z.critical=!0);for(var se=d(P,0),ce=0;ce<se.length;ce++){var Ee=S(P,se[ce]);z.array.push(this.getDistributionPoint(Ee))}return z},this.getDistributionPoint=function(P){for(var $={},V=d(P,0),z=0;z<V.length;z++){var se=P.substr(V[z],2),ce=S(P,V[z]);se=="a0"&&($.dpname=this.getDistributionPointName(ce))}return $},this.getDistributionPointName=function(P){for(var $={},V=d(P,0),z=0;z<V.length;z++){var se=P.substr(V[z],2),ce=S(P,V[z]);se=="a0"&&($.full=this.getGeneralNames(ce))}return $},this.getExtCRLDistributionPointsURI=function(){var P=this.getExtInfo("cRLDistributionPoints");if(P===void 0)return P;for(var $=new Array,V=d(this.hex,P.vidx),z=0;z<V.length;z++)try{var se=yt(k(this.hex,V[z],[0,0,0],"86"));$.push(se)}catch{}return $},this.getExtAIAInfo=function(){var P=this.getExtInfo("authorityInfoAccess");if(P===void 0)return P;for(var $={ocsp:[],caissuer:[]},V=d(this.hex,P.vidx),z=0;z<V.length;z++){var se=k(this.hex,V[z],[0],"06"),ce=k(this.hex,V[z],[1],"86");se==="2b06010505073001"&&$.ocsp.push(yt(ce)),se==="2b06010505073002"&&$.caissuer.push(yt(ce))}return $},this.getExtAuthorityInfoAccess=function(P,$){if(P===void 0&&$===void 0){var V=this.getExtInfo("authorityInfoAccess");if(V===void 0)return;P=S(this.hex,V.vidx),$=V.critical}var z={extname:"authorityInfoAccess",array:[]};$&&(z.critical=!0);for(var se=d(P,0),ce=0;ce<se.length;ce++){var Ee=M(P,se[ce],[0],"06"),pe=yt(k(P,se[ce],[1],"86"));if(Ee=="2b06010505073001")z.array.push({ocsp:pe});else{if(Ee!="2b06010505073002")throw new Error("unknown method: "+Ee);z.array.push({caissuer:pe})}}return z},this.getExtCertificatePolicies=function(P,$){if(P===void 0&&$===void 0){var V=this.getExtInfo("certificatePolicies");if(V===void 0)return;P=S(this.hex,V.vidx),$=V.critical}var z={extname:"certificatePolicies",array:[]};$&&(z.critical=!0);for(var se=d(P,0),ce=0;ce<se.length;ce++){var Ee=S(P,se[ce]),pe=this.getPolicyInformation(Ee);z.array.push(pe)}return z},this.getPolicyInformation=function(P){var $={},V=k(P,0,[0],"06");$.policyoid=ie(V);var z=K(P,0,[1],"30");if(z!=-1){$.array=[];for(var se=d(P,z),ce=0;ce<se.length;ce++){var Ee=S(P,se[ce]),pe=this.getPolicyQualifierInfo(Ee);$.array.push(pe)}}return $},this.getPolicyQualifierInfo=function(P){var $={},V=k(P,0,[0],"06");if(V==="2b06010505070201"){var z=M(P,0,[1],"16");$.cps=Mt(z)}else if(V==="2b06010505070202"){var se=U(P,0,[1],"30");$.unotice=this.getUserNotice(se)}return $},this.getUserNotice=function(P){for(var $={},V=d(P,0),z=0;z<V.length;z++){var se=S(P,V[z]);se.substr(0,2)!="30"&&($.exptext=this.getDisplayText(se))}return $},this.getDisplayText=function(P){var $={};return $.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[P.substr(0,2)],$.str=Mt(y(P,0)),$},this.getExtCRLNumber=function(P,$){var V={extname:"cRLNumber"};if($&&(V.critical=!0),P.substr(0,2)=="02")return V.num={hex:y(P,0)},V;throw new Error("hExtV parse error: "+P)},this.getExtCRLReason=function(P,$){var V={extname:"cRLReason"};if($&&(V.critical=!0),P.substr(0,2)=="0a")return V.code=parseInt(y(P,0),16),V;throw new Error("hExtV parse error: "+P)},this.getExtOcspNonce=function(P,$){var V={extname:"ocspNonce"};$&&(V.critical=!0);var z=y(P,0);return V.hex=z,V},this.getExtOcspNoCheck=function(P,$){var V={extname:"ocspNoCheck"};return $&&(V.critical=!0),V},this.getExtAdobeTimeStamp=function(P,$){if(P===void 0&&$===void 0){var V=this.getExtInfo("adobeTimeStamp");if(V===void 0)return;P=S(this.hex,V.vidx),$=V.critical}var z={extname:"adobeTimeStamp"};$&&(z.critical=!0);var se=d(P,0);if(se.length>1){var ce=S(P,se[1]),Ee=this.getGeneralName(ce);Ee.uri!=null&&(z.uri=Ee.uri)}if(se.length>2){var pe=S(P,se[2]);pe=="0101ff"&&(z.reqauth=!0),pe=="010100"&&(z.reqauth=!1)}return z},this.getX500NameRule=function(P){for(var $=null,V=[],z=0;z<P.length;z++)for(var se=P[z],ce=0;ce<se.length;ce++)V.push(se[ce]);for(z=0;z<V.length;z++){var Ee=V[z],pe=Ee.ds,$e=Ee.value,ve=Ee.type;if(pe!="prn"&&pe!="utf8"&&pe!="ia5")return"mixed";if(pe=="ia5"){if(ve!="CN")return"mixed";if(b.lang.String.isMail($e))continue;return"mixed"}if(ve=="C"){if(pe=="prn")continue;return"mixed"}if($==null)$=pe;else if($!==pe)return"mixed"}return $??"prn"},this.getX500Name=function(P){var $=this.getX500NameArray(P);return{array:$,str:this.dnarraytostr($)}},this.getX500NameArray=function(P){for(var $=[],V=d(P,0),z=0;z<V.length;z++)$.push(this.getRDN(S(P,V[z])));return $},this.getRDN=function(P){for(var $=[],V=d(P,0),z=0;z<V.length;z++)$.push(this.getAttrTypeAndValue(S(P,V[z])));return $},this.getAttrTypeAndValue=function(P){var $={type:null,value:null,ds:null},V=d(P,0),z=k(P,V[0],[],"06"),se=k(P,V[1],[]),ce=b.asn1.ASN1Util.oidHexToInt(z);return $.type=b.asn1.x509.OID.oid2atype(ce),$.ds=this.HEX2STAG[P.substr(V[1],2)],$.ds!="bmp"?$.value=yt(se):$.value=Rn(se),$},this.readCertPEM=function(P){this.readCertHex(ue(P))},this.readCertHex=function(P){this.hex=P,this.getVersion();try{H(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(){var P={};return P.version=this.getVersion(),P.serial={hex:this.getSerialNumberHex()},P.sigalg=this.getSignatureAlgorithmField(),P.issuer=this.getIssuer(),P.notbefore=this.getNotBefore(),P.notafter=this.getNotAfter(),P.subject=this.getSubject(),P.sbjpubkey=ge(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo.length>0&&(P.ext=this.getExtParamArray()),P.sighex=this.getSignatureValueHex(),P},this.getExtParamArray=function(P){P==null&&K(this.hex,0,[0,"[3]"])!=-1&&(P=B(this.hex,0,[0,"[3]",0],"30"));for(var $=[],V=d(P,0),z=0;z<V.length;z++){var se=S(P,V[z]),ce=this.getExtParam(se);ce!=null&&$.push(ce)}return $},this.getExtParam=function(P){var $=d(P,0).length;if($!=2&&$!=3)throw new Error("wrong number elements in Extension: "+$+" "+P);var V=ae(k(P,0,[0],"06")),z=!1;$==3&&U(P,0,[1])=="0101ff"&&(z=!0);var se=U(P,0,[$-1,0]),ce=void 0;if(V=="2.5.29.14"?ce=this.getExtSubjectKeyIdentifier(se,z):V=="2.5.29.15"?ce=this.getExtKeyUsage(se,z):V=="2.5.29.17"?ce=this.getExtSubjectAltName(se,z):V=="2.5.29.18"?ce=this.getExtIssuerAltName(se,z):V=="2.5.29.19"?ce=this.getExtBasicConstraints(se,z):V=="2.5.29.31"?ce=this.getExtCRLDistributionPoints(se,z):V=="2.5.29.32"?ce=this.getExtCertificatePolicies(se,z):V=="2.5.29.35"?ce=this.getExtAuthorityKeyIdentifier(se,z):V=="2.5.29.37"?ce=this.getExtExtKeyUsage(se,z):V=="1.3.6.1.5.5.7.1.1"?ce=this.getExtAuthorityInfoAccess(se,z):V=="2.5.29.20"?ce=this.getExtCRLNumber(se,z):V=="2.5.29.21"?ce=this.getExtCRLReason(se,z):V=="1.3.6.1.5.5.7.48.1.2"?ce=this.getExtOcspNonce(se,z):V=="1.3.6.1.5.5.7.48.1.5"?ce=this.getExtOcspNoCheck(se,z):V=="1.2.840.113583.1.1.9.1"&&(ce=this.getExtAdobeTimeStamp(se,z)),ce!=null)return ce;var Ee={extname:V,extn:se};return z&&(Ee.critical=!0),Ee},this.findExt=function(P,$){for(var V=0;V<P.length;V++)if(P[V].extname==$)return P[V];return null},this.updateExtCDPFullURI=function(P,$){var V=this.findExt(P,"cRLDistributionPoints");if(V!=null&&V.array!=null){for(var z=V.array,se=0;se<z.length;se++)if(z[se].dpname!=null&&z[se].dpname.full!=null)for(var ce=z[se].dpname.full,Ee=0;Ee<ce.length;Ee++){var pe=ce[se];pe.uri!=null&&(pe.uri=$)}}},this.updateExtAIAOCSP=function(P,$){var V=this.findExt(P,"authorityInfoAccess");if(V!=null&&V.array!=null)for(var z=V.array,se=0;se<z.length;se++)z[se].ocsp!=null&&(z[se].ocsp=$)},this.updateExtAIACAIssuer=function(P,$){var V=this.findExt(P,"authorityInfoAccess");if(V!=null&&V.array!=null)for(var z=V.array,se=0;se<z.length;se++)z[se].caissuer!=null&&(z[se].caissuer=$)},this.dnarraytostr=function(P){return"/"+P.map(function($){return function(z){return z.map(function(se){return function(Ee){return Ee.type+"="+Ee.value}(se).replace(/\+/,"\\+")}).join("+")}($).replace(/\//,"\\/")}).join("/")},this.getInfo=function(){var P,$,V,z=function($t){return JSON.stringify($t.array).replace(/[\[\]\{\}\"]/g,"")},se=function($t){for(var Ut="",Ot=$t.array,mt=0;mt<Ot.length;mt++){var Et=Ot[mt];if(Ut+="    policy oid: "+Et.policyoid+`
`,Et.array!==void 0)for(var Rt=0;Rt<Et.array.length;Rt++){var Bt=Et.array[Rt];Bt.cps!==void 0&&(Ut+="    cps: "+Bt.cps+`
`)}}return Ut},ce=function($t){for(var Ut="",Ot=$t.array,mt=0;mt<Ot.length;mt++){var Et=Ot[mt];try{Et.dpname.full[0].uri!==void 0&&(Ut+="    "+Et.dpname.full[0].uri+`
`)}catch{}try{Et.dname.full[0].dn.hex!==void 0&&(Ut+="    "+St.hex2dn(Et.dpname.full[0].dn.hex)+`
`)}catch{}}return Ut},Ee=function($t){for(var Ut="",Ot=$t.array,mt=0;mt<Ot.length;mt++){var Et=Ot[mt];Et.caissuer!==void 0&&(Ut+="    caissuer: "+Et.caissuer+`
`),Et.ocsp!==void 0&&(Ut+="    ocsp: "+Et.ocsp+`
`)}return Ut};if(P=`Basic Fields
`,P+="  serial number: "+this.getSerialNumberHex()+`
`,P+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,P+="  issuer: "+this.getIssuerString()+`
`,P+="  notBefore: "+this.getNotBefore()+`
`,P+="  notAfter: "+this.getNotAfter()+`
`,P+="  subject: "+this.getSubjectString()+`
`,P+=`  subject public key info: 
`,P+="    key algorithm: "+($=this.getPublicKey()).type+`
`,$.type==="RSA"&&(P+="    n="+Ur($.n.toString(16)).substr(0,16)+`...
`,P+="    e="+Ur($.e.toString(16))+`
`),(V=this.aExtInfo)!=null){P+=`X509v3 Extensions:
`;for(var pe=0;pe<V.length;pe++){var $e=V[pe],ve=b.asn1.x509.OID.oid2name($e.oid);ve===""&&(ve=$e.oid);var Ce="";if($e.critical===!0&&(Ce="CRITICAL"),P+="  "+ve+" "+Ce+`:
`,ve==="basicConstraints"){var ot=this.getExtBasicConstraints();ot.cA===void 0?P+=`    {}
`:(P+="    cA=true",ot.pathLen!==void 0&&(P+=", pathLen="+ot.pathLen),P+=`
`)}else if(ve==="keyUsage")P+="    "+this.getExtKeyUsageString()+`
`;else if(ve==="subjectKeyIdentifier")P+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(ve==="authorityKeyIdentifier"){var ct=this.getExtAuthorityKeyIdentifier();ct.kid!==void 0&&(P+="    kid="+ct.kid.hex+`
`)}else ve==="extKeyUsage"?P+="    "+this.getExtExtKeyUsage().array.join(", ")+`
`:ve==="subjectAltName"?P+="    "+z(this.getExtSubjectAltName())+`
`:ve==="cRLDistributionPoints"?P+=ce(this.getExtCRLDistributionPoints()):ve==="authorityInfoAccess"?P+=Ee(this.getExtAuthorityInfoAccess()):ve==="certificatePolicies"&&(P+=se(this.getExtCertificatePolicies()))}}return P+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,P+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`},typeof s=="string"&&(s.indexOf("-----BEGIN")!=-1?this.readCertPEM(s):b.lang.String.isHex(s)&&this.readCertHex(s))}Se.prototype.sign=function(s,i){var a=function(y){return b.crypto.Util.hashString(y,i)}(s);return this.signWithMessageHash(a,i)},Se.prototype.signWithMessageHash=function(s,i){var a=tt(b.crypto.Util.getPaddedDigestInfoHex(s,i,this.n.bitLength()),16);return Gt(this.doPrivate(a).toString(16),this.n.bitLength())},Se.prototype.signPSS=function(s,i,a){var d=function(S){return b.crypto.Util.hashHex(S,i)}(Ht(s));return a===void 0&&(a=-1),this.signWithMessageHashPSS(d,i,a)},Se.prototype.signWithMessageHashPSS=function(s,i,a){var d,y=Mt(s),S=y.length,k=this.n.bitLength()-1,M=Math.ceil(k/8),U=function(P){return b.crypto.Util.hashHex(P,i)};if(a===-1||a===void 0)a=S;else if(a===-2)a=M-S-2;else if(a<-2)throw new Error("invalid salt length");if(M<S+a+2)throw new Error("data too long");var B="";a>0&&(B=new Array(a),new _e().nextBytes(B),B=String.fromCharCode.apply(String,B));var H=Mt(U(Ht("\0\0\0\0\0\0\0\0"+y+B))),K=[];for(d=0;d<M-a-S-2;d+=1)K[d]=0;var G=String.fromCharCode.apply(String,K)+""+B,ee=No(H,G.length,U),ie=[];for(d=0;d<G.length;d+=1)ie[d]=G.charCodeAt(d)^ee.charCodeAt(d);var ae=65280>>8*M-k&255;for(ie[0]&=~ae,d=0;d<S;d++)ie.push(H.charCodeAt(d));return ie.push(188),Gt(this.doPrivate(new q(ie)).toString(16),this.n.bitLength())},Se.prototype.verify=function(s,i){if((i=i.toLowerCase()).match(/^[0-9a-f]+$/)==null)return!1;var a=tt(i,16),d=this.n.bitLength();if(a.bitLength()>d)return!1;var y=this.doPublic(a).toString(16);if(y.length+3!=d/4)return!1;var S=Lo(y.replace(/^1f+00/,""));if(S.length==0)return!1;var k=S[0];return S[1]==function(U){return b.crypto.Util.hashString(U,k)}(s)},Se.prototype.verifyWithMessageHash=function(s,i){if(i.length!=Math.ceil(this.n.bitLength()/4))return!1;var a=tt(i,16);if(a.bitLength()>this.n.bitLength())return 0;var d=Lo(this.doPublic(a).toString(16).replace(/^1f+00/,""));return d.length==0?!1:(d[0],d[1]==s)},Se.prototype.verifyPSS=function(s,i,a,d){var y=function(k){return b.crypto.Util.hashHex(k,a)}(Ht(s));return d===void 0&&(d=-1),this.verifyWithMessageHashPSS(y,i,a,d)},Se.prototype.verifyWithMessageHashPSS=function(s,i,a,d){if(i.length!=Math.ceil(this.n.bitLength()/4))return!1;var y,S=new q(i,16),k=function(V){return b.crypto.Util.hashHex(V,a)},M=Mt(s),U=M.length,B=this.n.bitLength()-1,H=Math.ceil(B/8);if(d===-1||d===void 0)d=U;else if(d===-2)d=H-U-2;else if(d<-2)throw new Error("invalid salt length");if(H<U+d+2)throw new Error("data too long");var K=this.doPublic(S).toByteArray();for(y=0;y<K.length;y+=1)K[y]&=255;for(;K.length<H;)K.unshift(0);if(K[H-1]!==188)throw new Error("encoded message does not end in 0xbc");var G=(K=String.fromCharCode.apply(String,K)).substr(0,H-U-1),ee=K.substr(G.length,U),ie=65280>>8*H-B&255;if(G.charCodeAt(0)&ie)throw new Error("bits beyond keysize not zero");var ae=No(ee,G.length,k),ue=[];for(y=0;y<G.length;y+=1)ue[y]=G.charCodeAt(y)^ae.charCodeAt(y);ue[0]&=~ie;var P=H-U-d-2;for(y=0;y<P;y+=1)if(ue[y]!==0)throw new Error("leftmost octets not zero");if(ue[P]!==1)throw new Error("0x01 marker not found");return ee===Mt(k(Ht("\0\0\0\0\0\0\0\0"+M+String.fromCharCode.apply(String,ue.slice(-d)))))},Se.SALT_LEN_HLEN=-1,Se.SALT_LEN_MAX=-2,Se.SALT_LEN_RECOVER=-2,St.hex2dn=function(s,i){i===void 0&&(i=0);var a=new St;return ne.getTLV(s,i),a.getX500Name(s).str},St.hex2rdn=function(s,i){if(i===void 0&&(i=0),s.substr(i,2)!=="31")throw new Error("malformed RDN");for(var a=new Array,d=ne.getChildIdx(s,i),y=0;y<d.length;y++)a.push(St.hex2attrTypeValue(s,d[y]));return(a=a.map(function(S){return S.replace("+","\\+")})).join("+")},St.hex2attrTypeValue=function(s,i){var a=ne,d=a.getV;if(i===void 0&&(i=0),s.substr(i,2)!=="30")throw new Error("malformed attribute type and value");var y=a.getChildIdx(s,i);y.length!==2||s.substr(y[0],2);var S=d(s,y[0]),k=b.asn1.ASN1Util.oidHexToInt(S);return b.asn1.x509.OID.oid2atype(k)+"="+Mt(d(s,y[1]))},St.getPublicKeyFromCertHex=function(s){var i=new St;return i.readCertHex(s),i.getPublicKey()},St.getPublicKeyFromCertPEM=function(s){var i=new St;return i.readCertPEM(s),i.getPublicKey()},St.getPublicKeyInfoPropOfCertPEM=function(s){var i,a,d=ne.getVbyList,y={};return y.algparam=null,(i=new St).readCertPEM(s),a=i.getPublicKeyHex(),y.keyhex=d(a,0,[1],"03").substr(2),y.algoid=d(a,0,[0,0],"06"),y.algoid==="2a8648ce3d0201"&&(y.algparam=d(a,0,[0,1],"06")),y},St.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],b!==void 0&&b||(n.KJUR=b={}),b.jws!==void 0&&b.jws||(b.jws={}),b.jws.JWS=function(){var s=b.jws.JWS.isSafeJSONString;this.parseJWS=function(i,a){if(this.parsedJWS===void 0||!a&&this.parsedJWS.sigvalH===void 0){var d=i.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(d==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var y=d[1],S=d[2],k=d[3],M=y+"."+S;if(this.parsedJWS={},this.parsedJWS.headB64U=y,this.parsedJWS.payloadB64U=S,this.parsedJWS.sigvalB64U=k,this.parsedJWS.si=M,!a){var U=Ye(k),B=tt(U,16);this.parsedJWS.sigvalH=U,this.parsedJWS.sigvalBI=B}var H=oe(y),K=oe(S);if(this.parsedJWS.headS=H,this.parsedJWS.payloadS=K,!s(H,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+H}}},b.jws.JWS.sign=function(s,i,a,d,y){var S,k,M,U=b,B=U.jws.JWS,H=B.readSafeJSONString,K=B.isSafeJSONString,G=U.crypto,ee=(G.ECDSA,G.Mac),ie=G.Signature,ae=JSON;if(typeof i!="string"&&(i===void 0?"undefined":C(i))!="object")throw"spHeader must be JSON string or object: "+i;if((i===void 0?"undefined":C(i))=="object"&&(k=i,S=ae.stringify(k)),typeof i=="string"){if(!K(S=i))throw"JWS Head is not safe JSON string: "+S;k=H(S)}if(M=a,(a===void 0?"undefined":C(a))=="object"&&(M=ae.stringify(a)),s!=""&&s!=null||k.alg===void 0||(s=k.alg),s!=""&&s!=null&&k.alg===void 0&&(k.alg=s,S=ae.stringify(k)),s!==k.alg)throw"alg and sHeader.alg doesn't match: "+s+"!="+k.alg;var ue=null;if(B.jwsalg2sigalg[s]===void 0)throw"unsupported alg name: "+s;ue=B.jwsalg2sigalg[s];var P=re(S)+"."+re(M),$="";if(ue.substr(0,4)=="Hmac"){if(d===void 0)throw"mac key shall be specified for HS* alg";var V=new ee({alg:ue,prov:"cryptojs",pass:d});V.updateString(P),$=V.doFinal()}else if(ue.indexOf("withECDSA")!=-1){(se=new ie({alg:ue})).init(d,y),se.updateString(P);var z=se.sign();$=b.crypto.ECDSA.asn1SigToConcatSig(z)}else{var se;ue!="none"&&((se=new ie({alg:ue})).init(d,y),se.updateString(P),$=se.sign())}return P+"."+gt($)},b.jws.JWS.verify=function(s,i,a){var d,y=b,S=y.jws.JWS,k=S.readSafeJSONString,M=y.crypto,U=M.ECDSA,B=M.Mac,H=M.Signature;C(Se)!==void 0&&(d=Se);var K=s.split(".");if(K.length!==3)return!1;var G=K[0]+"."+K[1],ee=Ye(K[2]),ie=k(oe(K[0])),ae=null,ue=null;if(ie.alg===void 0)throw"algorithm not specified in header";if(ue=(ae=ie.alg).substr(0,2),a!=null&&Object.prototype.toString.call(a)==="[object Array]"&&a.length>0&&(":"+a.join(":")+":").indexOf(":"+ae+":")==-1)throw"algorithm '"+ae+"' not accepted in the list";if(ae!="none"&&i===null)throw"key shall be specified to verify.";if(typeof i=="string"&&i.indexOf("-----BEGIN ")!=-1&&(i=Ze.getKey(i)),!(ue!="RS"&&ue!="PS"||i instanceof d))throw"key shall be a RSAKey obj for RS* and PS* algs";if(ue=="ES"&&!(i instanceof U))throw"key shall be a ECDSA obj for ES* algs";var P=null;if(S.jwsalg2sigalg[ie.alg]===void 0)throw"unsupported alg name: "+ae;if((P=S.jwsalg2sigalg[ae])=="none")throw"not supported";if(P.substr(0,4)=="Hmac"){if(i===void 0)throw"hexadecimal key shall be specified for HMAC";var $=new B({alg:P,pass:i});return $.updateString(G),ee==$.doFinal()}if(P.indexOf("withECDSA")!=-1){var V,z=null;try{z=U.concatSigToASN1Sig(ee)}catch{return!1}return(V=new H({alg:P})).init(i),V.updateString(G),V.verify(z)}return(V=new H({alg:P})).init(i),V.updateString(G),V.verify(ee)},b.jws.JWS.parse=function(s){var i,a,d,y=s.split("."),S={};if(y.length!=2&&y.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return i=y[0],a=y[1],y.length==3&&(d=y[2]),S.headerObj=b.jws.JWS.readSafeJSONString(oe(i)),S.payloadObj=b.jws.JWS.readSafeJSONString(oe(a)),S.headerPP=JSON.stringify(S.headerObj,null,"  "),S.payloadObj==null?S.payloadPP=oe(a):S.payloadPP=JSON.stringify(S.payloadObj,null,"  "),d!==void 0&&(S.sigHex=Ye(d)),S},b.jws.JWS.verifyJWT=function(s,i,a){var d=b.jws,y=d.JWS,S=y.readSafeJSONString,k=y.inArray,M=y.includedArray,U=s.split("."),B=U[0],H=U[1],K=(Ye(U[2]),S(oe(B))),G=S(oe(H));if(K.alg===void 0)return!1;if(a.alg===void 0)throw"acceptField.alg shall be specified";if(!k(K.alg,a.alg)||G.iss!==void 0&&C(a.iss)==="object"&&!k(G.iss,a.iss)||G.sub!==void 0&&C(a.sub)==="object"&&!k(G.sub,a.sub))return!1;if(G.aud!==void 0&&C(a.aud)==="object"){if(typeof G.aud=="string"){if(!k(G.aud,a.aud))return!1}else if(C(G.aud)=="object"&&!M(G.aud,a.aud))return!1}var ee=d.IntDate.getNow();return a.verifyAt!==void 0&&typeof a.verifyAt=="number"&&(ee=a.verifyAt),a.gracePeriod!==void 0&&typeof a.gracePeriod=="number"||(a.gracePeriod=0),!(G.exp!==void 0&&typeof G.exp=="number"&&G.exp+a.gracePeriod<ee)&&!(G.nbf!==void 0&&typeof G.nbf=="number"&&ee<G.nbf-a.gracePeriod)&&!(G.iat!==void 0&&typeof G.iat=="number"&&ee<G.iat-a.gracePeriod)&&(G.jti===void 0||a.jti===void 0||G.jti===a.jti)&&!!y.verify(s,i,a.alg)},b.jws.JWS.includedArray=function(s,i){var a=b.jws.JWS.inArray;if(s===null||(s===void 0?"undefined":C(s))!=="object"||typeof s.length!="number")return!1;for(var d=0;d<s.length;d++)if(!a(s[d],i))return!1;return!0},b.jws.JWS.inArray=function(s,i){if(i===null||(i===void 0?"undefined":C(i))!=="object"||typeof i.length!="number")return!1;for(var a=0;a<i.length;a++)if(i[a]==s)return!0;return!1},b.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},b.jws.JWS.isSafeJSONString=function(s,i,a){var d=null;try{return((d=w(s))===void 0?"undefined":C(d))!="object"||d.constructor===Array?0:(i&&(i[a]=d),1)}catch{return 0}},b.jws.JWS.readSafeJSONString=function(s){var i=null;try{return((i=w(s))===void 0?"undefined":C(i))!="object"||i.constructor===Array?null:i}catch{return null}},b.jws.JWS.getEncodedSignatureValueFromJWS=function(s){var i=s.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(i==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return i[1]},b.jws.JWS.getJWKthumbprint=function(s){if(s.kty!=="RSA"&&s.kty!=="EC"&&s.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var i="{";if(s.kty==="RSA"){if(typeof s.n!="string"||typeof s.e!="string")throw"wrong n and e value for RSA key";i+='"e":"'+s.e+'",',i+='"kty":"'+s.kty+'",',i+='"n":"'+s.n+'"}'}else if(s.kty==="EC"){if(typeof s.crv!="string"||typeof s.x!="string"||typeof s.y!="string")throw"wrong crv, x and y value for EC key";i+='"crv":"'+s.crv+'",',i+='"kty":"'+s.kty+'",',i+='"x":"'+s.x+'",',i+='"y":"'+s.y+'"}'}else if(s.kty==="oct"){if(typeof s.k!="string")throw"wrong k value for oct(symmetric) key";i+='"kty":"'+s.kty+'",',i+='"k":"'+s.k+'"}'}var a=Ht(i);return gt(b.crypto.Util.hashHex(a,"sha256"))},b.jws.IntDate={},b.jws.IntDate.get=function(s){var i=b.jws.IntDate,a=i.getNow,d=i.getZulu;if(s=="now")return a();if(s=="now + 1hour")return a()+3600;if(s=="now + 1day")return a()+86400;if(s=="now + 1month")return a()+2592e3;if(s=="now + 1year")return a()+31536e3;if(s.match(/Z$/))return d(s);if(s.match(/^[0-9]+$/))return parseInt(s);throw"unsupported format: "+s},b.jws.IntDate.getZulu=function(s){return vt(s)},b.jws.IntDate.getNow=function(){return~~(new Date/1e3)},b.jws.IntDate.intDate2UTCString=function(s){return new Date(1e3*s).toUTCString()},b.jws.IntDate.intDate2Zulu=function(s){var i=new Date(1e3*s);return("0000"+i.getUTCFullYear()).slice(-4)+("00"+(i.getUTCMonth()+1)).slice(-2)+("00"+i.getUTCDate()).slice(-2)+("00"+i.getUTCHours()).slice(-2)+("00"+i.getUTCMinutes()).slice(-2)+("00"+i.getUTCSeconds()).slice(-2)+"Z"},n.SecureRandom=_e,n.rng_seed_time=Z,n.BigInteger=q,n.RSAKey=Se;var Sl=b.crypto.EDSA;n.EDSA=Sl;var El=b.crypto.DSA;n.DSA=El;var xl=b.crypto.Signature;n.Signature=xl;var Fl=b.crypto.MessageDigest;n.MessageDigest=Fl;var Al=b.crypto.Mac;n.Mac=Al;var Il=b.crypto.Cipher;n.Cipher=Il,n.KEYUTIL=Ze,n.ASN1HEX=ne,n.X509=St,n.CryptoJS=O,n.b64tohex=fe,n.b64toBA=de,n.stoBA=Be,n.BAtos=nt,n.BAtohex=ze,n.stohex=qe,n.stob64=function(i){return W(qe(i))},n.stob64u=function(i){return Ve(W(qe(i)))},n.b64utos=function(i){return nt(de(Ar(i)))},n.b64tob64u=Ve,n.b64utob64=Ar,n.hex2b64=W,n.hextob64u=gt,n.b64utohex=Ye,n.utf8tob64u=re,n.b64utoutf8=oe,n.utf8tob64=function(i){return W(Tt(Dr(i)))},n.b64toutf8=function(i){return decodeURIComponent(Lr(fe(i)))},n.utf8tohex=Nr,n.hextoutf8=yt,n.hextorstr=Mt,n.rstrtohex=Ht,n.hextob64=An,n.hextob64nl=j,n.b64nltohex=J,n.hextopem=ge,n.pemtohex=ye,n.hextoArrayBuffer=function(i){if(i.length%2!=0)throw"input is not even length";if(i.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var a=new ArrayBuffer(i.length/2),d=new DataView(a),y=0;y<i.length/2;y++)d.setUint8(y,parseInt(i.substr(2*y,2),16));return a},n.ArrayBuffertohex=function(i){for(var a="",d=new DataView(i),y=0;y<i.byteLength;y++)a+=("00"+d.getUint8(y).toString(16)).slice(-2);return a},n.zulutomsec=xe,n.zulutosec=vt,n.zulutodate=function(i){return new Date(xe(i))},n.datetozulu=function(i,a,d){var y,S=i.getUTCFullYear();if(a){if(S<1950||2049<S)throw"not proper year for UTCTime: "+S;y=(""+S).slice(-2)}else y=("000"+S).slice(-4);if(y+=("0"+(i.getUTCMonth()+1)).slice(-2),y+=("0"+i.getUTCDate()).slice(-2),y+=("0"+i.getUTCHours()).slice(-2),y+=("0"+i.getUTCMinutes()).slice(-2),y+=("0"+i.getUTCSeconds()).slice(-2),d){var k=i.getUTCMilliseconds();k!==0&&(y+="."+(k=(k=("00"+k).slice(-3)).replace(/0+$/g,"")))}return y+="Z"},n.uricmptohex=Tt,n.hextouricmp=Lr,n.ipv6tohex=sr,n.hextoipv6=In,n.hextoip=Tn,n.iptohex=function(i){var a="malformed IP address";if(!(i=i.toLowerCase(i)).match(/^[0-9.]+$/)){if(i.match(/^[0-9a-f:]+$/)&&i.indexOf(":")!==-1)return sr(i);throw a}var d=i.split(".");if(d.length!==4)throw a;var y="";try{for(var S=0;S<4;S++)y+=("0"+parseInt(d[S]).toString(16)).slice(-2);return y}catch{throw a}},n.encodeURIComponentAll=Dr,n.newline_toUnix=function(i){return i=i.replace(/\r\n/gm,`
`)},n.newline_toDos=function(i){return i=(i=i.replace(/\r\n/gm,`
`)).replace(/\n/gm,`\r
`)},n.hextoposhex=Ur,n.intarystrtohex=function(i){i=(i=(i=i.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return i.split(/,/).map(function(a,d,y){var S=parseInt(a);if(S<0||255<S)throw"integer not in range 0-255";return("00"+S.toString(16)).slice(-2)}).join("")}catch(a){throw"malformed integer array string: "+a}},n.strdiffidx=function(i,a){var d=i.length;i.length>a.length&&(d=a.length);for(var y=0;y<d;y++)if(i.charCodeAt(y)!=a.charCodeAt(y))return y;return i.length!=a.length?d:-1},n.KJUR=b;var Tl=b.crypto;n.crypto=Tl;var Rl=b.asn1;n.asn1=Rl;var Pl=b.jws;n.jws=Pl;var kl=b.lang;n.lang=kl}).call(this,o(28).Buffer)},function(r,n,o){(function(c){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var u=o(30),l=o(31),g=o(32);function f(){return p.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function h(X,E){if(f()<E)throw new RangeError("Invalid typed array length");return p.TYPED_ARRAY_SUPPORT?(X=new Uint8Array(E)).__proto__=p.prototype:(X===null&&(X=new p(E)),X.length=E),X}function p(X,E,m){if(!(p.TYPED_ARRAY_SUPPORT||this instanceof p))return new p(X,E,m);if(typeof X=="number"){if(typeof E=="string")throw new Error("If encoding is specified then the first argument must be a string");return F(this,X)}return v(this,X,E,m)}function v(X,E,m,A){if(typeof E=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&E instanceof ArrayBuffer?function(Z,te,me,we){if(te.byteLength,me<0||te.byteLength<me)throw new RangeError("'offset' is out of bounds");if(te.byteLength<me+(we||0))throw new RangeError("'length' is out of bounds");return te=me===void 0&&we===void 0?new Uint8Array(te):we===void 0?new Uint8Array(te,me):new Uint8Array(te,me,we),p.TYPED_ARRAY_SUPPORT?(Z=te).__proto__=p.prototype:Z=I(Z,te),Z}(X,E,m,A):typeof E=="string"?function(Z,te,me){if(typeof me=="string"&&me!==""||(me="utf8"),!p.isEncoding(me))throw new TypeError('"encoding" must be a valid string encoding');var we=0|C(te,me),Re=(Z=h(Z,we)).write(te,me);return Re!==we&&(Z=Z.slice(0,Re)),Z}(X,E,m):function(Z,te){if(p.isBuffer(te)){var me=0|R(te.length);return(Z=h(Z,me)).length===0||te.copy(Z,0,0,me),Z}if(te){if(typeof ArrayBuffer<"u"&&te.buffer instanceof ArrayBuffer||"length"in te)return typeof te.length!="number"||function(Re){return Re!=Re}(te.length)?h(Z,0):I(Z,te);if(te.type==="Buffer"&&g(te.data))return I(Z,te.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(X,E)}function x(X){if(typeof X!="number")throw new TypeError('"size" argument must be a number');if(X<0)throw new RangeError('"size" argument must not be negative')}function F(X,E){if(x(E),X=h(X,E<0?0:0|R(E)),!p.TYPED_ARRAY_SUPPORT)for(var m=0;m<E;++m)X[m]=0;return X}function I(X,E){var m=E.length<0?0:0|R(E.length);X=h(X,m);for(var A=0;A<m;A+=1)X[A]=255&E[A];return X}function R(X){if(X>=f())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+f().toString(16)+" bytes");return 0|X}function C(X,E){if(p.isBuffer(X))return X.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(X)||X instanceof ArrayBuffer))return X.byteLength;typeof X!="string"&&(X=""+X);var m=X.length;if(m===0)return 0;for(var A=!1;;)switch(E){case"ascii":case"latin1":case"binary":return m;case"utf8":case"utf-8":case void 0:return Ge(X).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*m;case"hex":return m>>>1;case"base64":return Qe(X).length;default:if(A)return Ge(X).length;E=(""+E).toLowerCase(),A=!0}}function L(X,E,m){var A=!1;if((E===void 0||E<0)&&(E=0),E>this.length||((m===void 0||m>this.length)&&(m=this.length),m<=0)||(m>>>=0)<=(E>>>=0))return"";for(X||(X="utf8");;)switch(X){case"hex":return Oe(this,E,m);case"utf8":case"utf-8":return le(this,E,m);case"ascii":return Te(this,E,m);case"latin1":case"binary":return Ne(this,E,m);case"base64":return ke(this,E,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return He(this,E,m);default:if(A)throw new TypeError("Unknown encoding: "+X);X=(X+"").toLowerCase(),A=!0}}function N(X,E,m){var A=X[E];X[E]=X[m],X[m]=A}function O(X,E,m,A,D){if(X.length===0)return-1;if(typeof m=="string"?(A=m,m=0):m>2147483647?m=2147483647:m<-2147483648&&(m=-2147483648),m=+m,isNaN(m)&&(m=D?0:X.length-1),m<0&&(m=X.length+m),m>=X.length){if(D)return-1;m=X.length-1}else if(m<0){if(!D)return-1;m=0}if(typeof E=="string"&&(E=p.from(E,A)),p.isBuffer(E))return E.length===0?-1:Y(X,E,m,A,D);if(typeof E=="number")return E&=255,p.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?D?Uint8Array.prototype.indexOf.call(X,E,m):Uint8Array.prototype.lastIndexOf.call(X,E,m):Y(X,[E],m,A,D);throw new TypeError("val must be string, number or Buffer")}function Y(X,E,m,A,D){var Z,te=1,me=X.length,we=E.length;if(A!==void 0&&((A=String(A).toLowerCase())==="ucs2"||A==="ucs-2"||A==="utf16le"||A==="utf-16le")){if(X.length<2||E.length<2)return-1;te=2,me/=2,we/=2,m/=2}function Re(It,Se){return te===1?It[Se]:It.readUInt16BE(Se*te)}if(D){var De=-1;for(Z=m;Z<me;Z++)if(Re(X,Z)===Re(E,De===-1?0:Z-De)){if(De===-1&&(De=Z),Z-De+1===we)return De*te}else De!==-1&&(Z-=Z-De),De=-1}else for(m+we>me&&(m=me-we),Z=m;Z>=0;Z--){for(var _e=!0,tt=0;tt<we;tt++)if(Re(X,Z+tt)!==Re(E,tt)){_e=!1;break}if(_e)return Z}return-1}function Q(X,E,m,A){m=Number(m)||0;var D=X.length-m;A?(A=Number(A))>D&&(A=D):A=D;var Z=E.length;if(Z%2!=0)throw new TypeError("Invalid hex string");A>Z/2&&(A=Z/2);for(var te=0;te<A;++te){var me=parseInt(E.substr(2*te,2),16);if(isNaN(me))return te;X[m+te]=me}return te}function W(X,E,m,A){return Je(Ge(E,X.length-m),X,m,A)}function fe(X,E,m,A){return Je(function(Z){for(var te=[],me=0;me<Z.length;++me)te.push(255&Z.charCodeAt(me));return te}(E),X,m,A)}function de(X,E,m,A){return fe(X,E,m,A)}function q(X,E,m,A){return Je(Qe(E),X,m,A)}function he(X,E,m,A){return Je(function(Z,te){for(var me,we,Re,De=[],_e=0;_e<Z.length&&!((te-=2)<0);++_e)we=(me=Z.charCodeAt(_e))>>8,Re=me%256,De.push(Re),De.push(we);return De}(E,X.length-m),X,m,A)}function ke(X,E,m){return E===0&&m===X.length?u.fromByteArray(X):u.fromByteArray(X.slice(E,m))}function le(X,E,m){m=Math.min(X.length,m);for(var A=[],D=E;D<m;){var Z,te,me,we,Re=X[D],De=null,_e=Re>239?4:Re>223?3:Re>191?2:1;if(D+_e<=m)switch(_e){case 1:Re<128&&(De=Re);break;case 2:(192&(Z=X[D+1]))==128&&(we=(31&Re)<<6|63&Z)>127&&(De=we);break;case 3:Z=X[D+1],te=X[D+2],(192&Z)==128&&(192&te)==128&&(we=(15&Re)<<12|(63&Z)<<6|63&te)>2047&&(we<55296||we>57343)&&(De=we);break;case 4:Z=X[D+1],te=X[D+2],me=X[D+3],(192&Z)==128&&(192&te)==128&&(192&me)==128&&(we=(15&Re)<<18|(63&Z)<<12|(63&te)<<6|63&me)>65535&&we<1114112&&(De=we)}De===null?(De=65533,_e=1):De>65535&&(De-=65536,A.push(De>>>10&1023|55296),De=56320|1023&De),A.push(De),D+=_e}return function(It){var Se=It.length;if(Se<=Ue)return String.fromCharCode.apply(String,It);for(var rt="",T=0;T<Se;)rt+=String.fromCharCode.apply(String,It.slice(T,T+=Ue));return rt}(A)}n.Buffer=p,n.SlowBuffer=function(E){return+E!=E&&(E=0),p.alloc(+E)},n.INSPECT_MAX_BYTES=50,p.TYPED_ARRAY_SUPPORT=c.TYPED_ARRAY_SUPPORT!==void 0?c.TYPED_ARRAY_SUPPORT:function(){try{var E=new Uint8Array(1);return E.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},E.foo()===42&&typeof E.subarray=="function"&&E.subarray(1,1).byteLength===0}catch{return!1}}(),n.kMaxLength=f(),p.poolSize=8192,p._augment=function(X){return X.__proto__=p.prototype,X},p.from=function(X,E,m){return v(null,X,E,m)},p.TYPED_ARRAY_SUPPORT&&(p.prototype.__proto__=Uint8Array.prototype,p.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&p[Symbol.species]===p&&Object.defineProperty(p,Symbol.species,{value:null,configurable:!0})),p.alloc=function(X,E,m){return function(D,Z,te,me){return x(Z),Z<=0?h(D,Z):te!==void 0?typeof me=="string"?h(D,Z).fill(te,me):h(D,Z).fill(te):h(D,Z)}(null,X,E,m)},p.allocUnsafe=function(X){return F(null,X)},p.allocUnsafeSlow=function(X){return F(null,X)},p.isBuffer=function(E){return!(E==null||!E._isBuffer)},p.compare=function(E,m){if(!p.isBuffer(E)||!p.isBuffer(m))throw new TypeError("Arguments must be Buffers");if(E===m)return 0;for(var A=E.length,D=m.length,Z=0,te=Math.min(A,D);Z<te;++Z)if(E[Z]!==m[Z]){A=E[Z],D=m[Z];break}return A<D?-1:D<A?1:0},p.isEncoding=function(E){switch(String(E).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},p.concat=function(E,m){if(!g(E))throw new TypeError('"list" argument must be an Array of Buffers');if(E.length===0)return p.alloc(0);var A;if(m===void 0)for(m=0,A=0;A<E.length;++A)m+=E[A].length;var D=p.allocUnsafe(m),Z=0;for(A=0;A<E.length;++A){var te=E[A];if(!p.isBuffer(te))throw new TypeError('"list" argument must be an Array of Buffers');te.copy(D,Z),Z+=te.length}return D},p.byteLength=C,p.prototype._isBuffer=!0,p.prototype.swap16=function(){var E=this.length;if(E%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var m=0;m<E;m+=2)N(this,m,m+1);return this},p.prototype.swap32=function(){var E=this.length;if(E%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var m=0;m<E;m+=4)N(this,m,m+3),N(this,m+1,m+2);return this},p.prototype.swap64=function(){var E=this.length;if(E%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var m=0;m<E;m+=8)N(this,m,m+7),N(this,m+1,m+6),N(this,m+2,m+5),N(this,m+3,m+4);return this},p.prototype.toString=function(){var E=0|this.length;return E===0?"":arguments.length===0?le(this,0,E):L.apply(this,arguments)},p.prototype.equals=function(E){if(!p.isBuffer(E))throw new TypeError("Argument must be a Buffer");return this===E||p.compare(this,E)===0},p.prototype.inspect=function(){var E="",m=n.INSPECT_MAX_BYTES;return this.length>0&&(E=this.toString("hex",0,m).match(/.{2}/g).join(" "),this.length>m&&(E+=" ... ")),"<Buffer "+E+">"},p.prototype.compare=function(E,m,A,D,Z){if(!p.isBuffer(E))throw new TypeError("Argument must be a Buffer");if(m===void 0&&(m=0),A===void 0&&(A=E?E.length:0),D===void 0&&(D=0),Z===void 0&&(Z=this.length),m<0||A>E.length||D<0||Z>this.length)throw new RangeError("out of range index");if(D>=Z&&m>=A)return 0;if(D>=Z)return-1;if(m>=A)return 1;if(this===E)return 0;for(var te=(Z>>>=0)-(D>>>=0),me=(A>>>=0)-(m>>>=0),we=Math.min(te,me),Re=this.slice(D,Z),De=E.slice(m,A),_e=0;_e<we;++_e)if(Re[_e]!==De[_e]){te=Re[_e],me=De[_e];break}return te<me?-1:me<te?1:0},p.prototype.includes=function(E,m,A){return this.indexOf(E,m,A)!==-1},p.prototype.indexOf=function(E,m,A){return O(this,E,m,A,!0)},p.prototype.lastIndexOf=function(E,m,A){return O(this,E,m,A,!1)},p.prototype.write=function(E,m,A,D){if(m===void 0)D="utf8",A=this.length,m=0;else if(A===void 0&&typeof m=="string")D=m,A=this.length,m=0;else{if(!isFinite(m))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");m|=0,isFinite(A)?(A|=0,D===void 0&&(D="utf8")):(D=A,A=void 0)}var Z=this.length-m;if((A===void 0||A>Z)&&(A=Z),E.length>0&&(A<0||m<0)||m>this.length)throw new RangeError("Attempt to write outside buffer bounds");D||(D="utf8");for(var te=!1;;)switch(D){case"hex":return Q(this,E,m,A);case"utf8":case"utf-8":return W(this,E,m,A);case"ascii":return fe(this,E,m,A);case"latin1":case"binary":return de(this,E,m,A);case"base64":return q(this,E,m,A);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return he(this,E,m,A);default:if(te)throw new TypeError("Unknown encoding: "+D);D=(""+D).toLowerCase(),te=!0}},p.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Ue=4096;function Te(X,E,m){var A="";m=Math.min(X.length,m);for(var D=E;D<m;++D)A+=String.fromCharCode(127&X[D]);return A}function Ne(X,E,m){var A="";m=Math.min(X.length,m);for(var D=E;D<m;++D)A+=String.fromCharCode(X[D]);return A}function Oe(X,E,m){var A=X.length;(!E||E<0)&&(E=0),(!m||m<0||m>A)&&(m=A);for(var D="",Z=E;Z<m;++Z)D+=st(X[Z]);return D}function He(X,E,m){for(var A=X.slice(E,m),D="",Z=0;Z<A.length;Z+=2)D+=String.fromCharCode(A[Z]+256*A[Z+1]);return D}function Fe(X,E,m){if(X%1!=0||X<0)throw new RangeError("offset is not uint");if(X+E>m)throw new RangeError("Trying to access beyond buffer length")}function Pe(X,E,m,A,D,Z){if(!p.isBuffer(X))throw new TypeError('"buffer" argument must be a Buffer instance');if(E>D||E<Z)throw new RangeError('"value" argument is out of bounds');if(m+A>X.length)throw new RangeError("Index out of range")}function Ae(X,E,m,A){E<0&&(E=65535+E+1);for(var D=0,Z=Math.min(X.length-m,2);D<Z;++D)X[m+D]=(E&255<<8*(A?D:1-D))>>>8*(A?D:1-D)}function Me(X,E,m,A){E<0&&(E=4294967295+E+1);for(var D=0,Z=Math.min(X.length-m,4);D<Z;++D)X[m+D]=E>>>8*(A?D:3-D)&255}function Ie(X,E,m,A,D,Z){if(m+A>X.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("Index out of range")}function We(X,E,m,A,D){return D||Ie(X,0,m,4),l.write(X,E,m,A,23,4),m+4}function it(X,E,m,A,D){return D||Ie(X,0,m,8),l.write(X,E,m,A,52,8),m+8}p.prototype.slice=function(E,m){var A,D=this.length;if((E=~~E)<0?(E+=D)<0&&(E=0):E>D&&(E=D),(m=m===void 0?D:~~m)<0?(m+=D)<0&&(m=0):m>D&&(m=D),m<E&&(m=E),p.TYPED_ARRAY_SUPPORT)(A=this.subarray(E,m)).__proto__=p.prototype;else{var Z=m-E;A=new p(Z,void 0);for(var te=0;te<Z;++te)A[te]=this[te+E]}return A},p.prototype.readUIntLE=function(E,m,A){E|=0,m|=0,A||Fe(E,m,this.length);for(var D=this[E],Z=1,te=0;++te<m&&(Z*=256);)D+=this[E+te]*Z;return D},p.prototype.readUIntBE=function(E,m,A){E|=0,m|=0,A||Fe(E,m,this.length);for(var D=this[E+--m],Z=1;m>0&&(Z*=256);)D+=this[E+--m]*Z;return D},p.prototype.readUInt8=function(E,m){return m||Fe(E,1,this.length),this[E]},p.prototype.readUInt16LE=function(E,m){return m||Fe(E,2,this.length),this[E]|this[E+1]<<8},p.prototype.readUInt16BE=function(E,m){return m||Fe(E,2,this.length),this[E]<<8|this[E+1]},p.prototype.readUInt32LE=function(E,m){return m||Fe(E,4,this.length),(this[E]|this[E+1]<<8|this[E+2]<<16)+16777216*this[E+3]},p.prototype.readUInt32BE=function(E,m){return m||Fe(E,4,this.length),16777216*this[E]+(this[E+1]<<16|this[E+2]<<8|this[E+3])},p.prototype.readIntLE=function(E,m,A){E|=0,m|=0,A||Fe(E,m,this.length);for(var D=this[E],Z=1,te=0;++te<m&&(Z*=256);)D+=this[E+te]*Z;return D>=(Z*=128)&&(D-=Math.pow(2,8*m)),D},p.prototype.readIntBE=function(E,m,A){E|=0,m|=0,A||Fe(E,m,this.length);for(var D=m,Z=1,te=this[E+--D];D>0&&(Z*=256);)te+=this[E+--D]*Z;return te>=(Z*=128)&&(te-=Math.pow(2,8*m)),te},p.prototype.readInt8=function(E,m){return m||Fe(E,1,this.length),128&this[E]?-1*(255-this[E]+1):this[E]},p.prototype.readInt16LE=function(E,m){m||Fe(E,2,this.length);var A=this[E]|this[E+1]<<8;return 32768&A?4294901760|A:A},p.prototype.readInt16BE=function(E,m){m||Fe(E,2,this.length);var A=this[E+1]|this[E]<<8;return 32768&A?4294901760|A:A},p.prototype.readInt32LE=function(E,m){return m||Fe(E,4,this.length),this[E]|this[E+1]<<8|this[E+2]<<16|this[E+3]<<24},p.prototype.readInt32BE=function(E,m){return m||Fe(E,4,this.length),this[E]<<24|this[E+1]<<16|this[E+2]<<8|this[E+3]},p.prototype.readFloatLE=function(E,m){return m||Fe(E,4,this.length),l.read(this,E,!0,23,4)},p.prototype.readFloatBE=function(E,m){return m||Fe(E,4,this.length),l.read(this,E,!1,23,4)},p.prototype.readDoubleLE=function(E,m){return m||Fe(E,8,this.length),l.read(this,E,!0,52,8)},p.prototype.readDoubleBE=function(E,m){return m||Fe(E,8,this.length),l.read(this,E,!1,52,8)},p.prototype.writeUIntLE=function(E,m,A,D){E=+E,m|=0,A|=0,D||Pe(this,E,m,A,Math.pow(2,8*A)-1,0);var Z=1,te=0;for(this[m]=255&E;++te<A&&(Z*=256);)this[m+te]=E/Z&255;return m+A},p.prototype.writeUIntBE=function(E,m,A,D){E=+E,m|=0,A|=0,D||Pe(this,E,m,A,Math.pow(2,8*A)-1,0);var Z=A-1,te=1;for(this[m+Z]=255&E;--Z>=0&&(te*=256);)this[m+Z]=E/te&255;return m+A},p.prototype.writeUInt8=function(E,m,A){return E=+E,m|=0,A||Pe(this,E,m,1,255,0),p.TYPED_ARRAY_SUPPORT||(E=Math.floor(E)),this[m]=255&E,m+1},p.prototype.writeUInt16LE=function(E,m,A){return E=+E,m|=0,A||Pe(this,E,m,2,65535,0),p.TYPED_ARRAY_SUPPORT?(this[m]=255&E,this[m+1]=E>>>8):Ae(this,E,m,!0),m+2},p.prototype.writeUInt16BE=function(E,m,A){return E=+E,m|=0,A||Pe(this,E,m,2,65535,0),p.TYPED_ARRAY_SUPPORT?(this[m]=E>>>8,this[m+1]=255&E):Ae(this,E,m,!1),m+2},p.prototype.writeUInt32LE=function(E,m,A){return E=+E,m|=0,A||Pe(this,E,m,4,4294967295,0),p.TYPED_ARRAY_SUPPORT?(this[m+3]=E>>>24,this[m+2]=E>>>16,this[m+1]=E>>>8,this[m]=255&E):Me(this,E,m,!0),m+4},p.prototype.writeUInt32BE=function(E,m,A){return E=+E,m|=0,A||Pe(this,E,m,4,4294967295,0),p.TYPED_ARRAY_SUPPORT?(this[m]=E>>>24,this[m+1]=E>>>16,this[m+2]=E>>>8,this[m+3]=255&E):Me(this,E,m,!1),m+4},p.prototype.writeIntLE=function(E,m,A,D){if(E=+E,m|=0,!D){var Z=Math.pow(2,8*A-1);Pe(this,E,m,A,Z-1,-Z)}var te=0,me=1,we=0;for(this[m]=255&E;++te<A&&(me*=256);)E<0&&we===0&&this[m+te-1]!==0&&(we=1),this[m+te]=(E/me>>0)-we&255;return m+A},p.prototype.writeIntBE=function(E,m,A,D){if(E=+E,m|=0,!D){var Z=Math.pow(2,8*A-1);Pe(this,E,m,A,Z-1,-Z)}var te=A-1,me=1,we=0;for(this[m+te]=255&E;--te>=0&&(me*=256);)E<0&&we===0&&this[m+te+1]!==0&&(we=1),this[m+te]=(E/me>>0)-we&255;return m+A},p.prototype.writeInt8=function(E,m,A){return E=+E,m|=0,A||Pe(this,E,m,1,127,-128),p.TYPED_ARRAY_SUPPORT||(E=Math.floor(E)),E<0&&(E=255+E+1),this[m]=255&E,m+1},p.prototype.writeInt16LE=function(E,m,A){return E=+E,m|=0,A||Pe(this,E,m,2,32767,-32768),p.TYPED_ARRAY_SUPPORT?(this[m]=255&E,this[m+1]=E>>>8):Ae(this,E,m,!0),m+2},p.prototype.writeInt16BE=function(E,m,A){return E=+E,m|=0,A||Pe(this,E,m,2,32767,-32768),p.TYPED_ARRAY_SUPPORT?(this[m]=E>>>8,this[m+1]=255&E):Ae(this,E,m,!1),m+2},p.prototype.writeInt32LE=function(E,m,A){return E=+E,m|=0,A||Pe(this,E,m,4,2147483647,-2147483648),p.TYPED_ARRAY_SUPPORT?(this[m]=255&E,this[m+1]=E>>>8,this[m+2]=E>>>16,this[m+3]=E>>>24):Me(this,E,m,!0),m+4},p.prototype.writeInt32BE=function(E,m,A){return E=+E,m|=0,A||Pe(this,E,m,4,2147483647,-2147483648),E<0&&(E=4294967295+E+1),p.TYPED_ARRAY_SUPPORT?(this[m]=E>>>24,this[m+1]=E>>>16,this[m+2]=E>>>8,this[m+3]=255&E):Me(this,E,m,!1),m+4},p.prototype.writeFloatLE=function(E,m,A){return We(this,E,m,!0,A)},p.prototype.writeFloatBE=function(E,m,A){return We(this,E,m,!1,A)},p.prototype.writeDoubleLE=function(E,m,A){return it(this,E,m,!0,A)},p.prototype.writeDoubleBE=function(E,m,A){return it(this,E,m,!1,A)},p.prototype.copy=function(E,m,A,D){if(A||(A=0),D||D===0||(D=this.length),m>=E.length&&(m=E.length),m||(m=0),D>0&&D<A&&(D=A),D===A||E.length===0||this.length===0)return 0;if(m<0)throw new RangeError("targetStart out of bounds");if(A<0||A>=this.length)throw new RangeError("sourceStart out of bounds");if(D<0)throw new RangeError("sourceEnd out of bounds");D>this.length&&(D=this.length),E.length-m<D-A&&(D=E.length-m+A);var Z,te=D-A;if(this===E&&A<m&&m<D)for(Z=te-1;Z>=0;--Z)E[Z+m]=this[Z+A];else if(te<1e3||!p.TYPED_ARRAY_SUPPORT)for(Z=0;Z<te;++Z)E[Z+m]=this[Z+A];else Uint8Array.prototype.set.call(E,this.subarray(A,A+te),m);return te},p.prototype.fill=function(E,m,A,D){if(typeof E=="string"){if(typeof m=="string"?(D=m,m=0,A=this.length):typeof A=="string"&&(D=A,A=this.length),E.length===1){var Z=E.charCodeAt(0);Z<256&&(E=Z)}if(D!==void 0&&typeof D!="string")throw new TypeError("encoding must be a string");if(typeof D=="string"&&!p.isEncoding(D))throw new TypeError("Unknown encoding: "+D)}else typeof E=="number"&&(E&=255);if(m<0||this.length<m||this.length<A)throw new RangeError("Out of range index");if(A<=m)return this;var te;if(m>>>=0,A=A===void 0?this.length:A>>>0,E||(E=0),typeof E=="number")for(te=m;te<A;++te)this[te]=E;else{var me=p.isBuffer(E)?E:Ge(new p(E,D).toString()),we=me.length;for(te=0;te<A-m;++te)this[te+m]=me[te%we]}return this};var wt=/[^+\/0-9A-Za-z-_]/g;function st(X){return X<16?"0"+X.toString(16):X.toString(16)}function Ge(X,E){var m;E=E||1/0;for(var A=X.length,D=null,Z=[],te=0;te<A;++te){if((m=X.charCodeAt(te))>55295&&m<57344){if(!D){if(m>56319){(E-=3)>-1&&Z.push(239,191,189);continue}if(te+1===A){(E-=3)>-1&&Z.push(239,191,189);continue}D=m;continue}if(m<56320){(E-=3)>-1&&Z.push(239,191,189),D=m;continue}m=65536+(D-55296<<10|m-56320)}else D&&(E-=3)>-1&&Z.push(239,191,189);if(D=null,m<128){if((E-=1)<0)break;Z.push(m)}else if(m<2048){if((E-=2)<0)break;Z.push(m>>6|192,63&m|128)}else if(m<65536){if((E-=3)<0)break;Z.push(m>>12|224,m>>6&63|128,63&m|128)}else{if(!(m<1114112))throw new Error("Invalid code point");if((E-=4)<0)break;Z.push(m>>18|240,m>>12&63|128,m>>6&63|128,63&m|128)}}return Z}function Qe(X){return u.toByteArray(function(m){if((m=function(D){return D.trim?D.trim():D.replace(/^\s+|\s+$/g,"")}(m).replace(wt,"")).length<2)return"";for(;m.length%4!=0;)m+="=";return m}(X))}function Je(X,E,m,A){for(var D=0;D<A&&!(D+m>=E.length||D>=X.length);++D)E[D+m]=X[D];return D}}).call(this,o(29))},function(r,n){var o;o=function(){return this}();try{o=o||new Function("return this")()}catch{typeof window=="object"&&(o=window)}r.exports=o},function(r,n,o){n.byteLength=function(F){var I=p(F),R=I[0],C=I[1];return 3*(R+C)/4-C},n.toByteArray=function(F){var I,R,C=p(F),L=C[0],N=C[1],O=new l(function(fe,de,q){return 3*(de+q)/4-q}(0,L,N)),Y=0,Q=N>0?L-4:L;for(R=0;R<Q;R+=4)I=u[F.charCodeAt(R)]<<18|u[F.charCodeAt(R+1)]<<12|u[F.charCodeAt(R+2)]<<6|u[F.charCodeAt(R+3)],O[Y++]=I>>16&255,O[Y++]=I>>8&255,O[Y++]=255&I;return N===2&&(I=u[F.charCodeAt(R)]<<2|u[F.charCodeAt(R+1)]>>4,O[Y++]=255&I),N===1&&(I=u[F.charCodeAt(R)]<<10|u[F.charCodeAt(R+1)]<<4|u[F.charCodeAt(R+2)]>>2,O[Y++]=I>>8&255,O[Y++]=255&I),O},n.fromByteArray=function(F){for(var I,R=F.length,C=R%3,L=[],N=16383,O=0,Y=R-C;O<Y;O+=N)L.push(v(F,O,O+N>Y?Y:O+N));return C===1?(I=F[R-1],L.push(c[I>>2]+c[I<<4&63]+"==")):C===2&&(I=(F[R-2]<<8)+F[R-1],L.push(c[I>>10]+c[I>>4&63]+c[I<<2&63]+"=")),L.join("")};for(var c=[],u=[],l=typeof Uint8Array<"u"?Uint8Array:Array,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,h=g.length;f<h;++f)c[f]=g[f],u[g.charCodeAt(f)]=f;function p(x){var F=x.length;if(F%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=x.indexOf("=");return I===-1&&(I=F),[I,I===F?0:4-I%4]}function v(x,F,I){for(var R,C,L=[],N=F;N<I;N+=3)R=(x[N]<<16&16711680)+(x[N+1]<<8&65280)+(255&x[N+2]),L.push(c[(C=R)>>18&63]+c[C>>12&63]+c[C>>6&63]+c[63&C]);return L.join("")}u[45]=62,u[95]=63},function(r,n){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */n.read=function(o,c,u,l,g){var f,h,p=8*g-l-1,v=(1<<p)-1,x=v>>1,F=-7,I=u?g-1:0,R=u?-1:1,C=o[c+I];for(I+=R,f=C&(1<<-F)-1,C>>=-F,F+=p;F>0;f=256*f+o[c+I],I+=R,F-=8);for(h=f&(1<<-F)-1,f>>=-F,F+=l;F>0;h=256*h+o[c+I],I+=R,F-=8);if(f===0)f=1-x;else{if(f===v)return h?NaN:1/0*(C?-1:1);h+=Math.pow(2,l),f-=x}return(C?-1:1)*h*Math.pow(2,f-l)},n.write=function(o,c,u,l,g,f){var h,p,v,x=8*f-g-1,F=(1<<x)-1,I=F>>1,R=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=l?0:f-1,L=l?1:-1,N=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(p=isNaN(c)?1:0,h=F):(h=Math.floor(Math.log(c)/Math.LN2),c*(v=Math.pow(2,-h))<1&&(h--,v*=2),(c+=h+I>=1?R/v:R*Math.pow(2,1-I))*v>=2&&(h++,v/=2),h+I>=F?(p=0,h=F):h+I>=1?(p=(c*v-1)*Math.pow(2,g),h+=I):(p=c*Math.pow(2,I-1)*Math.pow(2,g),h=0));g>=8;o[u+C]=255&p,C+=L,p/=256,g-=8);for(h=h<<g|p,x+=g;x>0;o[u+C]=255&h,C+=L,h/=256,x-=8);o[u+C-L]|=128*N}},function(r,n){var o={}.toString;r.exports=Array.isArray||function(c){return o.call(c)=="[object Array]"}},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(l){var g=l.jws,f=l.KeyUtil,h=l.X509,p=l.crypto,v=l.hextob64u,x=l.b64tohex,F=l.AllowedSigningAlgs;return function(){function I(){(function(C,L){if(!(C instanceof L))throw new TypeError("Cannot call a class as a function")})(this,I)}return I.parseJwt=function(C){c.Log.debug("JoseUtil.parseJwt");try{var L=g.JWS.parse(C);return{header:L.headerObj,payload:L.payloadObj}}catch(N){c.Log.error(N)}},I.validateJwt=function(C,L,N,O,Y,Q,W){c.Log.debug("JoseUtil.validateJwt");try{if(L.kty==="RSA")if(L.e&&L.n)L=f.getKey(L);else{if(!L.x5c||!L.x5c.length)return c.Log.error("JoseUtil.validateJwt: RSA key missing key material",L),Promise.reject(new Error("RSA key missing key material"));var fe=x(L.x5c[0]);L=h.getPublicKeyFromCertHex(fe)}else{if(L.kty!=="EC")return c.Log.error("JoseUtil.validateJwt: Unsupported key type",L&&L.kty),Promise.reject(new Error(L.kty));if(!(L.crv&&L.x&&L.y))return c.Log.error("JoseUtil.validateJwt: EC key missing key material",L),Promise.reject(new Error("EC key missing key material"));L=f.getKey(L)}return I._validateJwt(C,L,N,O,Y,Q,W)}catch(de){return c.Log.error(de&&de.message||de),Promise.reject("JWT validation failed")}},I.validateJwtAttributes=function(C,L,N,O,Y,Q){O||(O=0),Y||(Y=parseInt(Date.now()/1e3));var W=I.parseJwt(C).payload;if(!W.iss)return c.Log.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(W.iss!==L)return c.Log.error("JoseUtil._validateJwt: Invalid issuer in token",W.iss),Promise.reject(new Error("Invalid issuer in token: "+W.iss));if(!W.aud)return c.Log.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(W.aud===N||Array.isArray(W.aud)&&W.aud.indexOf(N)>=0))return c.Log.error("JoseUtil._validateJwt: Invalid audience in token",W.aud),Promise.reject(new Error("Invalid audience in token: "+W.aud));if(W.azp&&W.azp!==N)return c.Log.error("JoseUtil._validateJwt: Invalid azp in token",W.azp),Promise.reject(new Error("Invalid azp in token: "+W.azp));if(!Q){var fe=Y+O,de=Y-O;if(!W.iat)return c.Log.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(fe<W.iat)return c.Log.error("JoseUtil._validateJwt: iat is in the future",W.iat),Promise.reject(new Error("iat is in the future: "+W.iat));if(W.nbf&&fe<W.nbf)return c.Log.error("JoseUtil._validateJwt: nbf is in the future",W.nbf),Promise.reject(new Error("nbf is in the future: "+W.nbf));if(!W.exp)return c.Log.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(W.exp<de)return c.Log.error("JoseUtil._validateJwt: exp is in the past",W.exp),Promise.reject(new Error("exp is in the past:"+W.exp))}return Promise.resolve(W)},I._validateJwt=function(C,L,N,O,Y,Q,W){return I.validateJwtAttributes(C,N,O,Y,Q,W).then(function(fe){try{return g.JWS.verify(C,L,F)?fe:(c.Log.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(de){return c.Log.error(de&&de.message||de),Promise.reject(new Error("signature validation failed"))}})},I.hashString=function(C,L){try{return p.Util.hashString(C,L)}catch(N){c.Log.error(N)}},I.hexToBase64Url=function(C){try{return v(C)}catch(L){c.Log.error(L)}},I}()};var c=o(0);r.exports=n.default},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.SigninResponse=void 0;var c=function(){function g(f,h){for(var p=0;p<h.length;p++){var v=h[p];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(f,v.key,v)}}return function(f,h,p){return h&&g(f.prototype,h),p&&g(f,p),f}}(),u=o(3);function l(g,f){if(!(g instanceof f))throw new TypeError("Cannot call a class as a function")}n.SigninResponse=function(){function g(f){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#";l(this,g);var p=u.UrlUtility.parseUrlFragment(f,h);this.error=p.error,this.error_description=p.error_description,this.error_uri=p.error_uri,this.code=p.code,this.state=p.state,this.id_token=p.id_token,this.session_state=p.session_state,this.access_token=p.access_token,this.token_type=p.token_type,this.scope=p.scope,this.profile=void 0,this.expires_in=p.expires_in}return c(g,[{key:"expires_in",get:function(){if(this.expires_at){var h=parseInt(Date.now()/1e3);return this.expires_at-h}},set:function(h){var p=parseInt(h);if(typeof p=="number"&&p>0){var v=parseInt(Date.now()/1e3);this.expires_at=v+p}}},{key:"expired",get:function(){var h=this.expires_in;if(h!==void 0)return h<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),g}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.SignoutRequest=void 0;var c=o(0),u=o(3),l=o(9);n.SignoutRequest=function g(f){var h=f.url,p=f.id_token_hint,v=f.post_logout_redirect_uri,x=f.data,F=f.extraQueryParams,I=f.request_type;if(function(L,N){if(!(L instanceof N))throw new TypeError("Cannot call a class as a function")}(this,g),!h)throw c.Log.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var R in p&&(h=u.UrlUtility.addQueryParam(h,"id_token_hint",p)),v&&(h=u.UrlUtility.addQueryParam(h,"post_logout_redirect_uri",v),x&&(this.state=new l.State({data:x,request_type:I}),h=u.UrlUtility.addQueryParam(h,"state",this.state.id))),F)h=u.UrlUtility.addQueryParam(h,R,F[R]);this.url=h}},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.SignoutResponse=void 0;var c=o(3);n.SignoutResponse=function u(l){(function(h,p){if(!(h instanceof p))throw new TypeError("Cannot call a class as a function")})(this,u);var g=c.UrlUtility.parseUrlFragment(l,"?");this.error=g.error,this.error_description=g.error_description,this.error_uri=g.error_uri,this.state=g.state}},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.InMemoryWebStorage=void 0;var c=function(){function l(g,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(g,p.key,p)}}return function(g,f,h){return f&&l(g.prototype,f),h&&l(g,h),g}}(),u=o(0);n.InMemoryWebStorage=function(){function l(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,l),this._data={}}return l.prototype.getItem=function(f){return u.Log.debug("InMemoryWebStorage.getItem",f),this._data[f]},l.prototype.setItem=function(f,h){u.Log.debug("InMemoryWebStorage.setItem",f),this._data[f]=h},l.prototype.removeItem=function(f){u.Log.debug("InMemoryWebStorage.removeItem",f),delete this._data[f]},l.prototype.key=function(f){return Object.getOwnPropertyNames(this._data)[f]},c(l,[{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),l}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.UserManager=void 0;var c=function(){function N(O,Y){for(var Q=0;Q<Y.length;Q++){var W=Y[Q];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(O,W.key,W)}}return function(O,Y,Q){return Y&&N(O.prototype,Y),Q&&N(O,Q),O}}(),u=o(0),l=o(10),g=o(39),f=o(15),h=o(45),p=o(47),v=o(18),x=o(8),F=o(20),I=o(11),R=o(4);function C(N,O){if(!(N instanceof O))throw new TypeError("Cannot call a class as a function")}function L(N,O){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!O||typeof O!="object"&&typeof O!="function"?N:O}n.UserManager=function(N){function O(){var Y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p.SilentRenewService,W=arguments.length>2&&arguments[2]!==void 0?arguments[2]:v.SessionMonitor,fe=arguments.length>3&&arguments[3]!==void 0?arguments[3]:F.TokenRevocationClient,de=arguments.length>4&&arguments[4]!==void 0?arguments[4]:I.TokenClient,q=arguments.length>5&&arguments[5]!==void 0?arguments[5]:R.JoseUtil;C(this,O),Y instanceof g.UserManagerSettings||(Y=new g.UserManagerSettings(Y));var he=L(this,N.call(this,Y));return he._events=new h.UserManagerEvents(Y),he._silentRenewService=new Q(he),he.settings.automaticSilentRenew&&(u.Log.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),he.startSilentRenew()),he.settings.monitorSession&&(u.Log.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),he._sessionMonitor=new W(he)),he._tokenRevocationClient=new fe(he._settings),he._tokenClient=new de(he._settings),he._joseUtil=q,he}return function(Q,W){if(typeof W!="function"&&W!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof W);Q.prototype=Object.create(W&&W.prototype,{constructor:{value:Q,enumerable:!1,writable:!0,configurable:!0}}),W&&(Object.setPrototypeOf?Object.setPrototypeOf(Q,W):Q.__proto__=W)}(O,N),O.prototype.getUser=function(){var Q=this;return this._loadUser().then(function(W){return W?(u.Log.info("UserManager.getUser: user loaded"),Q._events.load(W,!1),W):(u.Log.info("UserManager.getUser: user not found in storage"),null)})},O.prototype.removeUser=function(){var Q=this;return this.storeUser(null).then(function(){u.Log.info("UserManager.removeUser: user removed from storage"),Q._events.unload()})},O.prototype.signinRedirect=function(){var Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(Q=Object.assign({},Q)).request_type="si:r";var W={useReplaceToNavigate:Q.useReplaceToNavigate};return this._signinStart(Q,this._redirectNavigator,W).then(function(){u.Log.info("UserManager.signinRedirect: successful")})},O.prototype.signinRedirectCallback=function(Q){return this._signinEnd(Q||this._redirectNavigator.url).then(function(W){return W.profile&&W.profile.sub?u.Log.info("UserManager.signinRedirectCallback: successful, signed in sub: ",W.profile.sub):u.Log.info("UserManager.signinRedirectCallback: no sub"),W})},O.prototype.signinPopup=function(){var Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(Q=Object.assign({},Q)).request_type="si:p";var W=Q.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return W?(Q.redirect_uri=W,Q.display="popup",this._signin(Q,this._popupNavigator,{startUrl:W,popupWindowFeatures:Q.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:Q.popupWindowTarget||this.settings.popupWindowTarget}).then(function(fe){return fe&&(fe.profile&&fe.profile.sub?u.Log.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",fe.profile.sub):u.Log.info("UserManager.signinPopup: no sub")),fe})):(u.Log.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))},O.prototype.signinPopupCallback=function(Q){return this._signinCallback(Q,this._popupNavigator).then(function(W){return W&&(W.profile&&W.profile.sub?u.Log.info("UserManager.signinPopupCallback: successful, signed in sub: ",W.profile.sub):u.Log.info("UserManager.signinPopupCallback: no sub")),W}).catch(function(W){u.Log.error(W.message)})},O.prototype.signinSilent=function(){var Q=this,W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return W=Object.assign({},W),this._loadUser().then(function(fe){return fe&&fe.refresh_token?(W.refresh_token=fe.refresh_token,Q._useRefreshToken(W)):(W.request_type="si:s",W.id_token_hint=W.id_token_hint||Q.settings.includeIdTokenInSilentRenew&&fe&&fe.id_token,fe&&Q._settings.validateSubOnSilentRenew&&(u.Log.debug("UserManager.signinSilent, subject prior to silent renew: ",fe.profile.sub),W.current_sub=fe.profile.sub),Q._signinSilentIframe(W))})},O.prototype._useRefreshToken=function(){var Q=this,W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._tokenClient.exchangeRefreshToken(W).then(function(fe){return fe?fe.access_token?Q._loadUser().then(function(de){if(de){var q=Promise.resolve();return fe.id_token&&(q=Q._validateIdTokenFromTokenRefreshToken(de.profile,fe.id_token)),q.then(function(){return u.Log.debug("UserManager._useRefreshToken: refresh token response success"),de.id_token=fe.id_token||de.id_token,de.access_token=fe.access_token,de.refresh_token=fe.refresh_token||de.refresh_token,de.expires_in=fe.expires_in,Q.storeUser(de).then(function(){return Q._events.load(de),de})})}return null}):(u.Log.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(u.Log.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))})},O.prototype._validateIdTokenFromTokenRefreshToken=function(Q,W){var fe=this;return this._metadataService.getIssuer().then(function(de){return fe.settings.getEpochTime().then(function(q){return fe._joseUtil.validateJwtAttributes(W,de,fe._settings.client_id,fe._settings.clockSkew,q).then(function(he){return he?he.sub!==Q.sub?(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):he.auth_time&&he.auth_time!==Q.auth_time?(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):he.azp&&he.azp!==Q.azp?(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!he.azp&&Q.azp?(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))})})})},O.prototype._signinSilentIframe=function(){var Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},W=Q.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return W?(Q.redirect_uri=W,Q.prompt=Q.prompt||"none",this._signin(Q,this._iframeNavigator,{startUrl:W,silentRequestTimeout:Q.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(fe){return fe&&(fe.profile&&fe.profile.sub?u.Log.info("UserManager.signinSilent: successful, signed in sub: ",fe.profile.sub):u.Log.info("UserManager.signinSilent: no sub")),fe})):(u.Log.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},O.prototype.signinSilentCallback=function(Q){return this._signinCallback(Q,this._iframeNavigator).then(function(W){return W&&(W.profile&&W.profile.sub?u.Log.info("UserManager.signinSilentCallback: successful, signed in sub: ",W.profile.sub):u.Log.info("UserManager.signinSilentCallback: no sub")),W})},O.prototype.signinCallback=function(Q){var W=this;return this.readSigninResponseState(Q).then(function(fe){var de=fe.state;return fe.response,de.request_type==="si:r"?W.signinRedirectCallback(Q):de.request_type==="si:p"?W.signinPopupCallback(Q):de.request_type==="si:s"?W.signinSilentCallback(Q):Promise.reject(new Error("invalid response_type in state"))})},O.prototype.signoutCallback=function(Q,W){var fe=this;return this.readSignoutResponseState(Q).then(function(de){var q=de.state,he=de.response;return q?q.request_type==="so:r"?fe.signoutRedirectCallback(Q):q.request_type==="so:p"?fe.signoutPopupCallback(Q,W):Promise.reject(new Error("invalid response_type in state")):he})},O.prototype.querySessionStatus=function(){var Q=this,W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(W=Object.assign({},W)).request_type="si:s";var fe=W.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return fe?(W.redirect_uri=fe,W.prompt="none",W.response_type=W.response_type||this.settings.query_status_response_type,W.scope=W.scope||"openid",W.skipUserInfo=!0,this._signinStart(W,this._iframeNavigator,{startUrl:fe,silentRequestTimeout:W.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(de){return Q.processSigninResponse(de.url).then(function(q){if(u.Log.debug("UserManager.querySessionStatus: got signin response"),q.session_state&&q.profile.sub)return u.Log.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",q.profile.sub),{session_state:q.session_state,sub:q.profile.sub,sid:q.profile.sid};u.Log.info("querySessionStatus successful, user not authenticated")}).catch(function(q){if(q.session_state&&Q.settings.monitorAnonymousSession&&(q.message=="login_required"||q.message=="consent_required"||q.message=="interaction_required"||q.message=="account_selection_required"))return u.Log.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:q.session_state};throw q})})):(u.Log.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},O.prototype._signin=function(Q,W){var fe=this,de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signinStart(Q,W,de).then(function(q){return fe._signinEnd(q.url,Q)})},O.prototype._signinStart=function(Q,W){var fe=this,de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return W.prepare(de).then(function(q){return u.Log.debug("UserManager._signinStart: got navigator window handle"),fe.createSigninRequest(Q).then(function(he){return u.Log.debug("UserManager._signinStart: got signin request"),de.url=he.url,de.id=he.state.id,q.navigate(de)}).catch(function(he){throw q.close&&(u.Log.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),q.close()),he})})},O.prototype._signinEnd=function(Q){var W=this,fe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.processSigninResponse(Q).then(function(de){u.Log.debug("UserManager._signinEnd: got signin response");var q=new f.User(de);if(fe.current_sub){if(fe.current_sub!==q.profile.sub)return u.Log.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",q.profile.sub),Promise.reject(new Error("login_required"));u.Log.debug("UserManager._signinEnd: current user matches user returned from signin")}return W.storeUser(q).then(function(){return u.Log.debug("UserManager._signinEnd: user stored"),W._events.load(q),q})})},O.prototype._signinCallback=function(Q,W){u.Log.debug("UserManager._signinCallback");var fe=this._settings.response_mode==="query"||!this._settings.response_mode&&x.SigninRequest.isCode(this._settings.response_type)?"?":"#";return W.callback(Q,void 0,fe)},O.prototype.signoutRedirect=function(){var Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(Q=Object.assign({},Q)).request_type="so:r";var W=Q.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;W&&(Q.post_logout_redirect_uri=W);var fe={useReplaceToNavigate:Q.useReplaceToNavigate};return this._signoutStart(Q,this._redirectNavigator,fe).then(function(){u.Log.info("UserManager.signoutRedirect: successful")})},O.prototype.signoutRedirectCallback=function(Q){return this._signoutEnd(Q||this._redirectNavigator.url).then(function(W){return u.Log.info("UserManager.signoutRedirectCallback: successful"),W})},O.prototype.signoutPopup=function(){var Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(Q=Object.assign({},Q)).request_type="so:p";var W=Q.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return Q.post_logout_redirect_uri=W,Q.display="popup",Q.post_logout_redirect_uri&&(Q.state=Q.state||{}),this._signout(Q,this._popupNavigator,{startUrl:W,popupWindowFeatures:Q.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:Q.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){u.Log.info("UserManager.signoutPopup: successful")})},O.prototype.signoutPopupCallback=function(Q,W){return W===void 0&&typeof Q=="boolean"&&(W=Q,Q=null),this._popupNavigator.callback(Q,W,"?").then(function(){u.Log.info("UserManager.signoutPopupCallback: successful")})},O.prototype._signout=function(Q,W){var fe=this,de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signoutStart(Q,W,de).then(function(q){return fe._signoutEnd(q.url)})},O.prototype._signoutStart=function(){var Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},W=this,fe=arguments[1],de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return fe.prepare(de).then(function(q){return u.Log.debug("UserManager._signoutStart: got navigator window handle"),W._loadUser().then(function(he){return u.Log.debug("UserManager._signoutStart: loaded current user from storage"),(W._settings.revokeAccessTokenOnSignout?W._revokeInternal(he):Promise.resolve()).then(function(){var ke=Q.id_token_hint||he&&he.id_token;return ke&&(u.Log.debug("UserManager._signoutStart: Setting id_token into signout request"),Q.id_token_hint=ke),W.removeUser().then(function(){return u.Log.debug("UserManager._signoutStart: user removed, creating signout request"),W.createSignoutRequest(Q).then(function(le){return u.Log.debug("UserManager._signoutStart: got signout request"),de.url=le.url,le.state&&(de.id=le.state.id),q.navigate(de)})})})}).catch(function(he){throw q.close&&(u.Log.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),q.close()),he})})},O.prototype._signoutEnd=function(Q){return this.processSignoutResponse(Q).then(function(W){return u.Log.debug("UserManager._signoutEnd: got signout response"),W})},O.prototype.revokeAccessToken=function(){var Q=this;return this._loadUser().then(function(W){return Q._revokeInternal(W,!0).then(function(fe){if(fe)return u.Log.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),W.access_token=null,W.refresh_token=null,W.expires_at=null,W.token_type=null,Q.storeUser(W).then(function(){u.Log.debug("UserManager.revokeAccessToken: user stored"),Q._events.load(W)})})}).then(function(){u.Log.info("UserManager.revokeAccessToken: access token revoked successfully")})},O.prototype._revokeInternal=function(Q,W){var fe=this;if(Q){var de=Q.access_token,q=Q.refresh_token;return this._revokeAccessTokenInternal(de,W).then(function(he){return fe._revokeRefreshTokenInternal(q,W).then(function(ke){return he||ke||u.Log.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),he||ke})})}return Promise.resolve(!1)},O.prototype._revokeAccessTokenInternal=function(Q,W){return!Q||Q.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke(Q,W).then(function(){return!0})},O.prototype._revokeRefreshTokenInternal=function(Q,W){return Q?this._tokenRevocationClient.revoke(Q,W,"refresh_token").then(function(){return!0}):Promise.resolve(!1)},O.prototype.startSilentRenew=function(){this._silentRenewService.start()},O.prototype.stopSilentRenew=function(){this._silentRenewService.stop()},O.prototype._loadUser=function(){return this._userStore.get(this._userStoreKey).then(function(Q){return Q?(u.Log.debug("UserManager._loadUser: user storageString loaded"),f.User.fromStorageString(Q)):(u.Log.debug("UserManager._loadUser: no user storageString"),null)})},O.prototype.storeUser=function(Q){if(Q){u.Log.debug("UserManager.storeUser: storing user");var W=Q.toStorageString();return this._userStore.set(this._userStoreKey,W)}return u.Log.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},c(O,[{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),O}(l.OidcClient)},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.UserManagerSettings=void 0;var c=function(){function I(R,C){for(var L=0;L<C.length;L++){var N=C[L];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(R,N.key,N)}}return function(R,C,L){return C&&I(R.prototype,C),L&&I(R,L),R}}(),u=(o(0),o(5)),l=o(40),g=o(41),f=o(43),h=o(6),p=o(1),v=o(8);function x(I,R){if(!(I instanceof R))throw new TypeError("Cannot call a class as a function")}function F(I,R){if(!I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!R||typeof R!="object"&&typeof R!="function"?I:R}n.UserManagerSettings=function(I){function R(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},L=C.popup_redirect_uri,N=C.popup_post_logout_redirect_uri,O=C.popupWindowFeatures,Y=C.popupWindowTarget,Q=C.silent_redirect_uri,W=C.silentRequestTimeout,fe=C.automaticSilentRenew,de=fe!==void 0&&fe,q=C.validateSubOnSilentRenew,he=q!==void 0&&q,ke=C.includeIdTokenInSilentRenew,le=ke===void 0||ke,Ue=C.monitorSession,Te=Ue===void 0||Ue,Ne=C.monitorAnonymousSession,Oe=Ne!==void 0&&Ne,He=C.checkSessionInterval,Fe=He===void 0?2e3:He,Pe=C.stopCheckSessionOnError,Ae=Pe===void 0||Pe,Me=C.query_status_response_type,Ie=C.revokeAccessTokenOnSignout,We=Ie!==void 0&&Ie,it=C.accessTokenExpiringNotificationTime,wt=it===void 0?60:it,st=C.redirectNavigator,Ge=st===void 0?new l.RedirectNavigator:st,Qe=C.popupNavigator,Je=Qe===void 0?new g.PopupNavigator:Qe,X=C.iframeNavigator,E=X===void 0?new f.IFrameNavigator:X,m=C.userStore,A=m===void 0?new h.WebStorageStateStore({store:p.Global.sessionStorage}):m;x(this,R);var D=F(this,I.call(this,arguments[0]));return D._popup_redirect_uri=L,D._popup_post_logout_redirect_uri=N,D._popupWindowFeatures=O,D._popupWindowTarget=Y,D._silent_redirect_uri=Q,D._silentRequestTimeout=W,D._automaticSilentRenew=de,D._validateSubOnSilentRenew=he,D._includeIdTokenInSilentRenew=le,D._accessTokenExpiringNotificationTime=wt,D._monitorSession=Te,D._monitorAnonymousSession=Oe,D._checkSessionInterval=Fe,D._stopCheckSessionOnError=Ae,Me?D._query_status_response_type=Me:arguments[0]&&arguments[0].response_type?D._query_status_response_type=v.SigninRequest.isOidc(arguments[0].response_type)?"id_token":"code":D._query_status_response_type="id_token",D._revokeAccessTokenOnSignout=We,D._redirectNavigator=Ge,D._popupNavigator=Je,D._iframeNavigator=E,D._userStore=A,D}return function(L,N){if(typeof N!="function"&&N!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof N);L.prototype=Object.create(N&&N.prototype,{constructor:{value:L,enumerable:!1,writable:!0,configurable:!0}}),N&&(Object.setPrototypeOf?Object.setPrototypeOf(L,N):L.__proto__=N)}(R,I),c(R,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),R}(u.OidcClientSettings)},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.RedirectNavigator=void 0;var c=function(){function l(g,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(g,p.key,p)}}return function(g,f,h){return f&&l(g.prototype,f),h&&l(g,h),g}}(),u=o(0);n.RedirectNavigator=function(){function l(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.prepare=function(){return Promise.resolve(this)},l.prototype.navigate=function(f){return f&&f.url?(f.useReplaceToNavigate?window.location.replace(f.url):window.location=f.url,Promise.resolve()):(u.Log.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))},c(l,[{key:"url",get:function(){return window.location.href}}]),l}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.PopupNavigator=void 0;var c=o(0),u=o(42);n.PopupNavigator=function(){function l(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.prepare=function(f){var h=new u.PopupWindow(f);return Promise.resolve(h)},l.prototype.callback=function(f,h,p){c.Log.debug("PopupNavigator.callback");try{return u.PopupWindow.notifyOpener(f,h,p),Promise.resolve()}catch(v){return Promise.reject(v)}},l}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.PopupWindow=void 0;var c=function(){function g(f,h){for(var p=0;p<h.length;p++){var v=h[p];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(f,v.key,v)}}return function(f,h,p){return h&&g(f.prototype,h),p&&g(f,p),f}}(),u=o(0),l=o(3);n.PopupWindow=function(){function g(f){var h=this;(function(F,I){if(!(F instanceof I))throw new TypeError("Cannot call a class as a function")})(this,g),this._promise=new Promise(function(x,F){h._resolve=x,h._reject=F});var p=f.popupWindowTarget||"_blank",v=f.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",p,v),this._popup&&(u.Log.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}return g.prototype.navigate=function(h){return this._popup?h&&h.url?(u.Log.debug("PopupWindow.navigate: Setting URL in popup"),this._id=h.id,this._id&&(window["popupCallback_"+h.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=h.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},g.prototype._success=function(h){u.Log.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(h)},g.prototype._error=function(h){u.Log.error("PopupWindow.error: ",h),this._cleanup(),this._reject(new Error(h))},g.prototype.close=function(){this._cleanup(!1)},g.prototype._cleanup=function(h){u.Log.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!h&&this._popup.close(),this._popup=null},g.prototype._checkForPopupClosed=function(){this._popup&&!this._popup.closed||this._error("Popup window closed")},g.prototype._callback=function(h,p){this._cleanup(p),h?(u.Log.debug("PopupWindow.callback success"),this._success({url:h})):(u.Log.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},g.notifyOpener=function(h,p,v){if(window.opener){if(h=h||window.location.href){var x=l.UrlUtility.parseUrlFragment(h,v);if(x.state){var F="popupCallback_"+x.state,I=window.opener[F];I?(u.Log.debug("PopupWindow.notifyOpener: passing url message to opener"),I(h,p)):u.Log.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else u.Log.warn("PopupWindow.notifyOpener: no state found in response url")}}else u.Log.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},c(g,[{key:"promise",get:function(){return this._promise}}]),g}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.IFrameNavigator=void 0;var c=o(0),u=o(44);n.IFrameNavigator=function(){function l(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.prepare=function(f){var h=new u.IFrameWindow(f);return Promise.resolve(h)},l.prototype.callback=function(f){c.Log.debug("IFrameNavigator.callback");try{return u.IFrameWindow.notifyParent(f),Promise.resolve()}catch(h){return Promise.reject(h)}},l}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.IFrameWindow=void 0;var c=function(){function l(g,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(g,p.key,p)}}return function(g,f,h){return f&&l(g.prototype,f),h&&l(g,h),g}}(),u=o(0);n.IFrameWindow=function(){function l(g){var f=this;(function(p,v){if(!(p instanceof v))throw new TypeError("Cannot call a class as a function")})(this,l),this._promise=new Promise(function(h,p){f._resolve=h,f._reject=p}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.width=0,this._frame.height=0,window.document.body.appendChild(this._frame)}return l.prototype.navigate=function(f){if(f&&f.url){var h=f.silentRequestTimeout||1e4;u.Log.debug("IFrameWindow.navigate: Using timeout of:",h),this._timer=window.setTimeout(this._timeout.bind(this),h),this._frame.src=f.url}else this._error("No url provided");return this.promise},l.prototype._success=function(f){this._cleanup(),u.Log.debug("IFrameWindow: Successful response from frame window"),this._resolve(f)},l.prototype._error=function(f){this._cleanup(),u.Log.error(f),this._reject(new Error(f))},l.prototype.close=function(){this._cleanup()},l.prototype._cleanup=function(){this._frame&&(u.Log.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},l.prototype._timeout=function(){u.Log.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},l.prototype._message=function(f){if(u.Log.debug("IFrameWindow.message"),this._timer&&f.origin===this._origin&&f.source===this._frame.contentWindow&&typeof f.data=="string"&&(f.data.startsWith("http://")||f.data.startsWith("https://"))){var h=f.data;h?this._success({url:h}):this._error("Invalid response from frame")}},l.notifyParent=function(f){u.Log.debug("IFrameWindow.notifyParent"),(f=f||window.location.href)&&(u.Log.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(f,location.protocol+"//"+location.host))},c(l,[{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}]),l}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.UserManagerEvents=void 0;var c=o(0),u=o(16),l=o(17);n.UserManagerEvents=function(g){function f(h){(function(x,F){if(!(x instanceof F))throw new TypeError("Cannot call a class as a function")})(this,f);var p=function(x,F){if(!x)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!F||typeof F!="object"&&typeof F!="function"?x:F}(this,g.call(this,h));return p._userLoaded=new l.Event("User loaded"),p._userUnloaded=new l.Event("User unloaded"),p._silentRenewError=new l.Event("Silent renew error"),p._userSignedIn=new l.Event("User signed in"),p._userSignedOut=new l.Event("User signed out"),p._userSessionChanged=new l.Event("User session changed"),p}return function(p,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);p.prototype=Object.create(v&&v.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(p,v):p.__proto__=v)}(f,g),f.prototype.load=function(p){var v=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];c.Log.debug("UserManagerEvents.load"),g.prototype.load.call(this,p),v&&this._userLoaded.raise(p)},f.prototype.unload=function(){c.Log.debug("UserManagerEvents.unload"),g.prototype.unload.call(this),this._userUnloaded.raise()},f.prototype.addUserLoaded=function(p){this._userLoaded.addHandler(p)},f.prototype.removeUserLoaded=function(p){this._userLoaded.removeHandler(p)},f.prototype.addUserUnloaded=function(p){this._userUnloaded.addHandler(p)},f.prototype.removeUserUnloaded=function(p){this._userUnloaded.removeHandler(p)},f.prototype.addSilentRenewError=function(p){this._silentRenewError.addHandler(p)},f.prototype.removeSilentRenewError=function(p){this._silentRenewError.removeHandler(p)},f.prototype._raiseSilentRenewError=function(p){c.Log.debug("UserManagerEvents._raiseSilentRenewError",p.message),this._silentRenewError.raise(p)},f.prototype.addUserSignedIn=function(p){this._userSignedIn.addHandler(p)},f.prototype.removeUserSignedIn=function(p){this._userSignedIn.removeHandler(p)},f.prototype._raiseUserSignedIn=function(){c.Log.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},f.prototype.addUserSignedOut=function(p){this._userSignedOut.addHandler(p)},f.prototype.removeUserSignedOut=function(p){this._userSignedOut.removeHandler(p)},f.prototype._raiseUserSignedOut=function(){c.Log.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},f.prototype.addUserSessionChanged=function(p){this._userSessionChanged.addHandler(p)},f.prototype.removeUserSessionChanged=function(p){this._userSessionChanged.removeHandler(p)},f.prototype._raiseUserSessionChanged=function(){c.Log.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},f}(u.AccessTokenEvents)},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.Timer=void 0;var c=function(){function p(v,x){for(var F=0;F<x.length;F++){var I=x[F];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(v,I.key,I)}}return function(v,x,F){return x&&p(v.prototype,x),F&&p(v,F),v}}(),u=o(0),l=o(1),g=o(17);function f(p,v){if(!(p instanceof v))throw new TypeError("Cannot call a class as a function")}function h(p,v){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!v||typeof v!="object"&&typeof v!="function"?p:v}n.Timer=function(p){function v(x){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.Global.timer,I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;f(this,v);var R=h(this,p.call(this,x));return R._timer=F,R._nowFunc=I||function(){return Date.now()/1e3},R}return function(F,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof I);F.prototype=Object.create(I&&I.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(F,I):F.__proto__=I)}(v,p),v.prototype.init=function(F){F<=0&&(F=1),F=parseInt(F);var I=this.now+F;if(this.expiration===I&&this._timerHandle)u.Log.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),u.Log.debug("Timer.init timer "+this._name+" for duration:",F),this._expiration=I;var R=5;F<R&&(R=F),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*R)}},v.prototype.cancel=function(){this._timerHandle&&(u.Log.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},v.prototype._callback=function(){var F=this._expiration-this.now;u.Log.debug("Timer.callback; "+this._name+" timer expires in:",F),this._expiration<=this.now&&(this.cancel(),p.prototype.raise.call(this))},c(v,[{key:"now",get:function(){return parseInt(this._nowFunc())}},{key:"expiration",get:function(){return this._expiration}}]),v}(g.Event)},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.SilentRenewService=void 0;var c=o(0);n.SilentRenewService=function(){function u(l){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,u),this._userManager=l}return u.prototype.start=function(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(function(g){}).catch(function(g){c.Log.error("SilentRenewService.start: Error from getUser:",g.message)}))},u.prototype.stop=function(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},u.prototype._tokenExpiring=function(){var g=this;this._userManager.signinSilent().then(function(f){c.Log.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},function(f){c.Log.error("SilentRenewService._tokenExpiring: Error from signinSilent:",f.message),g._userManager.events._raiseSilentRenewError(f)})},u}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.CordovaPopupNavigator=void 0;var c=o(21);n.CordovaPopupNavigator=function(){function u(){(function(g,f){if(!(g instanceof f))throw new TypeError("Cannot call a class as a function")})(this,u)}return u.prototype.prepare=function(g){var f=new c.CordovaPopupWindow(g);return Promise.resolve(f)},u}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.CordovaIFrameNavigator=void 0;var c=o(21);n.CordovaIFrameNavigator=function(){function u(){(function(g,f){if(!(g instanceof f))throw new TypeError("Cannot call a class as a function")})(this,u)}return u.prototype.prepare=function(g){g.popupWindowFeatures="hidden=yes";var f=new c.CordovaPopupWindow(g);return Promise.resolve(f)},u}()},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.Version="1.11.6"}])})})(Yu);var Ds=Yu.exports;function wf(t,e){var r;throw t.error==="invalid_redirect_uri"?new Error(`Dynamic client registration failed: the provided redirect uri [${(r=e.redirectUrl)==null?void 0:r.toString()}] is invalid - ${t.error_description??""}`):t.error==="invalid_client_metadata"?new Error(`Dynamic client registration failed: the provided client metadata ${JSON.stringify(e)} is invalid - ${t.error_description??""}`):new Error(`Dynamic client registration failed: ${t.error} - ${t.error_description??""}`)}function vf(t){return typeof t.client_id=="string"}function Sf(t){return Array.isArray(t.redirect_uris)&&t.redirect_uris.every(e=>typeof e=="string")}function Ef(t,e){if(!vf(t))throw new Error(`Dynamic client registration failed: no client_id has been found on ${JSON.stringify(t)}`);if(e.redirectUrl&&Sf(t)&&t.redirect_uris[0]!==e.redirectUrl.toString())throw new Error(`Dynamic client registration failed: the returned redirect URIs ${JSON.stringify(t.redirect_uris)} don't match the provided ${JSON.stringify([e.redirectUrl.toString()])}`);return!0}async function xf(t,e){var u;if(!e.registrationEndpoint)throw new Error("Dynamic Registration could not be completed because the issuer has no registration endpoint.");if(!Array.isArray(e.idTokenSigningAlgValuesSupported))throw new Error("The OIDC issuer discovery profile is missing the 'id_token_signing_alg_values_supported' value, which is mandatory.");const r=Wd(e.idTokenSigningAlgValuesSupported,Ei),n={client_name:t.clientName,application_type:"web",redirect_uris:[(u=t.redirectUrl)==null?void 0:u.toString()],subject_type:"public",token_endpoint_auth_method:"client_secret_basic",id_token_signed_response_alg:r,grant_types:["authorization_code","refresh_token"]},o={"Content-Type":"application/json"},c=await fetch(e.registrationEndpoint.toString(),{method:"POST",headers:o,body:JSON.stringify(n)});if(c.ok){const l=await c.json();return Ef(l,t),{clientId:l.client_id,clientSecret:l.client_secret,expiresAt:l.client_secret_expires_at,idTokenSignedResponseAlg:l.id_token_signed_response_alg,clientType:"dynamic"}}throw c.status===400&&wf(await c.json(),t),new Error(`Dynamic client registration failed: the server returned ${c.status} ${c.statusText} - ${await c.text()}`)}function Ff(t){return t.error!==void 0&&typeof t.error=="string"}function Jo(t){return t.error_description!==void 0&&typeof t.error_description=="string"}function Af(t){return t.error_uri!==void 0&&typeof t.error_uri=="string"}function If(t){return t.access_token!==void 0&&typeof t.access_token=="string"}function Tf(t){return t.id_token!==void 0&&typeof t.id_token=="string"}function Rf(t){return t.refresh_token!==void 0&&typeof t.refresh_token=="string"}function Pf(t){return t.token_type!==void 0&&typeof t.token_type=="string"}function kf(t){return t.expires_in===void 0||typeof t.expires_in=="number"}function Cf(t,e){if(e.grantType&&(!t.grantTypesSupported||!t.grantTypesSupported.includes(e.grantType)))throw new Error(`The issuer [${t.issuer}] does not support the [${e.grantType}] grant`);if(!t.tokenEndpoint)throw new Error(`This issuer [${t.issuer}] does not have a token endpoint`)}function Xu(t,e){if(Ff(t))throw new Mu(`Token endpoint returned error [${t.error}]${Jo(t)?`: ${t.error_description}`:""}${Af(t)?` (see ${t.error_uri})`:""}`,t.error,Jo(t)?t.error_description:void 0);if(!If(t))throw new $n(["access_token"]);if(!Tf(t))throw new $n(["id_token"]);if(!Pf(t))throw new $n(["token_type"]);if(!kf(t))throw new $n(["expires_in"]);if(!e&&t.token_type.toLowerCase()!=="bearer")throw new Error(`Invalid token endpoint response: requested a [Bearer] token, but got a 'token_type' value of [${t.token_type}].`);return t}async function Nf(t,e,r,n){Cf(t,r);const o={"content-type":"application/x-www-form-urlencoded"};let c;n&&(c=await ef(),o.DPoP=await uo(t.tokenEndpoint,"POST",c)),e.clientSecret&&(o.Authorization=`Basic ${btoa(`${e.clientId}:${e.clientSecret}`)}`);const u={grant_type:r.grantType,redirect_uri:r.redirectUrl,code:r.code,code_verifier:r.codeVerifier,client_id:e.clientId},l={method:"POST",headers:o,body:new URLSearchParams(u).toString()},f=await(await fetch(t.tokenEndpoint,l)).json(),h=Xu(f,n),{webId:p,clientId:v}=await Nu(h.id_token,t.jwksUri,t.issuer,e.clientId);return{accessToken:h.access_token,idToken:h.id_token,refreshToken:Rf(h)?h.refresh_token:void 0,webId:p,clientId:v,dpopKey:c,expiresIn:h.expires_in}}const Lf=t=>{try{return new URL(t),!0}catch{return!1}};async function Df(t,e,r,n){if(r.clientId===void 0)throw new Error("No client ID available when trying to refresh the access token.");const o={grant_type:"refresh_token",refresh_token:t,scope:Cu};let c={};n!==void 0&&(c={DPoP:await uo(e.tokenEndpoint,"POST",n)});let u={};r.clientSecret!==void 0?u={Authorization:`Basic ${btoa(`${r.clientId}:${r.clientSecret}`)}`}:Lf(r.clientId)&&(o.client_id=r.clientId);const l=await fetch(e.tokenEndpoint,{method:"POST",body:new URLSearchParams(o).toString(),headers:{...c,...u,"Content-Type":"application/x-www-form-urlencoded"}});let g;try{g=await l.json()}catch{throw new Error(`The token endpoint of issuer ${e.issuer} returned a malformed response.`)}const f=Xu(g,n!==void 0),{webId:h}=await Nu(f.id_token,e.jwksUri,e.issuer,r.clientId);return{accessToken:f.access_token,idToken:f.id_token,refreshToken:typeof f.refresh_token=="string"?f.refresh_token:void 0,webId:h,dpopKey:n,expiresIn:f.expires_in}}function Uf(t){const e=Du(t);return e.hash="",t.includes(`${e.origin}/`)?e.href:`${e.origin}${e.href.substring(e.origin.length+1)}`}async function Of(){await new Ds.OidcClient({response_mode:"query"}).clearStaleState(new Ds.WebStorageStateStore({}));const e=window.localStorage,r=[];for(let n=0;n<=e.length;n+=1){const o=e.key(n);o&&(o.match(/^oidc\..+$/)||o.match(/^solidClientAuthenticationUser:.+$/))&&r.push(o)}r.forEach(n=>e.removeItem(n))}class Bf extends Yd{constructor(e,r){super(e,r)}}class jf extends Gd{constructor(){super(...arguments);Le(this,"login",async(r,n)=>{r.prompt!=="none"&&await this.sessionInfoManager.clear(r.sessionId);const o=r.redirectUrl??Uf(window.location.href);if(!Lu(o))throw new Error(`${o} is not a valid redirect URL, it is either a malformed IRI, includes a hash fragment, or reserved query parameters ('code' or 'state').`);await this.loginHandler.handle({...r,redirectUrl:o,clientName:r.clientName??r.clientId,eventEmitter:n})});Le(this,"validateCurrentSession",async r=>{const n=await this.sessionInfoManager.get(r);return n===void 0||n.clientAppId===void 0||n.issuer===void 0?null:n});Le(this,"handleIncomingRedirect",async(r,n)=>{try{const o=await this.redirectHandler.handle(r,n,void 0);return this.fetch=o.fetch.bind(window),this.boundLogout=o.getLogoutUrl,await this.cleanUrlAfterRedirect(r),{isLoggedIn:o.isLoggedIn,webId:o.webId,sessionId:o.sessionId,expirationDate:o.expirationDate,clientAppId:o.clientAppId}}catch(o){await this.cleanUrlAfterRedirect(r),n.emit(Ft.ERROR,"redirect",o);return}})}async cleanUrlAfterRedirect(r){const n=Du(r).href;for(window.history.replaceState(null,"",n);window.location.href!==n;)await new Promise(o=>{setTimeout(()=>o(),1)})}}function zo(t){return typeof t.oidcIssuer=="string"}function Go(t){return typeof t.redirectUrl=="string"}class Mf{constructor(e,r,n,o){Le(this,"storageUtility");Le(this,"oidcHandler");Le(this,"issuerConfigFetcher");Le(this,"clientRegistrar");this.storageUtility=e,this.oidcHandler=r,this.issuerConfigFetcher=n,this.clientRegistrar=o,this.storageUtility=e,this.oidcHandler=r,this.issuerConfigFetcher=n,this.clientRegistrar=o}async canHandle(e){return zo(e)&&Go(e)}async handle(e){if(!zo(e))throw new Ls(`OidcLoginHandler requires an OIDC issuer: missing property 'oidcIssuer' in ${JSON.stringify(e)}`);if(!Go(e))throw new Ls(`OidcLoginHandler requires a redirect URL: missing property 'redirectUrl' in ${JSON.stringify(e)}`);const r=await this.issuerConfigFetcher.fetchConfig(e.oidcIssuer),n=await zd(e,r,this.storageUtility,this.clientRegistrar),o={issuer:r.issuer,dpop:e.tokenType.toLowerCase()==="dpop",...e,issuerConfiguration:r,client:n};return this.oidcHandler.handle(o)}}class Hf extends Ud{async handle(e){const r={authority:e.issuer.toString(),client_id:e.client.clientId,client_secret:e.client.clientSecret,redirect_uri:e.redirectUrl,response_type:"code",scope:Cu,filterProtocolClaims:!0,loadUserInfo:!1,code_verifier:!0,prompt:e.prompt??"consent"},n=new Ds.OidcClient(r);try{const o=await n.createSigninRequest();return await this.setupRedirectHandler({oidcLoginOptions:e,state:o.state._id,codeVerifier:o.state._code_verifier,targetUrl:o.url.toString()})}catch(o){console.error(o)}}}const $f=".well-known/openid-configuration",Qo={issuer:{toKey:"issuer",convertToUrl:!0},authorization_endpoint:{toKey:"authorizationEndpoint",convertToUrl:!0},token_endpoint:{toKey:"tokenEndpoint",convertToUrl:!0},userinfo_endpoint:{toKey:"userinfoEndpoint",convertToUrl:!0},jwks_uri:{toKey:"jwksUri",convertToUrl:!0},registration_endpoint:{toKey:"registrationEndpoint",convertToUrl:!0},end_session_endpoint:{toKey:"endSessionEndpoint",convertToUrl:!0},scopes_supported:{toKey:"scopesSupported"},response_types_supported:{toKey:"responseTypesSupported"},response_modes_supported:{toKey:"responseModesSupported"},grant_types_supported:{toKey:"grantTypesSupported"},acr_values_supported:{toKey:"acrValuesSupported"},subject_types_supported:{toKey:"subjectTypesSupported"},id_token_signing_alg_values_supported:{toKey:"idTokenSigningAlgValuesSupported"},id_token_encryption_alg_values_supported:{toKey:"idTokenEncryptionAlgValuesSupported"},id_token_encryption_enc_values_supported:{toKey:"idTokenEncryptionEncValuesSupported"},userinfo_signing_alg_values_supported:{toKey:"userinfoSigningAlgValuesSupported"},userinfo_encryption_alg_values_supported:{toKey:"userinfoEncryptionAlgValuesSupported"},userinfo_encryption_enc_values_supported:{toKey:"userinfoEncryptionEncValuesSupported"},request_object_signing_alg_values_supported:{toKey:"requestObjectSigningAlgValuesSupported"},request_object_encryption_alg_values_supported:{toKey:"requestObjectEncryptionAlgValuesSupported"},request_object_encryption_enc_values_supported:{toKey:"requestObjectEncryptionEncValuesSupported"},token_endpoint_auth_methods_supported:{toKey:"tokenEndpointAuthMethodsSupported"},token_endpoint_auth_signing_alg_values_supported:{toKey:"tokenEndpointAuthSigningAlgValuesSupported"},display_values_supported:{toKey:"displayValuesSupported"},claim_types_supported:{toKey:"claimTypesSupported"},claims_supported:{toKey:"claimsSupported"},service_documentation:{toKey:"serviceDocumentation"},claims_locales_supported:{toKey:"claimsLocalesSupported"},ui_locales_supported:{toKey:"uiLocalesSupported"},claims_parameter_supported:{toKey:"claimsParameterSupported"},request_parameter_supported:{toKey:"requestParameterSupported"},request_uri_parameter_supported:{toKey:"requestUriParameterSupported"},require_request_uri_registration:{toKey:"requireRequestUriRegistration"},op_policy_uri:{toKey:"opPolicyUri",convertToUrl:!0},op_tos_uri:{toKey:"opTosUri",convertToUrl:!0}};function Kf(t){const e={};return Object.keys(t).forEach(r=>{Qo[r]&&(e[Qo[r].toKey]=t[r])}),Array.isArray(e.scopesSupported)||(e.scopesSupported=["openid"]),e}class lo{constructor(e){Le(this,"storageUtility");this.storageUtility=e,this.storageUtility=e}static getLocalStorageKey(e){return`issuerConfig:${e}`}async fetchConfig(e){let r;const n=new URL($f,e.endsWith("/")?e:`${e}/`).href,o=await fetch(n);try{r=Kf(await o.json())}catch(c){throw new Ls(`[${e.toString()}] has an invalid configuration: ${c.message}`)}return await this.storageUtility.set(lo.getLocalStorageKey(e),JSON.stringify(r)),r}}async function Wf(t,e){await Ou(t,e),await Of()}class Vf extends Md{async get(e){const[r,n,o,c,u,l,g,f]=await Promise.all([this.storageUtility.getForUser(e,"isLoggedIn",{secure:!0}),this.storageUtility.getForUser(e,"webId",{secure:!0}),this.storageUtility.getForUser(e,"clientId",{secure:!1}),this.storageUtility.getForUser(e,"clientSecret",{secure:!1}),this.storageUtility.getForUser(e,"redirectUrl",{secure:!1}),this.storageUtility.getForUser(e,"refreshToken",{secure:!0}),this.storageUtility.getForUser(e,"issuer",{secure:!1}),this.storageUtility.getForUser(e,"tokenType",{secure:!1})]);if(typeof u=="string"&&!Lu(u)){await Promise.all([this.storageUtility.deleteAllUserData(e,{secure:!1}),this.storageUtility.deleteAllUserData(e,{secure:!0})]);return}if(f!==void 0&&!Kd(f))throw new Error(`Tokens of type [${f}] are not supported.`);if(!(o===void 0&&r===void 0&&n===void 0&&l===void 0))return{sessionId:e,webId:n,isLoggedIn:r==="true",redirectUrl:u,refreshToken:l,issuer:g,clientAppId:o,clientAppSecret:c,tokenType:f??"DPoP"}}async clear(e){return Wf(e,this.storageUtility)}}class qf{async canHandle(e){try{return new URL(e),!0}catch(r){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${r}`)}}async handle(e){return Uu()}}class Jf{constructor(e,r,n,o,c){Le(this,"storageUtility");Le(this,"sessionInfoManager");Le(this,"issuerConfigFetcher");Le(this,"clientRegistrar");Le(this,"tokerRefresher");this.storageUtility=e,this.sessionInfoManager=r,this.issuerConfigFetcher=n,this.clientRegistrar=o,this.tokerRefresher=c,this.storageUtility=e,this.sessionInfoManager=r,this.issuerConfigFetcher=n,this.clientRegistrar=o,this.tokerRefresher=c}async canHandle(e){try{const r=new URL(e);return r.searchParams.get("code")!==null&&r.searchParams.get("state")!==null}catch(r){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${r}`)}}async handle(e,r){if(!await this.canHandle(e))throw new Error(`AuthCodeRedirectHandler cannot handle [${e}]: it is missing one of [code, state].`);const n=new URL(e),o=n.searchParams.get("state"),c=await this.storageUtility.getForUser(o,"sessionId",{errorIfNull:!0}),{issuerConfig:u,codeVerifier:l,redirectUrl:g,dpop:f}=await ju(c,this.storageUtility,this.issuerConfigFetcher),h=n.searchParams.get("iss");if(typeof h=="string"&&h!==u.issuer)throw new Error(`The value of the iss parameter (${h}) does not match the issuer identifier of the authorization server (${u.issuer}). See [rfc9207](https://www.rfc-editor.org/rfc/rfc9207.html#section-2.3-3.1.1)`);if(l===void 0)throw new Error(`The code verifier for session ${c} is missing from storage.`);if(g===void 0)throw new Error(`The redirect URL for session ${c} is missing from storage.`);const p=await this.clientRegistrar.getClient({sessionId:c},u),v=Date.now(),x=await Nf(u,p,{grantType:"authorization_code",code:n.searchParams.get("code"),codeVerifier:l,redirectUrl:g},f);window.localStorage.removeItem(`oidc.${o}`);let F;x.refreshToken!==void 0&&(F={sessionId:c,refreshToken:x.refreshToken,tokenRefresher:this.tokerRefresher});const I=of(x.accessToken,{dpopKey:x.dpopKey,refreshOptions:F,eventEmitter:r,expiresIn:x.expiresIn});await Qd(this.storageUtility,c,x.webId,x.clientId,"true",void 0,!0);const R=await this.sessionInfoManager.get(c);if(!R)throw new Error(`Could not retrieve session: [${c}].`);return Object.assign(R,{fetch:I,getLogoutUrl:$d({idTokenHint:x.idToken,endSessionEndpoint:u.endSessionEndpoint}),expirationDate:typeof x.expiresIn=="number"?v+x.expiresIn*1e3:void 0})}}class zf extends Ld{constructor(e){super(e)}}class Gf{get storage(){return window.localStorage}async get(e){return this.storage.getItem(e)||void 0}async set(e,r){this.storage.setItem(e,r)}async delete(e){this.storage.removeItem(e)}}class Qf{redirect(e,r){r&&r.handleRedirect?r.handleRedirect(e):r&&r.redirectByReplacingState?window.history.replaceState({},"",e):window.location.href=e}}class Yf{constructor(e){Le(this,"storageUtility");this.storageUtility=e,this.storageUtility=e}async getClient(e,r){const[n,o,c,u,l]=await Promise.all([this.storageUtility.getForUser(e.sessionId,"clientId",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientSecret",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"expiresAt",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientName",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientType",{secure:!1})]),g=c!==void 0?Number.parseInt(c,10):-1,f=o!==void 0&&Math.floor(Date.now()/1e3)>g;if(n&&Jd(l)&&!f)return o!==void 0?{clientId:n,clientSecret:o,clientName:u,clientType:"dynamic",expiresAt:g}:{clientId:n,clientName:u,clientType:l};try{const h=await xf(e,r),p={clientId:h.clientId,clientType:"dynamic"};return h.clientSecret!==void 0&&(p.clientSecret=h.clientSecret,p.expiresAt=String(h.expiresAt)),h.idTokenSignedResponseAlg&&(p.idTokenSignedResponseAlg=h.idTokenSignedResponseAlg),await this.storageUtility.setForUser(e.sessionId,p,{secure:!1}),h}catch(h){throw new Error("Client registration failed.",{cause:h})}}}class Xf{async canHandle(e){try{return new URL(e).searchParams.has("error")}catch(r){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${r}`)}}async handle(e,r){if(r!==void 0){const n=new URL(e),o=n.searchParams.get("error"),c=n.searchParams.get("error_description");r.emit(Ft.ERROR,o,c)}return Uu()}}class Zf{constructor(e,r,n){Le(this,"storageUtility");Le(this,"issuerConfigFetcher");Le(this,"clientRegistrar");this.storageUtility=e,this.issuerConfigFetcher=r,this.clientRegistrar=n,this.storageUtility=e,this.issuerConfigFetcher=r,this.clientRegistrar=n}async refresh(e,r,n,o){const c=await ju(e,this.storageUtility,this.issuerConfigFetcher),u=await this.clientRegistrar.getClient({sessionId:e},c.issuerConfig);if(r===void 0)throw new Error(`Session [${e}] has no refresh token to allow it to refresh its access token.`);if(c.dpop&&n===void 0)throw new Error(`For session [${e}], the key bound to the DPoP access token must be provided to refresh said access token.`);const l=await Df(r,c.issuerConfig,u,n);return l.refreshToken!==void 0&&(o==null||o.emit(Ft.NEW_REFRESH_TOKEN,l.refreshToken)),l}}function Yo(t){const e=new Xd,r=t.secureStorage||e,n=t.insecureStorage||new Gf,o=new Bf(r,n),c=new lo(o),u=new Yf(o),l=new Vf(o),g=new Zf(o,c,u),f=new Qf,h=new Mf(o,new Hf(o,f),c,u),p=new zf([new Xf,new Jf(o,l,c,u,g),new qf]);return new jf(h,p,new jd(l,f),l,c)}const is=`${ku}currentSession`,Us=`${ku}currentUrl`;async function eh(t,e,r){const n=await e.validateCurrentSession(t);return n!==null?(window.localStorage.setItem(Us,window.location.href),await e.login({sessionId:t,prompt:"none",oidcIssuer:n.issuer,redirectUrl:n.redirectUrl,clientId:n.clientAppId,clientSecret:n.clientAppSecret,tokenType:n.tokenType??"DPoP"},r.events),!0):!1}function th(t){return!!(t!=null&&t.isLoggedIn)}class rh{constructor(e={},r=void 0){Le(this,"info");Le(this,"events");Le(this,"clientAuthentication");Le(this,"tokenRequestInProgress",!1);Le(this,"login",async e=>(await this.clientAuthentication.login({sessionId:this.info.sessionId,...e,tokenType:e.tokenType??"DPoP"},this.events),new Promise(()=>{})));Le(this,"fetch",(e,r)=>this.clientAuthentication.fetch(e,r));Le(this,"internalLogout",async(e,r)=>{window.localStorage.removeItem(is),await this.clientAuthentication.logout(this.info.sessionId,r),this.info.isLoggedIn=!1,e&&this.events.emit(Ft.LOGOUT)});Le(this,"logout",async e=>this.internalLogout(!0,e));Le(this,"handleIncomingRedirect",async(e={})=>{if(this.info.isLoggedIn)return this.info;if(this.tokenRequestInProgress)return;const r=typeof e=="string"?{url:e}:e,n=r.url??window.location.href;this.tokenRequestInProgress=!0;const o=await this.clientAuthentication.handleIncomingRedirect(n,this.events);if(th(o)){this.setSessionInfo(o);const c=window.localStorage.getItem(Us);c===null?this.events.emit(Ft.LOGIN):(window.localStorage.removeItem(Us),this.events.emit(Ft.SESSION_RESTORED,c))}else if(r.restorePreviousSession===!0){const c=window.localStorage.getItem(is);if(c!==null&&await eh(c,this.clientAuthentication,this))return new Promise(()=>{})}return this.tokenRequestInProgress=!1,o});this.events=new bf,e.clientAuthentication?this.clientAuthentication=e.clientAuthentication:e.secureStorage&&e.insecureStorage?this.clientAuthentication=Yo({secureStorage:e.secureStorage,insecureStorage:e.insecureStorage}):this.clientAuthentication=Yo({}),e.sessionInfo?this.info={sessionId:e.sessionInfo.sessionId,isLoggedIn:!1,webId:e.sessionInfo.webId,clientAppId:e.sessionInfo.clientAppId}:this.info={sessionId:r??df(),isLoggedIn:!1},this.events.on(Ft.LOGIN,()=>window.localStorage.setItem(is,this.info.sessionId)),this.events.on(Ft.SESSION_EXPIRED,()=>this.internalLogout(!1)),this.events.on(Ft.ERROR,()=>this.internalLogout(!1))}setSessionInfo(e){this.info.isLoggedIn=e.isLoggedIn,this.info.webId=e.webId,this.info.sessionId=e.sessionId,this.info.clientAppId=e.clientAppId,this.info.expirationDate=e.expirationDate,this.events.on(Ft.SESSION_EXTENDED,r=>{this.info.expirationDate=Date.now()+r*1e3})}}var pr={},Ci={};Ci.byteLength=sh;Ci.toByteArray=ah;Ci.fromByteArray=lh;var lr=[],Yt=[],nh=typeof Uint8Array<"u"?Uint8Array:Array,ss="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var an=0,ih=ss.length;an<ih;++an)lr[an]=ss[an],Yt[ss.charCodeAt(an)]=an;Yt[45]=62;Yt[95]=63;function Zu(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function sh(t){var e=Zu(t),r=e[0],n=e[1];return(r+n)*3/4-n}function oh(t,e,r){return(e+r)*3/4-r}function ah(t){var e,r=Zu(t),n=r[0],o=r[1],c=new nh(oh(t,n,o)),u=0,l=o>0?n-4:n,g;for(g=0;g<l;g+=4)e=Yt[t.charCodeAt(g)]<<18|Yt[t.charCodeAt(g+1)]<<12|Yt[t.charCodeAt(g+2)]<<6|Yt[t.charCodeAt(g+3)],c[u++]=e>>16&255,c[u++]=e>>8&255,c[u++]=e&255;return o===2&&(e=Yt[t.charCodeAt(g)]<<2|Yt[t.charCodeAt(g+1)]>>4,c[u++]=e&255),o===1&&(e=Yt[t.charCodeAt(g)]<<10|Yt[t.charCodeAt(g+1)]<<4|Yt[t.charCodeAt(g+2)]>>2,c[u++]=e>>8&255,c[u++]=e&255),c}function uh(t){return lr[t>>18&63]+lr[t>>12&63]+lr[t>>6&63]+lr[t&63]}function ch(t,e,r){for(var n,o=[],c=e;c<r;c+=3)n=(t[c]<<16&16711680)+(t[c+1]<<8&65280)+(t[c+2]&255),o.push(uh(n));return o.join("")}function lh(t){for(var e,r=t.length,n=r%3,o=[],c=16383,u=0,l=r-n;u<l;u+=c)o.push(ch(t,u,u+c>l?l:u+c));return n===1?(e=t[r-1],o.push(lr[e>>2]+lr[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],o.push(lr[e>>10]+lr[e>>4&63]+lr[e<<2&63]+"=")),o.join("")}var fo={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */fo.read=function(t,e,r,n,o){var c,u,l=o*8-n-1,g=(1<<l)-1,f=g>>1,h=-7,p=r?o-1:0,v=r?-1:1,x=t[e+p];for(p+=v,c=x&(1<<-h)-1,x>>=-h,h+=l;h>0;c=c*256+t[e+p],p+=v,h-=8);for(u=c&(1<<-h)-1,c>>=-h,h+=n;h>0;u=u*256+t[e+p],p+=v,h-=8);if(c===0)c=1-f;else{if(c===g)return u?NaN:(x?-1:1)*(1/0);u=u+Math.pow(2,n),c=c-f}return(x?-1:1)*u*Math.pow(2,c-n)};fo.write=function(t,e,r,n,o,c){var u,l,g,f=c*8-o-1,h=(1<<f)-1,p=h>>1,v=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=n?0:c-1,F=n?1:-1,I=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,u=h):(u=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-u))<1&&(u--,g*=2),u+p>=1?e+=v/g:e+=v*Math.pow(2,1-p),e*g>=2&&(u++,g/=2),u+p>=h?(l=0,u=h):u+p>=1?(l=(e*g-1)*Math.pow(2,o),u=u+p):(l=e*Math.pow(2,p-1)*Math.pow(2,o),u=0));o>=8;t[r+x]=l&255,x+=F,l/=256,o-=8);for(u=u<<o|l,f+=o;f>0;t[r+x]=u&255,x+=F,u/=256,f-=8);t[r+x-F]|=I*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=Ci,r=fo,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=L,t.INSPECT_MAX_BYTES=50;const o=2147483647;t.kMaxLength=o,l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const T=new Uint8Array(1),_={foo:function(){return 42}};return Object.setPrototypeOf(_,Uint8Array.prototype),Object.setPrototypeOf(T,_),T.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function u(T){if(T>o)throw new RangeError('The value "'+T+'" is invalid for option "size"');const _=new Uint8Array(T);return Object.setPrototypeOf(_,l.prototype),_}function l(T,_,w){if(typeof T=="number"){if(typeof _=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(T)}return g(T,_,w)}l.poolSize=8192;function g(T,_,w){if(typeof T=="string")return v(T,_);if(ArrayBuffer.isView(T))return F(T);if(T==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof T);if(_e(T,ArrayBuffer)||T&&_e(T.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(_e(T,SharedArrayBuffer)||T&&_e(T.buffer,SharedArrayBuffer)))return I(T,_,w);if(typeof T=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const b=T.valueOf&&T.valueOf();if(b!=null&&b!==T)return l.from(b,_,w);const re=R(T);if(re)return re;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof T[Symbol.toPrimitive]=="function")return l.from(T[Symbol.toPrimitive]("string"),_,w);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof T)}l.from=function(T,_,w){return g(T,_,w)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function f(T){if(typeof T!="number")throw new TypeError('"size" argument must be of type number');if(T<0)throw new RangeError('The value "'+T+'" is invalid for option "size"')}function h(T,_,w){return f(T),T<=0?u(T):_!==void 0?typeof w=="string"?u(T).fill(_,w):u(T).fill(_):u(T)}l.alloc=function(T,_,w){return h(T,_,w)};function p(T){return f(T),u(T<0?0:C(T)|0)}l.allocUnsafe=function(T){return p(T)},l.allocUnsafeSlow=function(T){return p(T)};function v(T,_){if((typeof _!="string"||_==="")&&(_="utf8"),!l.isEncoding(_))throw new TypeError("Unknown encoding: "+_);const w=N(T,_)|0;let b=u(w);const re=b.write(T,_);return re!==w&&(b=b.slice(0,re)),b}function x(T){const _=T.length<0?0:C(T.length)|0,w=u(_);for(let b=0;b<_;b+=1)w[b]=T[b]&255;return w}function F(T){if(_e(T,Uint8Array)){const _=new Uint8Array(T);return I(_.buffer,_.byteOffset,_.byteLength)}return x(T)}function I(T,_,w){if(_<0||T.byteLength<_)throw new RangeError('"offset" is outside of buffer bounds');if(T.byteLength<_+(w||0))throw new RangeError('"length" is outside of buffer bounds');let b;return _===void 0&&w===void 0?b=new Uint8Array(T):w===void 0?b=new Uint8Array(T,_):b=new Uint8Array(T,_,w),Object.setPrototypeOf(b,l.prototype),b}function R(T){if(l.isBuffer(T)){const _=C(T.length)|0,w=u(_);return w.length===0||T.copy(w,0,0,_),w}if(T.length!==void 0)return typeof T.length!="number"||tt(T.length)?u(0):x(T);if(T.type==="Buffer"&&Array.isArray(T.data))return x(T.data)}function C(T){if(T>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return T|0}function L(T){return+T!=T&&(T=0),l.alloc(+T)}l.isBuffer=function(_){return _!=null&&_._isBuffer===!0&&_!==l.prototype},l.compare=function(_,w){if(_e(_,Uint8Array)&&(_=l.from(_,_.offset,_.byteLength)),_e(w,Uint8Array)&&(w=l.from(w,w.offset,w.byteLength)),!l.isBuffer(_)||!l.isBuffer(w))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(_===w)return 0;let b=_.length,re=w.length;for(let oe=0,ne=Math.min(b,re);oe<ne;++oe)if(_[oe]!==w[oe]){b=_[oe],re=w[oe];break}return b<re?-1:re<b?1:0},l.isEncoding=function(_){switch(String(_).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(_,w){if(!Array.isArray(_))throw new TypeError('"list" argument must be an Array of Buffers');if(_.length===0)return l.alloc(0);let b;if(w===void 0)for(w=0,b=0;b<_.length;++b)w+=_[b].length;const re=l.allocUnsafe(w);let oe=0;for(b=0;b<_.length;++b){let ne=_[b];if(_e(ne,Uint8Array))oe+ne.length>re.length?(l.isBuffer(ne)||(ne=l.from(ne)),ne.copy(re,oe)):Uint8Array.prototype.set.call(re,ne,oe);else if(l.isBuffer(ne))ne.copy(re,oe);else throw new TypeError('"list" argument must be an Array of Buffers');oe+=ne.length}return re};function N(T,_){if(l.isBuffer(T))return T.length;if(ArrayBuffer.isView(T)||_e(T,ArrayBuffer))return T.byteLength;if(typeof T!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof T);const w=T.length,b=arguments.length>2&&arguments[2]===!0;if(!b&&w===0)return 0;let re=!1;for(;;)switch(_){case"ascii":case"latin1":case"binary":return w;case"utf8":case"utf-8":return te(T).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w*2;case"hex":return w>>>1;case"base64":return Re(T).length;default:if(re)return b?-1:te(T).length;_=(""+_).toLowerCase(),re=!0}}l.byteLength=N;function O(T,_,w){let b=!1;if((_===void 0||_<0)&&(_=0),_>this.length||((w===void 0||w>this.length)&&(w=this.length),w<=0)||(w>>>=0,_>>>=0,w<=_))return"";for(T||(T="utf8");;)switch(T){case"hex":return Fe(this,_,w);case"utf8":case"utf-8":return Ue(this,_,w);case"ascii":return Oe(this,_,w);case"latin1":case"binary":return He(this,_,w);case"base64":return le(this,_,w);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Pe(this,_,w);default:if(b)throw new TypeError("Unknown encoding: "+T);T=(T+"").toLowerCase(),b=!0}}l.prototype._isBuffer=!0;function Y(T,_,w){const b=T[_];T[_]=T[w],T[w]=b}l.prototype.swap16=function(){const _=this.length;if(_%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let w=0;w<_;w+=2)Y(this,w,w+1);return this},l.prototype.swap32=function(){const _=this.length;if(_%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let w=0;w<_;w+=4)Y(this,w,w+3),Y(this,w+1,w+2);return this},l.prototype.swap64=function(){const _=this.length;if(_%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let w=0;w<_;w+=8)Y(this,w,w+7),Y(this,w+1,w+6),Y(this,w+2,w+5),Y(this,w+3,w+4);return this},l.prototype.toString=function(){const _=this.length;return _===0?"":arguments.length===0?Ue(this,0,_):O.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(_){if(!l.isBuffer(_))throw new TypeError("Argument must be a Buffer");return this===_?!0:l.compare(this,_)===0},l.prototype.inspect=function(){let _="";const w=t.INSPECT_MAX_BYTES;return _=this.toString("hex",0,w).replace(/(.{2})/g,"$1 ").trim(),this.length>w&&(_+=" ... "),"<Buffer "+_+">"},n&&(l.prototype[n]=l.prototype.inspect),l.prototype.compare=function(_,w,b,re,oe){if(_e(_,Uint8Array)&&(_=l.from(_,_.offset,_.byteLength)),!l.isBuffer(_))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof _);if(w===void 0&&(w=0),b===void 0&&(b=_?_.length:0),re===void 0&&(re=0),oe===void 0&&(oe=this.length),w<0||b>_.length||re<0||oe>this.length)throw new RangeError("out of range index");if(re>=oe&&w>=b)return 0;if(re>=oe)return-1;if(w>=b)return 1;if(w>>>=0,b>>>=0,re>>>=0,oe>>>=0,this===_)return 0;let ne=oe-re,Be=b-w;const nt=Math.min(ne,Be),ze=this.slice(re,oe),qe=_.slice(w,b);for(let Ve=0;Ve<nt;++Ve)if(ze[Ve]!==qe[Ve]){ne=ze[Ve],Be=qe[Ve];break}return ne<Be?-1:Be<ne?1:0};function Q(T,_,w,b,re){if(T.length===0)return-1;if(typeof w=="string"?(b=w,w=0):w>2147483647?w=2147483647:w<-2147483648&&(w=-2147483648),w=+w,tt(w)&&(w=re?0:T.length-1),w<0&&(w=T.length+w),w>=T.length){if(re)return-1;w=T.length-1}else if(w<0)if(re)w=0;else return-1;if(typeof _=="string"&&(_=l.from(_,b)),l.isBuffer(_))return _.length===0?-1:W(T,_,w,b,re);if(typeof _=="number")return _=_&255,typeof Uint8Array.prototype.indexOf=="function"?re?Uint8Array.prototype.indexOf.call(T,_,w):Uint8Array.prototype.lastIndexOf.call(T,_,w):W(T,[_],w,b,re);throw new TypeError("val must be string, number or Buffer")}function W(T,_,w,b,re){let oe=1,ne=T.length,Be=_.length;if(b!==void 0&&(b=String(b).toLowerCase(),b==="ucs2"||b==="ucs-2"||b==="utf16le"||b==="utf-16le")){if(T.length<2||_.length<2)return-1;oe=2,ne/=2,Be/=2,w/=2}function nt(qe,Ve){return oe===1?qe[Ve]:qe.readUInt16BE(Ve*oe)}let ze;if(re){let qe=-1;for(ze=w;ze<ne;ze++)if(nt(T,ze)===nt(_,qe===-1?0:ze-qe)){if(qe===-1&&(qe=ze),ze-qe+1===Be)return qe*oe}else qe!==-1&&(ze-=ze-qe),qe=-1}else for(w+Be>ne&&(w=ne-Be),ze=w;ze>=0;ze--){let qe=!0;for(let Ve=0;Ve<Be;Ve++)if(nt(T,ze+Ve)!==nt(_,Ve)){qe=!1;break}if(qe)return ze}return-1}l.prototype.includes=function(_,w,b){return this.indexOf(_,w,b)!==-1},l.prototype.indexOf=function(_,w,b){return Q(this,_,w,b,!0)},l.prototype.lastIndexOf=function(_,w,b){return Q(this,_,w,b,!1)};function fe(T,_,w,b){w=Number(w)||0;const re=T.length-w;b?(b=Number(b),b>re&&(b=re)):b=re;const oe=_.length;b>oe/2&&(b=oe/2);let ne;for(ne=0;ne<b;++ne){const Be=parseInt(_.substr(ne*2,2),16);if(tt(Be))return ne;T[w+ne]=Be}return ne}function de(T,_,w,b){return De(te(_,T.length-w),T,w,b)}function q(T,_,w,b){return De(me(_),T,w,b)}function he(T,_,w,b){return De(Re(_),T,w,b)}function ke(T,_,w,b){return De(we(_,T.length-w),T,w,b)}l.prototype.write=function(_,w,b,re){if(w===void 0)re="utf8",b=this.length,w=0;else if(b===void 0&&typeof w=="string")re=w,b=this.length,w=0;else if(isFinite(w))w=w>>>0,isFinite(b)?(b=b>>>0,re===void 0&&(re="utf8")):(re=b,b=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const oe=this.length-w;if((b===void 0||b>oe)&&(b=oe),_.length>0&&(b<0||w<0)||w>this.length)throw new RangeError("Attempt to write outside buffer bounds");re||(re="utf8");let ne=!1;for(;;)switch(re){case"hex":return fe(this,_,w,b);case"utf8":case"utf-8":return de(this,_,w,b);case"ascii":case"latin1":case"binary":return q(this,_,w,b);case"base64":return he(this,_,w,b);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ke(this,_,w,b);default:if(ne)throw new TypeError("Unknown encoding: "+re);re=(""+re).toLowerCase(),ne=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function le(T,_,w){return _===0&&w===T.length?e.fromByteArray(T):e.fromByteArray(T.slice(_,w))}function Ue(T,_,w){w=Math.min(T.length,w);const b=[];let re=_;for(;re<w;){const oe=T[re];let ne=null,Be=oe>239?4:oe>223?3:oe>191?2:1;if(re+Be<=w){let nt,ze,qe,Ve;switch(Be){case 1:oe<128&&(ne=oe);break;case 2:nt=T[re+1],(nt&192)===128&&(Ve=(oe&31)<<6|nt&63,Ve>127&&(ne=Ve));break;case 3:nt=T[re+1],ze=T[re+2],(nt&192)===128&&(ze&192)===128&&(Ve=(oe&15)<<12|(nt&63)<<6|ze&63,Ve>2047&&(Ve<55296||Ve>57343)&&(ne=Ve));break;case 4:nt=T[re+1],ze=T[re+2],qe=T[re+3],(nt&192)===128&&(ze&192)===128&&(qe&192)===128&&(Ve=(oe&15)<<18|(nt&63)<<12|(ze&63)<<6|qe&63,Ve>65535&&Ve<1114112&&(ne=Ve))}}ne===null?(ne=65533,Be=1):ne>65535&&(ne-=65536,b.push(ne>>>10&1023|55296),ne=56320|ne&1023),b.push(ne),re+=Be}return Ne(b)}const Te=4096;function Ne(T){const _=T.length;if(_<=Te)return String.fromCharCode.apply(String,T);let w="",b=0;for(;b<_;)w+=String.fromCharCode.apply(String,T.slice(b,b+=Te));return w}function Oe(T,_,w){let b="";w=Math.min(T.length,w);for(let re=_;re<w;++re)b+=String.fromCharCode(T[re]&127);return b}function He(T,_,w){let b="";w=Math.min(T.length,w);for(let re=_;re<w;++re)b+=String.fromCharCode(T[re]);return b}function Fe(T,_,w){const b=T.length;(!_||_<0)&&(_=0),(!w||w<0||w>b)&&(w=b);let re="";for(let oe=_;oe<w;++oe)re+=It[T[oe]];return re}function Pe(T,_,w){const b=T.slice(_,w);let re="";for(let oe=0;oe<b.length-1;oe+=2)re+=String.fromCharCode(b[oe]+b[oe+1]*256);return re}l.prototype.slice=function(_,w){const b=this.length;_=~~_,w=w===void 0?b:~~w,_<0?(_+=b,_<0&&(_=0)):_>b&&(_=b),w<0?(w+=b,w<0&&(w=0)):w>b&&(w=b),w<_&&(w=_);const re=this.subarray(_,w);return Object.setPrototypeOf(re,l.prototype),re};function Ae(T,_,w){if(T%1!==0||T<0)throw new RangeError("offset is not uint");if(T+_>w)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(_,w,b){_=_>>>0,w=w>>>0,b||Ae(_,w,this.length);let re=this[_],oe=1,ne=0;for(;++ne<w&&(oe*=256);)re+=this[_+ne]*oe;return re},l.prototype.readUintBE=l.prototype.readUIntBE=function(_,w,b){_=_>>>0,w=w>>>0,b||Ae(_,w,this.length);let re=this[_+--w],oe=1;for(;w>0&&(oe*=256);)re+=this[_+--w]*oe;return re},l.prototype.readUint8=l.prototype.readUInt8=function(_,w){return _=_>>>0,w||Ae(_,1,this.length),this[_]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(_,w){return _=_>>>0,w||Ae(_,2,this.length),this[_]|this[_+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(_,w){return _=_>>>0,w||Ae(_,2,this.length),this[_]<<8|this[_+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(_,w){return _=_>>>0,w||Ae(_,4,this.length),(this[_]|this[_+1]<<8|this[_+2]<<16)+this[_+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(_,w){return _=_>>>0,w||Ae(_,4,this.length),this[_]*16777216+(this[_+1]<<16|this[_+2]<<8|this[_+3])},l.prototype.readBigUInt64LE=Se(function(_){_=_>>>0,m(_,"offset");const w=this[_],b=this[_+7];(w===void 0||b===void 0)&&A(_,this.length-8);const re=w+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24,oe=this[++_]+this[++_]*2**8+this[++_]*2**16+b*2**24;return BigInt(re)+(BigInt(oe)<<BigInt(32))}),l.prototype.readBigUInt64BE=Se(function(_){_=_>>>0,m(_,"offset");const w=this[_],b=this[_+7];(w===void 0||b===void 0)&&A(_,this.length-8);const re=w*2**24+this[++_]*2**16+this[++_]*2**8+this[++_],oe=this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+b;return(BigInt(re)<<BigInt(32))+BigInt(oe)}),l.prototype.readIntLE=function(_,w,b){_=_>>>0,w=w>>>0,b||Ae(_,w,this.length);let re=this[_],oe=1,ne=0;for(;++ne<w&&(oe*=256);)re+=this[_+ne]*oe;return oe*=128,re>=oe&&(re-=Math.pow(2,8*w)),re},l.prototype.readIntBE=function(_,w,b){_=_>>>0,w=w>>>0,b||Ae(_,w,this.length);let re=w,oe=1,ne=this[_+--re];for(;re>0&&(oe*=256);)ne+=this[_+--re]*oe;return oe*=128,ne>=oe&&(ne-=Math.pow(2,8*w)),ne},l.prototype.readInt8=function(_,w){return _=_>>>0,w||Ae(_,1,this.length),this[_]&128?(255-this[_]+1)*-1:this[_]},l.prototype.readInt16LE=function(_,w){_=_>>>0,w||Ae(_,2,this.length);const b=this[_]|this[_+1]<<8;return b&32768?b|4294901760:b},l.prototype.readInt16BE=function(_,w){_=_>>>0,w||Ae(_,2,this.length);const b=this[_+1]|this[_]<<8;return b&32768?b|4294901760:b},l.prototype.readInt32LE=function(_,w){return _=_>>>0,w||Ae(_,4,this.length),this[_]|this[_+1]<<8|this[_+2]<<16|this[_+3]<<24},l.prototype.readInt32BE=function(_,w){return _=_>>>0,w||Ae(_,4,this.length),this[_]<<24|this[_+1]<<16|this[_+2]<<8|this[_+3]},l.prototype.readBigInt64LE=Se(function(_){_=_>>>0,m(_,"offset");const w=this[_],b=this[_+7];(w===void 0||b===void 0)&&A(_,this.length-8);const re=this[_+4]+this[_+5]*2**8+this[_+6]*2**16+(b<<24);return(BigInt(re)<<BigInt(32))+BigInt(w+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24)}),l.prototype.readBigInt64BE=Se(function(_){_=_>>>0,m(_,"offset");const w=this[_],b=this[_+7];(w===void 0||b===void 0)&&A(_,this.length-8);const re=(w<<24)+this[++_]*2**16+this[++_]*2**8+this[++_];return(BigInt(re)<<BigInt(32))+BigInt(this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+b)}),l.prototype.readFloatLE=function(_,w){return _=_>>>0,w||Ae(_,4,this.length),r.read(this,_,!0,23,4)},l.prototype.readFloatBE=function(_,w){return _=_>>>0,w||Ae(_,4,this.length),r.read(this,_,!1,23,4)},l.prototype.readDoubleLE=function(_,w){return _=_>>>0,w||Ae(_,8,this.length),r.read(this,_,!0,52,8)},l.prototype.readDoubleBE=function(_,w){return _=_>>>0,w||Ae(_,8,this.length),r.read(this,_,!1,52,8)};function Me(T,_,w,b,re,oe){if(!l.isBuffer(T))throw new TypeError('"buffer" argument must be a Buffer instance');if(_>re||_<oe)throw new RangeError('"value" argument is out of bounds');if(w+b>T.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(_,w,b,re){if(_=+_,w=w>>>0,b=b>>>0,!re){const Be=Math.pow(2,8*b)-1;Me(this,_,w,b,Be,0)}let oe=1,ne=0;for(this[w]=_&255;++ne<b&&(oe*=256);)this[w+ne]=_/oe&255;return w+b},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(_,w,b,re){if(_=+_,w=w>>>0,b=b>>>0,!re){const Be=Math.pow(2,8*b)-1;Me(this,_,w,b,Be,0)}let oe=b-1,ne=1;for(this[w+oe]=_&255;--oe>=0&&(ne*=256);)this[w+oe]=_/ne&255;return w+b},l.prototype.writeUint8=l.prototype.writeUInt8=function(_,w,b){return _=+_,w=w>>>0,b||Me(this,_,w,1,255,0),this[w]=_&255,w+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(_,w,b){return _=+_,w=w>>>0,b||Me(this,_,w,2,65535,0),this[w]=_&255,this[w+1]=_>>>8,w+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(_,w,b){return _=+_,w=w>>>0,b||Me(this,_,w,2,65535,0),this[w]=_>>>8,this[w+1]=_&255,w+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(_,w,b){return _=+_,w=w>>>0,b||Me(this,_,w,4,4294967295,0),this[w+3]=_>>>24,this[w+2]=_>>>16,this[w+1]=_>>>8,this[w]=_&255,w+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(_,w,b){return _=+_,w=w>>>0,b||Me(this,_,w,4,4294967295,0),this[w]=_>>>24,this[w+1]=_>>>16,this[w+2]=_>>>8,this[w+3]=_&255,w+4};function Ie(T,_,w,b,re){E(_,b,re,T,w,7);let oe=Number(_&BigInt(4294967295));T[w++]=oe,oe=oe>>8,T[w++]=oe,oe=oe>>8,T[w++]=oe,oe=oe>>8,T[w++]=oe;let ne=Number(_>>BigInt(32)&BigInt(4294967295));return T[w++]=ne,ne=ne>>8,T[w++]=ne,ne=ne>>8,T[w++]=ne,ne=ne>>8,T[w++]=ne,w}function We(T,_,w,b,re){E(_,b,re,T,w,7);let oe=Number(_&BigInt(4294967295));T[w+7]=oe,oe=oe>>8,T[w+6]=oe,oe=oe>>8,T[w+5]=oe,oe=oe>>8,T[w+4]=oe;let ne=Number(_>>BigInt(32)&BigInt(4294967295));return T[w+3]=ne,ne=ne>>8,T[w+2]=ne,ne=ne>>8,T[w+1]=ne,ne=ne>>8,T[w]=ne,w+8}l.prototype.writeBigUInt64LE=Se(function(_,w=0){return Ie(this,_,w,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Se(function(_,w=0){return We(this,_,w,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(_,w,b,re){if(_=+_,w=w>>>0,!re){const nt=Math.pow(2,8*b-1);Me(this,_,w,b,nt-1,-nt)}let oe=0,ne=1,Be=0;for(this[w]=_&255;++oe<b&&(ne*=256);)_<0&&Be===0&&this[w+oe-1]!==0&&(Be=1),this[w+oe]=(_/ne>>0)-Be&255;return w+b},l.prototype.writeIntBE=function(_,w,b,re){if(_=+_,w=w>>>0,!re){const nt=Math.pow(2,8*b-1);Me(this,_,w,b,nt-1,-nt)}let oe=b-1,ne=1,Be=0;for(this[w+oe]=_&255;--oe>=0&&(ne*=256);)_<0&&Be===0&&this[w+oe+1]!==0&&(Be=1),this[w+oe]=(_/ne>>0)-Be&255;return w+b},l.prototype.writeInt8=function(_,w,b){return _=+_,w=w>>>0,b||Me(this,_,w,1,127,-128),_<0&&(_=255+_+1),this[w]=_&255,w+1},l.prototype.writeInt16LE=function(_,w,b){return _=+_,w=w>>>0,b||Me(this,_,w,2,32767,-32768),this[w]=_&255,this[w+1]=_>>>8,w+2},l.prototype.writeInt16BE=function(_,w,b){return _=+_,w=w>>>0,b||Me(this,_,w,2,32767,-32768),this[w]=_>>>8,this[w+1]=_&255,w+2},l.prototype.writeInt32LE=function(_,w,b){return _=+_,w=w>>>0,b||Me(this,_,w,4,2147483647,-2147483648),this[w]=_&255,this[w+1]=_>>>8,this[w+2]=_>>>16,this[w+3]=_>>>24,w+4},l.prototype.writeInt32BE=function(_,w,b){return _=+_,w=w>>>0,b||Me(this,_,w,4,2147483647,-2147483648),_<0&&(_=4294967295+_+1),this[w]=_>>>24,this[w+1]=_>>>16,this[w+2]=_>>>8,this[w+3]=_&255,w+4},l.prototype.writeBigInt64LE=Se(function(_,w=0){return Ie(this,_,w,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Se(function(_,w=0){return We(this,_,w,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function it(T,_,w,b,re,oe){if(w+b>T.length)throw new RangeError("Index out of range");if(w<0)throw new RangeError("Index out of range")}function wt(T,_,w,b,re){return _=+_,w=w>>>0,re||it(T,_,w,4),r.write(T,_,w,b,23,4),w+4}l.prototype.writeFloatLE=function(_,w,b){return wt(this,_,w,!0,b)},l.prototype.writeFloatBE=function(_,w,b){return wt(this,_,w,!1,b)};function st(T,_,w,b,re){return _=+_,w=w>>>0,re||it(T,_,w,8),r.write(T,_,w,b,52,8),w+8}l.prototype.writeDoubleLE=function(_,w,b){return st(this,_,w,!0,b)},l.prototype.writeDoubleBE=function(_,w,b){return st(this,_,w,!1,b)},l.prototype.copy=function(_,w,b,re){if(!l.isBuffer(_))throw new TypeError("argument should be a Buffer");if(b||(b=0),!re&&re!==0&&(re=this.length),w>=_.length&&(w=_.length),w||(w=0),re>0&&re<b&&(re=b),re===b||_.length===0||this.length===0)return 0;if(w<0)throw new RangeError("targetStart out of bounds");if(b<0||b>=this.length)throw new RangeError("Index out of range");if(re<0)throw new RangeError("sourceEnd out of bounds");re>this.length&&(re=this.length),_.length-w<re-b&&(re=_.length-w+b);const oe=re-b;return this===_&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(w,b,re):Uint8Array.prototype.set.call(_,this.subarray(b,re),w),oe},l.prototype.fill=function(_,w,b,re){if(typeof _=="string"){if(typeof w=="string"?(re=w,w=0,b=this.length):typeof b=="string"&&(re=b,b=this.length),re!==void 0&&typeof re!="string")throw new TypeError("encoding must be a string");if(typeof re=="string"&&!l.isEncoding(re))throw new TypeError("Unknown encoding: "+re);if(_.length===1){const ne=_.charCodeAt(0);(re==="utf8"&&ne<128||re==="latin1")&&(_=ne)}}else typeof _=="number"?_=_&255:typeof _=="boolean"&&(_=Number(_));if(w<0||this.length<w||this.length<b)throw new RangeError("Out of range index");if(b<=w)return this;w=w>>>0,b=b===void 0?this.length:b>>>0,_||(_=0);let oe;if(typeof _=="number")for(oe=w;oe<b;++oe)this[oe]=_;else{const ne=l.isBuffer(_)?_:l.from(_,re),Be=ne.length;if(Be===0)throw new TypeError('The value "'+_+'" is invalid for argument "value"');for(oe=0;oe<b-w;++oe)this[oe+w]=ne[oe%Be]}return this};const Ge={};function Qe(T,_,w){Ge[T]=class extends w{constructor(){super(),Object.defineProperty(this,"message",{value:_.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${T}]`,this.stack,delete this.name}get code(){return T}set code(re){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:re,writable:!0})}toString(){return`${this.name} [${T}]: ${this.message}`}}}Qe("ERR_BUFFER_OUT_OF_BOUNDS",function(T){return T?`${T} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Qe("ERR_INVALID_ARG_TYPE",function(T,_){return`The "${T}" argument must be of type number. Received type ${typeof _}`},TypeError),Qe("ERR_OUT_OF_RANGE",function(T,_,w){let b=`The value of "${T}" is out of range.`,re=w;return Number.isInteger(w)&&Math.abs(w)>2**32?re=Je(String(w)):typeof w=="bigint"&&(re=String(w),(w>BigInt(2)**BigInt(32)||w<-(BigInt(2)**BigInt(32)))&&(re=Je(re)),re+="n"),b+=` It must be ${_}. Received ${re}`,b},RangeError);function Je(T){let _="",w=T.length;const b=T[0]==="-"?1:0;for(;w>=b+4;w-=3)_=`_${T.slice(w-3,w)}${_}`;return`${T.slice(0,w)}${_}`}function X(T,_,w){m(_,"offset"),(T[_]===void 0||T[_+w]===void 0)&&A(_,T.length-(w+1))}function E(T,_,w,b,re,oe){if(T>w||T<_){const ne=typeof _=="bigint"?"n":"";let Be;throw _===0||_===BigInt(0)?Be=`>= 0${ne} and < 2${ne} ** ${(oe+1)*8}${ne}`:Be=`>= -(2${ne} ** ${(oe+1)*8-1}${ne}) and < 2 ** ${(oe+1)*8-1}${ne}`,new Ge.ERR_OUT_OF_RANGE("value",Be,T)}X(b,re,oe)}function m(T,_){if(typeof T!="number")throw new Ge.ERR_INVALID_ARG_TYPE(_,"number",T)}function A(T,_,w){throw Math.floor(T)!==T?(m(T,w),new Ge.ERR_OUT_OF_RANGE("offset","an integer",T)):_<0?new Ge.ERR_BUFFER_OUT_OF_BOUNDS:new Ge.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${_}`,T)}const D=/[^+/0-9A-Za-z-_]/g;function Z(T){if(T=T.split("=")[0],T=T.trim().replace(D,""),T.length<2)return"";for(;T.length%4!==0;)T=T+"=";return T}function te(T,_){_=_||1/0;let w;const b=T.length;let re=null;const oe=[];for(let ne=0;ne<b;++ne){if(w=T.charCodeAt(ne),w>55295&&w<57344){if(!re){if(w>56319){(_-=3)>-1&&oe.push(239,191,189);continue}else if(ne+1===b){(_-=3)>-1&&oe.push(239,191,189);continue}re=w;continue}if(w<56320){(_-=3)>-1&&oe.push(239,191,189),re=w;continue}w=(re-55296<<10|w-56320)+65536}else re&&(_-=3)>-1&&oe.push(239,191,189);if(re=null,w<128){if((_-=1)<0)break;oe.push(w)}else if(w<2048){if((_-=2)<0)break;oe.push(w>>6|192,w&63|128)}else if(w<65536){if((_-=3)<0)break;oe.push(w>>12|224,w>>6&63|128,w&63|128)}else if(w<1114112){if((_-=4)<0)break;oe.push(w>>18|240,w>>12&63|128,w>>6&63|128,w&63|128)}else throw new Error("Invalid code point")}return oe}function me(T){const _=[];for(let w=0;w<T.length;++w)_.push(T.charCodeAt(w)&255);return _}function we(T,_){let w,b,re;const oe=[];for(let ne=0;ne<T.length&&!((_-=2)<0);++ne)w=T.charCodeAt(ne),b=w>>8,re=w%256,oe.push(re),oe.push(b);return oe}function Re(T){return e.toByteArray(Z(T))}function De(T,_,w,b){let re;for(re=0;re<b&&!(re+w>=_.length||re>=T.length);++re)_[re+w]=T[re];return re}function _e(T,_){return T instanceof _||T!=null&&T.constructor!=null&&T.constructor.name!=null&&T.constructor.name===_.name}function tt(T){return T!==T}const It=function(){const T="0123456789abcdef",_=new Array(256);for(let w=0;w<16;++w){const b=w*16;for(let re=0;re<16;++re)_[b+re]=T[w]+T[re]}return _}();function Se(T){return typeof BigInt>"u"?rt:T}function rt(){throw new Error("BigInt not supported")}})(pr);var dh=/^utf-?8|ascii|utf-?16-?le|ucs-?2|base-?64|latin-?1$/i,fh=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,hh=/\s|\uFEFF|\xA0/,ph=/\r?\n[\x20\x09]+/g,gh=/[;,"]/,yh=/[;,"]|\s/,mh=/^[!#$%&'*+\-\.^_`|~\da-zA-Z]+$/,_r={IDLE:1,URI:2,ATTR:4};function Xo(t){return t.replace(fh,"")}function mi(t){return hh.test(t)}function _h(t,e){for(;mi(t[e]);)e++;return e}function Zo(t){return yh.test(t)||!mh.test(t)}function bh(t,e){return Object.keys(t).length===Object.keys(e).length&&Object.keys(t).every(r=>r in e&&t[r]===e[r])}class ut{constructor(e){this.refs=[],e&&this.parse(e)}rel(e){for(var r=[],n=e.toLowerCase(),o=0;o<this.refs.length;o++)typeof this.refs[o].rel=="string"&&this.refs[o].rel.toLowerCase()===n&&r.push(this.refs[o]);return r}get(e,r){e=e.toLowerCase(),r=r.toLowerCase();for(var n=[],o=0;o<this.refs.length;o++)typeof this.refs[o][e]=="string"&&this.refs[o][e].toLowerCase()===r&&n.push(this.refs[o]);return n}set(e){return this.refs.push(e),this}setUnique(e){return this.refs.some(r=>bh(r,e))||this.refs.push(e),this}has(e,r){e=e.toLowerCase(),r=r.toLowerCase();for(var n=0;n<this.refs.length;n++)if(typeof this.refs[n][e]=="string"&&this.refs[n][e].toLowerCase()===r)return!0;return!1}parse(e,c){c=c||0,e=c?e.slice(c):e,e=Xo(e).replace(ph,"");for(var n=_r.IDLE,o=e.length,c=0,u=null;c<o;)if(n===_r.IDLE){if(mi(e[c])){c++;continue}else if(e[c]==="<"){u!=null&&(u.rel!=null?this.refs.push(...ut.expandRelations(u)):this.refs.push(u));var l=e.indexOf(">",c);if(l===-1)throw new Error("Expected end of URI delimiter at offset "+c);u={uri:e.slice(c+1,l)},c=l,n=_r.URI}else throw new Error('Unexpected character "'+e[c]+'" at offset '+c);c++}else if(n===_r.URI)if(mi(e[c])){c++;continue}else if(e[c]===";")n=_r.ATTR,c++;else if(e[c]===",")n=_r.IDLE,c++;else throw new Error('Unexpected character "'+e[c]+'" at offset '+c);else if(n===_r.ATTR){if(e[c]===";"||mi(e[c])){c++;continue}var l=e.indexOf("=",c);l===-1&&(l=e.indexOf(";",c)),l===-1&&(l=e.length);var g=Xo(e.slice(c,l)).toLowerCase(),f="";if(c=l+1,c=_h(e,c),e[c]==='"')for(c++;c<o;){if(e[c]==='"'){c++;break}e[c]==="\\"&&c++,f+=e[c],c++}else{for(var l=c+1;!gh.test(e[l])&&l<o;)l++;f=e.slice(c,l),c=l}switch(u[g]&&ut.isSingleOccurenceAttr(g)||(g[g.length-1]==="*"?u[g]=ut.parseExtendedValue(f):(f=g==="type"?f.toLowerCase():f,u[g]!=null?Array.isArray(u[g])?u[g].push(f):u[g]=[u[g],f]:u[g]=f)),e[c]){case",":n=_r.IDLE;break;case";":n=_r.ATTR;break}c++}else throw new Error('Unknown parser state "'+n+'"');return u!=null&&(u.rel!=null?this.refs.push(...ut.expandRelations(u)):this.refs.push(u)),u=null,this}toString(){for(var e=[],r="",n=null,o=0;o<this.refs.length;o++)n=this.refs[o],r=Object.keys(this.refs[o]).reduce(function(c,u){return u==="uri"?c:c+"; "+ut.formatAttribute(u,n[u])},"<"+n.uri+">"),e.push(r);return e.join(", ")}}ut.isCompatibleEncoding=function(t){return dh.test(t)};ut.parse=function(t,e){return new ut().parse(t,e)};ut.isSingleOccurenceAttr=function(t){return t==="rel"||t==="type"||t==="media"||t==="title"||t==="title*"};ut.isTokenAttr=function(t){return t==="rel"||t==="type"||t==="anchor"};ut.escapeQuotes=function(t){return t.replace(/"/g,'\\"')};ut.expandRelations=function(t){var e=t.rel.split(" ");return e.map(function(r){var n=Object.assign({},t);return n.rel=r,n})};ut.parseExtendedValue=function(t){var e=/([^']+)?(?:'([^']*)')?(.+)/.exec(t);return{language:e[2].toLowerCase(),encoding:ut.isCompatibleEncoding(e[1])?null:e[1].toLowerCase(),value:ut.isCompatibleEncoding(e[1])?decodeURIComponent(e[3]):e[3]}};ut.formatExtendedAttribute=function(t,e){var r=(e.encoding||"utf-8").toUpperCase(),n=e.language||"en",o="";return Buffer.isBuffer(e.value)&&ut.isCompatibleEncoding(r)?o=e.value.toString(r):Buffer.isBuffer(e.value)?o=e.value.toString("hex").replace(/[0-9a-f]{2}/gi,"%$1"):o=encodeURIComponent(e.value),t+"="+r+"'"+n+"'"+o};ut.formatAttribute=function(t,e){return Array.isArray(e)?e.map(r=>ut.formatAttribute(t,r)).join("; "):t[t.length-1]==="*"||typeof e!="string"?ut.formatExtendedAttribute(t,e):(ut.isTokenAttr(t)?e=Zo(e)?'"'+ut.escapeQuotes(e)+'"':ut.escapeQuotes(e):Zo(e)&&(e=encodeURIComponent(e),e=e.replace(/%20/g," ").replace(/%2C/g,",").replace(/%3B/g,";"),e='"'+e+'"'),t+"="+e)};var wh=ut;const vh=$u(wh);var ec={exports:{}},os={exports:{}};let Sh=class extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError(`Expected input to be an Array, got ${typeof e}`);let r="";for(let n=0;n<e.length;n++)r+=`    ${e[n].stack}
`;super(r),this.name="AggregateError",this.errors=e}};var ht={AggregateError:Sh,ArrayIsArray(t){return Array.isArray(t)},ArrayPrototypeIncludes(t,e){return t.includes(e)},ArrayPrototypeIndexOf(t,e){return t.indexOf(e)},ArrayPrototypeJoin(t,e){return t.join(e)},ArrayPrototypeMap(t,e){return t.map(e)},ArrayPrototypePop(t,e){return t.pop(e)},ArrayPrototypePush(t,e){return t.push(e)},ArrayPrototypeSlice(t,e,r){return t.slice(e,r)},Error,FunctionPrototypeCall(t,e,...r){return t.call(e,...r)},FunctionPrototypeSymbolHasInstance(t,e){return Function.prototype[Symbol.hasInstance].call(t,e)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(t,e){return Object.defineProperties(t,e)},ObjectDefineProperty(t,e,r){return Object.defineProperty(t,e,r)},ObjectGetOwnPropertyDescriptor(t,e){return Object.getOwnPropertyDescriptor(t,e)},ObjectKeys(t){return Object.keys(t)},ObjectSetPrototypeOf(t,e){return Object.setPrototypeOf(t,e)},Promise,PromisePrototypeCatch(t,e){return t.catch(e)},PromisePrototypeThen(t,e,r){return t.then(e,r)},PromiseReject(t){return Promise.reject(t)},PromiseResolve(t){return Promise.resolve(t)},ReflectApply:Reflect.apply,RegExpPrototypeTest(t,e){return t.test(e)},SafeSet:Set,String,StringPrototypeSlice(t,e,r){return t.slice(e,r)},StringPrototypeToLowerCase(t){return t.toLowerCase()},StringPrototypeToUpperCase(t){return t.toUpperCase()},StringPrototypeTrim(t){return t.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(t,e,r){return t.set(e,r)},Boolean,Uint8Array},tc={exports:{}},rc={format(t,...e){return t.replace(/%([sdifj])/g,function(...[r,n]){const o=e.shift();return n==="f"?o.toFixed(6):n==="j"?JSON.stringify(o):n==="s"&&typeof o=="object"?`${o.constructor!==Object?o.constructor.name:""} {}`.trim():o.toString()})},inspect(t){switch(typeof t){case"string":if(t.includes("'"))if(t.includes('"')){if(!t.includes("`")&&!t.includes("${"))return`\`${t}\``}else return`"${t}"`;return`'${t}'`;case"number":return isNaN(t)?"NaN":Object.is(t,-0)?String(t):t;case"bigint":return`${String(t)}n`;case"boolean":case"undefined":return String(t);case"object":return"{}"}}};const{format:Eh,inspect:xi}=rc,{AggregateError:xh}=ht,Fh=globalThis.AggregateError||xh,Ah=Symbol("kIsNodeError"),Ih=["string","function","number","object","Function","Object","boolean","bigint","symbol"],Th=/^([A-Z][a-z0-9]*)+$/,Rh="__node_internal_",Ni={};function Jr(t,e){if(!t)throw new Ni.ERR_INTERNAL_ASSERTION(e)}function ea(t){let e="",r=t.length;const n=t[0]==="-"?1:0;for(;r>=n+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function Ph(t,e,r){if(typeof e=="function")return Jr(e.length<=r.length,`Code: ${t}; The provided arguments length (${r.length}) does not match the required ones (${e.length}).`),e(...r);const n=(e.match(/%[dfijoOs]/g)||[]).length;return Jr(n===r.length,`Code: ${t}; The provided arguments length (${r.length}) does not match the required ones (${n}).`),r.length===0?e:Eh(e,...r)}function Dt(t,e,r){r||(r=Error);class n extends r{constructor(...c){super(Ph(t,e,c))}toString(){return`${this.name} [${t}]: ${this.message}`}}Object.defineProperties(n.prototype,{name:{value:r.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${t}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),n.prototype.code=t,n.prototype[Ah]=!0,Ni[t]=n}function ta(t){const e=Rh+t.name;return Object.defineProperty(t,"name",{value:e}),t}function kh(t,e){if(t&&e&&t!==e){if(Array.isArray(e.errors))return e.errors.push(t),e;const r=new Fh([e,t],e.message);return r.code=e.code,r}return t||e}let Ch=class extends Error{constructor(e="The operation was aborted",r=void 0){if(r!==void 0&&typeof r!="object")throw new Ni.ERR_INVALID_ARG_TYPE("options","Object",r);super(e,r),this.code="ABORT_ERR",this.name="AbortError"}};Dt("ERR_ASSERTION","%s",Error);Dt("ERR_INVALID_ARG_TYPE",(t,e,r)=>{Jr(typeof t=="string","'name' must be a string"),Array.isArray(e)||(e=[e]);let n="The ";t.endsWith(" argument")?n+=`${t} `:n+=`"${t}" ${t.includes(".")?"property":"argument"} `,n+="must be ";const o=[],c=[],u=[];for(const g of e)Jr(typeof g=="string","All expected entries have to be of type string"),Ih.includes(g)?o.push(g.toLowerCase()):Th.test(g)?c.push(g):(Jr(g!=="object",'The value "object" should be written as "Object"'),u.push(g));if(c.length>0){const g=o.indexOf("object");g!==-1&&(o.splice(o,g,1),c.push("Object"))}if(o.length>0){switch(o.length){case 1:n+=`of type ${o[0]}`;break;case 2:n+=`one of type ${o[0]} or ${o[1]}`;break;default:{const g=o.pop();n+=`one of type ${o.join(", ")}, or ${g}`}}(c.length>0||u.length>0)&&(n+=" or ")}if(c.length>0){switch(c.length){case 1:n+=`an instance of ${c[0]}`;break;case 2:n+=`an instance of ${c[0]} or ${c[1]}`;break;default:{const g=c.pop();n+=`an instance of ${c.join(", ")}, or ${g}`}}u.length>0&&(n+=" or ")}switch(u.length){case 0:break;case 1:u[0].toLowerCase()!==u[0]&&(n+="an "),n+=`${u[0]}`;break;case 2:n+=`one of ${u[0]} or ${u[1]}`;break;default:{const g=u.pop();n+=`one of ${u.join(", ")}, or ${g}`}}if(r==null)n+=`. Received ${r}`;else if(typeof r=="function"&&r.name)n+=`. Received function ${r.name}`;else if(typeof r=="object"){var l;if((l=r.constructor)!==null&&l!==void 0&&l.name)n+=`. Received an instance of ${r.constructor.name}`;else{const g=xi(r,{depth:-1});n+=`. Received ${g}`}}else{let g=xi(r,{colors:!1});g.length>25&&(g=`${g.slice(0,25)}...`),n+=`. Received type ${typeof r} (${g})`}return n},TypeError);Dt("ERR_INVALID_ARG_VALUE",(t,e,r="is invalid")=>{let n=xi(e);return n.length>128&&(n=n.slice(0,128)+"..."),`The ${t.includes(".")?"property":"argument"} '${t}' ${r}. Received ${n}`},TypeError);Dt("ERR_INVALID_RETURN_VALUE",(t,e,r)=>{var n;const o=r!=null&&(n=r.constructor)!==null&&n!==void 0&&n.name?`instance of ${r.constructor.name}`:`type ${typeof r}`;return`Expected ${t} to be returned from the "${e}" function but got ${o}.`},TypeError);Dt("ERR_MISSING_ARGS",(...t)=>{Jr(t.length>0,"At least one arg needs to be specified");let e;const r=t.length;switch(t=(Array.isArray(t)?t:[t]).map(n=>`"${n}"`).join(" or "),r){case 1:e+=`The ${t[0]} argument`;break;case 2:e+=`The ${t[0]} and ${t[1]} arguments`;break;default:{const n=t.pop();e+=`The ${t.join(", ")}, and ${n} arguments`}break}return`${e} must be specified`},TypeError);Dt("ERR_OUT_OF_RANGE",(t,e,r)=>{Jr(e,'Missing "range" argument');let n;if(Number.isInteger(r)&&Math.abs(r)>2**32)n=ea(String(r));else if(typeof r=="bigint"){n=String(r);const o=BigInt(2)**BigInt(32);(r>o||r<-o)&&(n=ea(n)),n+="n"}else n=xi(r);return`The value of "${t}" is out of range. It must be ${e}. Received ${n}`},RangeError);Dt("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);Dt("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);Dt("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);Dt("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);Dt("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);Dt("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);Dt("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);Dt("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);Dt("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);Dt("ERR_STREAM_WRITE_AFTER_END","write after end",Error);Dt("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);var jt={AbortError:Ch,aggregateTwoErrors:ta(kh),hideStackFrames:ta,codes:Ni},On={exports:{}},ra;function Xn(){if(ra)return On.exports;ra=1;const{AbortController:t,AbortSignal:e}=typeof self<"u"?self:typeof window<"u"?window:void 0;return On.exports=t,On.exports.AbortSignal=e,On.exports.default=t,On.exports}(function(t){const e=pr,{format:r,inspect:n}=rc,{codes:{ERR_INVALID_ARG_TYPE:o}}=jt,{kResistStopPropagation:c,AggregateError:u,SymbolDispose:l}=ht,g=globalThis.AbortSignal||Xn().AbortSignal,f=globalThis.AbortController||Xn().AbortController,h=Object.getPrototypeOf(async function(){}).constructor,p=globalThis.Blob||e.Blob,v=typeof p<"u"?function(R){return R instanceof p}:function(R){return!1},x=(I,R)=>{if(I!==void 0&&(I===null||typeof I!="object"||!("aborted"in I)))throw new o(R,"AbortSignal",I)},F=(I,R)=>{if(typeof I!="function")throw new o(R,"Function",I)};t.exports={AggregateError:u,kEmptyObject:Object.freeze({}),once(I){let R=!1;return function(...C){R||(R=!0,I.apply(this,C))}},createDeferredPromise:function(){let I,R;return{promise:new Promise((L,N)=>{I=L,R=N}),resolve:I,reject:R}},promisify(I){return new Promise((R,C)=>{I((L,...N)=>L?C(L):R(...N))})},debuglog(){return function(){}},format:r,inspect:n,types:{isAsyncFunction(I){return I instanceof h},isArrayBufferView(I){return ArrayBuffer.isView(I)}},isBlob:v,deprecate(I,R){return I},addAbortListener:Zn.addAbortListener||function(R,C){if(R===void 0)throw new o("signal","AbortSignal",R);x(R,"signal"),F(C,"listener");let L;return R.aborted?queueMicrotask(()=>C()):(R.addEventListener("abort",C,{__proto__:null,once:!0,[c]:!0}),L=()=>{R.removeEventListener("abort",C)}),{__proto__:null,[l](){var N;(N=L)===null||N===void 0||N()}}},AbortSignalAny:g.any||function(R){if(R.length===1)return R[0];const C=new f,L=()=>C.abort();return R.forEach(N=>{x(N,"signals"),N.addEventListener("abort",L,{once:!0})}),C.signal.addEventListener("abort",()=>{R.forEach(N=>N.removeEventListener("abort",L))},{once:!0}),C.signal}},t.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(tc);var Vt=tc.exports,ho={};const{ArrayIsArray:nc,ArrayPrototypeIncludes:Nh,ArrayPrototypeJoin:Lh,ArrayPrototypeMap:Dh,NumberIsInteger:po,NumberIsNaN:Lm,NumberMAX_SAFE_INTEGER:Uh,NumberMIN_SAFE_INTEGER:Oh,NumberParseInt:Dm,ObjectPrototypeHasOwnProperty:Bh,RegExpPrototypeExec:Um,String:jh,StringPrototypeToUpperCase:Om,StringPrototypeTrim:Bm}=ht,{hideStackFrames:Zt,codes:{ERR_SOCKET_BAD_PORT:jm,ERR_INVALID_ARG_TYPE:er,ERR_INVALID_ARG_VALUE:ic,ERR_OUT_OF_RANGE:_n,ERR_UNKNOWN_SIGNAL:Mm}}=jt,{normalizeEncoding:Hm}=Vt,{isAsyncFunction:Mh,isArrayBufferView:Hh}=Vt.types,$h=Zt((t,e,r=Oh,n=Uh)=>{if(typeof t!="number")throw new er(e,"number",t);if(!po(t))throw new _n(e,"an integer",t);if(t<r||t>n)throw new _n(e,`>= ${r} && <= ${n}`,t)});Zt((t,e,r=-2147483648,n=2147483647)=>{if(typeof t!="number")throw new er(e,"number",t);if(!po(t))throw new _n(e,"an integer",t);if(t<r||t>n)throw new _n(e,`>= ${r} && <= ${n}`,t)});Zt((t,e,r=!1)=>{if(typeof t!="number")throw new er(e,"number",t);if(!po(t))throw new _n(e,"an integer",t);const n=r?1:0,o=4294967295;if(t<n||t>o)throw new _n(e,`>= ${n} && <= ${o}`,t)});Zt((t,e,r)=>{if(!Nh(r,t)){const o="must be one of: "+Lh(Dh(r,c=>typeof c=="string"?`'${c}'`:jh(c)),", ");throw new ic(e,t,o)}});function Kh(t,e){if(typeof t!="boolean")throw new er(e,"boolean",t)}function as(t,e,r){return t==null||!Bh(t,e)?r:t[e]}const Wh=Zt((t,e,r=null)=>{const n=as(r,"allowArray",!1),o=as(r,"allowFunction",!1);if(!as(r,"nullable",!1)&&t===null||!n&&nc(t)||typeof t!="object"&&(!o||typeof t!="function"))throw new er(e,"Object",t)});Zt((t,e)=>{if(t!=null&&typeof t!="object"&&typeof t!="function")throw new er(e,"a dictionary",t)});Zt((t,e,r=0)=>{if(!nc(t))throw new er(e,"Array",t);if(t.length<r){const n=`must be longer than ${r}`;throw new ic(e,t,n)}});Zt((t,e="buffer")=>{if(!Hh(t))throw new er(e,["Buffer","TypedArray","DataView"],t)});const Vh=Zt((t,e)=>{if(t!==void 0&&(t===null||typeof t!="object"||!("aborted"in t)))throw new er(e,"AbortSignal",t)}),qh=Zt((t,e)=>{if(typeof t!="function")throw new er(e,"Function",t)});Zt((t,e)=>{if(typeof t!="function"||Mh(t))throw new er(e,"Function",t)});Zt((t,e)=>{if(t!==void 0)throw new er(e,"undefined",t)});var ei={validateBoolean:Kh,validateFunction:qh,validateInteger:$h,validateObject:Wh,validateAbortSignal:Vh},go={exports:{}},sc={exports:{}},bt=sc.exports={},ur,cr;function Os(){throw new Error("setTimeout has not been defined")}function Bs(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?ur=setTimeout:ur=Os}catch{ur=Os}try{typeof clearTimeout=="function"?cr=clearTimeout:cr=Bs}catch{cr=Bs}})();function oc(t){if(ur===setTimeout)return setTimeout(t,0);if((ur===Os||!ur)&&setTimeout)return ur=setTimeout,setTimeout(t,0);try{return ur(t,0)}catch{try{return ur.call(null,t,0)}catch{return ur.call(this,t,0)}}}function Jh(t){if(cr===clearTimeout)return clearTimeout(t);if((cr===Bs||!cr)&&clearTimeout)return cr=clearTimeout,clearTimeout(t);try{return cr(t)}catch{try{return cr.call(null,t)}catch{return cr.call(this,t)}}}var br=[],pn=!1,Vr,_i=-1;function zh(){!pn||!Vr||(pn=!1,Vr.length?br=Vr.concat(br):_i=-1,br.length&&ac())}function ac(){if(!pn){var t=oc(zh);pn=!0;for(var e=br.length;e;){for(Vr=br,br=[];++_i<e;)Vr&&Vr[_i].run();_i=-1,e=br.length}Vr=null,pn=!1,Jh(t)}}bt.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];br.push(new uc(t,e)),br.length===1&&!pn&&oc(ac)};function uc(t,e){this.fun=t,this.array=e}uc.prototype.run=function(){this.fun.apply(null,this.array)};bt.title="browser";bt.browser=!0;bt.env={};bt.argv=[];bt.version="";bt.versions={};function xr(){}bt.on=xr;bt.addListener=xr;bt.once=xr;bt.off=xr;bt.removeListener=xr;bt.removeAllListeners=xr;bt.emit=xr;bt.prependListener=xr;bt.prependOnceListener=xr;bt.listeners=function(t){return[]};bt.binding=function(t){throw new Error("process.binding is not supported")};bt.cwd=function(){return"/"};bt.chdir=function(t){throw new Error("process.chdir is not supported")};bt.umask=function(){return 0};var zr=sc.exports;const{SymbolAsyncIterator:na,SymbolIterator:ia,SymbolFor:Gr}=ht,cc=Gr("nodejs.stream.destroyed"),Gh=Gr("nodejs.stream.errored"),sa=Gr("nodejs.stream.readable"),oa=Gr("nodejs.stream.writable"),Qh=Gr("nodejs.stream.disturbed"),Yh=Gr("nodejs.webstream.isClosedPromise"),Xh=Gr("nodejs.webstream.controllerErrorFunction");function yo(t,e=!1){var r;return!!(t&&typeof t.pipe=="function"&&typeof t.on=="function"&&(!e||typeof t.pause=="function"&&typeof t.resume=="function")&&(!t._writableState||((r=t._readableState)===null||r===void 0?void 0:r.readable)!==!1)&&(!t._writableState||t._readableState))}function Li(t){var e;return!!(t&&typeof t.write=="function"&&typeof t.on=="function"&&(!t._readableState||((e=t._writableState)===null||e===void 0?void 0:e.writable)!==!1))}function Zh(t){return!!(t&&typeof t.pipe=="function"&&t._readableState&&typeof t.on=="function"&&typeof t.write=="function")}function gr(t){return t&&(t._readableState||t._writableState||typeof t.write=="function"&&typeof t.on=="function"||typeof t.pipe=="function"&&typeof t.on=="function")}function lc(t){return!!(t&&!gr(t)&&typeof t.pipeThrough=="function"&&typeof t.getReader=="function"&&typeof t.cancel=="function")}function dc(t){return!!(t&&!gr(t)&&typeof t.getWriter=="function"&&typeof t.abort=="function")}function fc(t){return!!(t&&!gr(t)&&typeof t.readable=="object"&&typeof t.writable=="object")}function ep(t){return lc(t)||dc(t)||fc(t)}function tp(t,e){return t==null?!1:e===!0?typeof t[na]=="function":e===!1?typeof t[ia]=="function":typeof t[na]=="function"||typeof t[ia]=="function"}function Di(t){if(!gr(t))return null;const e=t._writableState,r=t._readableState,n=e||r;return!!(t.destroyed||t[cc]||n!=null&&n.destroyed)}function rp(t){if(!Li(t))return null;if(t.writableEnded===!0)return!0;const e=t._writableState;return e!=null&&e.errored?!1:typeof(e==null?void 0:e.ended)!="boolean"?null:e.ended}function np(t,e){if(!Li(t))return null;if(t.writableFinished===!0)return!0;const r=t._writableState;return r!=null&&r.errored?!1:typeof(r==null?void 0:r.finished)!="boolean"?null:!!(r.finished||e===!1&&r.ended===!0&&r.length===0)}function hc(t,e){if(!yo(t))return null;const r=t._readableState;return r!=null&&r.errored?!1:typeof(r==null?void 0:r.endEmitted)!="boolean"?null:!!(r.endEmitted||e===!1&&r.ended===!0&&r.length===0)}function pc(t){return t&&t[sa]!=null?t[sa]:typeof(t==null?void 0:t.readable)!="boolean"?null:Di(t)?!1:yo(t)&&t.readable&&!hc(t)}function gc(t){return t&&t[oa]!=null?t[oa]:typeof(t==null?void 0:t.writable)!="boolean"?null:Di(t)?!1:Li(t)&&t.writable&&!rp(t)}function ip(t,e){return gr(t)?Di(t)?!0:!((e==null?void 0:e.readable)!==!1&&pc(t)||(e==null?void 0:e.writable)!==!1&&gc(t)):null}function sp(t){var e,r;return gr(t)?t.writableErrored?t.writableErrored:(e=(r=t._writableState)===null||r===void 0?void 0:r.errored)!==null&&e!==void 0?e:null:null}function op(t){var e,r;return gr(t)?t.readableErrored?t.readableErrored:(e=(r=t._readableState)===null||r===void 0?void 0:r.errored)!==null&&e!==void 0?e:null:null}function ap(t){if(!gr(t))return null;if(typeof t.closed=="boolean")return t.closed;const e=t._writableState,r=t._readableState;return typeof(e==null?void 0:e.closed)=="boolean"||typeof(r==null?void 0:r.closed)=="boolean"?(e==null?void 0:e.closed)||(r==null?void 0:r.closed):typeof t._closed=="boolean"&&yc(t)?t._closed:null}function yc(t){return typeof t._closed=="boolean"&&typeof t._defaultKeepAlive=="boolean"&&typeof t._removedConnection=="boolean"&&typeof t._removedContLen=="boolean"}function up(t){return typeof t._sent100=="boolean"&&yc(t)}function cp(t){var e;return typeof t._consuming=="boolean"&&typeof t._dumped=="boolean"&&((e=t.req)===null||e===void 0?void 0:e.upgradeOrConnect)===void 0}function lp(t){if(!gr(t))return null;const e=t._writableState,r=t._readableState,n=e||r;return!n&&up(t)||!!(n&&n.autoDestroy&&n.emitClose&&n.closed===!1)}function dp(t){var e;return!!(t&&((e=t[Qh])!==null&&e!==void 0?e:t.readableDidRead||t.readableAborted))}function fp(t){var e,r,n,o,c,u,l,g,f,h;return!!(t&&((e=(r=(n=(o=(c=(u=t[Gh])!==null&&u!==void 0?u:t.readableErrored)!==null&&c!==void 0?c:t.writableErrored)!==null&&o!==void 0?o:(l=t._readableState)===null||l===void 0?void 0:l.errorEmitted)!==null&&n!==void 0?n:(g=t._writableState)===null||g===void 0?void 0:g.errorEmitted)!==null&&r!==void 0?r:(f=t._readableState)===null||f===void 0?void 0:f.errored)!==null&&e!==void 0?e:!((h=t._writableState)===null||h===void 0)&&h.errored))}var Fr={isDestroyed:Di,kIsDestroyed:cc,isDisturbed:dp,isErrored:fp,isReadable:pc,kIsClosedPromise:Yh,kControllerErrorFunction:Xh,isClosed:ap,isDuplexNodeStream:Zh,isFinished:ip,isIterable:tp,isReadableNodeStream:yo,isReadableStream:lc,isReadableFinished:hc,isReadableErrored:op,isNodeStream:gr,isWebStream:ep,isWritable:gc,isWritableNodeStream:Li,isWritableStream:dc,isWritableFinished:np,isWritableErrored:sp,isServerRequest:cp,willEmitClose:lp,isTransformStream:fc};const Tr=zr,{AbortError:mc,codes:hp}=jt,{ERR_INVALID_ARG_TYPE:pp,ERR_STREAM_PREMATURE_CLOSE:aa}=hp,{kEmptyObject:js,once:Ms}=Vt,{validateAbortSignal:gp,validateFunction:yp,validateObject:mp,validateBoolean:_p}=ei,{Promise:bp,PromisePrototypeThen:wp,SymbolDispose:_c}=ht,{isClosed:vp,isReadable:ua,isReadableNodeStream:us,isReadableStream:Sp,isReadableFinished:ca,isReadableErrored:la,isWritable:da,isWritableNodeStream:fa,isWritableStream:Ep,isWritableFinished:ha,isWritableErrored:pa,isNodeStream:xp,willEmitClose:Fp,kIsClosedPromise:Ap}=Fr;let gn;function Ip(t){return t.setHeader&&typeof t.abort=="function"}const Hs=()=>{};function bc(t,e,r){var n,o;if(arguments.length===2?(r=e,e=js):e==null?e=js:mp(e,"options"),yp(r,"callback"),gp(e.signal,"options.signal"),r=Ms(r),Sp(t)||Ep(t))return Tp(t,e,r);if(!xp(t))throw new pp("stream",["ReadableStream","WritableStream","Stream"],t);const c=(n=e.readable)!==null&&n!==void 0?n:us(t),u=(o=e.writable)!==null&&o!==void 0?o:fa(t),l=t._writableState,g=t._readableState,f=()=>{t.writable||v()};let h=Fp(t)&&us(t)===c&&fa(t)===u,p=ha(t,!1);const v=()=>{p=!0,t.destroyed&&(h=!1),!(h&&(!t.readable||c))&&(!c||x)&&r.call(t)};let x=ca(t,!1);const F=()=>{x=!0,t.destroyed&&(h=!1),!(h&&(!t.writable||u))&&(!u||p)&&r.call(t)},I=Y=>{r.call(t,Y)};let R=vp(t);const C=()=>{R=!0;const Y=pa(t)||la(t);if(Y&&typeof Y!="boolean")return r.call(t,Y);if(c&&!x&&us(t,!0)&&!ca(t,!1))return r.call(t,new aa);if(u&&!p&&!ha(t,!1))return r.call(t,new aa);r.call(t)},L=()=>{R=!0;const Y=pa(t)||la(t);if(Y&&typeof Y!="boolean")return r.call(t,Y);r.call(t)},N=()=>{t.req.on("finish",v)};Ip(t)?(t.on("complete",v),h||t.on("abort",C),t.req?N():t.on("request",N)):u&&!l&&(t.on("end",f),t.on("close",f)),!h&&typeof t.aborted=="boolean"&&t.on("aborted",C),t.on("end",F),t.on("finish",v),e.error!==!1&&t.on("error",I),t.on("close",C),R?Tr.nextTick(C):l!=null&&l.errorEmitted||g!=null&&g.errorEmitted?h||Tr.nextTick(L):(!c&&(!h||ua(t))&&(p||da(t)===!1)||!u&&(!h||da(t))&&(x||ua(t)===!1)||g&&t.req&&t.aborted)&&Tr.nextTick(L);const O=()=>{r=Hs,t.removeListener("aborted",C),t.removeListener("complete",v),t.removeListener("abort",C),t.removeListener("request",N),t.req&&t.req.removeListener("finish",v),t.removeListener("end",f),t.removeListener("close",f),t.removeListener("finish",v),t.removeListener("end",F),t.removeListener("error",I),t.removeListener("close",C)};if(e.signal&&!R){const Y=()=>{const Q=r;O(),Q.call(t,new mc(void 0,{cause:e.signal.reason}))};if(e.signal.aborted)Tr.nextTick(Y);else{gn=gn||Vt.addAbortListener;const Q=gn(e.signal,Y),W=r;r=Ms((...fe)=>{Q[_c](),W.apply(t,fe)})}}return O}function Tp(t,e,r){let n=!1,o=Hs;if(e.signal)if(o=()=>{n=!0,r.call(t,new mc(void 0,{cause:e.signal.reason}))},e.signal.aborted)Tr.nextTick(o);else{gn=gn||Vt.addAbortListener;const u=gn(e.signal,o),l=r;r=Ms((...g)=>{u[_c](),l.apply(t,g)})}const c=(...u)=>{n||Tr.nextTick(()=>r.apply(t,u))};return wp(t[Ap].promise,c,c),Hs}function Rp(t,e){var r;let n=!1;return e===null&&(e=js),(r=e)!==null&&r!==void 0&&r.cleanup&&(_p(e.cleanup,"cleanup"),n=e.cleanup),new bp((o,c)=>{const u=bc(t,e,l=>{n&&u(),l?c(l):o()})})}go.exports=bc;go.exports.finished=Rp;var kr=go.exports;const fr=zr,{aggregateTwoErrors:Pp,codes:{ERR_MULTIPLE_CALLBACK:kp},AbortError:Cp}=jt,{Symbol:wc}=ht,{kIsDestroyed:Np,isDestroyed:Lp,isFinished:Dp,isServerRequest:Up}=Fr,vc=wc("kDestroy"),$s=wc("kConstruct");function Sc(t,e,r){t&&(t.stack,e&&!e.errored&&(e.errored=t),r&&!r.errored&&(r.errored=t))}function Op(t,e){const r=this._readableState,n=this._writableState,o=n||r;return n!=null&&n.destroyed||r!=null&&r.destroyed?(typeof e=="function"&&e(),this):(Sc(t,n,r),n&&(n.destroyed=!0),r&&(r.destroyed=!0),o.constructed?ga(this,t,e):this.once(vc,function(c){ga(this,Pp(c,t),e)}),this)}function ga(t,e,r){let n=!1;function o(c){if(n)return;n=!0;const u=t._readableState,l=t._writableState;Sc(c,l,u),l&&(l.closed=!0),u&&(u.closed=!0),typeof r=="function"&&r(c),c?fr.nextTick(Bp,t,c):fr.nextTick(Ec,t)}try{t._destroy(e||null,o)}catch(c){o(c)}}function Bp(t,e){Ks(t,e),Ec(t)}function Ec(t){const e=t._readableState,r=t._writableState;r&&(r.closeEmitted=!0),e&&(e.closeEmitted=!0),(r!=null&&r.emitClose||e!=null&&e.emitClose)&&t.emit("close")}function Ks(t,e){const r=t._readableState,n=t._writableState;n!=null&&n.errorEmitted||r!=null&&r.errorEmitted||(n&&(n.errorEmitted=!0),r&&(r.errorEmitted=!0),t.emit("error",e))}function jp(){const t=this._readableState,e=this._writableState;t&&(t.constructed=!0,t.closed=!1,t.closeEmitted=!1,t.destroyed=!1,t.errored=null,t.errorEmitted=!1,t.reading=!1,t.ended=t.readable===!1,t.endEmitted=t.readable===!1),e&&(e.constructed=!0,e.destroyed=!1,e.closed=!1,e.closeEmitted=!1,e.errored=null,e.errorEmitted=!1,e.finalCalled=!1,e.prefinished=!1,e.ended=e.writable===!1,e.ending=e.writable===!1,e.finished=e.writable===!1)}function Ws(t,e,r){const n=t._readableState,o=t._writableState;if(o!=null&&o.destroyed||n!=null&&n.destroyed)return this;n!=null&&n.autoDestroy||o!=null&&o.autoDestroy?t.destroy(e):e&&(e.stack,o&&!o.errored&&(o.errored=e),n&&!n.errored&&(n.errored=e),r?fr.nextTick(Ks,t,e):Ks(t,e))}function Mp(t,e){if(typeof t._construct!="function")return;const r=t._readableState,n=t._writableState;r&&(r.constructed=!1),n&&(n.constructed=!1),t.once($s,e),!(t.listenerCount($s)>1)&&fr.nextTick(Hp,t)}function Hp(t){let e=!1;function r(n){if(e){Ws(t,n??new kp);return}e=!0;const o=t._readableState,c=t._writableState,u=c||o;o&&(o.constructed=!0),c&&(c.constructed=!0),u.destroyed?t.emit(vc,n):n?Ws(t,n,!0):fr.nextTick($p,t)}try{t._construct(n=>{fr.nextTick(r,n)})}catch(n){fr.nextTick(r,n)}}function $p(t){t.emit($s)}function ya(t){return(t==null?void 0:t.setHeader)&&typeof t.abort=="function"}function xc(t){t.emit("close")}function Kp(t,e){t.emit("error",e),fr.nextTick(xc,t)}function Wp(t,e){!t||Lp(t)||(!e&&!Dp(t)&&(e=new Cp),Up(t)?(t.socket=null,t.destroy(e)):ya(t)?t.abort():ya(t.req)?t.req.abort():typeof t.destroy=="function"?t.destroy(e):typeof t.close=="function"?t.close():e?fr.nextTick(Kp,t,e):fr.nextTick(xc,t),t.destroyed||(t[Np]=!0))}var En={construct:Mp,destroyer:Wp,destroy:Op,undestroy:jp,errorOrDestroy:Ws};const{ArrayIsArray:Vp,ObjectSetPrototypeOf:Fc}=ht,{EventEmitter:Ui}=Zn;function Oi(t){Ui.call(this,t)}Fc(Oi.prototype,Ui.prototype);Fc(Oi,Ui);Oi.prototype.pipe=function(t,e){const r=this;function n(h){t.writable&&t.write(h)===!1&&r.pause&&r.pause()}r.on("data",n);function o(){r.readable&&r.resume&&r.resume()}t.on("drain",o),!t._isStdio&&(!e||e.end!==!1)&&(r.on("end",u),r.on("close",l));let c=!1;function u(){c||(c=!0,t.end())}function l(){c||(c=!0,typeof t.destroy=="function"&&t.destroy())}function g(h){f(),Ui.listenerCount(this,"error")===0&&this.emit("error",h)}Vs(r,"error",g),Vs(t,"error",g);function f(){r.removeListener("data",n),t.removeListener("drain",o),r.removeListener("end",u),r.removeListener("close",l),r.removeListener("error",g),t.removeListener("error",g),r.removeListener("end",f),r.removeListener("close",f),t.removeListener("close",f)}return r.on("end",f),r.on("close",f),t.on("close",f),t.emit("pipe",r),t};function Vs(t,e,r){if(typeof t.prependListener=="function")return t.prependListener(e,r);!t._events||!t._events[e]?t.on(e,r):Vp(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]}var mo={Stream:Oi,prependListener:Vs},Ac={exports:{}};(function(t){const{SymbolDispose:e}=ht,{AbortError:r,codes:n}=jt,{isNodeStream:o,isWebStream:c,kControllerErrorFunction:u}=Fr,l=kr,{ERR_INVALID_ARG_TYPE:g}=n;let f;const h=(p,v)=>{if(typeof p!="object"||!("aborted"in p))throw new g(v,"AbortSignal",p)};t.exports.addAbortSignal=function(v,x){if(h(v,"signal"),!o(x)&&!c(x))throw new g("stream",["ReadableStream","WritableStream","Stream"],x);return t.exports.addAbortSignalNoValidate(v,x)},t.exports.addAbortSignalNoValidate=function(p,v){if(typeof p!="object"||!("aborted"in p))return v;const x=o(v)?()=>{v.destroy(new r(void 0,{cause:p.reason}))}:()=>{v[u](new r(void 0,{cause:p.reason}))};if(p.aborted)x();else{f=f||Vt.addAbortListener;const F=f(p,x);l(v,F[e])}return v}})(Ac);var Bi=Ac.exports;const{StringPrototypeSlice:ma,SymbolIterator:qp,TypedArrayPrototypeSet:oi,Uint8Array:Jp}=ht,{Buffer:cs}=pr,{inspect:zp}=Vt;var Gp=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){const r={data:e,next:null};this.length>0?this.tail.next=r:this.head=r,this.tail=r,++this.length}unshift(e){const r={data:e,next:this.head};this.length===0&&(this.tail=r),this.head=r,++this.length}shift(){if(this.length===0)return;const e=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(this.length===0)return"";let r=this.head,n=""+r.data;for(;(r=r.next)!==null;)n+=e+r.data;return n}concat(e){if(this.length===0)return cs.alloc(0);const r=cs.allocUnsafe(e>>>0);let n=this.head,o=0;for(;n;)oi(r,n.data,o),o+=n.data.length,n=n.next;return r}consume(e,r){const n=this.head.data;if(e<n.length){const o=n.slice(0,e);return this.head.data=n.slice(e),o}return e===n.length?this.shift():r?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[qp](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let r="",n=this.head,o=0;do{const c=n.data;if(e>c.length)r+=c,e-=c.length;else{e===c.length?(r+=c,++o,n.next?this.head=n.next:this.head=this.tail=null):(r+=ma(c,0,e),this.head=n,n.data=ma(c,e));break}++o}while((n=n.next)!==null);return this.length-=o,r}_getBuffer(e){const r=cs.allocUnsafe(e),n=e;let o=this.head,c=0;do{const u=o.data;if(e>u.length)oi(r,u,n-e),e-=u.length;else{e===u.length?(oi(r,u,n-e),++c,o.next?this.head=o.next:this.head=this.tail=null):(oi(r,new Jp(u.buffer,u.byteOffset,e),n-e),this.head=o,o.data=u.slice(e));break}++c}while((o=o.next)!==null);return this.length-=c,r}[Symbol.for("nodejs.util.inspect.custom")](e,r){return zp(this,{...r,depth:0,customInspect:!1})}};const{MathFloor:Qp,NumberIsInteger:Yp}=ht,{validateInteger:Xp}=ei,{ERR_INVALID_ARG_VALUE:Zp}=jt.codes;let Ic=16*1024,Tc=16;function eg(t,e,r){return t.highWaterMark!=null?t.highWaterMark:e?t[r]:null}function Rc(t){return t?Tc:Ic}function tg(t,e){Xp(e,"value",0),t?Tc=e:Ic=e}function rg(t,e,r,n){const o=eg(e,n,r);if(o!=null){if(!Yp(o)||o<0){const c=n?`options.${r}`:"options.highWaterMark";throw new Zp(c,o)}return Qp(o)}return Rc(t.objectMode)}var ji={getHighWaterMark:rg,getDefaultHighWaterMark:Rc,setDefaultHighWaterMark:tg},Pc={},qs={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(t,e){var r=pr,n=r.Buffer;function o(u,l){for(var g in u)l[g]=u[g]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=r:(o(r,e),e.Buffer=c);function c(u,l,g){return n(u,l,g)}c.prototype=Object.create(n.prototype),o(n,c),c.from=function(u,l,g){if(typeof u=="number")throw new TypeError("Argument must not be a number");return n(u,l,g)},c.alloc=function(u,l,g){if(typeof u!="number")throw new TypeError("Argument must be a number");var f=n(u);return l!==void 0?typeof g=="string"?f.fill(l,g):f.fill(l):f.fill(0),f},c.allocUnsafe=function(u){if(typeof u!="number")throw new TypeError("Argument must be a number");return n(u)},c.allocUnsafeSlow=function(u){if(typeof u!="number")throw new TypeError("Argument must be a number");return r.SlowBuffer(u)}})(qs,qs.exports);var ng=qs.exports,_o=ng.Buffer,_a=_o.isEncoding||function(t){switch(t=""+t,t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function ig(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function sg(t){var e=ig(t);if(typeof e!="string"&&(_o.isEncoding===_a||!_a(t)))throw new Error("Unknown encoding: "+t);return e||t}Pc.StringDecoder=ti;function ti(t){this.encoding=sg(t);var e;switch(this.encoding){case"utf16le":this.text=dg,this.end=fg,e=4;break;case"utf8":this.fillLast=ug,e=4;break;case"base64":this.text=hg,this.end=pg,e=3;break;default:this.write=gg,this.end=yg;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=_o.allocUnsafe(e)}ti.prototype.write=function(t){if(t.length===0)return"";var e,r;if(this.lastNeed){if(e=this.fillLast(t),e===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""};ti.prototype.end=lg;ti.prototype.text=cg;ti.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length};function ls(t){return t<=127?0:t>>5===6?2:t>>4===14?3:t>>3===30?4:t>>6===2?-1:-2}function og(t,e,r){var n=e.length-1;if(n<r)return 0;var o=ls(e[n]);return o>=0?(o>0&&(t.lastNeed=o-1),o):--n<r||o===-2?0:(o=ls(e[n]),o>=0?(o>0&&(t.lastNeed=o-2),o):--n<r||o===-2?0:(o=ls(e[n]),o>=0?(o>0&&(o===2?o=0:t.lastNeed=o-3),o):0))}function ag(t,e,r){if((e[0]&192)!==128)return t.lastNeed=0,"";if(t.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return t.lastNeed=1,"";if(t.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return t.lastNeed=2,""}}function ug(t){var e=this.lastTotal-this.lastNeed,r=ag(this,t);if(r!==void 0)return r;if(this.lastNeed<=t.length)return t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,e,0,t.length),this.lastNeed-=t.length}function cg(t,e){var r=og(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)}function lg(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"":e}function dg(t,e){if((t.length-e)%2===0){var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function fg(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function hg(t,e){var r=(t.length-e)%3;return r===0?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function pg(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function gg(t){return t.toString(this.encoding)}function yg(t){return t&&t.length?this.write(t):""}const ba=zr,{PromisePrototypeThen:mg,SymbolAsyncIterator:wa,SymbolIterator:va}=ht,{Buffer:_g}=pr,{ERR_INVALID_ARG_TYPE:bg,ERR_STREAM_NULL_VALUES:wg}=jt.codes;function vg(t,e,r){let n;if(typeof e=="string"||e instanceof _g)return new t({objectMode:!0,...r,read(){this.push(e),this.push(null)}});let o;if(e&&e[wa])o=!0,n=e[wa]();else if(e&&e[va])o=!1,n=e[va]();else throw new bg("iterable",["Iterable"],e);const c=new t({objectMode:!0,highWaterMark:1,...r});let u=!1;c._read=function(){u||(u=!0,g())},c._destroy=function(f,h){mg(l(f),()=>ba.nextTick(h,f),p=>ba.nextTick(h,p||f))};async function l(f){const h=f!=null,p=typeof n.throw=="function";if(h&&p){const{value:v,done:x}=await n.throw(f);if(await v,x)return}if(typeof n.return=="function"){const{value:v}=await n.return();await v}}async function g(){for(;;){try{const{value:f,done:h}=o?await n.next():n.next();if(h)c.push(null);else{const p=f&&typeof f.then=="function"?await f:f;if(p===null)throw u=!1,new wg;if(c.push(p))continue;u=!1}}catch(f){c.destroy(f)}break}}return c}var kc=vg,ds,Sa;function Mi(){if(Sa)return ds;Sa=1;const t=zr,{ArrayPrototypeIndexOf:e,NumberIsInteger:r,NumberIsNaN:n,NumberParseInt:o,ObjectDefineProperties:c,ObjectKeys:u,ObjectSetPrototypeOf:l,Promise:g,SafeSet:f,SymbolAsyncDispose:h,SymbolAsyncIterator:p,Symbol:v}=ht;ds=_e,_e.ReadableState=De;const{EventEmitter:x}=Zn,{Stream:F,prependListener:I}=mo,{Buffer:R}=pr,{addAbortSignal:C}=Bi,L=kr;let N=Vt.debuglog("stream",j=>{N=j});const O=Gp,Y=En,{getHighWaterMark:Q,getDefaultHighWaterMark:W}=ji,{aggregateTwoErrors:fe,codes:{ERR_INVALID_ARG_TYPE:de,ERR_METHOD_NOT_IMPLEMENTED:q,ERR_OUT_OF_RANGE:he,ERR_STREAM_PUSH_AFTER_EOF:ke,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:le},AbortError:Ue}=jt,{validateObject:Te}=ei,Ne=v("kPaused"),{StringDecoder:Oe}=Pc,He=kc;l(_e.prototype,F.prototype),l(_e,F);const Fe=()=>{},{errorOrDestroy:Pe}=Y,Ae=1,Me=2,Ie=4,We=8,it=16,wt=32,st=64,Ge=128,Qe=256,Je=512,X=1024,E=2048,m=4096,A=8192,D=16384,Z=32768,te=65536,me=1<<17,we=1<<18;function Re(j){return{enumerable:!1,get(){return(this.state&j)!==0},set(J){J?this.state|=j:this.state&=~j}}}c(De.prototype,{objectMode:Re(Ae),ended:Re(Me),endEmitted:Re(Ie),reading:Re(We),constructed:Re(it),sync:Re(wt),needReadable:Re(st),emittedReadable:Re(Ge),readableListening:Re(Qe),resumeScheduled:Re(Je),errorEmitted:Re(X),emitClose:Re(E),autoDestroy:Re(m),destroyed:Re(A),closed:Re(D),closeEmitted:Re(Z),multiAwaitDrain:Re(te),readingMore:Re(me),dataEmitted:Re(we)});function De(j,J,ge){typeof ge!="boolean"&&(ge=J instanceof vr()),this.state=E|m|it|wt,j&&j.objectMode&&(this.state|=Ae),ge&&j&&j.readableObjectMode&&(this.state|=Ae),this.highWaterMark=j?Q(this,j,"readableHighWaterMark",ge):W(!1),this.buffer=new O,this.length=0,this.pipes=[],this.flowing=null,this[Ne]=null,j&&j.emitClose===!1&&(this.state&=~E),j&&j.autoDestroy===!1&&(this.state&=~m),this.errored=null,this.defaultEncoding=j&&j.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,j&&j.encoding&&(this.decoder=new Oe(j.encoding),this.encoding=j.encoding)}function _e(j){if(!(this instanceof _e))return new _e(j);const J=this instanceof vr();this._readableState=new De(j,this,J),j&&(typeof j.read=="function"&&(this._read=j.read),typeof j.destroy=="function"&&(this._destroy=j.destroy),typeof j.construct=="function"&&(this._construct=j.construct),j.signal&&!J&&C(j.signal,this)),F.call(this,j),Y.construct(this,()=>{this._readableState.needReadable&&re(this,this._readableState)})}_e.prototype.destroy=Y.destroy,_e.prototype._undestroy=Y.undestroy,_e.prototype._destroy=function(j,J){J(j)},_e.prototype[x.captureRejectionSymbol]=function(j){this.destroy(j)},_e.prototype[h]=function(){let j;return this.destroyed||(j=this.readableEnded?null:new Ue,this.destroy(j)),new g((J,ge)=>L(this,ye=>ye&&ye!==j?ge(ye):J(null)))},_e.prototype.push=function(j,J){return tt(this,j,J,!1)},_e.prototype.unshift=function(j,J){return tt(this,j,J,!0)};function tt(j,J,ge,ye){N("readableAddChunk",J);const xe=j._readableState;let vt;if(xe.state&Ae||(typeof J=="string"?(ge=ge||xe.defaultEncoding,xe.encoding!==ge&&(ye&&xe.encoding?J=R.from(J,ge).toString(xe.encoding):(J=R.from(J,ge),ge=""))):J instanceof R?ge="":F._isUint8Array(J)?(J=F._uint8ArrayToBuffer(J),ge=""):J!=null&&(vt=new de("chunk",["string","Buffer","Uint8Array"],J))),vt)Pe(j,vt);else if(J===null)xe.state&=~We,_(j,xe);else if(xe.state&Ae||J&&J.length>0)if(ye)if(xe.state&Ie)Pe(j,new le);else{if(xe.destroyed||xe.errored)return!1;It(j,xe,J,!0)}else if(xe.ended)Pe(j,new ke);else{if(xe.destroyed||xe.errored)return!1;xe.state&=~We,xe.decoder&&!ge?(J=xe.decoder.write(J),xe.objectMode||J.length!==0?It(j,xe,J,!1):re(j,xe)):It(j,xe,J,!1)}else ye||(xe.state&=~We,re(j,xe));return!xe.ended&&(xe.length<xe.highWaterMark||xe.length===0)}function It(j,J,ge,ye){J.flowing&&J.length===0&&!J.sync&&j.listenerCount("data")>0?(J.state&te?J.awaitDrainWriters.clear():J.awaitDrainWriters=null,J.dataEmitted=!0,j.emit("data",ge)):(J.length+=J.objectMode?1:ge.length,ye?J.buffer.unshift(ge):J.buffer.push(ge),J.state&st&&w(j)),re(j,J)}_e.prototype.isPaused=function(){const j=this._readableState;return j[Ne]===!0||j.flowing===!1},_e.prototype.setEncoding=function(j){const J=new Oe(j);this._readableState.decoder=J,this._readableState.encoding=this._readableState.decoder.encoding;const ge=this._readableState.buffer;let ye="";for(const xe of ge)ye+=J.write(xe);return ge.clear(),ye!==""&&ge.push(ye),this._readableState.length=ye.length,this};const Se=1073741824;function rt(j){if(j>Se)throw new he("size","<= 1GiB",j);return j--,j|=j>>>1,j|=j>>>2,j|=j>>>4,j|=j>>>8,j|=j>>>16,j++,j}function T(j,J){return j<=0||J.length===0&&J.ended?0:J.state&Ae?1:n(j)?J.flowing&&J.length?J.buffer.first().length:J.length:j<=J.length?j:J.ended?J.length:0}_e.prototype.read=function(j){N("read",j),j===void 0?j=NaN:r(j)||(j=o(j,10));const J=this._readableState,ge=j;if(j>J.highWaterMark&&(J.highWaterMark=rt(j)),j!==0&&(J.state&=~Ge),j===0&&J.needReadable&&((J.highWaterMark!==0?J.length>=J.highWaterMark:J.length>0)||J.ended))return N("read: emitReadable",J.length,J.ended),J.length===0&&J.ended?Nr(this):w(this),null;if(j=T(j,J),j===0&&J.ended)return J.length===0&&Nr(this),null;let ye=(J.state&st)!==0;if(N("need readable",ye),(J.length===0||J.length-j<J.highWaterMark)&&(ye=!0,N("length less than watermark",ye)),J.ended||J.reading||J.destroyed||J.errored||!J.constructed)ye=!1,N("reading, ended or constructing",ye);else if(ye){N("do read"),J.state|=We|wt,J.length===0&&(J.state|=st);try{this._read(J.highWaterMark)}catch(vt){Pe(this,vt)}J.state&=~wt,J.reading||(j=T(ge,J))}let xe;return j>0?xe=Ye(j,J):xe=null,xe===null?(J.needReadable=J.length<=J.highWaterMark,j=0):(J.length-=j,J.multiAwaitDrain?J.awaitDrainWriters.clear():J.awaitDrainWriters=null),J.length===0&&(J.ended||(J.needReadable=!0),ge!==j&&J.ended&&Nr(this)),xe!==null&&!J.errorEmitted&&!J.closeEmitted&&(J.dataEmitted=!0,this.emit("data",xe)),xe};function _(j,J){if(N("onEofChunk"),!J.ended){if(J.decoder){const ge=J.decoder.end();ge&&ge.length&&(J.buffer.push(ge),J.length+=J.objectMode?1:ge.length)}J.ended=!0,J.sync?w(j):(J.needReadable=!1,J.emittedReadable=!0,b(j))}}function w(j){const J=j._readableState;N("emitReadable",J.needReadable,J.emittedReadable),J.needReadable=!1,J.emittedReadable||(N("emitReadable",J.flowing),J.emittedReadable=!0,t.nextTick(b,j))}function b(j){const J=j._readableState;N("emitReadable_",J.destroyed,J.length,J.ended),!J.destroyed&&!J.errored&&(J.length||J.ended)&&(j.emit("readable"),J.emittedReadable=!1),J.needReadable=!J.flowing&&!J.ended&&J.length<=J.highWaterMark,Ve(j)}function re(j,J){!J.readingMore&&J.constructed&&(J.readingMore=!0,t.nextTick(oe,j,J))}function oe(j,J){for(;!J.reading&&!J.ended&&(J.length<J.highWaterMark||J.flowing&&J.length===0);){const ge=J.length;if(N("maybeReadMore read 0"),j.read(0),ge===J.length)break}J.readingMore=!1}_e.prototype._read=function(j){throw new q("_read()")},_e.prototype.pipe=function(j,J){const ge=this,ye=this._readableState;ye.pipes.length===1&&(ye.multiAwaitDrain||(ye.multiAwaitDrain=!0,ye.awaitDrainWriters=new f(ye.awaitDrainWriters?[ye.awaitDrainWriters]:[]))),ye.pipes.push(j),N("pipe count=%d opts=%j",ye.pipes.length,J);const vt=(!J||J.end!==!1)&&j!==t.stdout&&j!==t.stderr?Lr:Xe;ye.endEmitted?t.nextTick(vt):ge.once("end",vt),j.on("unpipe",Tt);function Tt(Ze,Gt){N("onunpipe"),Ze===ge&&Gt&&Gt.hasUnpiped===!1&&(Gt.hasUnpiped=!0,Tn())}function Lr(){N("onend"),j.end()}let sr,In=!1;function Tn(){N("cleanup"),j.removeListener("close",Ur),j.removeListener("finish",en),sr&&j.removeListener("drain",sr),j.removeListener("error",Zr),j.removeListener("unpipe",Tt),ge.removeListener("end",Lr),ge.removeListener("end",Xe),ge.removeListener("data",Dr),In=!0,sr&&ye.awaitDrainWriters&&(!j._writableState||j._writableState.needDrain)&&sr()}function Rn(){In||(ye.pipes.length===1&&ye.pipes[0]===j?(N("false write response, pause",0),ye.awaitDrainWriters=j,ye.multiAwaitDrain=!1):ye.pipes.length>1&&ye.pipes.includes(j)&&(N("false write response, pause",ye.awaitDrainWriters.size),ye.awaitDrainWriters.add(j)),ge.pause()),sr||(sr=ne(ge,j),j.on("drain",sr))}ge.on("data",Dr);function Dr(Ze){N("ondata");const Gt=j.write(Ze);N("dest.write",Gt),Gt===!1&&Rn()}function Zr(Ze){if(N("onerror",Ze),Xe(),j.removeListener("error",Zr),j.listenerCount("error")===0){const Gt=j._writableState||j._readableState;Gt&&!Gt.errorEmitted?Pe(j,Ze):j.emit("error",Ze)}}I(j,"error",Zr);function Ur(){j.removeListener("finish",en),Xe()}j.once("close",Ur);function en(){N("onfinish"),j.removeListener("close",Ur),Xe()}j.once("finish",en);function Xe(){N("unpipe"),ge.unpipe(j)}return j.emit("pipe",ge),j.writableNeedDrain===!0?Rn():ye.flowing||(N("pipe resume"),ge.resume()),j};function ne(j,J){return function(){const ye=j._readableState;ye.awaitDrainWriters===J?(N("pipeOnDrain",1),ye.awaitDrainWriters=null):ye.multiAwaitDrain&&(N("pipeOnDrain",ye.awaitDrainWriters.size),ye.awaitDrainWriters.delete(J)),(!ye.awaitDrainWriters||ye.awaitDrainWriters.size===0)&&j.listenerCount("data")&&j.resume()}}_e.prototype.unpipe=function(j){const J=this._readableState,ge={hasUnpiped:!1};if(J.pipes.length===0)return this;if(!j){const xe=J.pipes;J.pipes=[],this.pause();for(let vt=0;vt<xe.length;vt++)xe[vt].emit("unpipe",this,{hasUnpiped:!1});return this}const ye=e(J.pipes,j);return ye===-1?this:(J.pipes.splice(ye,1),J.pipes.length===0&&this.pause(),j.emit("unpipe",this,ge),this)},_e.prototype.on=function(j,J){const ge=F.prototype.on.call(this,j,J),ye=this._readableState;return j==="data"?(ye.readableListening=this.listenerCount("readable")>0,ye.flowing!==!1&&this.resume()):j==="readable"&&!ye.endEmitted&&!ye.readableListening&&(ye.readableListening=ye.needReadable=!0,ye.flowing=!1,ye.emittedReadable=!1,N("on readable",ye.length,ye.reading),ye.length?w(this):ye.reading||t.nextTick(nt,this)),ge},_e.prototype.addListener=_e.prototype.on,_e.prototype.removeListener=function(j,J){const ge=F.prototype.removeListener.call(this,j,J);return j==="readable"&&t.nextTick(Be,this),ge},_e.prototype.off=_e.prototype.removeListener,_e.prototype.removeAllListeners=function(j){const J=F.prototype.removeAllListeners.apply(this,arguments);return(j==="readable"||j===void 0)&&t.nextTick(Be,this),J};function Be(j){const J=j._readableState;J.readableListening=j.listenerCount("readable")>0,J.resumeScheduled&&J[Ne]===!1?J.flowing=!0:j.listenerCount("data")>0?j.resume():J.readableListening||(J.flowing=null)}function nt(j){N("readable nexttick read 0"),j.read(0)}_e.prototype.resume=function(){const j=this._readableState;return j.flowing||(N("resume"),j.flowing=!j.readableListening,ze(this,j)),j[Ne]=!1,this};function ze(j,J){J.resumeScheduled||(J.resumeScheduled=!0,t.nextTick(qe,j,J))}function qe(j,J){N("resume",J.reading),J.reading||j.read(0),J.resumeScheduled=!1,j.emit("resume"),Ve(j),J.flowing&&!J.reading&&j.read(0)}_e.prototype.pause=function(){return N("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(N("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[Ne]=!0,this};function Ve(j){const J=j._readableState;for(N("flow",J.flowing);J.flowing&&j.read()!==null;);}_e.prototype.wrap=function(j){let J=!1;j.on("data",ye=>{!this.push(ye)&&j.pause&&(J=!0,j.pause())}),j.on("end",()=>{this.push(null)}),j.on("error",ye=>{Pe(this,ye)}),j.on("close",()=>{this.destroy()}),j.on("destroy",()=>{this.destroy()}),this._read=()=>{J&&j.resume&&(J=!1,j.resume())};const ge=u(j);for(let ye=1;ye<ge.length;ye++){const xe=ge[ye];this[xe]===void 0&&typeof j[xe]=="function"&&(this[xe]=j[xe].bind(j))}return this},_e.prototype[p]=function(){return Ar(this)},_e.prototype.iterator=function(j){return j!==void 0&&Te(j,"options"),Ar(this,j)};function Ar(j,J){typeof j.read!="function"&&(j=_e.wrap(j,{objectMode:!0}));const ge=gt(j,J);return ge.stream=j,ge}async function*gt(j,J){let ge=Fe;function ye(Tt){this===j?(ge(),ge=Fe):ge=Tt}j.on("readable",ye);let xe;const vt=L(j,{writable:!1},Tt=>{xe=Tt?fe(xe,Tt):null,ge(),ge=Fe});try{for(;;){const Tt=j.destroyed?null:j.read();if(Tt!==null)yield Tt;else{if(xe)throw xe;if(xe===null)return;await new g(ye)}}}catch(Tt){throw xe=fe(xe,Tt),xe}finally{(xe||(J==null?void 0:J.destroyOnReturn)!==!1)&&(xe===void 0||j._readableState.autoDestroy)?Y.destroyer(j,null):(j.off("readable",ye),vt())}}c(_e.prototype,{readable:{__proto__:null,get(){const j=this._readableState;return!!j&&j.readable!==!1&&!j.destroyed&&!j.errorEmitted&&!j.endEmitted},set(j){this._readableState&&(this._readableState.readable=!!j)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(j){this._readableState&&(this._readableState.flowing=j)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(j){this._readableState&&(this._readableState.destroyed=j)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),c(De.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[Ne]!==!1},set(j){this[Ne]=!!j}}}),_e._fromList=Ye;function Ye(j,J){if(J.length===0)return null;let ge;return J.objectMode?ge=J.buffer.shift():!j||j>=J.length?(J.decoder?ge=J.buffer.join(""):J.buffer.length===1?ge=J.buffer.first():ge=J.buffer.concat(J.length),J.buffer.clear()):ge=J.buffer.consume(j,J.decoder),ge}function Nr(j){const J=j._readableState;N("endReadable",J.endEmitted),J.endEmitted||(J.ended=!0,t.nextTick(yt,J,j))}function yt(j,J){if(N("endReadableNT",j.endEmitted,j.length),!j.errored&&!j.closeEmitted&&!j.endEmitted&&j.length===0){if(j.endEmitted=!0,J.emit("end"),J.writable&&J.allowHalfOpen===!1)t.nextTick(Mt,J);else if(j.autoDestroy){const ge=J._writableState;(!ge||ge.autoDestroy&&(ge.finished||ge.writable===!1))&&J.destroy()}}}function Mt(j){j.writable&&!j.writableEnded&&!j.destroyed&&j.end()}_e.from=function(j,J){return He(_e,j,J)};let Ht;function An(){return Ht===void 0&&(Ht={}),Ht}return _e.fromWeb=function(j,J){return An().newStreamReadableFromReadableStream(j,J)},_e.toWeb=function(j,J){return An().newReadableStreamFromStreamReadable(j,J)},_e.wrap=function(j,J){var ge,ye;return new _e({objectMode:(ge=(ye=j.readableObjectMode)!==null&&ye!==void 0?ye:j.objectMode)!==null&&ge!==void 0?ge:!0,...J,destroy(xe,vt){Y.destroyer(j,xe),vt(xe)}}).wrap(j)},ds}var fs,Ea;function bo(){if(Ea)return fs;Ea=1;const t=zr,{ArrayPrototypeSlice:e,Error:r,FunctionPrototypeSymbolHasInstance:n,ObjectDefineProperty:o,ObjectDefineProperties:c,ObjectSetPrototypeOf:u,StringPrototypeToLowerCase:l,Symbol:g,SymbolHasInstance:f}=ht;fs=Te,Te.WritableState=le;const{EventEmitter:h}=Zn,p=mo.Stream,{Buffer:v}=pr,x=En,{addAbortSignal:F}=Bi,{getHighWaterMark:I,getDefaultHighWaterMark:R}=ji,{ERR_INVALID_ARG_TYPE:C,ERR_METHOD_NOT_IMPLEMENTED:L,ERR_MULTIPLE_CALLBACK:N,ERR_STREAM_CANNOT_PIPE:O,ERR_STREAM_DESTROYED:Y,ERR_STREAM_ALREADY_FINISHED:Q,ERR_STREAM_NULL_VALUES:W,ERR_STREAM_WRITE_AFTER_END:fe,ERR_UNKNOWN_ENCODING:de}=jt.codes,{errorOrDestroy:q}=x;u(Te.prototype,p.prototype),u(Te,p);function he(){}const ke=g("kOnFinished");function le(m,A,D){typeof D!="boolean"&&(D=A instanceof vr()),this.objectMode=!!(m&&m.objectMode),D&&(this.objectMode=this.objectMode||!!(m&&m.writableObjectMode)),this.highWaterMark=m?I(this,m,"writableHighWaterMark",D):R(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const Z=!!(m&&m.decodeStrings===!1);this.decodeStrings=!Z,this.defaultEncoding=m&&m.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=Pe.bind(void 0,A),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,Ue(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!m||m.emitClose!==!1,this.autoDestroy=!m||m.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[ke]=[]}function Ue(m){m.buffered=[],m.bufferedIndex=0,m.allBuffers=!0,m.allNoop=!0}le.prototype.getBuffer=function(){return e(this.buffered,this.bufferedIndex)},o(le.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function Te(m){const A=this instanceof vr();if(!A&&!n(Te,this))return new Te(m);this._writableState=new le(m,this,A),m&&(typeof m.write=="function"&&(this._write=m.write),typeof m.writev=="function"&&(this._writev=m.writev),typeof m.destroy=="function"&&(this._destroy=m.destroy),typeof m.final=="function"&&(this._final=m.final),typeof m.construct=="function"&&(this._construct=m.construct),m.signal&&F(m.signal,this)),p.call(this,m),x.construct(this,()=>{const D=this._writableState;D.writing||We(this,D),Ge(this,D)})}o(Te,f,{__proto__:null,value:function(m){return n(this,m)?!0:this!==Te?!1:m&&m._writableState instanceof le}}),Te.prototype.pipe=function(){q(this,new O)};function Ne(m,A,D,Z){const te=m._writableState;if(typeof D=="function")Z=D,D=te.defaultEncoding;else{if(!D)D=te.defaultEncoding;else if(D!=="buffer"&&!v.isEncoding(D))throw new de(D);typeof Z!="function"&&(Z=he)}if(A===null)throw new W;if(!te.objectMode)if(typeof A=="string")te.decodeStrings!==!1&&(A=v.from(A,D),D="buffer");else if(A instanceof v)D="buffer";else if(p._isUint8Array(A))A=p._uint8ArrayToBuffer(A),D="buffer";else throw new C("chunk",["string","Buffer","Uint8Array"],A);let me;return te.ending?me=new fe:te.destroyed&&(me=new Y("write")),me?(t.nextTick(Z,me),q(m,me,!0),me):(te.pendingcb++,Oe(m,te,A,D,Z))}Te.prototype.write=function(m,A,D){return Ne(this,m,A,D)===!0},Te.prototype.cork=function(){this._writableState.corked++},Te.prototype.uncork=function(){const m=this._writableState;m.corked&&(m.corked--,m.writing||We(this,m))},Te.prototype.setDefaultEncoding=function(A){if(typeof A=="string"&&(A=l(A)),!v.isEncoding(A))throw new de(A);return this._writableState.defaultEncoding=A,this};function Oe(m,A,D,Z,te){const me=A.objectMode?1:D.length;A.length+=me;const we=A.length<A.highWaterMark;return we||(A.needDrain=!0),A.writing||A.corked||A.errored||!A.constructed?(A.buffered.push({chunk:D,encoding:Z,callback:te}),A.allBuffers&&Z!=="buffer"&&(A.allBuffers=!1),A.allNoop&&te!==he&&(A.allNoop=!1)):(A.writelen=me,A.writecb=te,A.writing=!0,A.sync=!0,m._write(D,Z,A.onwrite),A.sync=!1),we&&!A.errored&&!A.destroyed}function He(m,A,D,Z,te,me,we){A.writelen=Z,A.writecb=we,A.writing=!0,A.sync=!0,A.destroyed?A.onwrite(new Y("write")):D?m._writev(te,A.onwrite):m._write(te,me,A.onwrite),A.sync=!1}function Fe(m,A,D,Z){--A.pendingcb,Z(D),Ie(A),q(m,D)}function Pe(m,A){const D=m._writableState,Z=D.sync,te=D.writecb;if(typeof te!="function"){q(m,new N);return}D.writing=!1,D.writecb=null,D.length-=D.writelen,D.writelen=0,A?(A.stack,D.errored||(D.errored=A),m._readableState&&!m._readableState.errored&&(m._readableState.errored=A),Z?t.nextTick(Fe,m,D,A,te):Fe(m,D,A,te)):(D.buffered.length>D.bufferedIndex&&We(m,D),Z?D.afterWriteTickInfo!==null&&D.afterWriteTickInfo.cb===te?D.afterWriteTickInfo.count++:(D.afterWriteTickInfo={count:1,cb:te,stream:m,state:D},t.nextTick(Ae,D.afterWriteTickInfo)):Me(m,D,1,te))}function Ae({stream:m,state:A,count:D,cb:Z}){return A.afterWriteTickInfo=null,Me(m,A,D,Z)}function Me(m,A,D,Z){for(!A.ending&&!m.destroyed&&A.length===0&&A.needDrain&&(A.needDrain=!1,m.emit("drain"));D-- >0;)A.pendingcb--,Z();A.destroyed&&Ie(A),Ge(m,A)}function Ie(m){if(m.writing)return;for(let te=m.bufferedIndex;te<m.buffered.length;++te){var A;const{chunk:me,callback:we}=m.buffered[te],Re=m.objectMode?1:me.length;m.length-=Re,we((A=m.errored)!==null&&A!==void 0?A:new Y("write"))}const D=m[ke].splice(0);for(let te=0;te<D.length;te++){var Z;D[te]((Z=m.errored)!==null&&Z!==void 0?Z:new Y("end"))}Ue(m)}function We(m,A){if(A.corked||A.bufferProcessing||A.destroyed||!A.constructed)return;const{buffered:D,bufferedIndex:Z,objectMode:te}=A,me=D.length-Z;if(!me)return;let we=Z;if(A.bufferProcessing=!0,me>1&&m._writev){A.pendingcb-=me-1;const Re=A.allNoop?he:_e=>{for(let tt=we;tt<D.length;++tt)D[tt].callback(_e)},De=A.allNoop&&we===0?D:e(D,we);De.allBuffers=A.allBuffers,He(m,A,!0,A.length,De,"",Re),Ue(A)}else{do{const{chunk:Re,encoding:De,callback:_e}=D[we];D[we++]=null;const tt=te?1:Re.length;He(m,A,!1,tt,Re,De,_e)}while(we<D.length&&!A.writing);we===D.length?Ue(A):we>256?(D.splice(0,we),A.bufferedIndex=0):A.bufferedIndex=we}A.bufferProcessing=!1}Te.prototype._write=function(m,A,D){if(this._writev)this._writev([{chunk:m,encoding:A}],D);else throw new L("_write()")},Te.prototype._writev=null,Te.prototype.end=function(m,A,D){const Z=this._writableState;typeof m=="function"?(D=m,m=null,A=null):typeof A=="function"&&(D=A,A=null);let te;if(m!=null){const me=Ne(this,m,A);me instanceof r&&(te=me)}return Z.corked&&(Z.corked=1,this.uncork()),te||(!Z.errored&&!Z.ending?(Z.ending=!0,Ge(this,Z,!0),Z.ended=!0):Z.finished?te=new Q("end"):Z.destroyed&&(te=new Y("end"))),typeof D=="function"&&(te||Z.finished?t.nextTick(D,te):Z[ke].push(D)),this};function it(m){return m.ending&&!m.destroyed&&m.constructed&&m.length===0&&!m.errored&&m.buffered.length===0&&!m.finished&&!m.writing&&!m.errorEmitted&&!m.closeEmitted}function wt(m,A){let D=!1;function Z(te){if(D){q(m,te??N());return}if(D=!0,A.pendingcb--,te){const me=A[ke].splice(0);for(let we=0;we<me.length;we++)me[we](te);q(m,te,A.sync)}else it(A)&&(A.prefinished=!0,m.emit("prefinish"),A.pendingcb++,t.nextTick(Qe,m,A))}A.sync=!0,A.pendingcb++;try{m._final(Z)}catch(te){Z(te)}A.sync=!1}function st(m,A){!A.prefinished&&!A.finalCalled&&(typeof m._final=="function"&&!A.destroyed?(A.finalCalled=!0,wt(m,A)):(A.prefinished=!0,m.emit("prefinish")))}function Ge(m,A,D){it(A)&&(st(m,A),A.pendingcb===0&&(D?(A.pendingcb++,t.nextTick((Z,te)=>{it(te)?Qe(Z,te):te.pendingcb--},m,A)):it(A)&&(A.pendingcb++,Qe(m,A))))}function Qe(m,A){A.pendingcb--,A.finished=!0;const D=A[ke].splice(0);for(let Z=0;Z<D.length;Z++)D[Z]();if(m.emit("finish"),A.autoDestroy){const Z=m._readableState;(!Z||Z.autoDestroy&&(Z.endEmitted||Z.readable===!1))&&m.destroy()}}c(Te.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(m){this._writableState&&(this._writableState.destroyed=m)}},writable:{__proto__:null,get(){const m=this._writableState;return!!m&&m.writable!==!1&&!m.destroyed&&!m.errored&&!m.ending&&!m.ended},set(m){this._writableState&&(this._writableState.writable=!!m)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const m=this._writableState;return m?!m.destroyed&&!m.ending&&m.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const Je=x.destroy;Te.prototype.destroy=function(m,A){const D=this._writableState;return!D.destroyed&&(D.bufferedIndex<D.buffered.length||D[ke].length)&&t.nextTick(Ie,D),Je.call(this,m,A),this},Te.prototype._undestroy=x.undestroy,Te.prototype._destroy=function(m,A){A(m)},Te.prototype[h.captureRejectionSymbol]=function(m){this.destroy(m)};let X;function E(){return X===void 0&&(X={}),X}return Te.fromWeb=function(m,A){return E().newStreamWritableFromWritableStream(m,A)},Te.toWeb=function(m){return E().newWritableStreamFromStreamWritable(m)},fs}var hs,xa;function Sg(){if(xa)return hs;xa=1;const t=zr,e=pr,{isReadable:r,isWritable:n,isIterable:o,isNodeStream:c,isReadableNodeStream:u,isWritableNodeStream:l,isDuplexNodeStream:g,isReadableStream:f,isWritableStream:h}=Fr,p=kr,{AbortError:v,codes:{ERR_INVALID_ARG_TYPE:x,ERR_INVALID_RETURN_VALUE:F}}=jt,{destroyer:I}=En,R=vr(),C=Mi(),L=bo(),{createDeferredPromise:N}=Vt,O=kc,Y=globalThis.Blob||e.Blob,Q=typeof Y<"u"?function(le){return le instanceof Y}:function(le){return!1},W=globalThis.AbortController||Xn().AbortController,{FunctionPrototypeCall:fe}=ht;class de extends R{constructor(le){super(le),(le==null?void 0:le.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(le==null?void 0:le.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}hs=function ke(le,Ue){if(g(le))return le;if(u(le))return he({readable:le});if(l(le))return he({writable:le});if(c(le))return he({writable:!1,readable:!1});if(f(le))return he({readable:C.fromWeb(le)});if(h(le))return he({writable:L.fromWeb(le)});if(typeof le=="function"){const{value:Ne,write:Oe,final:He,destroy:Fe}=q(le);if(o(Ne))return O(de,Ne,{objectMode:!0,write:Oe,final:He,destroy:Fe});const Pe=Ne==null?void 0:Ne.then;if(typeof Pe=="function"){let Ae;const Me=fe(Pe,Ne,Ie=>{if(Ie!=null)throw new F("nully","body",Ie)},Ie=>{I(Ae,Ie)});return Ae=new de({objectMode:!0,readable:!1,write:Oe,final(Ie){He(async()=>{try{await Me,t.nextTick(Ie,null)}catch(We){t.nextTick(Ie,We)}})},destroy:Fe})}throw new F("Iterable, AsyncIterable or AsyncFunction",Ue,Ne)}if(Q(le))return ke(le.arrayBuffer());if(o(le))return O(de,le,{objectMode:!0,writable:!1});if(f(le==null?void 0:le.readable)&&h(le==null?void 0:le.writable))return de.fromWeb(le);if(typeof(le==null?void 0:le.writable)=="object"||typeof(le==null?void 0:le.readable)=="object"){const Ne=le!=null&&le.readable?u(le==null?void 0:le.readable)?le==null?void 0:le.readable:ke(le.readable):void 0,Oe=le!=null&&le.writable?l(le==null?void 0:le.writable)?le==null?void 0:le.writable:ke(le.writable):void 0;return he({readable:Ne,writable:Oe})}const Te=le==null?void 0:le.then;if(typeof Te=="function"){let Ne;return fe(Te,le,Oe=>{Oe!=null&&Ne.push(Oe),Ne.push(null)},Oe=>{I(Ne,Oe)}),Ne=new de({objectMode:!0,writable:!1,read(){}})}throw new x(Ue,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],le)};function q(ke){let{promise:le,resolve:Ue}=N();const Te=new W,Ne=Te.signal;return{value:ke(async function*(){for(;;){const He=le;le=null;const{chunk:Fe,done:Pe,cb:Ae}=await He;if(t.nextTick(Ae),Pe)return;if(Ne.aborted)throw new v(void 0,{cause:Ne.reason});({promise:le,resolve:Ue}=N()),yield Fe}}(),{signal:Ne}),write(He,Fe,Pe){const Ae=Ue;Ue=null,Ae({chunk:He,done:!1,cb:Pe})},final(He){const Fe=Ue;Ue=null,Fe({done:!0,cb:He})},destroy(He,Fe){Te.abort(),Fe(He)}}}function he(ke){const le=ke.readable&&typeof ke.readable.read!="function"?C.wrap(ke.readable):ke.readable,Ue=ke.writable;let Te=!!r(le),Ne=!!n(Ue),Oe,He,Fe,Pe,Ae;function Me(Ie){const We=Pe;Pe=null,We?We(Ie):Ie&&Ae.destroy(Ie)}return Ae=new de({readableObjectMode:!!(le!=null&&le.readableObjectMode),writableObjectMode:!!(Ue!=null&&Ue.writableObjectMode),readable:Te,writable:Ne}),Ne&&(p(Ue,Ie=>{Ne=!1,Ie&&I(le,Ie),Me(Ie)}),Ae._write=function(Ie,We,it){Ue.write(Ie,We)?it():Oe=it},Ae._final=function(Ie){Ue.end(),He=Ie},Ue.on("drain",function(){if(Oe){const Ie=Oe;Oe=null,Ie()}}),Ue.on("finish",function(){if(He){const Ie=He;He=null,Ie()}})),Te&&(p(le,Ie=>{Te=!1,Ie&&I(le,Ie),Me(Ie)}),le.on("readable",function(){if(Fe){const Ie=Fe;Fe=null,Ie()}}),le.on("end",function(){Ae.push(null)}),Ae._read=function(){for(;;){const Ie=le.read();if(Ie===null){Fe=Ae._read;return}if(!Ae.push(Ie))return}}),Ae._destroy=function(Ie,We){!Ie&&Pe!==null&&(Ie=new v),Fe=null,Oe=null,He=null,Pe===null?We(Ie):(Pe=We,I(Ue,Ie),I(le,Ie))},Ae}return hs}var ps,Fa;function vr(){if(Fa)return ps;Fa=1;const{ObjectDefineProperties:t,ObjectGetOwnPropertyDescriptor:e,ObjectKeys:r,ObjectSetPrototypeOf:n}=ht;ps=u;const o=Mi(),c=bo();n(u.prototype,o.prototype),n(u,o);{const h=r(c.prototype);for(let p=0;p<h.length;p++){const v=h[p];u.prototype[v]||(u.prototype[v]=c.prototype[v])}}function u(h){if(!(this instanceof u))return new u(h);o.call(this,h),c.call(this,h),h?(this.allowHalfOpen=h.allowHalfOpen!==!1,h.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),h.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}t(u.prototype,{writable:{__proto__:null,...e(c.prototype,"writable")},writableHighWaterMark:{__proto__:null,...e(c.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...e(c.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...e(c.prototype,"writableBuffer")},writableLength:{__proto__:null,...e(c.prototype,"writableLength")},writableFinished:{__proto__:null,...e(c.prototype,"writableFinished")},writableCorked:{__proto__:null,...e(c.prototype,"writableCorked")},writableEnded:{__proto__:null,...e(c.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...e(c.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(h){this._readableState&&this._writableState&&(this._readableState.destroyed=h,this._writableState.destroyed=h)}}});let l;function g(){return l===void 0&&(l={}),l}u.fromWeb=function(h,p){return g().newStreamDuplexFromReadableWritablePair(h,p)},u.toWeb=function(h){return g().newReadableWritablePairFromDuplex(h)};let f;return u.from=function(h){return f||(f=Sg()),f(h,"body")},ps}const{ObjectSetPrototypeOf:Cc,Symbol:Eg}=ht;var Nc=Sr;const{ERR_METHOD_NOT_IMPLEMENTED:xg}=jt.codes,wo=vr(),{getHighWaterMark:Fg}=ji;Cc(Sr.prototype,wo.prototype);Cc(Sr,wo);const Jn=Eg("kCallback");function Sr(t){if(!(this instanceof Sr))return new Sr(t);const e=t?Fg(this,t,"readableHighWaterMark",!0):null;e===0&&(t={...t,highWaterMark:null,readableHighWaterMark:e,writableHighWaterMark:t.writableHighWaterMark||0}),wo.call(this,t),this._readableState.sync=!1,this[Jn]=null,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",Ag)}function Js(t){typeof this._flush=="function"&&!this.destroyed?this._flush((e,r)=>{if(e){t?t(e):this.destroy(e);return}r!=null&&this.push(r),this.push(null),t&&t()}):(this.push(null),t&&t())}function Ag(){this._final!==Js&&Js.call(this)}Sr.prototype._final=Js;Sr.prototype._transform=function(t,e,r){throw new xg("_transform()")};Sr.prototype._write=function(t,e,r){const n=this._readableState,o=this._writableState,c=n.length;this._transform(t,e,(u,l)=>{if(u){r(u);return}l!=null&&this.push(l),o.ended||c===n.length||n.length<n.highWaterMark?r():this[Jn]=r})};Sr.prototype._read=function(){if(this[Jn]){const t=this[Jn];this[Jn]=null,t()}};const{ObjectSetPrototypeOf:Lc}=ht;var Dc=bn;const vo=Nc;Lc(bn.prototype,vo.prototype);Lc(bn,vo);function bn(t){if(!(this instanceof bn))return new bn(t);vo.call(this,t)}bn.prototype._transform=function(t,e,r){r(null,t)};const Kn=zr,{ArrayIsArray:Ig,Promise:Tg,SymbolAsyncIterator:Rg,SymbolDispose:Pg}=ht,Fi=kr,{once:kg}=Vt,Cg=En,Aa=vr(),{aggregateTwoErrors:Ng,codes:{ERR_INVALID_ARG_TYPE:zs,ERR_INVALID_RETURN_VALUE:gs,ERR_MISSING_ARGS:Lg,ERR_STREAM_DESTROYED:Dg,ERR_STREAM_PREMATURE_CLOSE:Ug},AbortError:Og}=jt,{validateFunction:Bg,validateAbortSignal:jg}=ei,{isIterable:Kr,isReadable:ys,isReadableNodeStream:bi,isNodeStream:Ia,isTransformStream:ln,isWebStream:Mg,isReadableStream:ms,isReadableFinished:Hg}=Fr,$g=globalThis.AbortController||Xn().AbortController;let _s,bs,ws;function Ta(t,e,r){let n=!1;t.on("close",()=>{n=!0});const o=Fi(t,{readable:e,writable:r},c=>{n=!c});return{destroy:c=>{n||(n=!0,Cg.destroyer(t,c||new Dg("pipe")))},cleanup:o}}function Kg(t){return Bg(t[t.length-1],"streams[stream.length - 1]"),t.pop()}function vs(t){if(Kr(t))return t;if(bi(t))return Wg(t);throw new zs("val",["Readable","Iterable","AsyncIterable"],t)}async function*Wg(t){bs||(bs=Mi()),yield*bs.prototype[Rg].call(t)}async function ai(t,e,r,{end:n}){let o,c=null;const u=f=>{if(f&&(o=f),c){const h=c;c=null,h()}},l=()=>new Tg((f,h)=>{o?h(o):c=()=>{o?h(o):f()}});e.on("drain",u);const g=Fi(e,{readable:!1},u);try{e.writableNeedDrain&&await l();for await(const f of t)e.write(f)||await l();n&&(e.end(),await l()),r()}catch(f){r(o!==f?Ng(o,f):f)}finally{g(),e.off("drain",u)}}async function Ss(t,e,r,{end:n}){ln(e)&&(e=e.writable);const o=e.getWriter();try{for await(const c of t)await o.ready,o.write(c).catch(()=>{});await o.ready,n&&await o.close(),r()}catch(c){try{await o.abort(c),r(c)}catch(u){r(u)}}}function Vg(...t){return Uc(t,kg(Kg(t)))}function Uc(t,e,r){if(t.length===1&&Ig(t[0])&&(t=t[0]),t.length<2)throw new Lg("streams");const n=new $g,o=n.signal,c=r==null?void 0:r.signal,u=[];jg(c,"options.signal");function l(){F(new Og)}ws=ws||Vt.addAbortListener;let g;c&&(g=ws(c,l));let f,h;const p=[];let v=0;function x(N){F(N,--v===0)}function F(N,O){var Y;if(N&&(!f||f.code==="ERR_STREAM_PREMATURE_CLOSE")&&(f=N),!(!f&&!O)){for(;p.length;)p.shift()(f);(Y=g)===null||Y===void 0||Y[Pg](),n.abort(),O&&(f||u.forEach(Q=>Q()),Kn.nextTick(e,f,h))}}let I;for(let N=0;N<t.length;N++){const O=t[N],Y=N<t.length-1,Q=N>0,W=Y||(r==null?void 0:r.end)!==!1,fe=N===t.length-1;if(Ia(O)){let de=function(q){q&&q.name!=="AbortError"&&q.code!=="ERR_STREAM_PREMATURE_CLOSE"&&x(q)};var L=de;if(W){const{destroy:q,cleanup:he}=Ta(O,Y,Q);p.push(q),ys(O)&&fe&&u.push(he)}O.on("error",de),ys(O)&&fe&&u.push(()=>{O.removeListener("error",de)})}if(N===0)if(typeof O=="function"){if(I=O({signal:o}),!Kr(I))throw new gs("Iterable, AsyncIterable or Stream","source",I)}else Kr(O)||bi(O)||ln(O)?I=O:I=Aa.from(O);else if(typeof O=="function"){if(ln(I)){var R;I=vs((R=I)===null||R===void 0?void 0:R.readable)}else I=vs(I);if(I=O(I,{signal:o}),Y){if(!Kr(I,!0))throw new gs("AsyncIterable",`transform[${N-1}]`,I)}else{var C;_s||(_s=Dc);const de=new _s({objectMode:!0}),q=(C=I)===null||C===void 0?void 0:C.then;if(typeof q=="function")v++,q.call(I,le=>{h=le,le!=null&&de.write(le),W&&de.end(),Kn.nextTick(x)},le=>{de.destroy(le),Kn.nextTick(x,le)});else if(Kr(I,!0))v++,ai(I,de,x,{end:W});else if(ms(I)||ln(I)){const le=I.readable||I;v++,ai(le,de,x,{end:W})}else throw new gs("AsyncIterable or Promise","destination",I);I=de;const{destroy:he,cleanup:ke}=Ta(I,!1,!0);p.push(he),fe&&u.push(ke)}}else if(Ia(O)){if(bi(I)){v+=2;const de=qg(I,O,x,{end:W});ys(O)&&fe&&u.push(de)}else if(ln(I)||ms(I)){const de=I.readable||I;v++,ai(de,O,x,{end:W})}else if(Kr(I))v++,ai(I,O,x,{end:W});else throw new zs("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],I);I=O}else if(Mg(O)){if(bi(I))v++,Ss(vs(I),O,x,{end:W});else if(ms(I)||Kr(I))v++,Ss(I,O,x,{end:W});else if(ln(I))v++,Ss(I.readable,O,x,{end:W});else throw new zs("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],I);I=O}else I=Aa.from(O)}return(o!=null&&o.aborted||c!=null&&c.aborted)&&Kn.nextTick(l),I}function qg(t,e,r,{end:n}){let o=!1;if(e.on("close",()=>{o||r(new Ug)}),t.pipe(e,{end:!1}),n){let u=function(){o=!0,e.end()};var c=u;Hg(t)?Kn.nextTick(u):t.once("end",u)}else r();return Fi(t,{readable:!0,writable:!1},u=>{const l=t._readableState;u&&u.code==="ERR_STREAM_PREMATURE_CLOSE"&&l&&l.ended&&!l.errored&&!l.errorEmitted?t.once("end",r).once("error",r):r(u)}),Fi(e,{readable:!1,writable:!0},r)}var So={pipelineImpl:Uc,pipeline:Vg};const{pipeline:Jg}=So,ui=vr(),{destroyer:zg}=En,{isNodeStream:ci,isReadable:Ra,isWritable:Pa,isWebStream:Es,isTransformStream:Hr,isWritableStream:ka,isReadableStream:Ca}=Fr,{AbortError:Gg,codes:{ERR_INVALID_ARG_VALUE:Na,ERR_MISSING_ARGS:Qg}}=jt,Yg=kr;var Oc=function(...e){if(e.length===0)throw new Qg("streams");if(e.length===1)return ui.from(e[0]);const r=[...e];if(typeof e[0]=="function"&&(e[0]=ui.from(e[0])),typeof e[e.length-1]=="function"){const x=e.length-1;e[x]=ui.from(e[x])}for(let x=0;x<e.length;++x)if(!(!ci(e[x])&&!Es(e[x]))){if(x<e.length-1&&!(Ra(e[x])||Ca(e[x])||Hr(e[x])))throw new Na(`streams[${x}]`,r[x],"must be readable");if(x>0&&!(Pa(e[x])||ka(e[x])||Hr(e[x])))throw new Na(`streams[${x}]`,r[x],"must be writable")}let n,o,c,u,l;function g(x){const F=u;u=null,F?F(x):x?l.destroy(x):!v&&!p&&l.destroy()}const f=e[0],h=Jg(e,g),p=!!(Pa(f)||ka(f)||Hr(f)),v=!!(Ra(h)||Ca(h)||Hr(h));if(l=new ui({writableObjectMode:!!(f!=null&&f.writableObjectMode),readableObjectMode:!!(h!=null&&h.readableObjectMode),writable:p,readable:v}),p){if(ci(f))l._write=function(F,I,R){f.write(F,I)?R():n=R},l._final=function(F){f.end(),o=F},f.on("drain",function(){if(n){const F=n;n=null,F()}});else if(Es(f)){const I=(Hr(f)?f.writable:f).getWriter();l._write=async function(R,C,L){try{await I.ready,I.write(R).catch(()=>{}),L()}catch(N){L(N)}},l._final=async function(R){try{await I.ready,I.close().catch(()=>{}),o=R}catch(C){R(C)}}}const x=Hr(h)?h.readable:h;Yg(x,()=>{if(o){const F=o;o=null,F()}})}if(v){if(ci(h))h.on("readable",function(){if(c){const x=c;c=null,x()}}),h.on("end",function(){l.push(null)}),l._read=function(){for(;;){const x=h.read();if(x===null){c=l._read;return}if(!l.push(x))return}};else if(Es(h)){const F=(Hr(h)?h.readable:h).getReader();l._read=async function(){for(;;)try{const{value:I,done:R}=await F.read();if(!l.push(I))return;if(R){l.push(null);return}}catch{return}}}}return l._destroy=function(x,F){!x&&u!==null&&(x=new Gg),c=null,n=null,o=null,u===null?F(x):(u=F,ci(h)&&zg(h,x))},l};const Xg=globalThis.AbortController||Xn().AbortController,{codes:{ERR_INVALID_ARG_VALUE:Zg,ERR_INVALID_ARG_TYPE:ri,ERR_MISSING_ARGS:e0,ERR_OUT_OF_RANGE:t0},AbortError:hr}=jt,{validateAbortSignal:Qr,validateInteger:La,validateObject:Yr}=ei,r0=ht.Symbol("kWeak"),n0=ht.Symbol("kResistStopPropagation"),{finished:i0}=kr,s0=Oc,{addAbortSignalNoValidate:o0}=Bi,{isWritable:a0,isNodeStream:u0}=Fr,{deprecate:c0}=Vt,{ArrayPrototypePush:l0,Boolean:d0,MathFloor:Da,Number:f0,NumberIsNaN:h0,Promise:Ua,PromiseReject:Oa,PromiseResolve:p0,PromisePrototypeThen:Ba,Symbol:Bc}=ht,Ai=Bc("kEmpty"),ja=Bc("kEof");function g0(t,e){if(e!=null&&Yr(e,"options"),(e==null?void 0:e.signal)!=null&&Qr(e.signal,"options.signal"),u0(t)&&!a0(t))throw new Zg("stream",t,"must be writable");const r=s0(this,t);return e!=null&&e.signal&&o0(e.signal,r),r}function Hi(t,e){if(typeof t!="function")throw new ri("fn",["Function","AsyncFunction"],t);e!=null&&Yr(e,"options"),(e==null?void 0:e.signal)!=null&&Qr(e.signal,"options.signal");let r=1;(e==null?void 0:e.concurrency)!=null&&(r=Da(e.concurrency));let n=r-1;return(e==null?void 0:e.highWaterMark)!=null&&(n=Da(e.highWaterMark)),La(r,"options.concurrency",1),La(n,"options.highWaterMark",0),n+=r,(async function*(){const c=Vt.AbortSignalAny([e==null?void 0:e.signal].filter(d0)),u=this,l=[],g={signal:c};let f,h,p=!1,v=0;function x(){p=!0,F()}function F(){v-=1,I()}function I(){h&&!p&&v<r&&l.length<n&&(h(),h=null)}async function R(){try{for await(let C of u){if(p)return;if(c.aborted)throw new hr;try{if(C=t(C,g),C===Ai)continue;C=p0(C)}catch(L){C=Oa(L)}v+=1,Ba(C,F,x),l.push(C),f&&(f(),f=null),!p&&(l.length>=n||v>=r)&&await new Ua(L=>{h=L})}l.push(ja)}catch(C){const L=Oa(C);Ba(L,F,x),l.push(L)}finally{p=!0,f&&(f(),f=null)}}R();try{for(;;){for(;l.length>0;){const C=await l[0];if(C===ja)return;if(c.aborted)throw new hr;C!==Ai&&(yield C),l.shift(),I()}await new Ua(C=>{f=C})}}finally{p=!0,h&&(h(),h=null)}}).call(this)}function y0(t=void 0){return t!=null&&Yr(t,"options"),(t==null?void 0:t.signal)!=null&&Qr(t.signal,"options.signal"),(async function*(){let r=0;for await(const o of this){var n;if(t!=null&&(n=t.signal)!==null&&n!==void 0&&n.aborted)throw new hr({cause:t.signal.reason});yield[r++,o]}}).call(this)}async function jc(t,e=void 0){for await(const r of Eo.call(this,t,e))return!0;return!1}async function m0(t,e=void 0){if(typeof t!="function")throw new ri("fn",["Function","AsyncFunction"],t);return!await jc.call(this,async(...r)=>!await t(...r),e)}async function _0(t,e){for await(const r of Eo.call(this,t,e))return r}async function b0(t,e){if(typeof t!="function")throw new ri("fn",["Function","AsyncFunction"],t);async function r(n,o){return await t(n,o),Ai}for await(const n of Hi.call(this,r,e));}function Eo(t,e){if(typeof t!="function")throw new ri("fn",["Function","AsyncFunction"],t);async function r(n,o){return await t(n,o)?n:Ai}return Hi.call(this,r,e)}class w0 extends e0{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function v0(t,e,r){var n;if(typeof t!="function")throw new ri("reducer",["Function","AsyncFunction"],t);r!=null&&Yr(r,"options"),(r==null?void 0:r.signal)!=null&&Qr(r.signal,"options.signal");let o=arguments.length>1;if(r!=null&&(n=r.signal)!==null&&n!==void 0&&n.aborted){const f=new hr(void 0,{cause:r.signal.reason});throw this.once("error",()=>{}),await i0(this.destroy(f)),f}const c=new Xg,u=c.signal;if(r!=null&&r.signal){const f={once:!0,[r0]:this,[n0]:!0};r.signal.addEventListener("abort",()=>c.abort(),f)}let l=!1;try{for await(const f of this){var g;if(l=!0,r!=null&&(g=r.signal)!==null&&g!==void 0&&g.aborted)throw new hr;o?e=await t(e,f,{signal:u}):(e=f,o=!0)}if(!l&&!o)throw new w0}finally{c.abort()}return e}async function S0(t){t!=null&&Yr(t,"options"),(t==null?void 0:t.signal)!=null&&Qr(t.signal,"options.signal");const e=[];for await(const n of this){var r;if(t!=null&&(r=t.signal)!==null&&r!==void 0&&r.aborted)throw new hr(void 0,{cause:t.signal.reason});l0(e,n)}return e}function E0(t,e){const r=Hi.call(this,t,e);return(async function*(){for await(const o of r)yield*o}).call(this)}function Mc(t){if(t=f0(t),h0(t))return 0;if(t<0)throw new t0("number",">= 0",t);return t}function x0(t,e=void 0){return e!=null&&Yr(e,"options"),(e==null?void 0:e.signal)!=null&&Qr(e.signal,"options.signal"),t=Mc(t),(async function*(){var n;if(e!=null&&(n=e.signal)!==null&&n!==void 0&&n.aborted)throw new hr;for await(const c of this){var o;if(e!=null&&(o=e.signal)!==null&&o!==void 0&&o.aborted)throw new hr;t--<=0&&(yield c)}}).call(this)}function F0(t,e=void 0){return e!=null&&Yr(e,"options"),(e==null?void 0:e.signal)!=null&&Qr(e.signal,"options.signal"),t=Mc(t),(async function*(){var n;if(e!=null&&(n=e.signal)!==null&&n!==void 0&&n.aborted)throw new hr;for await(const c of this){var o;if(e!=null&&(o=e.signal)!==null&&o!==void 0&&o.aborted)throw new hr;if(t-- >0&&(yield c),t<=0)return}}).call(this)}ho.streamReturningOperators={asIndexedPairs:c0(y0,"readable.asIndexedPairs will be removed in a future version."),drop:x0,filter:Eo,flatMap:E0,map:Hi,take:F0,compose:g0};ho.promiseReturningOperators={every:m0,forEach:b0,reduce:v0,toArray:S0,some:jc,find:_0};var xs,Ma;function Hc(){if(Ma)return xs;Ma=1;const{ArrayPrototypePop:t,Promise:e}=ht,{isIterable:r,isNodeStream:n,isWebStream:o}=Fr,{pipelineImpl:c}=So,{finished:u}=kr;$c();function l(...g){return new e((f,h)=>{let p,v;const x=g[g.length-1];if(x&&typeof x=="object"&&!n(x)&&!r(x)&&!o(x)){const F=t(g);p=F.signal,v=F.end}c(g,(F,I)=>{F?h(F):f(I)},{signal:p,end:v})})}return xs={finished:u,pipeline:l},xs}var Ha;function $c(){if(Ha)return os.exports;Ha=1;const{Buffer:t}=pr,{ObjectDefineProperty:e,ObjectKeys:r,ReflectApply:n}=ht,{promisify:{custom:o}}=Vt,{streamReturningOperators:c,promiseReturningOperators:u}=ho,{codes:{ERR_ILLEGAL_CONSTRUCTOR:l}}=jt,g=Oc,{setDefaultHighWaterMark:f,getDefaultHighWaterMark:h}=ji,{pipeline:p}=So,{destroyer:v}=En,x=kr,F=Hc(),I=Fr,R=os.exports=mo.Stream;R.isDestroyed=I.isDestroyed,R.isDisturbed=I.isDisturbed,R.isErrored=I.isErrored,R.isReadable=I.isReadable,R.isWritable=I.isWritable,R.Readable=Mi();for(const N of r(c)){let Y=function(...Q){if(new.target)throw l();return R.Readable.from(n(O,this,Q))};var L=Y;const O=c[N];e(Y,"name",{__proto__:null,value:O.name}),e(Y,"length",{__proto__:null,value:O.length}),e(R.Readable.prototype,N,{__proto__:null,value:Y,enumerable:!1,configurable:!0,writable:!0})}for(const N of r(u)){let Y=function(...W){if(new.target)throw l();return n(O,this,W)};var L=Y;const O=u[N];e(Y,"name",{__proto__:null,value:O.name}),e(Y,"length",{__proto__:null,value:O.length}),e(R.Readable.prototype,N,{__proto__:null,value:Y,enumerable:!1,configurable:!0,writable:!0})}R.Writable=bo(),R.Duplex=vr(),R.Transform=Nc,R.PassThrough=Dc,R.pipeline=p;const{addAbortSignal:C}=Bi;return R.addAbortSignal=C,R.finished=x,R.destroy=v,R.compose=g,R.setDefaultHighWaterMark=f,R.getDefaultHighWaterMark=h,e(R,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return F}}),e(p,o,{__proto__:null,enumerable:!0,get(){return F.pipeline}}),e(x,o,{__proto__:null,enumerable:!0,get(){return F.finished}}),R.Stream=R,R._isUint8Array=function(O){return O instanceof Uint8Array},R._uint8ArrayToBuffer=function(O){return t.from(O.buffer,O.byteOffset,O.byteLength)},os.exports}(function(t){const e=$c(),r=Hc(),n=e.Readable.destroy;t.exports=e.Readable,t.exports._uint8ArrayToBuffer=e._uint8ArrayToBuffer,t.exports._isUint8Array=e._isUint8Array,t.exports.isDisturbed=e.isDisturbed,t.exports.isErrored=e.isErrored,t.exports.isReadable=e.isReadable,t.exports.Readable=e.Readable,t.exports.Writable=e.Writable,t.exports.Duplex=e.Duplex,t.exports.Transform=e.Transform,t.exports.PassThrough=e.PassThrough,t.exports.addAbortSignal=e.addAbortSignal,t.exports.finished=e.finished,t.exports.destroy=e.destroy,t.exports.destroy=n,t.exports.pipeline=e.pipeline,t.exports.compose=e.compose,Object.defineProperty(e,"promises",{configurable:!0,enumerable:!0,get(){return r}}),t.exports.Stream=e.Stream,t.exports.default=t.exports})(ec);var Kc=ec.exports;class $a extends Error{}const A0="application/problem+json",I0=new URL("about:blank");function Ka(t,e){if(t!==void 0)try{return new URL(t,e)}catch{}}function T0(t){let e,r,n,o,c;if(t.headers.get("Content-Type")===A0)try{const u=JSON.parse(t.body),l=Ka(u.type,t.url);l!==void 0&&(e=l),typeof u.title=="string"&&(r=u.title),typeof u.status=="number"&&(n=u.status),typeof u.detail=="string"&&(o=u.detail);const g=Ka(u.instance,t.url);g!==void 0&&(c=g)}catch{}return Object.freeze({type:e??I0,title:r??t.statusText,status:n??t.status,detail:o,instance:c})}class Wa extends $a{constructor(e,r,n,o){if(super(n,o),e.status>=200&&e.status<400)throw new $a(`A ClientHttpError cannot be built from a success response, got ${e.status} ${e.statusText}`);this.errorResponse=Object.freeze({status:e.status,statusText:e.statusText,headers:e.headers,url:e.url,body:r,ok:!1}),this.details=T0(this.errorResponse)}get response(){return this.errorResponse}get problemDetails(){return this.details}}function $i(t){const e=t;return typeof e=="object"&&typeof e.internal_resourceInfo=="object"}function R0(t){const e=t;return typeof e=="object"&&typeof e.internal_resourceInfo=="object"&&typeof e.internal_resourceInfo.linkedResources=="object"}function xn(t){const e=t;return typeof e.internal_changeLog=="object"&&Array.isArray(e.internal_changeLog.additions)&&Array.isArray(e.internal_changeLog.deletions)}class ni extends Error{}function pt(t){return typeof t=="string"?t:t.value}function Wc(t,e={}){const r=new URL(t);return r.pathname=r.pathname.replace(/\/\/+/g,"/"),e.trailingSlash===!1&&r.pathname.slice(-1)==="/"&&(r.pathname=r.pathname.slice(0,r.pathname.length-1)),e.trailingSlash===!0&&r.pathname.slice(-1)!=="/"&&(r.pathname=`${r.pathname}/`),r.href}function Vc(t){var e,r,n,o,c;const u=(r=(e=t.headers.get("Content-Type"))===null||e===void 0?void 0:e.split(";"))!==null&&r!==void 0?r:[],l=u.length>0&&["text/turtle","application/ld+json"].includes(u[0]),g={sourceIri:t.url,isRawData:!l,contentLocation:(n=t.headers.get("Content-Location"))!==null&&n!==void 0?n:void 0,contentType:(o=t.headers.get("Content-Type"))!==null&&o!==void 0?o:void 0,linkedResources:{},location:(c=t.headers.get("Location"))!==null&&c!==void 0?c:void 0},f=t.headers.get("Link");if(f){const p=vh.parse(f),v=p.get("rel","acl");v.length===1&&(g.aclUrl=new URL(v[0].uri,g.sourceIri).href),g.linkedResources=p.refs.reduce((x,F)=>{var I,R;return(I=x[R=F.rel])!==null&&I!==void 0||(x[R]=[]),x[F.rel].push(new URL(F.uri,g.sourceIri).href),x},g.linkedResources)}const h=t.headers.get("WAC-Allow");return h&&(g.permissions=P0(h)),g}function P0(t){function e(n){const o=n.split(" ");return o.includes("write")?{read:o.includes("read"),append:!0,write:!0,control:o.includes("control")}:{read:o.includes("read"),append:o.includes("append"),write:!1,control:o.includes("control")}}function r(n,o){const c=n.split(",").map(l=>l.split("=")).filter(l=>l.length===2&&l[0].trim()===o);if(c.length!==1)return"";const u=c[0][1].trim();return u.charAt(0)!=='"'||u.charAt(u.length-1)!=='"'?"":u.substring(1,u.length-1)}return{user:e(r(t,"user")),public:e(r(t,"public"))}}function Ki(t){return!t.ok}function k0(t){return t.status===401||t.status===403}const C0={Resource:"http://www.w3.org/ns/ldp#Resource"};function N0(t,e={ignoreAuthenticationErrors:!1}){if(Ki(t)&&(!k0(t)||!e.ignoreAuthenticationErrors))throw new Wi(`Fetching the metadata of the Resource at [${t.url}] failed: [${t.status}] [${t.statusText}].`,t);return{internal_resourceInfo:Vc(t)}}function L0(t){var e;return(e=t.internal_resourceInfo.contentType)!==null&&e!==void 0?e:null}function Xt(t){return $i(t)?t.internal_resourceInfo.sourceIri:null}class Wi extends ni{constructor(e,r,n){super(e),this.response=r,typeof n=="string"?this.httpError=new Wa(r,n,e):this.httpError=new Wa(r,"",e)}get statusCode(){return this.response.status}get statusText(){return this.response.statusText}get problemDetails(){return this.httpError.problemDetails}}const Bn="http://www.w3.org/1999/02/22-rdf-syntax-ns#",jn="http://www.w3.org/2001/XMLSchema#",li="http://www.w3.org/2000/10/swap/",Nt={xsd:{decimal:`${jn}decimal`,boolean:`${jn}boolean`,double:`${jn}double`,integer:`${jn}integer`,string:`${jn}string`},rdf:{type:`${Bn}type`,nil:`${Bn}nil`,first:`${Bn}first`,rest:`${Bn}rest`,langString:`${Bn}langString`},owl:{sameAs:"http://www.w3.org/2002/07/owl#sameAs"},r:{forSome:`${li}reify#forSome`,forAll:`${li}reify#forAll`},log:{implies:`${li}log#implies`,isImpliedBy:`${li}log#isImpliedBy`}},{xsd:di}=Nt,D0=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\([^])/g,Va={"\\":"\\","'":"'",'"':'"',n:`
`,r:"\r",t:"	",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},U0=/[\x00-\x20<>\\"\{\}\|\^\`]/,O0={_iri:!0,_unescapedIri:!0,_simpleQuotedString:!0,_langcode:!0,_blank:!0,_newline:!0,_comment:!0,_whitespace:!0,_endOfFile:!0},B0=/$0^/;class j0{constructor(e){if(this._iri=/^<((?:[^ <>{}\\]|\\[uU])+)>[ \t]*/,this._unescapedIri=/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>[ \t]*/,this._simpleQuotedString=/^"([^"\\\r\n]*)"(?=[^"])/,this._simpleApostropheString=/^'([^'\\\r\n]*)'(?=[^'])/,this._langcode=/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,this._prefix=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,this._prefixed=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?:[ \t]+|(?=\.?[,;!\^\s#()\[\]\{\}"'<>]))/,this._variable=/^\?(?:(?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=[.,;!\^\s#()\[\]\{\}"'<>])/,this._blank=/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?:[ \t]+|(?=\.?[,;:\s#()\[\]\{\}"'<>]))/,this._number=/^[\-+]?(?:(\d+\.\d*|\.?\d+)[eE][\-+]?|\d*(\.)?)\d+(?=\.?[,;:\s#()\[\]\{\}"'<>])/,this._boolean=/^(?:true|false)(?=[.,;\s#()\[\]\{\}"'<>])/,this._keyword=/^@[a-z]+(?=[\s#<:])/i,this._sparqlKeyword=/^(?:PREFIX|BASE|GRAPH)(?=[\s#<])/i,this._shortPredicates=/^a(?=[\s#()\[\]\{\}"'<>])/,this._newline=/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,this._comment=/#([^\n\r]*)/,this._whitespace=/^[ \t]+/,this._endOfFile=/^(?:#[^\n\r]*)?$/,e=e||{},this._isImpliedBy=e.isImpliedBy,this._lineMode=!!e.lineMode){this._n3Mode=!1;for(const r in this)!(r in O0)&&this[r]instanceof RegExp&&(this[r]=B0)}else this._n3Mode=e.n3!==!1;this.comments=!!e.comments,this._literalClosingPos=0}_tokenizeToEnd(e,r){let n=this._input,o=n.length;for(;;){let l,g;for(;l=this._newline.exec(n);)this.comments&&(g=this._comment.exec(l[0]))&&c("comment",g[1],"",this._line,l[0].length),n=n.substr(l[0].length,n.length),o=n.length,this._line++;if(!l&&(l=this._whitespace.exec(n))&&(n=n.substr(l[0].length,n.length)),this._endOfFile.test(n))return r&&(this.comments&&(g=this._comment.exec(n))&&c("comment",g[1],"",this._line,n.length),n=null,c("eof","","",this._line,0)),this._input=n;const f=this._line,h=n[0];let p="",v="",x="",F=null,I=0,R=!1;switch(h){case"^":if(n.length<3)break;if(n[1]==="^"){if(this._previousMarker="^^",n=n.substr(2),n[0]!=="<"){R=!0;break}}else{this._n3Mode&&(I=1,p="^");break}case"<":if(F=this._unescapedIri.exec(n))p="IRI",v=F[1];else if(F=this._iri.exec(n)){if(v=this._unescape(F[1]),v===null||U0.test(v))return u(this);p="IRI"}else n.length>1&&n[1]==="<"?(p="<<",I=2):this._n3Mode&&n.length>1&&n[1]==="="&&(I=2,this._isImpliedBy?(p="abbreviation",v="<"):(p="inverse",v=">"));break;case">":n.length>1&&n[1]===">"&&(p=">>",I=2);break;case"_":((F=this._blank.exec(n))||r&&(F=this._blank.exec(`${n} `)))&&(p="blank",x="_",v=F[1]);break;case'"':if(F=this._simpleQuotedString.exec(n))v=F[1];else if({value:v,matchLength:I}=this._parseLiteral(n),v===null)return u(this);(F!==null||I!==0)&&(p="literal",this._literalClosingPos=0);break;case"'":if(!this._lineMode){if(F=this._simpleApostropheString.exec(n))v=F[1];else if({value:v,matchLength:I}=this._parseLiteral(n),v===null)return u(this);(F!==null||I!==0)&&(p="literal",this._literalClosingPos=0)}break;case"?":this._n3Mode&&(F=this._variable.exec(n))&&(p="var",v=F[0]);break;case"@":this._previousMarker==="literal"&&(F=this._langcode.exec(n))?(p="langcode",v=F[1]):(F=this._keyword.exec(n))&&(p=F[0]);break;case".":if(n.length===1?r:n[1]<"0"||n[1]>"9"){p=".",I=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(F=this._number.exec(n)||r&&(F=this._number.exec(`${n} `)))&&(p="literal",v=F[0],x=typeof F[1]=="string"?di.double:typeof F[2]=="string"?di.decimal:di.integer);break;case"B":case"b":case"p":case"P":case"G":case"g":(F=this._sparqlKeyword.exec(n))?p=F[0].toUpperCase():R=!0;break;case"f":case"t":(F=this._boolean.exec(n))?(p="literal",v=F[0],x=di.boolean):R=!0;break;case"a":(F=this._shortPredicates.exec(n))?(p="abbreviation",v="a"):R=!0;break;case"=":this._n3Mode&&n.length>1&&(p="abbreviation",n[1]!==">"?(I=1,v="="):(I=2,v=">"));break;case"!":if(!this._n3Mode)break;case",":case";":case"[":case"]":case"(":case")":case"}":this._lineMode||(I=1,p=h);break;case"{":!this._lineMode&&n.length>=2&&(n[1]==="|"?(p="{|",I=2):(p=h,I=1));break;case"|":n.length>=2&&n[1]==="}"&&(p="|}",I=2);break;default:R=!0}if(R&&((this._previousMarker==="@prefix"||this._previousMarker==="PREFIX")&&(F=this._prefix.exec(n))?(p="prefix",v=F[1]||""):((F=this._prefixed.exec(n))||r&&(F=this._prefixed.exec(`${n} `)))&&(p="prefixed",x=F[1]||"",v=this._unescape(F[2]))),this._previousMarker==="^^")switch(p){case"prefixed":p="type";break;case"IRI":p="typeIRI";break;default:p=""}if(!p)return r||!/^'''|^"""/.test(n)&&/\n|\r/.test(n)?u(this):this._input=n;const C=I||F[0].length,L=c(p,v,x,f,C);this.previousToken=L,this._previousMarker=p,n=n.substr(C,n.length)}function c(l,g,f,h,p){const v=n?o-n.length:o,x=v+p,F={type:l,value:g,prefix:f,line:h,start:v,end:x};return e(null,F),F}function u(l){e(l._syntaxError(/^\S*/.exec(n)[0]))}}_unescape(e){let r=!1;const n=e.replace(D0,(o,c,u,l)=>{if(typeof c=="string")return String.fromCharCode(Number.parseInt(c,16));if(typeof u=="string"){let g=Number.parseInt(u,16);return g<=65535?String.fromCharCode(Number.parseInt(u,16)):String.fromCharCode(55296+((g-=65536)>>10),56320+(g&1023))}return l in Va?Va[l]:(r=!0,"")});return r?null:n}_parseLiteral(e){if(e.length>=3){const r=e.match(/^(?:"""|"|'''|'|)/)[0],n=r.length;let o=Math.max(this._literalClosingPos,n);for(;(o=e.indexOf(r,o))>0;){let c=0;for(;e[o-c-1]==="\\";)c++;if(c%2===0){const u=e.substring(n,o),l=u.split(/\r\n|\r|\n/).length-1,g=o+n;if(n===1&&l!==0||n===3&&this._lineMode)break;return this._line+=l,{value:this._unescape(u),matchLength:g}}o++}this._literalClosingPos=e.length-n+1}return{value:"",matchLength:0}}_syntaxError(e){this._input=null;const r=new Error(`Unexpected "${e}" on line ${this._line}.`);return r.context={token:void 0,line:this._line,previousToken:this.previousToken},r}_readStartingBom(e){return e.startsWith("\uFEFF")?e.substr(1):e}tokenize(e,r){if(this._line=1,typeof e=="string")if(this._input=this._readStartingBom(e),typeof r=="function")queueMicrotask(()=>this._tokenizeToEnd(r,!0));else{const n=[];let o;if(this._tokenizeToEnd((c,u)=>c?o=c:n.push(u),!0),o)throw o;return n}else this._pendingBuffer=null,typeof e.setEncoding=="function"&&e.setEncoding("utf8"),e.on("data",n=>{this._input!==null&&n.length!==0&&(this._pendingBuffer&&(n=pr.Buffer.concat([this._pendingBuffer,n]),this._pendingBuffer=null),n[n.length-1]&128?this._pendingBuffer=n:(typeof this._input>"u"?this._input=this._readStartingBom(typeof n=="string"?n:n.toString()):this._input+=n,this._tokenizeToEnd(r,!1)))}),e.on("end",()=>{typeof this._input=="string"&&this._tokenizeToEnd(r,!0)}),e.on("error",r)}}const{rdf:M0,xsd:Wr}=Nt;let Fn,H0=0;const _t={namedNode:zc,blankNode:Gc,variable:Yc,literal:Qc,defaultGraph:V0,quad:Gs,triple:Gs,fromTerm:Vn,fromQuad:Xc};class ir{constructor(e){this.id=e}get value(){return this.id}equals(e){return e instanceof ir?this.id===e.id:!!e&&this.termType===e.termType&&this.value===e.value}hashCode(){return 0}toJSON(){return{termType:this.termType,value:this.value}}}class qc extends ir{get termType(){return"NamedNode"}}class yn extends ir{get termType(){return"Literal"}get value(){return this.id.substring(1,this.id.lastIndexOf('"'))}get language(){const e=this.id;let r=e.lastIndexOf('"')+1;return r<e.length&&e[r++]==="@"?e.substr(r).toLowerCase():""}get datatype(){return new qc(this.datatypeString)}get datatypeString(){const e=this.id,r=e.lastIndexOf('"')+1,n=r<e.length?e[r]:"";return n==="^"?e.substr(r+2):n!=="@"?Wr.string:M0.langString}equals(e){return e instanceof yn?this.id===e.id:!!e&&!!e.datatype&&this.termType===e.termType&&this.value===e.value&&this.language===e.language&&this.datatype.value===e.datatype.value}toJSON(){return{termType:this.termType,value:this.value,language:this.language,datatype:{termType:"NamedNode",value:this.datatypeString}}}}class $0 extends ir{constructor(e){super(`_:${e}`)}get termType(){return"BlankNode"}get value(){return this.id.substr(2)}}class K0 extends ir{constructor(e){super(`?${e}`)}get termType(){return"Variable"}get value(){return this.id.substr(1)}}class W0 extends ir{constructor(){return super(""),Fn||this}get termType(){return"DefaultGraph"}equals(e){return this===e||!!e&&this.termType===e.termType}}Fn=new W0;function Wn(t,e,r){if(e=e||_t,!t)return e.defaultGraph();switch(t[0]){case"?":return e.variable(t.substr(1));case"_":return e.blankNode(t.substr(2));case'"':if(e===_t)return new yn(t);if(t[t.length-1]==='"')return e.literal(t.substr(1,t.length-2));const n=t.lastIndexOf('"',t.length-1);return e.literal(t.substr(1,n-1),t[n+1]==="@"?t.substr(n+2):e.namedNode(t.substr(n+3)));case"[":t=JSON.parse(t);break;default:if(!r||!Array.isArray(t))return e.namedNode(t)}return e.quad(Wn(t[0],e,!0),Wn(t[1],e,!0),Wn(t[2],e,!0),t[3]&&Wn(t[3],e,!0))}function fn(t,e){if(typeof t=="string")return t;if(t instanceof ir&&t.termType!=="Quad")return t.id;if(!t)return Fn.id;switch(t.termType){case"NamedNode":return t.value;case"BlankNode":return`_:${t.value}`;case"Variable":return`?${t.value}`;case"DefaultGraph":return"";case"Literal":return`"${t.value}"${t.language?`@${t.language}`:t.datatype&&t.datatype.value!==Wr.string?`^^${t.datatype.value}`:""}`;case"Quad":const r=[fn(t.subject,!0),fn(t.predicate,!0),fn(t.object,!0)];return t.graph&&t.graph.termType!=="DefaultGraph"&&r.push(fn(t.graph,!0)),e?r:JSON.stringify(r);default:throw new Error(`Unexpected termType: ${t.termType}`)}}class Jc extends ir{constructor(e,r,n,o){super(""),this._subject=e,this._predicate=r,this._object=n,this._graph=o||Fn}get termType(){return"Quad"}get subject(){return this._subject}get predicate(){return this._predicate}get object(){return this._object}get graph(){return this._graph}toJSON(){return{termType:this.termType,subject:this._subject.toJSON(),predicate:this._predicate.toJSON(),object:this._object.toJSON(),graph:this._graph.toJSON()}}equals(e){return!!e&&this._subject.equals(e.subject)&&this._predicate.equals(e.predicate)&&this._object.equals(e.object)&&this._graph.equals(e.graph)}}function zc(t){return new qc(t)}function Gc(t){return new $0(t||`n3-${H0++}`)}function Qc(t,e){if(typeof e=="string")return new yn(`"${t}"@${e.toLowerCase()}`);let r=e?e.value:"";return r===""&&(typeof t=="boolean"?r=Wr.boolean:typeof t=="number"&&(Number.isFinite(t)?r=Number.isInteger(t)?Wr.integer:Wr.double:(r=Wr.double,Number.isNaN(t)||(t=t>0?"INF":"-INF")))),r===""||r===Wr.string?new yn(`"${t}"`):new yn(`"${t}"^^${r}`)}function Yc(t){return new K0(t)}function V0(){return Fn}function Gs(t,e,r,n){return new Jc(t,e,r,n)}function Vn(t){if(t instanceof ir)return t;switch(t.termType){case"NamedNode":return zc(t.value);case"BlankNode":return Gc(t.value);case"Variable":return Yc(t.value);case"DefaultGraph":return Fn;case"Literal":return Qc(t.value,t.language||t.datatype);case"Quad":return Xc(t);default:throw new Error(`Unexpected termType: ${t.termType}`)}}function Xc(t){if(t instanceof Jc)return t;if(t.termType!=="Quad")throw new Error(`Unexpected termType: ${t.termType}`);return Gs(Vn(t.subject),Vn(t.predicate),Vn(t.object),Vn(t.graph))}let qa=0;class Zc{constructor(e){this._contextStack=[],this._graph=null,e=e||{},this._setBase(e.baseIRI),e.factory&&el(this,e.factory);const r=typeof e.format=="string"?e.format.match(/\w*$/)[0].toLowerCase():"",n=/turtle/.test(r),o=/trig/.test(r),c=/triple/.test(r),u=/quad/.test(r),l=this._n3Mode=/n3/.test(r),g=c||u;(this._supportsNamedGraphs=!(n||l))||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(n||o||c||l),this._isImpliedBy=e.isImpliedBy,this._supportsRDFStar=r===""||/star|\*$/.test(r),g&&(this._resolveRelativeIRI=f=>null),this._blankNodePrefix=typeof e.blankNodePrefix!="string"?"":e.blankNodePrefix.replace(/^(?!_:)/,"_:"),this._lexer=e.lexer||new j0({lineMode:g,n3:l,isImpliedBy:this._isImpliedBy}),this._explicitQuantifiers=!!e.explicitQuantifiers}static _resetBlankNodePrefix(){qa=0}_setBase(e){if(!e)this._base="",this._basePath="";else{const r=e.indexOf("#");r>=0&&(e=e.substr(0,r)),this._base=e,this._basePath=e.indexOf("/")<0?e:e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i),this._baseRoot=e[0],this._baseScheme=e[1]}}_saveContext(e,r,n,o,c){const u=this._n3Mode;this._contextStack.push({type:e,subject:n,predicate:o,object:c,graph:r,inverse:u?this._inversePredicate:!1,blankPrefix:u?this._prefixes._:"",quantified:u?this._quantified:null}),u&&(this._inversePredicate=!1,this._prefixes._=this._graph?`${this._graph.value}.`:".",this._quantified=Object.create(this._quantified))}_restoreContext(e,r){const n=this._contextStack.pop();if(!n||n.type!==e)return this._error(`Unexpected ${r.type}`,r);this._subject=n.subject,this._predicate=n.predicate,this._object=n.object,this._graph=n.graph,this._n3Mode&&(this._inversePredicate=n.inverse,this._prefixes._=n.blankPrefix,this._quantified=n.quantified)}_readInTopContext(e){switch(e.type){case"eof":return this._graph!==null?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"PREFIX":this._sparqlStyle=!0;case"@prefix":return this._readPrefix;case"BASE":this._sparqlStyle=!0;case"@base":return this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}}_readEntity(e,r){let n;switch(e.type){case"IRI":case"typeIRI":const o=this._resolveIRI(e.value);if(o===null)return this._error("Invalid IRI",e);n=this._factory.namedNode(o);break;case"type":case"prefixed":const c=this._prefixes[e.prefix];if(c===void 0)return this._error(`Undefined prefix "${e.prefix}:"`,e);n=this._factory.namedNode(c+e.value);break;case"blank":n=this._factory.blankNode(this._prefixes[e.prefix]+e.value);break;case"var":n=this._factory.variable(e.value.substr(1));break;default:return this._error(`Expected entity but got ${e.type}`,e)}return!r&&this._n3Mode&&n.id in this._quantified&&(n=this._quantified[n.id]),n}_readSubject(e){switch(this._predicate=null,e.type){case"[":return this._saveContext("blank",this._graph,this._subject=this._factory.blankNode(),null,null),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this.RDF_NIL,null,null),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._graph=this._factory.blankNode(),null,null),this._readSubject):this._error("Unexpected graph",e);case"}":return this._readPunctuation(e);case"@forSome":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORSOME,this._quantifier="blankNode",this._readQuantifierList):this._error('Unexpected "@forSome"',e);case"@forAll":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORALL,this._quantifier="variable",this._readQuantifierList):this._error('Unexpected "@forAll"',e);case"literal":if(!this._n3Mode)return this._error("Unexpected literal",e);if(e.prefix.length===0)return this._literalValue=e.value,this._completeSubjectLiteral;this._subject=this._factory.literal(e.value,this._factory.namedNode(e.prefix));break;case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,null,null,null),this._graph=null,this._readSubject):this._error("Unexpected RDF-star syntax",e);default:if((this._subject=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._readPredicateOrNamedGraph)}return this._readPredicateOrNamedGraph}_readPredicate(e){const r=e.type;switch(r){case"inverse":this._inversePredicate=!0;case"abbreviation":this._predicate=this.ABBREVIATIONS[e.value];break;case".":case"]":case"}":return this._predicate===null?this._error(`Unexpected ${r}`,e):(this._subject=null,r==="]"?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return this._predicate!==null?this._readPredicate:this._error("Expected predicate but got ;",e);case"[":if(this._n3Mode)return this._saveContext("blank",this._graph,this._subject,this._subject=this._factory.blankNode(),null),this._readBlankNodeHead;case"blank":if(!this._n3Mode)return this._error("Disallowed blank node as predicate",e);default:if((this._predicate=this._readEntity(e))===void 0)return}return this._readObject}_readObject(e){switch(e.type){case"literal":if(e.prefix.length===0)return this._literalValue=e.value,this._readDataTypeOrLang;this._object=this._factory.literal(e.value,this._factory.namedNode(e.prefix));break;case"[":return this._saveContext("blank",this._graph,this._subject,this._predicate,this._subject=this._factory.blankNode()),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this._subject,this._predicate,this.RDF_NIL),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._factory.blankNode()),this._readSubject):this._error("Unexpected graph",e);case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,this._subject,this._predicate,null),this._graph=null,this._readSubject):this._error("Unexpected RDF-star syntax",e);default:if((this._object=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._getContextEndReader())}return this._getContextEndReader()}_readPredicateOrNamedGraph(e){return e.type==="{"?this._readGraph(e):this._readPredicate(e)}_readGraph(e){return e.type!=="{"?this._error(`Expected graph but got ${e.type}`,e):(this._graph=this._subject,this._subject=null,this._readSubject)}_readBlankNodeHead(e){return e.type==="]"?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))}_readBlankNodeTail(e){if(e.type!=="]")return this._readBlankNodePunctuation(e);this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph);const r=this._predicate===null;return this._restoreContext("blank",e),this._object!==null?this._getContextEndReader():this._predicate!==null?this._readObject:r?this._readPredicateOrNamedGraph:this._readPredicateAfterBlank}_readPredicateAfterBlank(e){switch(e.type){case".":case"}":return this._subject=null,this._readPunctuation(e);default:return this._readPredicate(e)}}_readListItem(e){let r=null,n=null,o=this._readListItem;const c=this._subject,u=this._contextStack,l=u[u.length-1];switch(e.type){case"[":this._saveContext("blank",this._graph,n=this._factory.blankNode(),this.RDF_FIRST,this._subject=r=this._factory.blankNode()),o=this._readBlankNodeHead;break;case"(":this._saveContext("list",this._graph,n=this._factory.blankNode(),this.RDF_FIRST,this.RDF_NIL),this._subject=null;break;case")":if(this._restoreContext("list",e),u.length!==0&&u[u.length-1].type==="list"&&this._emit(this._subject,this._predicate,this._object,this._graph),this._predicate===null){if(o=this._readPredicate,this._subject===this.RDF_NIL)return o}else if(o=this._getContextEndReader(),this._object===this.RDF_NIL)return o;n=this.RDF_NIL;break;case"literal":e.prefix.length===0?(this._literalValue=e.value,o=this._readListItemDataTypeOrLang):(r=this._factory.literal(e.value,this._factory.namedNode(e.prefix)),o=this._getContextEndReader());break;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._factory.blankNode()),this._readSubject):this._error("Unexpected graph",e);default:if((r=this._readEntity(e))===void 0)return}if(n===null&&(this._subject=n=this._factory.blankNode()),c===null?l.predicate===null?l.subject=n:l.object=n:this._emit(c,this.RDF_REST,n,this._graph),r!==null){if(this._n3Mode&&(e.type==="IRI"||e.type==="prefixed"))return this._saveContext("item",this._graph,n,this.RDF_FIRST,r),this._subject=r,this._predicate=null,this._getPathReader(this._readListItem);this._emit(n,this.RDF_FIRST,r,this._graph)}return o}_readDataTypeOrLang(e){return this._completeObjectLiteral(e,!1)}_readListItemDataTypeOrLang(e){return this._completeObjectLiteral(e,!0)}_completeLiteral(e){let r=this._factory.literal(this._literalValue);switch(e.type){case"type":case"typeIRI":const n=this._readEntity(e);if(n===void 0)return;r=this._factory.literal(this._literalValue,n),e=null;break;case"langcode":r=this._factory.literal(this._literalValue,e.value),e=null;break}return{token:e,literal:r}}_completeSubjectLiteral(e){return this._subject=this._completeLiteral(e).literal,this._readPredicateOrNamedGraph}_completeObjectLiteral(e,r){const n=this._completeLiteral(e);if(n)return this._object=n.literal,r&&this._emit(this._subject,this.RDF_FIRST,this._object,this._graph),n.token===null?this._getContextEndReader():(this._readCallback=this._getContextEndReader(),this._readCallback(n.token))}_readFormulaTail(e){return e.type!=="}"?this._readPunctuation(e):(this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph),this._restoreContext("formula",e),this._object===null?this._readPredicate:this._getContextEndReader())}_readPunctuation(e){let r,n=this._graph;const o=this._subject,c=this._inversePredicate;switch(e.type){case"}":if(this._graph===null)return this._error("Unexpected graph closing",e);if(this._n3Mode)return this._readFormulaTail(e);this._graph=null;case".":this._subject=null,r=this._contextStack.length?this._readSubject:this._readInTopContext,c&&(this._inversePredicate=!1);break;case";":r=this._readPredicate;break;case",":r=this._readObject;break;case"{|":if(!this._supportsRDFStar)return this._error("Unexpected RDF-star syntax",e);const u=this._predicate,l=this._object;this._subject=this._factory.quad(o,u,l,this.DEFAULTGRAPH),r=this._readPredicate;break;case"|}":if(this._subject.termType!=="Quad")return this._error("Unexpected asserted triple closing",e);this._subject=null,r=this._readPunctuation;break;default:if(this._supportsQuads&&this._graph===null&&(n=this._readEntity(e))!==void 0){r=this._readQuadPunctuation;break}return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}if(o!==null){const u=this._predicate,l=this._object;c?this._emit(l,u,o,n):this._emit(o,u,l,n)}return r}_readBlankNodePunctuation(e){let r;switch(e.type){case";":r=this._readPredicate;break;case",":r=this._readObject;break;default:return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}return this._emit(this._subject,this._predicate,this._object,this._graph),r}_readQuadPunctuation(e){return e.type!=="."?this._error("Expected dot to follow quad",e):this._readInTopContext}_readPrefix(e){return e.type!=="prefix"?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)}_readPrefixIRI(e){if(e.type!=="IRI")return this._error(`Expected IRI to follow prefix "${this._prefix}:"`,e);const r=this._readEntity(e);return this._prefixes[this._prefix]=r.value,this._prefixCallback(this._prefix,r),this._readDeclarationPunctuation}_readBaseIRI(e){const r=e.type==="IRI"&&this._resolveIRI(e.value);return r?(this._setBase(r),this._readDeclarationPunctuation):this._error("Expected valid IRI to follow base declaration",e)}_readNamedGraphLabel(e){switch(e.type){case"IRI":case"blank":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}}_readNamedGraphBlankLabel(e){return e.type!=="]"?this._error("Invalid graph label",e):(this._subject=this._factory.blankNode(),this._readGraph)}_readDeclarationPunctuation(e){return this._sparqlStyle?(this._sparqlStyle=!1,this._readInTopContext(e)):e.type!=="."?this._error("Expected declaration to end with a dot",e):this._readInTopContext}_readQuantifierList(e){let r;switch(e.type){case"IRI":case"prefixed":if((r=this._readEntity(e,!0))!==void 0)break;default:return this._error(`Unexpected ${e.type}`,e)}return this._explicitQuantifiers?(this._subject===null?this._emit(this._graph||this.DEFAULTGRAPH,this._predicate,this._subject=this._factory.blankNode(),this.QUANTIFIERS_GRAPH):this._emit(this._subject,this.RDF_REST,this._subject=this._factory.blankNode(),this.QUANTIFIERS_GRAPH),this._emit(this._subject,this.RDF_FIRST,r,this.QUANTIFIERS_GRAPH)):this._quantified[r.id]=this._factory[this._quantifier](this._factory.blankNode().value),this._readQuantifierPunctuation}_readQuantifierPunctuation(e){return e.type===","?this._readQuantifierList:(this._explicitQuantifiers&&(this._emit(this._subject,this.RDF_REST,this.RDF_NIL,this.QUANTIFIERS_GRAPH),this._subject=null),this._readCallback=this._getContextEndReader(),this._readCallback(e))}_getPathReader(e){return this._afterPath=e,this._readPath}_readPath(e){switch(e.type){case"!":return this._readForwardPath;case"^":return this._readBackwardPath;default:const r=this._contextStack,n=r.length&&r[r.length-1];if(n&&n.type==="item"){const o=this._subject;this._restoreContext("item",e),this._emit(this._subject,this.RDF_FIRST,o,this._graph)}return this._afterPath(e)}}_readForwardPath(e){let r,n;const o=this._factory.blankNode();if((n=this._readEntity(e))!==void 0)return this._predicate===null?(r=this._subject,this._subject=o):(r=this._object,this._object=o),this._emit(r,n,o,this._graph),this._readPath}_readBackwardPath(e){const r=this._factory.blankNode();let n,o;if((n=this._readEntity(e))!==void 0)return this._predicate===null?(o=this._subject,this._subject=r):(o=this._object,this._object=r),this._emit(r,n,o,this._graph),this._readPath}_readRDFStarTailOrGraph(e){return e.type!==">>"?this._supportsQuads&&this._graph===null&&(this._graph=this._readEntity(e))!==void 0?this._readRDFStarTail:this._error(`Expected >> to follow "${this._object.id}"`,e):this._readRDFStarTail(e)}_readRDFStarTail(e){if(e.type!==">>")return this._error(`Expected >> but got ${e.type}`,e);const r=this._factory.quad(this._subject,this._predicate,this._object,this._graph||this.DEFAULTGRAPH);return this._restoreContext("<<",e),this._subject===null?(this._subject=r,this._readPredicate):(this._object=r,this._getContextEndReader())}_getContextEndReader(){const e=this._contextStack;if(!e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem;case"formula":return this._readFormulaTail;case"<<":return this._readRDFStarTailOrGraph}}_emit(e,r,n,o){this._callback(null,this._factory.quad(e,r,n,o||this.DEFAULTGRAPH))}_error(e,r){const n=new Error(`${e} on line ${r.line}.`);n.context={token:r,line:r.line,previousToken:this._lexer.previousToken},this._callback(n),this._callback=fi}_resolveIRI(e){return/^[a-z][a-z0-9+.-]*:/i.test(e)?e:this._resolveRelativeIRI(e)}_resolveRelativeIRI(e){if(!e.length)return this._base;switch(e[0]){case"#":return this._base+e;case"?":return this._base.replace(/(?:\?.*)?$/,e);case"/":return(e[1]==="/"?this._baseScheme:this._baseRoot)+this._removeDotSegments(e);default:return/^[^/:]*:/.test(e)?null:this._removeDotSegments(this._basePath+e)}}_removeDotSegments(e){if(!/(^|\/)\.\.?($|[/#?])/.test(e))return e;const r=e.length;let n="",o=-1,c=-1,u=0,l="/";for(;o<r;){switch(l){case":":if(c<0&&e[++o]==="/"&&e[++o]==="/")for(;(c=o+1)<r&&e[c]!=="/";)o=c;break;case"?":case"#":o=r;break;case"/":if(e[o+1]===".")switch(l=e[++o+1],l){case"/":n+=e.substring(u,o-1),u=o+1;break;case void 0:case"?":case"#":return n+e.substring(u,o)+e.substr(o+1);case".":if(l=e[++o+1],l===void 0||l==="/"||l==="?"||l==="#"){if(n+=e.substring(u,o-2),(u=n.lastIndexOf("/"))>=c&&(n=n.substr(0,u)),l!=="/")return`${n}/${e.substr(o+1)}`;u=o+1}}}l=e[++o]}return n+e.substring(u)}parse(e,r,n){let o,c,u;if(r&&(r.onQuad||r.onPrefix||r.onComment)?(o=r.onQuad,c=r.onPrefix,u=r.onComment):(o=r,c=n),this._readCallback=this._readInTopContext,this._sparqlStyle=!1,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix?this._blankNodePrefix.substr(2):`b${qa++}_`,this._prefixCallback=c||fi,this._inversePredicate=!1,this._quantified=Object.create(null),!o){const g=[];let f;if(this._callback=(h,p)=>{h?f=h:p&&g.push(p)},this._lexer.tokenize(e).every(h=>this._readCallback=this._readCallback(h)),f)throw f;return g}let l=(g,f)=>{g!==null?(this._callback(g),this._callback=fi):this._readCallback&&(this._readCallback=this._readCallback(f))};u&&(this._lexer.comments=!0,l=(g,f)=>{g!==null?(this._callback(g),this._callback=fi):this._readCallback&&(f.type==="comment"?u(f.value):this._readCallback=this._readCallback(f))}),this._callback=o,this._lexer.tokenize(e,l)}}function fi(){}function el(t,e){t._factory=e,t.DEFAULTGRAPH=e.defaultGraph(),t.RDF_FIRST=e.namedNode(Nt.rdf.first),t.RDF_REST=e.namedNode(Nt.rdf.rest),t.RDF_NIL=e.namedNode(Nt.rdf.nil),t.N3_FORALL=e.namedNode(Nt.r.forAll),t.N3_FORSOME=e.namedNode(Nt.r.forSome),t.ABBREVIATIONS={a:e.namedNode(Nt.rdf.type),"=":e.namedNode(Nt.owl.sameAs),">":e.namedNode(Nt.log.implies),"<":e.namedNode(Nt.log.isImpliedBy)},t.QUANTIFIERS_GRAPH=e.namedNode("urn:n3:quantifiers")}el(Zc.prototype,_t);function Qs(t){return!!t&&t.termType==="DefaultGraph"}function wi(t){return t.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&")}const q0=/^:?[^:?#]*(?:[?#]|$)|^file:|^[^:]*:\/*[^?#]+?\/(?:\.\.?(?:\/|$)|\/)/i,J0=/^(?:(?:[^/?#]{3,}|\.?[^/?#.]\.?)(?:\/[^/?#]{3,}|\.?[^/?#.]\.?)*\/?)?(?:[?#]|$)/,Ja="./",z0="../",Fs="?",za="#";class xo{constructor(e){this.base=e,this._baseLength=0,this._baseMatcher=null,this._pathReplacements=new Array(e.length+1)}static supports(e){return!q0.test(e)}_getBaseMatcher(){if(this._baseMatcher)return this._baseMatcher;if(!xo.supports(this.base))return this._baseMatcher=/.^/;const e=/^[^:]*:\/*/.exec(this.base)[0],r=["^",wi(e)],n=[],o=[],c=/[^/?#]*([/?#])/y;let u,l=0,g=0,f=c.lastIndex=e.length;for(;!l&&!g&&(u=c.exec(this.base));)u[1]===za?g=c.lastIndex-1:(r.push(wi(u[0]),"(?:"),n.push(")?"),u[1]!==Fs?o.push(f=c.lastIndex):(l=f=c.lastIndex,g=this.base.indexOf(za,l),this._pathReplacements[l]=Fs));for(let h=0;h<o.length;h++)this._pathReplacements[o[h]]=z0.repeat(o.length-h-1);return this._pathReplacements[o[o.length-1]]=Ja,this._baseLength=g>0?g:this.base.length,r.push(wi(this.base.substring(f,this._baseLength)),l?"(?:#|$)":"(?:[?#]|$)"),this._baseMatcher=new RegExp([...r,...n].join(""))}toRelative(e){const r=this._getBaseMatcher().exec(e);if(!r)return e;const n=r[0].length;if(n===this._baseLength&&n===e.length)return"";const o=this._pathReplacements[n];if(o){const c=e.substring(n);return o!==Fs&&!J0.test(c)?e:o===Ja&&/^[^?#]/.test(c)?c:o+c}return e.substring(n-1)}}const Mn=_t.defaultGraph(),{rdf:G0,xsd:un}=Nt,Ga=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,Qa=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,Q0={"\\":"\\\\",'"':'\\"',"	":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};class Hn extends ir{equals(e){return e===this}}class Fo{constructor(e,r){if(this._prefixRegex=/$0^/,e&&typeof e.write!="function"&&(r=e,e=null),r=r||{},this._lists=r.lists,e)this._outputStream=e,this._endStream=r.end===void 0?!0:!!r.end;else{let n="";this._outputStream={write(o,c,u){n+=o,u&&u()},end:o=>{o&&o(null,n)}},this._endStream=!0}this._subject=null,/triple|quad/i.test(r.format)?(this._lineMode=!0,this._writeQuad=this._writeQuadLine):(this._lineMode=!1,this._graph=Mn,this._prefixIRIs=Object.create(null),r.prefixes&&this.addPrefixes(r.prefixes),r.baseIRI&&(this._baseIri=new xo(r.baseIRI)))}get _inDefaultGraph(){return Mn.equals(this._graph)}_write(e,r){this._outputStream.write(e,"utf8",r)}_writeQuad(e,r,n,o,c){try{o.equals(this._graph)||(this._write((this._subject===null?"":this._inDefaultGraph?`.
`:`
}
`)+(Mn.equals(o)?"":`${this._encodeIriOrBlank(o)} {
`)),this._graph=o,this._subject=null),e.equals(this._subject)?r.equals(this._predicate)?this._write(`, ${this._encodeObject(n)}`,c):this._write(`;
    ${this._encodePredicate(this._predicate=r)} ${this._encodeObject(n)}`,c):this._write(`${(this._subject===null?"":`.
`)+this._encodeSubject(this._subject=e)} ${this._encodePredicate(this._predicate=r)} ${this._encodeObject(n)}`,c)}catch(u){c&&c(u)}}_writeQuadLine(e,r,n,o,c){delete this._prefixMatch,this._write(this.quadToString(e,r,n,o),c)}quadToString(e,r,n,o){return`${this._encodeSubject(e)} ${this._encodeIriOrBlank(r)} ${this._encodeObject(n)}${o&&o.value?` ${this._encodeIriOrBlank(o)} .
`:` .
`}`}quadsToString(e){let r="";for(const n of e)r+=this.quadToString(n.subject,n.predicate,n.object,n.graph);return r}_encodeSubject(e){return e.termType==="Quad"?this._encodeQuad(e):this._encodeIriOrBlank(e)}_encodeIriOrBlank(e){if(e.termType!=="NamedNode")return this._lists&&e.value in this._lists&&(e=this.list(this._lists[e.value])),"id"in e?e.id:`_:${e.value}`;let r=e.value;this._baseIri&&(r=this._baseIri.toRelative(r)),Ga.test(r)&&(r=r.replace(Qa,Ya));const n=this._prefixRegex.exec(r);return n?n[1]?this._prefixIRIs[n[1]]+n[2]:r:`<${r}>`}_encodeLiteral(e){let r=e.value;if(Ga.test(r)&&(r=r.replace(Qa,Ya)),e.language)return`"${r}"@${e.language}`;if(this._lineMode){if(e.datatype.value===un.string)return`"${r}"`}else switch(e.datatype.value){case un.string:return`"${r}"`;case un.boolean:if(r==="true"||r==="false")return r;break;case un.integer:if(/^[+-]?\d+$/.test(r))return r;break;case un.decimal:if(/^[+-]?\d*\.\d+$/.test(r))return r;break;case un.double:if(/^[+-]?(?:\d+\.\d*|\.?\d+)[eE][+-]?\d+$/.test(r))return r;break}return`"${r}"^^${this._encodeIriOrBlank(e.datatype)}`}_encodePredicate(e){return e.value===G0.type?"a":this._encodeIriOrBlank(e)}_encodeObject(e){switch(e.termType){case"Quad":return this._encodeQuad(e);case"Literal":return this._encodeLiteral(e);default:return this._encodeIriOrBlank(e)}}_encodeQuad({subject:e,predicate:r,object:n,graph:o}){return`<<${this._encodeSubject(e)} ${this._encodePredicate(r)} ${this._encodeObject(n)}${Qs(o)?"":` ${this._encodeIriOrBlank(o)}`}>>`}_blockedWrite(){throw new Error("Cannot write because the writer has been closed.")}addQuad(e,r,n,o,c){n===void 0?this._writeQuad(e.subject,e.predicate,e.object,e.graph,r):typeof o=="function"?this._writeQuad(e,r,n,Mn,o):this._writeQuad(e,r,n,o||Mn,c)}addQuads(e){for(let r=0;r<e.length;r++)this.addQuad(e[r])}addPrefix(e,r,n){const o={};o[e]=r,this.addPrefixes(o,n)}addPrefixes(e,r){if(!this._prefixIRIs)return r&&r();let n=!1;for(let o in e){let c=e[o];typeof c!="string"&&(c=c.value),n=!0,this._subject!==null&&(this._write(this._inDefaultGraph?`.
`:`
}
`),this._subject=null,this._graph=""),this._prefixIRIs[c]=o+=":",this._write(`@prefix ${o} <${c}>.
`)}if(n){let o="",c="";for(const u in this._prefixIRIs)o+=o?`|${u}`:u,c+=(c?"|":"")+this._prefixIRIs[u];o=wi(o),this._prefixRegex=new RegExp(`^(?:${c})[^/]*$|^(${o})([_a-zA-Z0-9][\\-_a-zA-Z0-9]*)$`)}this._write(n?`
`:"",r)}blank(e,r){let n=e,o,c;switch(e===void 0?n=[]:e.termType?n=[{predicate:e,object:r}]:"length"in e||(n=[e]),c=n.length){case 0:return new Hn("[]");case 1:if(o=n[0],!(o.object instanceof Hn))return new Hn(`[ ${this._encodePredicate(o.predicate)} ${this._encodeObject(o.object)} ]`);default:let u="[";for(let l=0;l<c;l++)o=n[l],o.predicate.equals(e)?u+=`, ${this._encodeObject(o.object)}`:(u+=`${(l?`;
  `:`
  `)+this._encodePredicate(o.predicate)} ${this._encodeObject(o.object)}`,e=o.predicate);return new Hn(`${u}
]`)}}list(e){const r=e&&e.length||0,n=new Array(r);for(let o=0;o<r;o++)n[o]=this._encodeObject(e[o]);return new Hn(`(${n.join(" ")})`)}end(e){this._subject!==null&&(this._write(this._inDefaultGraph?`.
`:`
}
`),this._subject=null),this._write=this._blockedWrite;let r=e&&((n,o)=>{r=null,e(n,o)});if(this._endStream)try{return this._outputStream.end(r)}catch{}r&&r()}}function Ya(t){let e=Q0[t];return e===void 0&&(t.length===1?(e=t.charCodeAt(0).toString(16),e="\\u0000".substr(0,6-e.length)+e):(e=((t.charCodeAt(0)-55296)*1024+t.charCodeAt(1)+9216).toString(16),e="\\U00000000".substr(0,10-e.length)+e)),e}const As=Symbol("iter");function zn(t,e,r=4){if(r===0)return Object.assign(t,e);for(const n in e)t[n]=zn(t[n]||Object.create(null),e[n],r-1);return t}function tl(t,e,r=4){let n=!1;for(const o in t)if(o in e){const c=r===0?null:tl(t[o],e[o],r-1);if(c!==!1)n=n||Object.create(null),n[o]=c;else if(r===3)return!1}return n}function rl(t,e,r=4){let n=!1;for(const o in t)if(!(o in e))n=n||Object.create(null),n[o]=r===0?null:zn({},t[o],r-1);else if(r!==0){const c=rl(t[o],e[o],r-1);if(c!==!1)n=n||Object.create(null),n[o]=c;else if(r===3)return!1}return n}class Y0{constructor(e={}){this._id=1,this._ids=Object.create(null),this._ids[""]=1,this._entities=Object.create(null),this._entities[1]="",this._blankNodeIndex=0,this._factory=e.factory||_t}_termFromId(e){if(e[0]==="."){const r=this._entities,n=e.split(".");return this._factory.quad(this._termFromId(r[n[1]]),this._termFromId(r[n[2]]),this._termFromId(r[n[3]]),n[4]&&this._termFromId(r[n[4]]))}return Wn(e,this._factory)}_termToNumericId(e){if(e.termType==="Quad"){const r=this._termToNumericId(e.subject),n=this._termToNumericId(e.predicate),o=this._termToNumericId(e.object);let c;return r&&n&&o&&(Qs(e.graph)||(c=this._termToNumericId(e.graph)))&&this._ids[c?`.${r}.${n}.${o}.${c}`:`.${r}.${n}.${o}`]}return this._ids[fn(e)]}_termToNewNumericId(e){const r=e&&e.termType==="Quad"?`.${this._termToNewNumericId(e.subject)}.${this._termToNewNumericId(e.predicate)}.${this._termToNewNumericId(e.object)}${Qs(e.graph)?"":`.${this._termToNewNumericId(e.graph)}`}`:fn(e);return this._ids[r]||(this._ids[this._entities[++this._id]=r]=this._id)}createBlankNode(e){let r,n;if(e)for(r=e=`_:${e}`,n=1;this._ids[r];)r=e+n++;else do r=`_:b${this._blankNodeIndex++}`;while(this._ids[r]);return this._ids[r]=++this._id,this._entities[this._id]=r,this._factory.blankNode(r.substr(2))}}class Kt{constructor(e,r){this._size=0,this._graphs=Object.create(null),!r&&e&&!e[0]&&typeof e.match!="function"&&(r=e,e=null),r=r||{},this._factory=r.factory||_t,this._entityIndex=r.entityIndex||new Y0({factory:this._factory}),this._entities=this._entityIndex._entities,this._termFromId=this._entityIndex._termFromId.bind(this._entityIndex),this._termToNumericId=this._entityIndex._termToNumericId.bind(this._entityIndex),this._termToNewNumericId=this._entityIndex._termToNewNumericId.bind(this._entityIndex),e&&this.addAll(e)}get size(){let e=this._size;if(e!==null)return e;e=0;const r=this._graphs;let n,o;for(const c in r)for(const u in n=r[c].subjects)for(const l in o=n[u])e+=Object.keys(o[l]).length;return this._size=e}_addToIndex(e,r,n,o){const c=e[r]||(e[r]={}),u=c[n]||(c[n]={}),l=o in u;return l||(u[o]=null),!l}_removeFromIndex(e,r,n,o){const c=e[r],u=c[n];delete u[o];for(const l in u)return;delete c[n];for(const l in c)return;delete e[r]}*_findInIndex(e,r,n,o,c,u,l,g){let f,h,p;const v=this._entities,x=this._termFromId(v[g]),F={subject:null,predicate:null,object:null};r&&((f=e,e={})[r]=f[r]);for(const I in e)if(h=e[I]){F[c]=this._termFromId(v[I]),n&&((f=h,h={})[n]=f[n]);for(const R in h)if(p=h[R]){F[u]=this._termFromId(v[R]);const C=o?o in p?[o]:[]:Object.keys(p);for(let L=0;L<C.length;L++)F[l]=this._termFromId(v[C[L]]),yield this._factory.quad(F.subject,F.predicate,F.object,x)}}}_loop(e,r){for(const n in e)r(n)}_loopByKey0(e,r,n){let o,c;if(o=e[r])for(c in o)n(c)}_loopByKey1(e,r,n){let o,c;for(o in e)c=e[o],c[r]&&n(o)}_loopBy2Keys(e,r,n,o){let c,u,l;if((c=e[r])&&(u=c[n]))for(l in u)o(l)}_countInIndex(e,r,n,o){let c=0,u,l,g;r&&((u=e,e={})[r]=u[r]);for(const f in e)if(l=e[f]){n&&((u=l,l={})[n]=u[n]);for(const h in l)(g=l[h])&&(o?o in g&&c++:c+=Object.keys(g).length)}return c}_getGraphs(e){return e=e===""?1:e&&(this._termToNumericId(e)||-1),typeof e!="number"?this._graphs:{[e]:this._graphs[e]}}_uniqueEntities(e){const r=Object.create(null);return n=>{n in r||(r[n]=!0,e(this._termFromId(this._entities[n],this._factory)))}}add(e){return this.addQuad(e),this}addQuad(e,r,n,o){r||(o=e.graph,n=e.object,r=e.predicate,e=e.subject),o=o?this._termToNewNumericId(o):1;let c=this._graphs[o];return c||(c=this._graphs[o]={subjects:{},predicates:{},objects:{}},Object.freeze(c)),e=this._termToNewNumericId(e),r=this._termToNewNumericId(r),n=this._termToNewNumericId(n),this._addToIndex(c.subjects,e,r,n)?(this._addToIndex(c.predicates,r,n,e),this._addToIndex(c.objects,n,e,r),this._size=null,!0):!1}addQuads(e){for(let r=0;r<e.length;r++)this.addQuad(e[r])}delete(e){return this.removeQuad(e),this}has(e,r,n,o){return e&&e.subject&&({subject:e,predicate:r,object:n,graph:o}=e),!this.readQuads(e,r,n,o).next().done}import(e){return e.on("data",r=>{this.addQuad(r)}),e}removeQuad(e,r,n,o){r||({subject:e,predicate:r,object:n,graph:o}=e),o=o?this._termToNumericId(o):1;const c=this._graphs;let u,l,g;if(!(e=e&&this._termToNumericId(e))||!(r=r&&this._termToNumericId(r))||!(n=n&&this._termToNumericId(n))||!(u=c[o])||!(l=u.subjects[e])||!(g=l[r])||!(n in g))return!1;this._removeFromIndex(u.subjects,e,r,n),this._removeFromIndex(u.predicates,r,n,e),this._removeFromIndex(u.objects,n,e,r),this._size!==null&&this._size--;for(e in u.subjects)return!0;return delete c[o],!0}removeQuads(e){for(let r=0;r<e.length;r++)this.removeQuad(e[r])}remove(e){return e.on("data",r=>{this.removeQuad(r)}),e}removeMatches(e,r,n,o){const c=new Kc.Readable({objectMode:!0}),u=this.readQuads(e,r,n,o);return c._read=l=>{for(;--l>=0;){const{done:g,value:f}=u.next();if(g){c.push(null);return}c.push(f)}},this.remove(c)}deleteGraph(e){return this.removeMatches(null,null,null,e)}getQuads(e,r,n,o){return[...this.readQuads(e,r,n,o)]}*readQuads(e,r,n,o){const c=this._getGraphs(o);let u,l,g,f;if(!(e&&!(l=this._termToNumericId(e))||r&&!(g=this._termToNumericId(r))||n&&!(f=this._termToNumericId(n))))for(const h in c)(u=c[h])&&(l?f?yield*this._findInIndex(u.objects,f,l,g,"object","subject","predicate",h):yield*this._findInIndex(u.subjects,l,g,null,"subject","predicate","object",h):g?yield*this._findInIndex(u.predicates,g,f,null,"predicate","object","subject",h):f?yield*this._findInIndex(u.objects,f,null,null,"object","subject","predicate",h):yield*this._findInIndex(u.subjects,null,null,null,"subject","predicate","object",h))}match(e,r,n,o){return new Rr(this,e,r,n,o,{entityIndex:this._entityIndex})}countQuads(e,r,n,o){const c=this._getGraphs(o);let u=0,l,g,f,h;if(e&&!(g=this._termToNumericId(e))||r&&!(f=this._termToNumericId(r))||n&&!(h=this._termToNumericId(n)))return 0;for(const p in c)(l=c[p])&&(e?n?u+=this._countInIndex(l.objects,h,g,f):u+=this._countInIndex(l.subjects,g,f,h):r?u+=this._countInIndex(l.predicates,f,h,g):u+=this._countInIndex(l.objects,h,g,f));return u}forEach(e,r,n,o,c){this.some(u=>(e(u,this),!1),r,n,o,c)}every(e,r,n,o,c){return!this.some(u=>!e(u,this),r,n,o,c)}some(e,r,n,o,c){for(const u of this.readQuads(r,n,o,c))if(e(u,this))return!0;return!1}getSubjects(e,r,n){const o=[];return this.forSubjects(c=>{o.push(c)},e,r,n),o}forSubjects(e,r,n,o){const c=this._getGraphs(o);let u,l,g;if(e=this._uniqueEntities(e),!(r&&!(l=this._termToNumericId(r))||n&&!(g=this._termToNumericId(n))))for(o in c)(u=c[o])&&(l?g?this._loopBy2Keys(u.predicates,l,g,e):this._loopByKey1(u.subjects,l,e):g?this._loopByKey0(u.objects,g,e):this._loop(u.subjects,e))}getPredicates(e,r,n){const o=[];return this.forPredicates(c=>{o.push(c)},e,r,n),o}forPredicates(e,r,n,o){const c=this._getGraphs(o);let u,l,g;if(e=this._uniqueEntities(e),!(r&&!(l=this._termToNumericId(r))||n&&!(g=this._termToNumericId(n))))for(o in c)(u=c[o])&&(l?g?this._loopBy2Keys(u.objects,g,l,e):this._loopByKey0(u.subjects,l,e):g?this._loopByKey1(u.predicates,g,e):this._loop(u.predicates,e))}getObjects(e,r,n){const o=[];return this.forObjects(c=>{o.push(c)},e,r,n),o}forObjects(e,r,n,o){const c=this._getGraphs(o);let u,l,g;if(e=this._uniqueEntities(e),!(r&&!(l=this._termToNumericId(r))||n&&!(g=this._termToNumericId(n))))for(o in c)(u=c[o])&&(l?g?this._loopBy2Keys(u.subjects,l,g,e):this._loopByKey1(u.objects,l,e):g?this._loopByKey0(u.predicates,g,e):this._loop(u.objects,e))}getGraphs(e,r,n){const o=[];return this.forGraphs(c=>{o.push(c)},e,r,n),o}forGraphs(e,r,n,o){for(const c in this._graphs)this.some(u=>(e(u.graph),!0),r,n,o,this._termFromId(this._entities[c]))}createBlankNode(e){return this._entityIndex.createBlankNode(e)}extractLists({remove:e=!1,ignoreErrors:r=!1}={}){const n={},o=r?()=>!0:(l,g)=>{throw new Error(`${l.value} ${g}`)},c=this.getQuads(null,Nt.rdf.rest,Nt.rdf.nil,null),u=e?[...c]:[];return c.forEach(l=>{const g=[];let f=!1,h,p;const v=l.graph;let x=l.subject;for(;x&&!f;){const F=this.getQuads(null,null,x,null),I=this.getQuads(x,null,null,null);let R,C=null,L=null,N=null;for(let O=0;O<I.length&&!f;O++)R=I[O],R.graph.equals(v)?h?f=o(x,"has non-list arcs out"):R.predicate.value===Nt.rdf.first?C?f=o(x,"has multiple rdf:first arcs"):u.push(C=R):R.predicate.value===Nt.rdf.rest?L?f=o(x,"has multiple rdf:rest arcs"):u.push(L=R):F.length?f=o(x,"can't be subject and object"):(h=R,p="subject"):f=o(x,"not confined to single graph");for(let O=0;O<F.length&&!f;++O)R=F[O],h?f=o(x,"can't have coreferences"):R.predicate.value===Nt.rdf.rest?N?f=o(x,"has incoming rdf:rest arcs"):N=R:(h=R,p="object");C?g.unshift(C.object):f=o(x,"has no list head"),x=N&&N.subject}f?e=!1:h&&(n[h[p].value]=g)}),e&&this.removeQuads(u),n}addAll(e){if(e instanceof Rr&&(e=e.filtered),Array.isArray(e))this.addQuads(e);else if(e instanceof Kt&&e._entityIndex===this._entityIndex)e._size!==0&&(this._graphs=zn(this._graphs,e._graphs),this._size=null);else for(const r of e)this.add(r);return this}contains(e){if(e instanceof Rr&&(e=e.filtered),e===this)return!0;if(!(e instanceof Kt)||this._entityIndex!==e._entityIndex)return e.every(f=>this.has(f));const r=this._graphs,n=e._graphs;let o,c,u,l,g;for(const f in n){if(!(o=r[f]))return!1;o=o.subjects;for(const h in c=n[f].subjects){if(!(u=o[h]))return!1;for(const p in l=c[h]){if(!(g=u[p]))return!1;for(const v in l[p])if(!(v in g))return!1}}}return!0}deleteMatches(e,r,n,o){for(const c of this.match(e,r,n,o))this.removeQuad(c);return this}difference(e){if(e&&e instanceof Rr&&(e=e.filtered),e===this)return new Kt({entityIndex:this._entityIndex});if(e instanceof Kt&&e._entityIndex===this._entityIndex){const r=new Kt({entityIndex:this._entityIndex}),n=rl(this._graphs,e._graphs);return n&&(r._graphs=n,r._size=null),r}return this.filter(r=>!e.has(r))}equals(e){return e instanceof Rr&&(e=e.filtered),e===this||this.size===e.size&&this.contains(e)}filter(e){const r=new Kt({entityIndex:this._entityIndex});for(const n of this)e(n,this)&&r.add(n);return r}intersection(e){if(e instanceof Rr&&(e=e.filtered),e===this){const r=new Kt({entityIndex:this._entityIndex});return r._graphs=zn(Object.create(null),this._graphs),r._size=this._size,r}else if(e instanceof Kt&&this._entityIndex===e._entityIndex){const r=new Kt({entityIndex:this._entityIndex}),n=tl(e._graphs,this._graphs);return n&&(r._graphs=n,r._size=null),r}return this.filter(r=>e.has(r))}map(e){const r=new Kt({entityIndex:this._entityIndex});for(const n of this)r.add(e(n,this));return r}reduce(e,r){const n=this.readQuads();let o=r===void 0?n.next().value:r;for(const c of n)o=e(o,c,this);return o}toArray(){return this.getQuads()}toCanonical(){throw new Error("not implemented")}toStream(){return this.match()}toString(){return new Fo().quadsToString(this)}union(e){const r=new Kt({entityIndex:this._entityIndex});return r._graphs=zn(Object.create(null),this._graphs),r._size=this._size,r.addAll(e),r}*[Symbol.iterator](){yield*this.readQuads()}}function ar(t,e,r=0){const n=e[r];if(n&&!(n in t))return!1;let o=!1;for(const c in n?{[n]:t[n]}:t){const u=r===2?null:ar(t[c],e,r+1);u!==!1&&(o=o||Object.create(null),o[c]=u)}return o}class Rr extends Kc.Readable{constructor(e,r,n,o,c,u){super({objectMode:!0}),Object.assign(this,{n3Store:e,subject:r,predicate:n,object:o,graph:c,options:u})}get filtered(){if(!this._filtered){const{n3Store:e,graph:r,object:n,predicate:o,subject:c}=this,u=this._filtered=new Kt({factory:e._factory,entityIndex:this.options.entityIndex});let l,g,f;if(c&&!(l=u._termToNumericId(c))||o&&!(g=u._termToNumericId(o))||n&&!(f=u._termToNumericId(n)))return u;const h=e._getGraphs(r);for(const p in h){let v,x,F,I;(I=h[p])&&(!l&&g?(x=ar(I.predicates,[g,f,l]))&&(v=ar(I.subjects,[l,g,f]),F=ar(I.objects,[f,l,g])):f?(F=ar(I.objects,[f,l,g]))&&(v=ar(I.subjects,[l,g,f]),x=ar(I.predicates,[g,f,l])):(v=ar(I.subjects,[l,g,f]))&&(x=ar(I.predicates,[g,f,l]),F=ar(I.objects,[f,l,g])),v&&(u._graphs[p]={subjects:v,predicates:x,objects:F}))}u._size=null}return this._filtered}get size(){return this.filtered.size}_read(e){e>0&&!this[As]&&(this[As]=this[Symbol.iterator]());const r=this[As];for(;--e>=0;){const{done:n,value:o}=r.next();if(n){this.push(null);return}this.push(o)}}addAll(e){return this.filtered.addAll(e)}contains(e){return this.filtered.contains(e)}deleteMatches(e,r,n,o){return this.filtered.deleteMatches(e,r,n,o)}difference(e){return this.filtered.difference(e)}equals(e){return this.filtered.equals(e)}every(e,r,n,o,c){return this.filtered.every(e,r,n,o,c)}filter(e){return this.filtered.filter(e)}forEach(e,r,n,o,c){return this.filtered.forEach(e,r,n,o,c)}import(e){return this.filtered.import(e)}intersection(e){return this.filtered.intersection(e)}map(e){return this.filtered.map(e)}some(e,r,n,o,c){return this.filtered.some(e,r,n,o,c)}toCanonical(){return this.filtered.toCanonical()}toStream(){return this._filtered?this._filtered.toStream():this.n3Store.match(this.subject,this.predicate,this.object,this.graph)}union(e){return this._filtered?this._filtered.union(e):this.n3Store.match(this.subject,this.predicate,this.object,this.graph).addAll(e)}toArray(){return this._filtered?this._filtered.toArray():this.n3Store.getQuads(this.subject,this.predicate,this.object,this.graph)}reduce(e,r){return this.filtered.reduce(e,r)}toString(){return new Fo().quadsToString(this)}add(e){return this.filtered.add(e)}delete(e){return this.filtered.delete(e)}has(e){return this.filtered.has(e)}match(e,r,n,o){return new Rr(this.filtered,e,r,n,o,this.options)}*[Symbol.iterator](){yield*this._filtered||this.n3Store.readQuads(this.subject,this.predicate,this.object,this.graph)}}const X0=()=>{const t=[],e=[],r=[];return{onQuad:n=>{t.push(n)},onError:n=>{r.push(n)},onComplete:n=>{e.push(n)},parse:(n,o)=>{Z0(Xt(o)).parse(n,(c,u)=>{c?r.forEach(l=>l(c)):u?t.forEach(l=>l(u)):e.forEach(l=>l())})}}};function Z0(t){return new Zc({format:"text/turtle",baseIRI:t})}async function Ys(t,e){const r="text/turtle",n=new Fo({format:r,prefixes:e==null?void 0:e.prefixes}),o=t.map(l=>_t.quad(l.subject,l.predicate,l.object,void 0));return n.addQuads(o),await new Promise((l,g)=>{n.end((f,h)=>{f?g(f):l(h)})})}const Ii="https://inrupt.com/.well-known/sdk-local-node/",{freeze:be}=Object;function Pr(t){return t.substring(0,Ii.length)===Ii}function Er(t){return t.substring(Ii.length)}function ey(t){return`${Ii}${t}`}function Vi(t){return typeof t=="string"&&t.substring(0,2)==="_:"}function Ao(t){return t.substring(2)}function nl(t){return`_:${t.value}`}const ft={boolean:"http://www.w3.org/2001/XMLSchema#boolean",dateTime:"http://www.w3.org/2001/XMLSchema#dateTime",date:"http://www.w3.org/2001/XMLSchema#date",time:"http://www.w3.org/2001/XMLSchema#time",decimal:"http://www.w3.org/2001/XMLSchema#decimal",integer:"http://www.w3.org/2001/XMLSchema#integer",string:"http://www.w3.org/2001/XMLSchema#string",langString:"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"};function ty(t){return t?"true":"false"}function il(t){return t==="true"||t==="1"?!0:t==="false"||t==="0"?!1:null}function ry(t){let e,r;if(t.millisecond&&(t.millisecond<10?e=`00${t.millisecond}`:t.millisecond<100?e=`0${t.millisecond}`:e=t.millisecond),typeof t.timezoneHourOffset=="number"){const n=Math.abs(t.timezoneHourOffset)<10?`0${Math.abs(t.timezoneHourOffset)}`:Math.abs(t.timezoneHourOffset);r=t.timezoneHourOffset>=0?`+${n}`:`-${n}`,t.timezoneMinuteOffset?r=`${r}:${t.timezoneMinuteOffset<10?`0${t.timezoneMinuteOffset}`:t.timezoneMinuteOffset}`:r+=":00"}return`${t.hour<10?`0${t.hour}`:t.hour}:${t.minute<10?`0${t.minute}`:t.minute}:${t.second<10?`0${t.second}`:t.second}${t.millisecond?`.${e}`:""}${r||""}`}function ny(t){if(!/\d\d:\d\d:\d\d(\.\d+)?(Z|(\+|-)\d\d:\d\d)?/.test(t))return null;const[r,n]=Io(t),[o,c,u]=r.split(":");let l=Number.parseInt(o,10),g=Number.parseInt(c,10);const[f,h]=u.split("."),p=Number.parseInt(f,10),v=h?Number.parseInt(h,10):void 0;g>=60&&(l+=1,g-=60);const x={hour:l,minute:g,second:p};if(typeof v=="number"&&(x.millisecond=v),typeof n=="string"){const[F,I]=ol(n);if(typeof F!="number"||F>24||typeof I!="number"||I>59)return null;x.timezoneHourOffset=F,x.timezoneMinuteOffset=I}return x}function iy(t){return t.toISOString()}function sl(t){if(!/-?\d{4,}-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+)?(Z|(\+|-)\d\d:\d\d)?/.test(t))return null;const[r,n]=t.split("T"),[o,c]=r.charAt(0)==="-"?[-1,r.substring(1)]:[1,r],[u,l,g]=c.split("-"),f=Number.parseInt(u,10)*o,h=Number.parseInt(l,10)-1,p=Number.parseInt(g,10),[v,x]=Io(n),[F,I]=typeof x=="string"?ol(x):[0,0],[R,C,L]=v.split(":"),N=Number.parseInt(R,10)+F,O=Number.parseInt(C,10)+I,[Y,Q]=L.split("."),W=Number.parseInt(Y,10),fe=Q?Number.parseInt(Q,10):0,de=new Date(Date.UTC(f,h,p,N,O,W,fe));return f>=0&&f<100&&de.setUTCFullYear(de.getUTCFullYear()-1900),de}function sy(t){const e=t.getFullYear(),r=t.getMonth()+1,n=t.getDate(),[,o]=Io(t.toISOString());return`${e}-${String(r).padStart(2,"0")}-${String(n).padStart(2,"0")}${o}`}function oy(t){if(!/-?\d{4,}-\d\d-\d\d(Z|(\+|-)\d\d:\d\d)?/.test(t))return null;const r=t,[n,o]=r.charAt(0)==="-"?[-1,r.substring(1)]:[1,r],[c,u,l]=o.split("-"),g=l.length>2?l.substring(0,2):l,f=Number.parseInt(c,10)*n,h=Number.parseInt(u,10)-1,p=Number.parseInt(g,10),v=12,x=new Date(Date.UTC(f,h,p,v));return f>=0&&f<100&&x.setUTCFullYear(x.getUTCFullYear()-1900),x}function Io(t){if(t.endsWith("Z"))return[t.substring(0,t.length-1),"Z"];const e=t.split("+"),r=t.split("-");return e.length===1&&r.length===1?[e[0],void 0]:e.length>r.length?[e[0],`+${e[1]}`]:[r[0],`-${r[1]}`]}function ol(t){if(t==="Z")return[0,0];const e=t.charAt(0)==="+"?1:-1,[r,n]=t.substring(1).split(":"),o=Number.parseInt(r,10),c=Number.parseInt(n,10);return[o*e,c*e]}function ay(t){return t.toString()}function al(t){const e=Number.parseFloat(t);return Number.isNaN(e)?null:e}function uy(t){return t.toString()}function ul(t){const e=Number.parseInt(t,10);return Number.isNaN(e)?null:e}function Xs(t){return t.toLowerCase()}function Jt(t){return cl(t)&&t.termType==="NamedNode"}function cy(t){return cl(t)&&t.termType==="Literal"}function cl(t){return t!==null&&typeof t=="object"&&typeof t.termType=="string"&&typeof t.value=="string"&&typeof t.equals=="function"}function Xa(t){return Jt(t)&&Pr(t.value)}function At(t){const e=pt(t);if(typeof URL!="function")return!0;try{return new URL(e),!0}catch{return!1}}function Za(t,e){return _t.namedNode(To(Er(t.value),e))}function To(t,e){if(typeof URL!="function")throw new Error("The URL interface is not available, so an IRI cannot be determined.");const r=new URL(e);return r.hash=t,r.href}function ly(t,e){var r;if(!["NamedNode","DefaultGraph"].includes(e.graph.termType))throw new Error(`Cannot parse Quads with nodes of type [${e.graph.termType}] as their Graph node.`);const o=e.graph.termType==="DefaultGraph"?"default":e.graph.value,c=(r=t.graphs[o])!==null&&r!==void 0?r:{};return be({...t,graphs:be({...t.graphs,[o]:dy(c,e)})})}function dy(t,e){var r;if(!["NamedNode","BlankNode"].includes(e.subject.termType))throw new Error(`Cannot parse Quads with nodes of type [${e.subject.termType}] as their Subject node.`);const o=e.subject.termType==="BlankNode"?`_:${e.subject.value}`:e.subject.value,c=(r=t[o])!==null&&r!==void 0?r:{type:"Subject",url:o,predicates:{}};return be({...t,[o]:fy(c,e)})}function fy(t,e){return be({...t,predicates:hy(t.predicates,e)})}function hy(t,e){var r;if(!["NamedNode"].includes(e.predicate.termType))throw new Error(`Cannot parse Quads with nodes of type [${e.predicate.termType}] as their Predicate node.`);const o=e.predicate.value,c=(r=t[o])!==null&&r!==void 0?r:{};return be({...t,[o]:py(c,e)})}function py(t,e){var r,n,o,c,u,l,g,f;if(e.object.termType==="NamedNode"){const h=be([...(r=t.namedNodes)!==null&&r!==void 0?r:[],e.object.value]);return be({...t,namedNodes:h})}if(e.object.termType==="Literal"){if(e.object.datatype.value===ft.langString){const v=e.object.language.toLowerCase(),x=be([...(o=(n=t.langStrings)===null||n===void 0?void 0:n[v])!==null&&o!==void 0?o:[],e.object.value]),F=be({...(c=t.langStrings)!==null&&c!==void 0?c:{},[v]:x});return be({...t,langStrings:F})}const h=be([...(l=(u=t.literals)===null||u===void 0?void 0:u[e.object.datatype.value])!==null&&l!==void 0?l:[],e.object.value]),p=be({...(g=t.literals)!==null&&g!==void 0?g:{},[e.object.datatype.value]:h});return be({...t,literals:p})}if(e.object.termType==="BlankNode"){const h=be([...(f=t.blankNodes)!==null&&f!==void 0?f:[],nl(e.object)]);return be({...t,blankNodes:h})}throw new Error(`Objects of type [${e.object.termType}] are not supported.`)}function gy(t,e={}){var r;const n=[],o=(r=e.dataFactory)!==null&&r!==void 0?r:_t;return Object.keys(t.graphs).forEach(c=>{const u=t.graphs[c],l=c==="default"?o.defaultGraph():o.namedNode(c);Object.keys(u).forEach(g=>{const{predicates:f}=u[g],h=Vi(g)?o.blankNode(Ao(g)):o.namedNode(g);n.push(...Ti(f,h,l,e))})}),n}function Ti(t,e,r,n={}){var o;const c=[],u=(o=n.dataFactory)!==null&&o!==void 0?o:_t;return Object.keys(t).forEach(l=>{var g,f,h,p;const v=u.namedNode(l),x=(g=t[l].langStrings)!==null&&g!==void 0?g:{},F=(f=t[l].namedNodes)!==null&&f!==void 0?f:[],I=(h=t[l].literals)!==null&&h!==void 0?h:{},R=(p=t[l].blankNodes)!==null&&p!==void 0?p:[];Object.keys(I).forEach(N=>{const O=u.namedNode(N);I[N].forEach(Q=>{const W=u.literal(Q,O);c.push(u.quad(e,v,W,r))})}),Object.keys(x).forEach(N=>{x[N].forEach(Y=>{const Q=u.literal(Y,N);c.push(u.quad(e,v,Q,r))})}),F.forEach(N=>{const O=u.namedNode(N);c.push(u.quad(e,v,O,r))}),R.forEach(N=>{if(Vi(N)){const O=u.blankNode(Ao(N));c.push(u.quad(e,v,O,r))}else{const O=u.blankNode(),Y=u.quad(e,v,O,r),Q=Ti(N,O,r);c.push(Y),c.push(...Q)}})}),c}function yy(t){const e={graphs:{default:{}},type:"Dataset"};return Array.from(t).reduce((r,n)=>ly(r,n),e)}var Ct=[];for(var Is=0;Is<256;++Is)Ct.push((Is+256).toString(16).slice(1));function my(t,e=0){return(Ct[t[e+0]]+Ct[t[e+1]]+Ct[t[e+2]]+Ct[t[e+3]]+"-"+Ct[t[e+4]]+Ct[t[e+5]]+"-"+Ct[t[e+6]]+Ct[t[e+7]]+"-"+Ct[t[e+8]]+Ct[t[e+9]]+"-"+Ct[t[e+10]]+Ct[t[e+11]]+Ct[t[e+12]]+Ct[t[e+13]]+Ct[t[e+14]]+Ct[t[e+15]]).toLowerCase()}var hi,_y=new Uint8Array(16);function by(){if(!hi&&(hi=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!hi))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return hi(_y)}var wy=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const eu={randomUUID:wy};function vy(t,e,r){if(eu.randomUUID&&!t)return eu.randomUUID();t=t||{};var n=t.random||(t.rng||by)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,my(n)}function Zs(t){var e,r,n,o,c,u,l,g;if(Jt(t))return`<${t.value}> (URL)`;if(cy(t)){if(!Jt(t.datatype))return`[${t.value}] (RDF/JS Literal of unknown type)`;let f;switch(t.datatype.value){case ft.boolean:return f=(r=(e=il(t.value))===null||e===void 0?void 0:e.valueOf())!==null&&r!==void 0?r:`Invalid data: \`${t.value}\``,`${f} (boolean)`;case ft.dateTime:return f=(o=(n=sl(t.value))===null||n===void 0?void 0:n.toUTCString())!==null&&o!==void 0?o:`Invalid data: \`${t.value}\``,`${f} (datetime)`;case ft.decimal:return f=(u=(c=al(t.value))===null||c===void 0?void 0:c.toString())!==null&&u!==void 0?u:`Invalid data: \`${t.value}\``,`${f} (decimal)`;case ft.integer:return f=(g=(l=ul(t.value))===null||l===void 0?void 0:l.toString())!==null&&g!==void 0?g:`Invalid data: \`${t.value}\``,`${f} (integer)`;case ft.langString:return`"${t.value}" (${t.language} string)`;case ft.string:return`"${t.value}" (string)`;default:return`[${t.value}] (RDF/JS Literal of type: \`${t.datatype.value}\`)`}}return t.termType==="BlankNode"?`[${t.value}] (RDF/JS BlankNode)`:t.termType==="Quad"?"??? (nested RDF* Quad)":t.termType==="Variable"?`?${t.value} (RDF/JS Variable)`:t}function Ke(t){if(!wn(t))throw new Ly(t)}function Sy(t,e){const r=xn(t)?t.internal_changeLog:{additions:[],deletions:[]},[n,o]=e.filter(c=>!ll(c)).reduce(([c,u],l)=>typeof u.find(f=>f.equals(l))<"u"?[c,u.filter(f=>!f.equals(l))]:[c.concat(l),u],[r.additions,r.deletions]);return be({...t,internal_changeLog:{additions:n,deletions:o}})}function Ey(t,e){const r=xn(t)?t.internal_changeLog:{additions:[],deletions:[]},[n,o]=e.filter(c=>!ll(c)).reduce(([c,u],l)=>typeof c.find(f=>f.equals(l))<"u"?[c.filter(f=>!f.equals(l)),u]:[c,u.concat(l)],[r.additions,r.deletions]);return be({...t,internal_changeLog:{additions:n,deletions:o}})}function xy(t){return xn(t)?t:be({...t,internal_changeLog:{additions:[],deletions:[]}})}function ll(t){return t.subject.termType==="BlankNode"||t.object.termType==="BlankNode"}function Fy(t,e){var r,n,o;if(Ke(t),!At(e))throw new qt(e);const c=pt(e);return(o=(n=(r=t.predicates[c])===null||r===void 0?void 0:r.namedNodes)===null||n===void 0?void 0:n.map(u=>Pr(u)?`#${Er(u)}`:u))!==null&&o!==void 0?o:[]}const Ay=Fy;function Iy(t,e){return Ay(t,e).map(n=>_t.namedNode(n))}function Ty(t,e){var r,n,o,c;if(Ke(t),!At(e))throw new qt(e);const u=pt(e);let l=[];const g=(n=(r=t.predicates[u])===null||r===void 0?void 0:r.langStrings)!==null&&n!==void 0?n:{},f=Object.keys(g);for(const v of f){const F=g[v].map(I=>_t.literal(I,v));l=l.concat(F)}const h=(c=(o=t.predicates[u])===null||o===void 0?void 0:o.literals)!==null&&c!==void 0?c:{},p=Object.keys(h);for(const v of p){const x=h[v],F=_t.namedNode(v),I=x.map(R=>_t.literal(R,F));l=l.concat(I)}return l}function Ry(t,e){var r,n;Ke(t);const o=Iy(t,e),c=Ty(t,e),u=pt(e),g=((n=(r=t.predicates[u])===null||r===void 0?void 0:r.blankNodes)!==null&&n!==void 0?n:[]).map(h=>{const p=Vi(h)?Ao(h):void 0;return _t.blankNode(p)});return o.concat(c).concat(g)}function Py(t,e={acceptBlankNodes:!1}){var r;const n=typeof e.scope<"u"?pt(e.scope):"default",o=(r=t.graphs[n])!==null&&r!==void 0?r:{};return Object.values(o).filter(c=>!Vi(c.url)||e.acceptBlankNodes)}function ky(t,e){var r;const n=qi(e)&&R0(t)?To(Er(e.url),Xt(t)):e.url,o=t.graphs.default,c=be({...o,[n]:be({...e,url:n})}),u=be({...t.graphs,default:c}),l=_t.namedNode(n),g=(r=t.graphs.default[n])===null||r===void 0?void 0:r.predicates,f=typeof g<"u"?Ti(g,l,_t.defaultGraph()):[],h=Ti(e.predicates,l,_t.defaultGraph());return Sy(Ey(be({...t,graphs:u}),f),h)}function eo(t={}){var e;if(typeof t.url<"u"){const{url:c}=t;if(!At(c))throw new Dy(c);return be({type:"Subject",predicates:be({}),url:c})}const r=(e=t.name)!==null&&e!==void 0?e:Uy(),n=ey(r);return be({type:"Subject",predicates:be({}),url:n})}function wn(t){return typeof t=="object"&&t!==null&&typeof t.type=="string"&&t.type==="Subject"}function Cy(t,e){if(qi(t)){if(typeof e>"u")throw new Error("The URL of a Thing that has not been persisted cannot be determined without a base URL.");return To(Er(t.url),e)}return t.url}const dl=Cy;function Ny(t){let e="";qi(t)?e+=`## Thing (no URL yet  identifier: \`#${Er(t.url)}\`)
`:e+=`## Thing: ${t.url}
`;const r=Object.keys(t.predicates);if(r.length===0)e+=`
<empty>
`;else for(const n of r){e+=`
Property: ${n}
`;const o=Ry(t,n);e+=o.reduce((c,u)=>`${c}- ${Zs(u)}
`,"")}return e}function qi(t){return Pr(t.url)}class Ly extends ni{constructor(e){const r=`Expected a Thing, but received: [${e}].`;super(r),this.receivedValue=e}}class qt extends ni{constructor(e){const r=Jt(e)?e.value:e,n=`Expected a valid URL to identify a property, but received: [${r}].`;super(n),this.receivedProperty=r}}class Ro extends ni{constructor(e){const r=Jt(e)?e.value:e,n=`Expected a valid URL value, but received: [${r}].`;super(n),this.receivedValue=r}}class Dy extends ni{constructor(e){const r=Jt(e)?e.value:e,n=`Expected a valid URL to identify a Thing, but received: [${r}].`;super(n),this.receivedValue=r}}const Uy=()=>vy();function tu(t){const e=new URL(t);return e.hash="",e.href}function Oy(){return be({type:"Dataset",graphs:{default:{}}})}async function By(t,e={}){if(Ki(t)){const h=await t.clone().text();throw new Wi(`Fetching the SolidDataset at [${t.url}] failed: [${t.status}] [${t.statusText}] ${h}.`,t,h)}const r=N0(t),n={"text/turtle":X0(),...e.parsers},o=L0(r);if(o===null)throw new Error(`Could not determine the content type of the Resource at [${Xt(r)}].`);const c=o.split(";")[0],u=n[c];if(typeof u>"u")throw new Error(`The Resource at [${Xt(r)}] has a MIME type of [${c}], but the only parsers available are for the following MIME types: [${Object.keys(n).join(", ")}].`);const l=await t.text(),g=await new Promise((h,p)=>{const v=new Kt;u.onError(x=>{p(new Error(`Encountered an error parsing the Resource at [${Xt(r)}] with content type [${o}]: ${x}`))}),u.onQuad(x=>{v.add(x)}),u.onComplete(()=>{h(v)}),u.parse(l,r)}),f=be(yy(g));return be({...f,...r})}async function jy(t,e){var r,n;const o=Wc(pt(t)),c=Object.keys((r=e==null?void 0:e.parsers)!==null&&r!==void 0?r:{}),u=c.length>0?c.join(", "):"text/turtle",l=await((n=e==null?void 0:e.fetch)!==null&&n!==void 0?n:fetch)(o,{headers:{Accept:u}});if(Ki(l)){const f=await l.clone().text();throw new Wi(`Fetching the Resource at [${o}] failed: [${l.status}] [${l.statusText}] ${f}.`,l,f)}return await By(l,e)}async function My(t){const e=t.internal_changeLog.deletions.length>0?`DELETE DATA {${(await Ys(t.internal_changeLog.deletions.map(to))).trim()}};`:"",r=t.internal_changeLog.additions.length>0?`INSERT DATA {${(await Ys(t.internal_changeLog.additions.map(to))).trim()}};`:"";return{method:"PATCH",body:`${e} ${r}`,headers:{"Content-Type":"application/sparql-update"}}}async function Hy(t,e){return{method:"PUT",body:await Ys(gy(t).map(to),e),headers:{"Content-Type":"text/turtle","If-None-Match":"*",Link:`<${C0.Resource}>; rel="type"`}}}async function $y(t,e,r){var n;const o=Wc(pt(t)),c=xy(e),u=ru(c,o)?await My(c):await Hy(c,r),l=await((n=r==null?void 0:r.fetch)!==null&&n!==void 0?n:fetch)(o,u);if(Ki(l)){const p=ru(c,o)?`The changes that were sent to the Pod are listed below.

${Vy(c)}`:`The SolidDataset that was sent to the Pod is listed below.

${Wy(c)}`,v=await l.clone().text();throw new Wi(`Storing the Resource at [${o}] failed: [${l.status}] [${l.statusText}] ${v}.

${p}`,l,v)}const g={...Vc(l),isRawData:!1},f=be({...e,internal_changeLog:{additions:[],deletions:[]},internal_resourceInfo:g});return zy(f)}function Ky(t,e){return tu(t.internal_resourceInfo.sourceIri)===tu(e)}function ru(t,e){return xn(t)&&$i(t)&&typeof t.internal_resourceInfo.sourceIri=="string"&&Ky(t,e)}function Wy(t){let e="";$i(t)?e+=`# SolidDataset: ${Xt(t)}
`:e+=`# SolidDataset (no URL yet)
`;const r=Py(t);return r.length===0?e+=`
<empty>
`:r.forEach(n=>{e+=`
${Ny(n)}`,xn(t)&&(e+=`
${Jy(t,n)}
`)}),e}function Vy(t){if(!$i(t))return"This is a newly initialized SolidDataset, so there is no source to compare it to.";if(!xn(t)||t.internal_changeLog.additions.length===0&&t.internal_changeLog.deletions.length===0)return`## Changes compared to ${Xt(t)}

This SolidDataset has not been modified since it was fetched from ${Xt(t)}.
`;let e=`## Changes compared to ${Xt(t)}
`;const r=qy(t);return Object.keys(r).forEach(n=>{e+=`
### Thing: ${n}
`;const o=r[n];Object.keys(o).forEach(c=>{e+=`
Property: ${c}
`;const{deleted:u}=o[c],{added:l}=o[c];u.length>0&&(e+=`- Removed:
`,e+=u.reduce((g,f)=>`${g}  - ${Zs(f)}
`,"")),l.length>0&&(e+=`- Added:
`,e+=l.reduce((g,f)=>`${g}  - ${Zs(f)}
`,""))})}),e}function qy(t){const e=Object.create(null);return t.internal_changeLog.deletions.forEach(r=>{var n,o,c;const u=Xa(r.subject)?Za(r.subject,Xt(t)):r.subject;if(!Jt(u)||!Jt(r.predicate))return;const l=pt(u),g=pt(r.predicate);(n=e[l])!==null&&n!==void 0||(e[l]=Object.create(null)),(o=(c=e[l])[g])!==null&&o!==void 0||(c[g]={added:[],deleted:[]}),e[l][g].deleted.push(r.object)}),t.internal_changeLog.additions.forEach(r=>{var n,o,c;const u=Xa(r.subject)?Za(r.subject,Xt(t)):r.subject;if(!Jt(u)||!Jt(r.predicate))return;const l=pt(u),g=pt(r.predicate);(n=e[l])!==null&&n!==void 0||(e[l]=Object.create(null)),(o=(c=e[l])[g])!==null&&o!==void 0||(c[g]={added:[],deleted:[]}),e[l][g].added.push(r.object)}),e}function Jy(t,e){const r=_t.namedNode(e.url),n=t.internal_changeLog.additions.reduce((l,g)=>g.subject.equals(r)?l+1:l,0),o=t.internal_changeLog.deletions.reduce((l,g)=>g.subject.equals(r)?l+1:l,0),c=n===1?"1 new value added":`${n} new values added`,u=o===1?"1 value removed":`${o} values removed`;return`(${c} / ${u})`}function to(t){const e=Jt(t.subject)?nu(t.subject):t.subject,r=Jt(t.object)?nu(t.object):t.object;return _t.quad(e,t.predicate,r,t.graph)}function nu(t){return Pr(t.value)?_t.namedNode(`#${Er(t.value)}`):t}function zy(t){const e=Xt(t),r=t.graphs.default,o=Object.keys(r).reduce((u,l)=>{const g=Gy(u[l],e),f=Pr(l)?`${e}#${Er(l)}`:l,h={...u};return delete h[l],h[f]=g,be(h)},r),c=be({...t.graphs,default:o});return be({...t,graphs:c})}function Gy(t,e){const n=Object.keys(t.predicates).reduce((o,c)=>{var u;const l=(u=o[c].namedNodes)!==null&&u!==void 0?u:[];if(l.every(h=>!Pr(h)))return o;const g=be(l.map(h=>Pr(h)?`${e}#${Er(h)}`:h)),f=be({...o[c],namedNodes:g});return be({...o,[c]:f})},t.predicates);return be({...t,predicates:n,url:Pr(t.url)?`${e}#${Er(t.url)}`:t.url})}const Ji=(t,e,r)=>{var n,o;if(Ke(t),!At(e))throw new qt(e);if(!wn(r)&&!At(r))throw new Ro(r);const c=pt(e),u=(n=t.predicates[c])!==null&&n!==void 0?n:{},l=(o=u.namedNodes)!==null&&o!==void 0?o:[];let g;Jt(r)?g=r.value:typeof r=="string"?g=r:qi(r)?g=r.url:g=dl(r);const f=be(l.concat(pt(g))),h=be({...u,namedNodes:f}),p=be({...t.predicates,[c]:h});return be({...t,predicates:p})},Qy=Ji,fl=(t,e,r)=>(Ke(t),Cr(t,e,ty(r),ft.boolean)),hl=(t,e,r)=>(Ke(t),Cr(t,e,iy(r),ft.dateTime)),pl=(t,e,r)=>(Ke(t),Cr(t,e,sy(r),ft.date)),gl=(t,e,r)=>(Ke(t),Cr(t,e,ry(r),ft.time)),yl=(t,e,r)=>(Ke(t),Cr(t,e,ay(r),ft.decimal)),ml=(t,e,r)=>(Ke(t),Cr(t,e,uy(r),ft.integer));function Ri(t,e,r,n){var o,c,u;if(Ke(t),!At(e))throw new qt(e);const l=pt(e),g=Xs(n),f=(o=t.predicates[l])!==null&&o!==void 0?o:{},h=(c=f.langStrings)!==null&&c!==void 0?c:{},p=(u=h[g])!==null&&u!==void 0?u:[],v=be(p.concat(r)),x=be({...h,[g]:v}),F=be({...f,langStrings:x}),I=be({...t.predicates,[l]:F});return be({...t,predicates:I})}const _l=(t,e,r)=>(Ke(t),Cr(t,e,r,ft.string));function Po(t,e,r){return Ji(t,e,r.value)}function ko(t,e,r){if(Ke(t),!At(e))throw new qt(e);return r.datatype.value===ft.langString?Ri(t,e,r.value,r.language):Cr(t,e,r.value,r.datatype.value)}function bl(t,e,r){var n,o;if(r.termType==="NamedNode")return Po(t,e,r);if(r.termType==="Literal")return ko(t,e,r);if(r.termType==="BlankNode"){if(Ke(t),!At(e))throw new qt(e);const c=pt(e),u=(n=t.predicates[c])!==null&&n!==void 0?n:{},l=(o=u.blankNodes)!==null&&o!==void 0?o:[],g=be(l.concat(nl(r))),f=be({...u,blankNodes:g}),h=be({...t.predicates,[c]:f});return be({...t,predicates:h})}throw new Error(`Term type [${r.termType}] is not supported by @inrupt/solid-client.`)}function Cr(t,e,r,n){var o,c,u;if(Ke(t),!At(e))throw new qt(e);const l=pt(e),g=(o=t.predicates[l])!==null&&o!==void 0?o:{},f=(c=g.literals)!==null&&c!==void 0?c:{},h=(u=f[n])!==null&&u!==void 0?u:[],p=be(h.concat(r)),v=be({...f,[n]:p}),x=be({...g,literals:v}),F=be({...t.predicates,[l]:x});return be({...t,predicates:F})}function zt(t,e){if(Ke(t),!At(e))throw new qt(e);const r=pt(e),n={...t.predicates};return delete n[r],be({...t,predicates:be(n)})}const Co=(t,e,r)=>{var n,o,c;if(Ke(t),!At(e))throw new qt(e);const u=pt(e);if(!wn(r)&&!At(r))throw new Ro(r);const l=wn(r)?dl(r):pt(r),g=be((c=(o=(n=t.predicates[u])===null||n===void 0?void 0:n.namedNodes)===null||o===void 0?void 0:o.filter(p=>p.toLowerCase()!==l.toLowerCase()))!==null&&c!==void 0?c:[]),f=be({...t.predicates[u],namedNodes:g}),h=be({...t.predicates,[u]:f});return be({...t,predicates:h})},Yy=Co,Xy=(t,e,r)=>(Ke(t),Xr(t,e,ft.boolean,n=>il(n)===r)),Zy=(t,e,r)=>(Ke(t),Xr(t,e,ft.dateTime,n=>{var o;return((o=sl(n))===null||o===void 0?void 0:o.getTime())===r.getTime()})),em=(t,e,r)=>(Ke(t),Xr(t,e,ft.date,function(n){const o=oy(n);return o?o.getFullYear()===r.getFullYear()&&o.getMonth()===r.getMonth()&&o.getUTCDate()===r.getUTCDate():!1})),tm=(t,e,r)=>(Ke(t),Xr(t,e,ft.time,function(n){const o=ny(n);return o?o.hour===r.hour&&o.minute===r.minute&&o.second===r.second&&o.millisecond===r.millisecond&&o.timezoneHourOffset===r.timezoneHourOffset&&o.timezoneMinuteOffset===r.timezoneMinuteOffset:!1})),rm=(t,e,r)=>(Ke(t),Xr(t,e,ft.decimal,n=>al(n)===r)),nm=(t,e,r)=>(Ke(t),Xr(t,e,ft.integer,n=>ul(n)===r));function ro(t,e,r,n){var o,c;if(Ke(t),!At(e))throw new qt(e);const u=pt(e),l=(c=(o=t.predicates[u])===null||o===void 0?void 0:o.langStrings)!==null&&c!==void 0?c:{},g=Object.keys(l).find(F=>Xs(F)===Xs(n)&&Array.isArray(l[F])&&l[F].length>0);if(typeof g!="string")return t;const f=l[g],h=be(f.filter(F=>F!==r)),p=be({...l,[g]:h}),v=be({...t.predicates[u],langStrings:p}),x=be({...t.predicates,[u]:v});return be({...t,predicates:x})}const im=(t,e,r)=>(Ke(t),Xr(t,e,ft.string,n=>n===r));function sm(t,e,r){return Co(t,e,r.value)}function om(t,e,r){var n,o,c;if(Ke(t),!At(e))throw new qt(e);const u=r.datatype.value;if(u===ft.langString)return ro(t,e,r.value,r.language);const l=pt(e),g=(n=t.predicates[l])!==null&&n!==void 0?n:{},f=(o=g.literals)!==null&&o!==void 0?o:{},h=(c=f[u])!==null&&c!==void 0?c:[],p=be(h.filter(R=>R!==r.value)),v=be({...f,[u]:p}),x=be({...g,literals:v}),F=be({...t.predicates,[l]:x});return be({...t,predicates:F})}function Xr(t,e,r,n){var o,c,u;if(!At(e))throw new qt(e);const l=pt(e),g=(o=t.predicates[l])!==null&&o!==void 0?o:{},f=(c=g.literals)!==null&&c!==void 0?c:{},h=(u=f[r])!==null&&u!==void 0?u:[],p=be(h.filter(R=>!n(R))),v=be({...f,[r]:p}),x=be({...g,literals:v}),F=be({...t.predicates,[l]:x});return be({...t,predicates:F})}const wl=(t,e,r)=>{if(Ke(t),!At(e))throw new qt(e);if(!wn(r)&&!At(r))throw new Ro(r);return Ji(zt(t,e),e,r)},am=wl,um=(t,e,r)=>(Ke(t),fl(zt(t,e),e,r)),cm=(t,e,r)=>(Ke(t),hl(zt(t,e),e,r)),lm=(t,e,r)=>(Ke(t),pl(zt(t,e),e,r)),dm=(t,e,r)=>(Ke(t),gl(zt(t,e),e,r)),fm=(t,e,r)=>(Ke(t),yl(zt(t,e),e,r)),hm=(t,e,r)=>(Ke(t),ml(zt(t,e),e,r));function iu(t,e,r,n){return Ke(t),Ri(zt(t,e),e,r,n)}const pm=(t,e,r)=>(Ke(t),_l(zt(t,e),e,r));function gm(t,e,r){return Ke(t),Po(zt(t,e),e,r)}function ym(t,e,r){return Ke(t),ko(zt(t,e),e,r)}function mm(t,e,r){if(Ke(t),!At(e))throw new qt(e);return bl(zt(t,e),e,r)}function no(t=eo()){let e=wn(t)?t:eo(t);function r(u){return(l,g)=>(e=u(e,l,g),c)}function n(u){return(l,g)=>(e=u(e,l,g),c)}function o(u){return(l,g)=>(e=u(e,l,g),c)}const c={build:()=>e,addUrl:r(Ji),addIri:r(Qy),addBoolean:r(fl),addDatetime:r(hl),addDate:r(pl),addTime:r(gl),addDecimal:r(yl),addInteger:r(ml),addStringNoLocale:r(_l),addStringEnglish:(u,l)=>(e=Ri(e,u,l,"en"),c),addStringWithLocale:(u,l,g)=>(e=Ri(e,u,l,g),c),addNamedNode:r(Po),addLiteral:r(ko),addTerm:r(bl),setUrl:n(wl),setIri:n(am),setBoolean:n(um),setDatetime:n(cm),setDate:n(lm),setTime:n(dm),setDecimal:n(fm),setInteger:n(hm),setStringNoLocale:n(pm),setStringEnglish:(u,l)=>(e=iu(e,u,l,"en"),c),setStringWithLocale:(u,l,g)=>(e=iu(e,u,l,g),c),setNamedNode:n(gm),setLiteral:n(ym),setTerm:n(mm),removeAll:u=>(e=zt(e,u),c),removeUrl:o(Co),removeIri:o(Yy),removeBoolean:o(Xy),removeDatetime:o(Zy),removeDate:o(em),removeTime:o(tm),removeDecimal:o(rm),removeInteger:o(nm),removeStringNoLocale:o(im),removeStringEnglish:(u,l)=>no(ro(e,u,l,"en")),removeStringWithLocale:(u,l,g)=>no(ro(e,u,l,g)),removeNamedNode:o(sm),removeLiteral:o(om)};return c}const Gn={podUrl:"https://nono2357.solidweb.org/myapps/myquotes/myquotes.ttl",oidcIssuer:"https://solidweb.org",clientName:"MyQuotes App",appUrl:"https://nono2357.solidweb.org/myapps/myquotes/"},$r={schema:"http://schema.org/",rdfs:"http://www.w3.org/2000/01/rdf-schema#",dcterms:"http://purl.org/dc/terms/",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#"},je={loginBtn:document.getElementById("login-btn"),logoutBtn:document.getElementById("logout-btn"),userInfo:document.getElementById("user-info"),userName:document.getElementById("user-name"),quoteForm:document.getElementById("quote-form"),loginPrompt:document.getElementById("login-prompt"),statusMessage:document.getElementById("status-message"),quoteEn:document.getElementById("quote-en"),quoteFr:document.getElementById("quote-fr"),authorEn:document.getElementById("author-en"),authorFr:document.getElementById("author-fr"),wikidataSearch:document.getElementById("wikidata-search"),wikidataSuggestions:document.getElementById("wikidata-suggestions"),wikidataUri:document.getElementById("wikidata-uri"),selectedPerson:document.getElementById("selected-person"),selectedPersonName:document.getElementById("selected-person-name"),clearPerson:document.getElementById("clear-person"),submitBtn:document.getElementById("submit-btn")};let su=null,Ts=null;const _m="myquotes-session";function zi(){return Ts||(Ts=new rh({sessionId:_m})),Ts}async function bm(){try{const t=zi(),e=window.location.hostname==="nono2357.github.io",r=window.location.hostname==="localhost";let n;if(e)n="https://nono2357.github.io/myapps/myquotes/index.html";else{const c=new URL(window.location.href);c.search="",c.hash="",n=c.toString()}console.log("Login redirect URL:",n),console.log("OIDC Issuer:",Gn.oidcIssuer),console.log("Is production:",e),console.log("Is localhost:",r),console.log("Session ID:",t.info.sessionId);const o={oidcIssuer:Gn.oidcIssuer,redirectUrl:n,clientName:Gn.clientName};e?(o.clientId="https://nono2357.github.io/myapps/myquotes/clientid.jsonld",console.log("Using production client ID:",o.clientId)):console.log("Using Dynamic Client Registration (DCR) for local development"),await t.login(o)}catch(t){console.error("Login error:",t),dn("Login failed: "+t.message,"error")}}async function wm(){try{await zi().logout(),vi()}catch(t){console.error("Logout error:",t)}}function ou(t){je.loginBtn.classList.add("hidden"),je.userInfo.classList.remove("hidden"),je.userName.textContent=vm(t),je.quoteForm.classList.remove("hidden"),je.loginPrompt.classList.add("hidden")}function vi(){je.loginBtn.classList.remove("hidden"),je.userInfo.classList.add("hidden"),je.quoteForm.classList.add("hidden"),je.loginPrompt.classList.remove("hidden")}function vm(t){try{return new URL(t).hostname.split(".")[0]}catch{return"User"}}async function Sm(t){if(!t||t.length<2){Qn();return}try{const e=new URL("https://www.wikidata.org/w/api.php");e.searchParams.set("action","wbsearchentities"),e.searchParams.set("search",t),e.searchParams.set("type","item"),e.searchParams.set("language","en"),e.searchParams.set("uselang","en"),e.searchParams.set("limit","10"),e.searchParams.set("format","json"),e.searchParams.set("origin","*");const n=await(await fetch(e)).json();n.search&&n.search.length>0?Em(n.search):Qn()}catch(e){console.error("Wikidata search error:",e),Qn()}}function Em(t){je.wikidataSuggestions.innerHTML="",t.forEach(e=>{const r=document.createElement("div");r.className="suggestion-item",r.innerHTML=`
            <div class="name">${au(e.label||e.id)}</div>
            ${e.description?`<div class="description">${au(e.description)}</div>`:""}
            <div class="qid">${e.id}</div>
        `,r.addEventListener("click",()=>xm(e)),je.wikidataSuggestions.appendChild(r)}),je.wikidataSuggestions.classList.remove("hidden")}function Qn(){je.wikidataSuggestions.classList.add("hidden"),je.wikidataSuggestions.innerHTML=""}function xm(t){const e=`http://www.wikidata.org/entity/${t.id}`;je.wikidataUri.value=e,je.wikidataSearch.value="",je.selectedPersonName.textContent=`${t.label} (${t.id})`,je.selectedPerson.classList.remove("hidden"),Qn()}function vl(){je.wikidataUri.value="",je.selectedPerson.classList.add("hidden"),je.selectedPersonName.textContent=""}function au(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}async function Fm(t){t.preventDefault();const e=zi();if(!e.info.isLoggedIn){dn("Please login first","error");return}const r=je.quoteEn.value.trim(),n=je.quoteFr.value.trim(),o=je.authorEn.value.trim(),c=je.authorFr.value.trim(),u=je.wikidataUri.value.trim();if(!r&&!n){dn("Please enter at least one quote text (English or French)","error");return}dn("Saving quote...","loading"),je.submitBtn.disabled=!0;try{const l=`quote-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;let g=no(eo({name:l})).addUrl(`${$r.rdf}type`,`${$r.schema}Quotation`);r&&(g=g.addStringWithLocale(`${$r.rdfs}label`,r,"en")),n&&(g=g.addStringWithLocale(`${$r.rdfs}label`,n,"fr")),o&&(g=g.addStringWithLocale(`${$r.schema}author`,o,"en")),c&&(g=g.addStringWithLocale(`${$r.schema}author`,c,"fr")),u&&(g=g.addUrl(`${$r.dcterms}creator`,u));const f=g.build();let h;try{h=await jy(Gn.podUrl,{fetch:e.fetch})}catch(p){if(p.statusCode===404||p.message&&p.message.includes("404"))h=Oy();else throw p}h=ky(h,f),await $y(Gn.podUrl,h,{fetch:e.fetch}),dn("Quote saved successfully! ","success"),Am()}catch(l){console.error("Error saving quote:",l),dn("Error saving quote: "+l.message,"error")}finally{je.submitBtn.disabled=!1}}function Am(){je.quoteEn.value="",je.quoteFr.value="",je.authorEn.value="",je.authorFr.value="",vl()}function dn(t,e){je.statusMessage.textContent=t,je.statusMessage.className=`status-message ${e}`,je.statusMessage.classList.remove("hidden"),e==="success"&&setTimeout(()=>{je.statusMessage.classList.add("hidden")},5e3)}function Im(){je.loginBtn.addEventListener("click",bm),je.logoutBtn.addEventListener("click",wm),je.quoteForm.addEventListener("submit",Fm),je.wikidataSearch.addEventListener("input",t=>{clearTimeout(su),su=setTimeout(()=>{Sm(t.target.value)},300)}),document.addEventListener("click",t=>{!je.wikidataSearch.contains(t.target)&&!je.wikidataSuggestions.contains(t.target)&&Qn()}),je.clearPerson.addEventListener("click",vl)}async function Tm(){Im();const t=zi();t.events.on("login",()=>{console.log("Login event fired!"),ou(t.info.webId)}),t.events.on("logout",()=>{console.log("Logout event fired!"),vi()});try{console.log("Current URL:",window.location.href),console.log("Handling incoming redirect..."),console.log("Session ID:",t.info.sessionId);const r=new URLSearchParams(window.location.search).has("code");if(console.log("Has auth code in URL:",r),await t.handleIncomingRedirect(window.location.href),console.log("handleIncomingRedirect completed"),console.log("Session info:",JSON.stringify(t.info)),t.info.isLoggedIn){if(console.log("User is logged in:",t.info.webId),ou(t.info.webId),r){const n=window.location.origin+window.location.pathname;window.history.replaceState({},document.title,n)}}else console.log("User is not logged in"),vi()}catch(e){console.error("Session restore error:",e),vi()}}Tm();
